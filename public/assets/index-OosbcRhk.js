import{r as t,c as ie,j as e,I as W,i as He,L as ae,S as I,d as Ce,C as Te,e as Ve,f as fe,u as be,w as We,b as qe,E as De,a as $e,R as Ne,l as ke,g as de,h as Ue,k as me,m as Ge,n as ve,o as Ae,p as ze,q as Je,s as Xe,t as Re,v as Ke,x as he,y as _e,z as Be,A as Oe,B as je,D as ye,G as Se,H as Ye,J as Qe,K as Ee,M as Ze,N as es,O as ss,P as ts,Q as as,T as rs,U as ge,V as is,W as Le,X as ns,Y as ls,Z as os,_ as cs,$ as ds,a0 as Y,a1 as xs}from"./vendor-wvbi1EcI.js";import{B as z,E as ms}from"./examenes-laboratorio-crud-DStsTHPr.js";import{P as hs,a as us,S as ue}from"./paciente-list-CzYw-iNo.js";import{U as ps}from"./usuario-list-CuwNE_0O.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))d(h);new MutationObserver(h=>{for(const C of h)if(C.type==="childList")for(const y of C.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&d(y)}).observe(document,{childList:!0,subtree:!0});function r(h){const C={};return h.integrity&&(C.integrity=h.integrity),h.referrerPolicy&&(C.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?C.credentials="include":h.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function d(h){if(h.ep)return;h.ep=!0;const C=r(h);fetch(h.href,C)}})();function gs({onLogin:s}){const[i,r]=t.useState(""),[d,h]=t.useState(""),[C,y]=t.useState(""),[m,j]=t.useState(!1),[g,w]=t.useState(!1),v=ie(),l=()=>window.location.protocol!=="https:"&&window.location.hostname!=="localhost"?{isValid:!1,message:"⚠️ Conexión insegura detectada. Se requiere HTTPS para proteger tus credenciales."}:{isValid:!0},k=async L=>{L.preventDefault(),y(""),j(!0);const o=l();if(!o.isValid){y(o.message),j(!1);return}const p=i.includes("@")&&i.includes(".");try{if(p){let a,n;try{a=await fetch(z+"api_login_medico.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:i,password:d}),credentials:"include"}),n=await a.json()}catch{a={ok:!1},n={}}if(a.ok&&n.success){const _={...n.medico,rol:"medico"};sessionStorage.setItem("medico",JSON.stringify(_)),s&&s(_),v("/");return}let c,u;try{c=await fetch(z+"api_login.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({usuario:i,password:d}),credentials:"include"}),u=await c.json()}catch{c={ok:!1},u={}}if(c.ok&&u.success){sessionStorage.setItem("usuario",JSON.stringify(u.usuario)),s&&s(u.usuario),v("/");return}}else{let a,n;try{a=await fetch(z+"api_login.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({usuario:i,password:d}),credentials:"include"}),n=await a.json()}catch{a={ok:!1},n={}}if(a.ok&&n.success){sessionStorage.setItem("usuario",JSON.stringify(n.usuario)),s&&s(n.usuario),v("/");return}let c,u;try{c=await fetch(z+"api_login_medico.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:i,password:d}),credentials:"include"}),u=await c.json()}catch{c={ok:!1},u={}}if(c.ok&&u.success){const _={...u.medico,rol:"medico"};sessionStorage.setItem("medico",JSON.stringify(_)),s&&s(_),v("/");return}}y("Usuario o contraseña incorrectos")}catch{y("Error de conexión con el servidor")}finally{j(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-900 via-purple-800 to-indigo-900 flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-blue-400/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-80 h-80 bg-purple-400/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-3/4 left-1/2 w-64 h-64 bg-indigo-400/20 rounded-full blur-3xl"})]}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl border border-white/20 shadow-2xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"relative mx-auto w-20 h-20 mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full blur-lg opacity-60"}),e.jsx("img",{src:"/2demayo.svg",alt:"Logo clínica",className:"relative w-20 h-20 object-contain bg-white/90 rounded-full p-3 shadow-lg ring-4 ring-white/30"})]}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2 drop-shadow-lg",children:"Clínica 2 de Mayo"}),e.jsx("p",{className:"text-lg text-white/80",children:"Acceso al Sistema Médico"})]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(W,{iconName:"Contact",className:"text-xl text-white/60"})}),e.jsx("input",{type:"text",placeholder:"Usuario o email del médico",value:i,onChange:L=>r(L.target.value),className:"w-full bg-white/10 border border-white/20 rounded-2xl pl-12 pr-4 py-4 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:border-transparent backdrop-blur-sm transition-all duration-300",required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(W,{iconName:"Lock",className:"text-xl text-white/60"})}),e.jsx("input",{type:g?"text":"password",placeholder:"Contraseña",value:d,onChange:L=>h(L.target.value),className:"w-full bg-white/10 border border-white/20 rounded-2xl pl-12 pr-12 py-4 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:border-transparent backdrop-blur-sm transition-all duration-300",required:!0}),e.jsx("button",{type:"button",onClick:()=>w(!g),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-white/60 hover:text-white transition-colors",children:e.jsx(W,{iconName:g?"Hide":"RedEye",className:"text-xl"})})]}),e.jsxs("button",{type:"submit",disabled:m,className:"w-full bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 hover:from-blue-700 hover:via-purple-700 hover:to-indigo-800 text-white font-bold rounded-2xl py-4 px-6 shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-3 relative overflow-hidden",children:[m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Verificando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{iconName:"SignIn",className:"text-xl"}),e.jsx("span",{children:"Ingresar al Sistema"})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"})]}),C&&e.jsx("div",{className:"bg-red-500/20 backdrop-blur-sm border border-red-400/30 rounded-2xl p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-200",children:[e.jsx(W,{iconName:"ErrorBadge",className:"text-xl"}),e.jsx("span",{className:"font-medium",children:C})]})})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-white/60 text-sm",children:[e.jsx(W,{iconName:"Shield",className:"text-lg"}),e.jsx("span",{children:"Sistema Seguro y Confiable"})]})})]})})]})}function bs(){return e.jsx("footer",{className:"w-full bg-purple-800 py-4 border-t border-blue-500 shadow-inner",children:e.jsx("div",{className:"container mx-auto text-center",children:e.jsxs("span",{className:"text-white text-sm font-medium drop-shadow",children:["© ",new Date().getFullYear()," Clínica 2 de Mayo. Todos los derechos reservados."]})})})}He();function fs({open:s,onClose:i,onLogout:r,usuario:d}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed inset-0 z-40 bg-black bg-opacity-40 transition-opacity duration-200 md:hidden ${s?"block":"hidden"}`,onClick:i,"aria-hidden":"true"}),e.jsx("aside",{className:`fixed z-50 top-0 left-0 h-full w-64 bg-white border-r border-blue-500 shadow-lg transform transition-transform duration-200 ease-in-out
        ${s?"translate-x-0":"-translate-x-full"}
        md:translate-x-0 md:static md:flex md:flex-col md:z-10 md:h-auto md:shadow-none md:bg-white md:w-64`,children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsxs("div",{className:"flex flex-col items-center py-6 bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 text-white rounded-b-2xl mx-2 mb-4 shadow-lg",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-full blur-md"}),e.jsx("img",{src:"/2demayo.svg",alt:"Logo",className:"relative h-16 w-16 object-contain bg-white rounded-full p-2 shadow-lg ring-4 ring-white/30",onError:h=>{h.target.onerror=null,h.target.src="/logo.svg"}})]}),e.jsx("h5",{className:"text-lg font-bold text-white mt-3 text-center drop-shadow-lg",children:"Clínica 2 de Mayo"}),e.jsx("div",{className:"w-12 h-0.5 bg-white/30 rounded-full mt-2"})]}),e.jsx("nav",{className:"flex flex-col gap-3 px-4 flex-1 overflow-y-auto",children:d?.rol==="medico"?e.jsxs(e.Fragment,{children:[e.jsxs(ae,{to:"/mis-consultas",className:"py-2 px-3 rounded-lg text-indigo-700 hover:bg-indigo-100 font-medium flex items-center gap-2",onClick:i,children:[e.jsx(W,{iconName:"Contact",className:"text-xl"}),"Mis Consultas"]}),e.jsxs(ae,{to:"/panel-medico",className:"py-2 px-3 rounded-lg text-blue-700 hover:bg-blue-100 font-medium flex items-center gap-2",onClick:i,children:[e.jsx(W,{iconName:"Calendar",className:"text-xl"}),"Disponibilidad"]}),e.jsxs(ae,{to:"/historial-consultas",className:"py-2 px-3 rounded-lg text-blue-700 hover:bg-blue-100 font-medium flex items-center gap-2",onClick:i,children:[e.jsx(W,{iconName:"History",className:"text-xl"}),"Historial de consultas"]})]}):d?.rol==="enfermero"?e.jsx(e.Fragment,{children:e.jsx(ae,{to:"/panel-enfermero",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:i,children:"Panel Enfermería"})}):d?.rol==="laboratorista"?e.jsxs(e.Fragment,{children:[e.jsx(ae,{to:"/panel-laboratorio",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:i,children:"Panel Laboratorio"}),e.jsx(ae,{to:"/examenes-laboratorio",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:i,children:"Gestión de Exámenes"})]}):d?.rol==="químico"||d?.rol==="quimico"?e.jsxs(e.Fragment,{children:[e.jsx(ae,{to:"/medicamentos",className:"py-2 px-3 rounded-lg text-pink-700 hover:bg-pink-100 font-medium",onClick:i,children:"Medicamentos"}),e.jsx(ae,{to:"/farmacia/cotizador",className:"py-2 px-3 rounded-lg text-blue-700 hover:bg-blue-100 font-medium",onClick:i,children:"Cotizador Farmacia"}),e.jsx(ae,{to:"/farmacia/ventas",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:i,children:"Ventas de Farmacia"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ae,{to:"/",className:"group relative py-3 px-4 rounded-xl bg-gradient-to-r from-purple-600 via-purple-700 to-indigo-800 text-white font-semibold shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 flex items-center gap-3 overflow-hidden",onClick:i,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"relative z-10 flex items-center justify-center w-8 h-8 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(W,{iconName:"ViewDashboard",className:"text-xl text-white"})}),e.jsx("span",{className:"relative z-10 text-lg",children:"Dashboard"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"})]}),e.jsxs(ae,{to:"/pacientes",className:"py-3 px-4 rounded-lg text-cyan-700 hover:bg-gradient-to-r hover:from-cyan-50 hover:to-blue-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-cyan-100 rounded-lg",children:e.jsx(W,{iconName:"People",className:"text-xl text-cyan-600"})}),e.jsx("span",{children:"Pacientes"})]}),d?.rol==="administrador"&&e.jsxs(e.Fragment,{children:[e.jsxs(ae,{to:"/usuarios",className:"py-3 px-4 rounded-lg text-blue-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 rounded-lg",children:e.jsx(W,{iconName:"People",className:"text-xl text-blue-600"})}),e.jsx("span",{children:"Usuarios"})]}),e.jsxs(ae,{to:"/medicos",className:"py-3 px-4 rounded-lg text-emerald-700 hover:bg-gradient-to-r hover:from-emerald-50 hover:to-green-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-emerald-100 rounded-lg",children:e.jsx(W,{iconName:"Health",className:"text-xl text-emerald-600"})}),e.jsx("span",{children:"Médicos"})]}),e.jsxs(ae,{to:"/gestion-tarifas",className:"py-3 px-4 rounded-lg text-amber-700 hover:bg-gradient-to-r hover:from-amber-50 hover:to-yellow-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-amber-100 rounded-lg",children:e.jsx(W,{iconName:"Money",className:"text-xl text-amber-600"})}),e.jsx("span",{children:"💰 Gestión de Tarifas"})]})]}),e.jsxs(ae,{to:"/reportes",className:"py-3 px-4 rounded-lg text-violet-700 hover:bg-gradient-to-r hover:from-violet-50 hover:to-purple-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-violet-100 rounded-lg",children:e.jsx(W,{iconName:"BarChart4",className:"text-xl text-violet-600"})}),e.jsx("span",{children:"Reportes"})]}),e.jsxs(ae,{to:"/configuracion",className:"py-3 px-4 rounded-lg text-gray-700 hover:bg-gradient-to-r hover:from-gray-50 hover:to-slate-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-gray-100 rounded-lg",children:e.jsx(W,{iconName:"Settings",className:"text-xl text-gray-600"})}),e.jsx("span",{children:"Configuración"})]}),e.jsxs(ae,{to:"/reabrir-caja",className:"py-3 px-4 rounded-lg text-gray-700 hover:bg-gradient-to-r hover:from-yellow-50 hover:to-orange-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-yellow-100 rounded-lg",children:e.jsx(W,{iconName:"Unlock",className:"text-xl text-yellow-600"})}),e.jsx("span",{children:"🔓 Reabrir Cajas"})]})]})}),e.jsx("div",{className:"mt-auto p-4",children:e.jsxs("button",{onClick:r,className:"group w-full bg-gradient-to-r from-red-600 via-red-700 to-rose-800 text-white font-bold rounded-xl py-3 px-4 shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 flex items-center justify-center gap-3 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-700 via-rose-600 to-pink-700 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"relative z-10 flex items-center justify-center w-6 h-6 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(W,{iconName:"SignOut",className:"text-lg text-white"})}),e.jsx("span",{className:"relative z-10",children:"Cerrar sesión"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"})]})})]})})]})}function js({usuario:s,onMenu:i}){return e.jsxs("header",{className:"flex items-center justify-between px-6 py-3 bg-purple-800 shadow text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"/2demayo.svg",alt:"Logo",className:"h-10 w-10 object-contain bg-white rounded-full p-1 shadow"}),e.jsx("span",{className:"text-xl font-bold drop-shadow",children:"Clínica 2 de Mayo"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-white/90",children:[s?.nombre," ",s?.apellido||""]}),e.jsx("button",{className:"md:hidden ml-2",onClick:i,"aria-label":"Abrir menú",children:e.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]})]})}function Ns({usuario:s,onLogout:i,children:r}){const[d,h]=t.useState(!1);return t.useEffect(()=>{const C=()=>{window.innerWidth>=768&&h(!1)};return window.addEventListener("resize",C),C(),()=>window.removeEventListener("resize",C)},[]),e.jsxs("div",{className:"min-h-screen flex flex-col bg-blue-50 overflow-x-hidden",children:[e.jsx(js,{usuario:s,onMenu:()=>h(!0)}),e.jsxs("div",{className:"flex flex-1 max-w-full",children:[e.jsx(fs,{open:d,onClose:()=>h(!1),onLogout:i,usuario:s}),e.jsx("main",{className:"flex-1 px-2 sm:px-4 md:px-8 min-w-0 max-w-full overflow-x-auto",children:r})]}),e.jsx(bs,{})]})}function Ie({onPacienteEncontrado:s,onNoEncontrado:i,onNuevaBusqueda:r}){const[d,h]=t.useState(""),[C,y]=t.useState("dni"),[m,j]=t.useState([]),[g,w]=t.useState(!1),[v,l]=t.useState(!1),k=async p=>{if(p.preventDefault(),!!d.trim()){w(!0),j([]);try{const n=await(await fetch(z+"api_pacientes_buscar.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tipo:C,valor:d})})).json();n.success&&Array.isArray(n.pacientes)&&n.pacientes.length>0?(j(n.pacientes),l(!1),n.pacientes.length===1&&s&&(l(!1),s(n.pacientes[0]))):(j([]),l(!0),i())}catch{j([]),i()}w(!1)}},L=p=>{h(p.target.value),l(!1),r&&r()},o=p=>{y(p.target.value),l(!1),r&&r()};return e.jsxs("div",{className:"mb-4",children:[e.jsxs("form",{onSubmit:k,className:"flex flex-col md:flex-row gap-2 mb-4",children:[e.jsxs("select",{value:C,onChange:o,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"dni",children:"DNI"}),e.jsx("option",{value:"nombre",children:"Nombre y Apellido"}),e.jsx("option",{value:"historia",children:"Historia Clínica"})]}),e.jsx("input",{type:"text",value:d,onChange:L,placeholder:`Buscar por ${C}`,className:"border rounded px-2 py-1 flex-1"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white rounded px-4 py-1 font-bold",disabled:g,children:"Buscar"})]}),g&&e.jsx("div",{className:"text-blue-600",children:"Buscando..."}),m.length>0&&e.jsxs("div",{className:"mt-2 bg-blue-50 rounded-lg p-2",children:[e.jsx("div",{className:"font-bold mb-2",children:"Selecciona un paciente:"}),e.jsx("ul",{className:"divide-y divide-blue-100",children:m.length===1?e.jsx("li",{className:"py-2 flex flex-col md:flex-row md:items-center gap-2",children:e.jsxs("span",{className:"w-full px-3 py-2 rounded bg-blue-100 font-semibold text-blue-900",children:[m[0].nombre," ",m[0].apellido," | DNI: ",m[0].dni," | HC: ",m[0].historia_clinica]})},m[0].id):m.map(p=>e.jsx("li",{className:"py-2 flex flex-col md:flex-row md:items-center gap-2",children:e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 rounded bg-blue-100 hover:bg-blue-200 font-semibold text-blue-900",onClick:()=>{l(!1),s(p)},children:[p.nombre," ",p.apellido," | DNI: ",p.dni," | HC: ",p.historia_clinica]})},p.id))})]}),v&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded border border-yellow-300 text-sm",disabled:!0,children:"Paciente no encontrado"})})]})}function vs({paciente:s}){return e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4",children:[e.jsx("div",{className:"font-bold text-blue-800 mb-2",children:"Paciente encontrado:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Nombre:"})," ",s.nombre]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Apellido:"})," ",s.apellido]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"DNI:"})," ",s.dni]}),s.fecha_nacimiento&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Fecha de nacimiento:"})," ",s.fecha_nacimiento]}),s.sexo&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Sexo:"})," ",s.sexo]}),s.direccion&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Dirección:"})," ",s.direccion]}),s.telefono&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Teléfono:"})," ",s.telefono]}),s.email&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",s.email]}),s.tipo_seguro&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Tipo de seguro:"})," ",s.tipo_seguro]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Historia Clínica:"})," ",s.historia_clinica]}),s.edad&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Edad:"})," ",s.edad," ",s.edad_unidad||""]}),s.procedencia&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Procedencia:"})," ",s.procedencia]})]})]})]})}function pe({paciente:s,servicio:i,onCobroCompleto:r,onCancelar:d,detalles:h,total:C}){const[y,m]=t.useState([]),[j,g]=t.useState("particular"),[w,v]=t.useState("efectivo"),[l,k]=t.useState(""),[L,o]=t.useState(!1);t.useEffect(()=>{h||p()},[h]);const p=async()=>{try{const x=await(await fetch(`${z}api_tarifas.php`,{credentials:"include"})).json();x.success&&m(x.tarifas||[])}catch(E){console.error("Error al cargar tarifas:",E)}},a=t.useMemo(()=>Array.isArray(h)&&h.length>0?h:[],[h]),n=()=>typeof C=="number"&&C>0?C:a.reduce((E,x)=>E+x.subtotal,0),c=async()=>{if(a.length===0){I.fire("Error","No hay servicios para cobrar","error");return}if(!s||!s.nombre||!s.dni){I.fire("Error","Faltan datos del paciente (nombre y DNI son requeridos)","error");return}o(!0);try{const E=JSON.parse(sessionStorage.getItem("usuario")||"{}"),x={paciente_id:s.id,usuario_id:E.id,total:n(),tipo_pago:w,observaciones:l,detalles:a,servicio_info:i,paciente_nombre:s.nombre,paciente_dni:s.dni,paciente_historia_clinica:s.historia_clinica||`MANUAL-${s.dni}`},f=await(await fetch(`${z}api_cobros.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(x)})).json();if(f.success){if(i?.key==="laboratorio"&&!i?.consulta_id){const S=a.map(R=>R.servicio_id),$=await(await fetch(`${z}api_ordenes_laboratorio.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({consulta_id:null,examenes:S,paciente_id:s?.id||null,cobro_id:f.cobro_id})})).json()}await u(f.cobro_id,x),r&&r(f.cobro_id,i)}else I.fire("Error",f.error||"Error al procesar el cobro","error")}catch(E){console.error("Error:",E),I.fire("Error","Error de conexión con el servidor","error")}finally{o(!1)}},u=async(E,x)=>{const b=new Date().toLocaleString("es-PE"),f=s.apellido?`${s.nombre} ${s.apellido}`:s.nombre,S=`
      <div style="text-align: left; font-family: monospace;">
        <h3 style="text-align: center; margin-bottom: 20px;">🏥 CLÍNICA 2 DE MAYO</h3>
        <hr>
        <p><strong>COMPROBANTE DE PAGO #${E}</strong></p>
        <p>Fecha: ${b}</p>
        <p>Paciente: ${f}</p>
        <p>DNI: ${s.dni}</p>
        <p>H.C.: ${s.historia_clinica}</p>
        <hr>
        <p><strong>DETALLE:</strong></p>
        ${x.detalles.map(F=>`<p>${F.descripcion} x${F.cantidad} .... S/ ${F.subtotal.toFixed(2)}</p>`).join("")}
        <hr>
        <p><strong>TOTAL: S/ ${x.total.toFixed(2)}</strong></p>
  <p>Tipo de pago: ${w==="yape"?"Yape":w.toUpperCase()}</p>
        <p>Cobertura: ${j.toUpperCase()}</p>
        <hr>
        <p style="text-align: center; font-size: 12px;">
          Gracias por su preferencia<br>
          Conserve este comprobante
        </p>
      </div>
    `;await I.fire({title:"Cobro Procesado ✅",html:S,icon:"success",confirmButtonText:"Imprimir Comprobante",showCancelButton:!0,cancelButtonText:"Solo Continuar"}).then(F=>{if(F.isConfirmed){const $=window.open("","_blank");$.document.write(S),$.document.close(),$.print()}})};if(!i)return e.jsx("div",{children:"Seleccione un servicio primero"});const _=n();return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-blue-200",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-blue-800",children:"💰 Módulo de Cobros"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Paciente:"}),e.jsx("p",{children:s.nombre}),e.jsxs("p",{children:["DNI: ",s.dni," | H.C.: ",s.historia_clinica]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Tipo de Cobertura:"}),e.jsxs("select",{value:j,onChange:E=>g(E.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"particular",children:"Particular"}),e.jsx("option",{value:"seguro",children:"Seguro"}),e.jsx("option",{value:"convenio",children:"Convenio"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Detalle del Servicio:"}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded",children:[a.map((E,x)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:E.descripcion}),e.jsxs("span",{className:"font-bold",children:["S/ ",E.subtotal.toFixed(2)]})]},x)),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between items-center font-bold text-lg",children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{className:"text-green-600",children:["S/ ",_.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Método de Pago:"}),e.jsxs("select",{value:w,onChange:E=>v(E.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"}),e.jsx("option",{value:"transferencia",children:"Transferencia"}),e.jsx("option",{value:"yape",children:"Yape"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Observaciones:"}),e.jsx("textarea",{value:l,onChange:E=>k(E.target.value),className:"w-full border rounded px-3 py-2 h-20",placeholder:"Observaciones adicionales (opcional)"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:c,disabled:L||_<=0,className:"flex-1 bg-green-600 text-white py-3 px-6 rounded font-bold text-lg hover:bg-green-700 disabled:bg-gray-400",children:L?"Procesando...":`💳 Cobrar S/ ${_.toFixed(2)}`}),e.jsx("button",{onClick:d,className:"bg-gray-500 text-white py-3 px-6 rounded font-bold hover:bg-gray-600",children:"Cancelar"})]})]})}const ys=[{key:"consulta",label:"Consulta Médica",icon:"👨‍⚕️",requiresPayment:!1},{key:"laboratorio",label:"Laboratorio",icon:"🔬",requiresPayment:!0},{key:"farmacia",label:"Farmacia",icon:"💊",requiresPayment:!0},{key:"rayosx",label:"Rayos X",icon:"🩻",requiresPayment:!0},{key:"ecografia",label:"Ecografía",icon:"🩺",requiresPayment:!0},{key:"ocupacional",label:"Medicina Ocupacional",icon:"👷‍⚕️",requiresPayment:!0}],ws=["consulta","laboratorio","farmacia","ecografia","rayosx","ocupacional"];function Cs({paciente:s}){const i=ie(),[r,d]=t.useState(null),[h,C]=t.useState(!1),[y,m]=t.useState([]);t.useEffect(()=>{fetch(z+"api_tarifas.php",{credentials:"include"}).then(l=>l.json()).then(l=>{if(l.success&&Array.isArray(l.tarifas)){const k=l.tarifas.filter(L=>L.activo===1&&!ws.includes(L.servicio_tipo)).map(L=>({key:L.servicio_tipo+"_"+L.id,label:L.descripcion,icon:"🛠️",requiresPayment:!0,tarifaId:L.id}));m(k)}})},[]);const j=l=>{l.key==="consulta"?i("/agendar-consulta",{state:{pacienteId:s.id}}):l.key==="laboratorio"?i(`/cotizar-laboratorio/${s.id}`):l.key==="farmacia"?i(`/cotizar-farmacia/${s.id}`):l.key==="rayosx"?i(`/cotizar-rayosx/${s.id}`):l.key==="ecografia"?i(`/cotizar-ecografia/${s.id}`):l.key==="ocupacional"?I.fire({title:"Página en construcción",text:"La funcionalidad de Medicina Ocupacional estará disponible próximamente.",icon:"info",confirmButtonText:"OK"}):l.key==="procedimiento"?i(`/cotizar-procedimientos/${s.id}`):l.requiresPayment?(d(l),C(!0)):v(l)},g=async(l,k)=>{C(!1),I.fire({title:"💰 Pago Procesado",text:`Servicio de ${k.label} pagado exitosamente.`,icon:"success",confirmButtonText:"OK"})},w=()=>{C(!1),d(null)},v=async l=>{const k=JSON.parse(sessionStorage.getItem("usuario")||"{}");if(!k.id){I.fire("Error","No se pudo identificar al usuario","error");return}try{const o=await(await fetch(z+"api_atenciones.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paciente_id:s.id,usuario_id:k.id,servicio:l.key,observaciones:""})})).json();o.success?I.fire({title:"Atención registrada",text:`Atención registrada para ${l.label}.`,icon:"success",confirmButtonText:"OK"}):I.fire({title:"Error",text:o.error||"No se pudo registrar la atención",icon:"error",confirmButtonText:"OK"})}catch(L){console.error("Error:",L),I.fire("Error","Error de conexión","error")}};return h&&r&&r.key!=="laboratorio"?e.jsx(pe,{paciente:s,servicio:r,onCobroCompleto:g,onCancelar:w}):e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 text-blue-800",children:["🏥 Seleccionar Servicio para: ",s.nombre," ",s.apellido]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[ys.map(l=>l.key==="ocupacional"?e.jsxs("button",{onClick:()=>{I.fire({title:"Página en construcción",text:"La funcionalidad de Medicina Ocupacional estará disponible próximamente.",icon:"info",confirmButtonText:"OK"})},className:"flex items-center justify-center gap-2 p-4 bg-white border border-blue-300 rounded-lg hover:bg-blue-100 hover:border-blue-400 transition-colors font-medium text-blue-700 hover:text-blue-800",children:[e.jsx("span",{className:"text-2xl",children:l.icon}),e.jsx("span",{children:l.label}),l.requiresPayment&&e.jsx("span",{className:"text-green-600 text-sm",children:"💰"})]},l.key):e.jsxs("button",{onClick:()=>j(l),className:"flex items-center justify-center gap-2 p-4 bg-white border border-blue-300 rounded-lg hover:bg-blue-100 hover:border-blue-400 transition-colors font-medium text-blue-700 hover:text-blue-800",children:[e.jsx("span",{className:"text-2xl",children:l.icon}),e.jsx("span",{children:l.label}),l.requiresPayment&&e.jsx("span",{className:"text-green-600 text-sm",children:"💰"})]},l.key)),e.jsxs("button",{onClick:()=>j({key:"procedimiento",label:"Procedimientos",icon:"🛠️",requiresPayment:!0}),className:"flex items-center justify-center gap-2 p-4 bg-white border border-orange-300 rounded-lg hover:bg-orange-100 hover:border-orange-400 transition-colors font-medium text-orange-700 hover:text-orange-800",children:[e.jsx("span",{className:"text-2xl",children:"🛠️"}),e.jsx("span",{children:"Procedimientos"}),e.jsx("span",{className:"text-green-600 text-sm",children:"💰"})]},"procedimientos")]}),e.jsx("div",{className:"mt-3 text-sm text-gray-600 text-center",children:"💰 = Requiere pago previo | 🏥 = Agendar primero, cobrar después"})]})}function ks({onPacienteRegistrado:s}){const[i,r]=t.useState(null),[d,h]=t.useState(!1),C=()=>{r(null),h(!1)},y=m=>{r(m),s&&s()};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ie,{onPacienteEncontrado:r,onNoEncontrado:()=>h(!0),onNuevaBusqueda:C}),i&&e.jsxs(e.Fragment,{children:[e.jsx(vs,{paciente:i}),e.jsx(Cs,{paciente:i})]}),d&&!i&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"mb-2 text-blue-700",children:"Paciente no encontrado. ¿Desea registrarlo?"}),e.jsx(hs,{initialData:{},onRegistroExitoso:y})]})]})}function _s({usuario:s}){const[i,r]=t.useState(null),[d,h]=t.useState({pacientesHoy:0,consultasHoy:0,totalPacientes:0}),C=Ce(),y=t.useCallback(async()=>{try{const w=await(await fetch(z+"api_estadisticas_dashboard.php")).json();w.success?h({pacientesHoy:w.estadisticas.pacientes_hoy,consultasHoy:w.estadisticas.consultas_hoy,totalPacientes:w.estadisticas.total_pacientes}):(console.error("Error al obtener estadísticas:",w.error),h({pacientesHoy:0,consultasHoy:0,totalPacientes:0}))}catch(g){console.error("Error de conexión al obtener estadísticas:",g),h({pacientesHoy:0,consultasHoy:0,totalPacientes:0})}},[]),m=t.useCallback(()=>{fetch(z+"api_ultima_hc.php").then(g=>g.json()).then(g=>{g.success&&r(g.ultima_hc)}),y()},[y]);t.useEffect(()=>{m(),y()},[s,C.pathname,m,y]);const j=()=>new Intl.DateTimeFormat("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(new Date);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 rounded-2xl p-6 sm:p-8 text-white shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white/10 rounded-full -translate-y-20 translate-x-20"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-white/5 rounded-full translate-y-16 -translate-x-16"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-white/20 rounded-2xl backdrop-blur-sm",children:e.jsx(W,{iconName:"Hospital",className:"text-3xl text-white"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold drop-shadow-lg",children:["¡Bienvenido, ",s?.nombre," ",s?.apellido||"","!"]}),e.jsx("p",{className:"text-lg text-white/90 mt-1",children:j()})]})]}),e.jsx("p",{className:"text-xl text-white/95 font-medium",children:"Panel de Control - Clínica 2 de Mayo"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"group bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border border-cyan-100 hover:border-cyan-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-xl",children:e.jsx(W,{iconName:"People",className:"text-2xl text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:d.pacientesHoy}),e.jsx("p",{className:"text-sm text-gray-500",children:"Hoy"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Pacientes Atendidos"}),e.jsx("p",{className:"text-sm text-gray-600",children:"En el día de hoy"})]}),e.jsxs("div",{className:"group bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border border-emerald-100 hover:border-emerald-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-emerald-400 to-green-500 rounded-xl",children:e.jsx(W,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:d.consultasHoy}),e.jsx("p",{className:"text-sm text-gray-500",children:"Hoy"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Consultas Médicas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"En el día de hoy"})]}),e.jsxs("div",{className:"group bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border border-purple-100 hover:border-purple-200 sm:col-span-2 lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-xl",children:e.jsx(W,{iconName:"Contact",className:"text-2xl text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:d.totalPacientes}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Pacientes Registrados"}),e.jsx("p",{className:"text-sm text-gray-600",children:"En la base de datos"})]})]}),i&&e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-amber-100",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl",children:e.jsx(W,{iconName:"DocumentSearch",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Última Historia Clínica"}),e.jsx("p",{className:"text-gray-600",children:"Registro más reciente en el sistema"})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-amber-100 rounded-lg",children:e.jsx(W,{iconName:"NumberField",className:"text-lg text-amber-700"})}),e.jsx("span",{className:"text-lg font-mono font-bold text-amber-800",children:i}),e.jsxs("span",{className:"text-sm text-amber-600 bg-amber-100 px-2 py-1 rounded-full",children:["HC #",i]})]})})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(W,{iconName:"ContactCard",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Atención en Recepción"}),e.jsx("p",{className:"text-indigo-100",children:"Gestión de pacientes y servicios"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx(ks,{onPacienteRegistrado:m})})]})]})}function Ss(){return e.jsx("div",{children:e.jsx(us,{})})}function Es(){return e.jsxs("div",{className:"container py-4",children:[e.jsx("h2",{className:"mb-4 text-2xl font-bold text-purple-800",children:"Gestión de Usuarios"}),e.jsx(ps,{})]})}function Ls(){const[s,i]=t.useState([]),[r,d]=t.useState([]),[h,C]=t.useState([]),[y,m]=t.useState(!1),[j,g]=t.useState(""),[w,v]=t.useState(1),[l,k]=t.useState(new Date),L=["#22c55e","#3b82f6","#f59e42","#e11d48","#a21caf","#facc15","#0ea5e9","#14b8a6","#6366f1","#f472b6"],o=Array.isArray(s)?s:[],p=o.reduce((x,b,f)=>(x[b.id]=L[f%L.length],x),{});t.useEffect(()=>{m(!0),Promise.all([fetch(z+"api_medicos.php").then(x=>x.json()),fetch(z+"api_disponibilidad_medicos.php").then(x=>x.json()),fetch(z+"api_consultas.php").then(x=>x.json())]).then(([x,b,f])=>{i(x.medicos||[]),d(b.disponibilidad||[]),C(f.consultas||[]),m(!1)})},[]);const a={};r.forEach(x=>{x.fecha&&(a[x.fecha]||(a[x.fecha]=[]),a[x.fecha].push(x))});function n(x){const b=x.toISOString().slice(0,10),f=r.filter($=>$.fecha===b);if(f.length>0)return f;const F=["domingo","lunes","martes","miércoles","jueves","viernes","sábado"][x.getDay()];return r.filter($=>$.dia_semana===F&&!$.fecha)}const c=n(l);o.filter(x=>c.some(b=>b.medico_id==x.id));const u=j.trim().toLowerCase();let _=[];u?_=r.filter(x=>{const b=o.find(f=>f.id==x.medico_id);return b?b.nombre&&b.nombre.toLowerCase().includes(u)||b.especialidad&&b.especialidad.toLowerCase().includes(u):!1}):_=c;const E=_;return e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-2 text-center",children:"Disponibilidad de Médicos"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4 items-start",children:[e.jsx(Te,{onChange:k,value:l,className:"border rounded shadow !text-base w-full max-w-xs md:!text-base md:w-[350px] md:h-[350px] !h-[320px] md:!h-[350px]",tileContent:({date:x,view:b})=>{if(b!=="month")return null;const f=n(x);if(!f.length)return null;const S=[...new Set(f.map(F=>F.medico_id))];return e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:2},children:S.map((F,$)=>e.jsx("span",{style:{display:"inline-block",width:8,height:8,borderRadius:"50%",background:p[F]||"#888",marginLeft:$>0?2:0}},F))})}}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("input",{type:"text",placeholder:"Buscar por nombre o especialidad...",value:j,onChange:x=>{g(x.target.value),v(1)},className:"border rounded px-3 py-1"})}),y?e.jsx("div",{children:"Cargando..."}):e.jsx("div",{className:"overflow-x-auto",style:{maxHeight:260,minHeight:80},children:e.jsxs("table",{className:"min-w-full text-[11px] md:text-sm border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Médico"}),e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Especialidad"}),e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Horario"}),e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Cupos libres"})]})}),e.jsx("tbody",{children:E.map((x,b)=>{const f=o.find(T=>T.id==x.medico_id);if(!f)return null;let S=x.fecha;!S&&x.dia_semana&&(S=x.dia_semana);const F=x.hora_inicio.split(":").map(Number),$=x.hora_fin.split(":").map(Number);let R=0,P=F[0],A=F[1];for(;P<$[0]||P===$[0]&&A<$[1];)R++,A+=30,A>=60&&(P++,A=0);const H=h.filter(T=>T.medico_id==f.id&&(x.fecha?T.fecha===x.fecha:!0)&&T.hora>=x.hora_inicio&&T.hora<x.hora_fin&&T.estado==="pendiente"),N=R-H.length;return e.jsxs("tr",{className:N>0?"bg-green-50":"bg-yellow-100",children:[e.jsxs("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1 font-bold",style:{color:p[f.id]||void 0},children:["Dr(a). ",f.nombre," ",f.apellido||""]}),e.jsx("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1",children:f.especialidad}),e.jsxs("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1",children:[x.hora_inicio," - ",x.hora_fin," ",S?e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",S,")"]}):null]}),e.jsx("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1 font-bold",children:N>0?N:"Sin cupos"})]},x.medico_id+"-"+b)})})]})})]})]})]})}function Ms({pacienteId:s}){const[i,r]=t.useState([]),[d,h]=t.useState(0),[C,y]=t.useState([]),[m,j]=t.useState(""),[g,w]=t.useState([]),[v,l]=t.useState(""),[k,L]=t.useState(""),[o,p]=t.useState(""),[a,n]=t.useState(null),[c,u]=t.useState(!1),[_,E]=t.useState(null),[x,b]=t.useState(!1),f=Ve(I);t.useEffect(()=>{c&&a?fetch(z+"api_tarifas.php",{credentials:"include"}).then(R=>R.json()).then(R=>{if(R.success&&Array.isArray(R.tarifas)){let P=R.tarifas.find(A=>A.servicio_tipo==="consulta"&&A.activo===1&&Number(A.medico_id)===Number(a.medico_id));if(P||(P=R.tarifas.find(A=>A.servicio_tipo==="consulta"&&A.activo===1&&(!A.medico_id||A.medico_id===null))),P){const A={servicio_tipo:"consulta",servicio_id:a.id,descripcion:P.descripcion||`Consulta - ${a.medico_nombre}`,cantidad:1,precio_unitario:parseFloat(P.precio_particular)||0,subtotal:parseFloat(P.precio_particular)||0};r([A]),h(A.subtotal)}else r([]),h(0)}}):(r([]),h(0))},[c,a]),t.useEffect(()=>{fetch(z+"api_medicos.php").then(R=>R.json()).then(R=>y(R.medicos||[]))},[]),t.useEffect(()=>{m&&v?(b(!0),fetch(`${z}api_horarios_disponibles.php?medico_id=${m}&fecha=${v}`).then(R=>R.json()).then(R=>{R.success?w(R.horarios_disponibles||[]):(w([]),console.error("Error:",R.error))}).catch(R=>{console.error("Error:",R),w([])}).finally(()=>b(!1))):w([])},[m,v]),t.useEffect(()=>{s&&fetch(`${z}api_pacientes.php?id=${s}`).then(R=>R.json()).then(R=>{R.success&&R.paciente&&E(R.paciente)}).catch(console.error)},[s]);const S=async R=>{if(R.preventDefault(),p(""),!s||!m||!v||!k){p("Completa todos los campos");return}try{const A=await(await fetch(z+"api_consultas.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paciente_id:s,medico_id:m,fecha:v,hora:k,estado:"programada"})})).json();if(A.success){const H=C.find(T=>String(T.id)===String(m)),N=`${H?.nombre} ${H?.apellido||""}`.trim();n({id:A.consulta_id||A.id,medico_id:m,medico_nombre:N,medico_especialidad:H?.especialidad,fecha:v,hora:k,paciente_id:s}),u(!0),p("")}else p(A.error||"Error al agendar")}catch(P){console.error("Error:",P),p("Error de conexión")}},F=async(R,P)=>{u(!1),f.fire({icon:"success",title:"¡Consulta Agendada y Pagada!",html:`
        <div class="text-left">
          <p><strong>Consulta:</strong> ${a.medico_nombre}</p>
          <p><strong>Especialidad:</strong> ${a.medico_especialidad}</p>
          <p><strong>Fecha:</strong> ${a.fecha}</p>
          <p><strong>Hora:</strong> ${a.hora}</p>
          <p><strong>Cobro ID:</strong> ${R}</p>
        </div>
      `,confirmButtonColor:"#22c55e",confirmButtonText:"Aceptar"}),l(""),L(""),j(""),n(null)},$=()=>{u(!1),f.fire({title:"Cobro Cancelado",text:"La consulta fue agendada pero no se realizó el cobro. Puede cobrarse posteriormente.",icon:"info",confirmButtonText:"Entendido"})};return c&&a&&_?e.jsxs("div",{className:"max-w-2xl mx-auto p-2 md:p-8 w-full",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-4 border border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"✅ Consulta Agendada Exitosamente"}),e.jsxs("div",{className:"text-sm text-blue-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Médico:"})," ",a.medico_nombre," (",a.medico_especialidad,")"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",a.fecha," - ",e.jsx("strong",{children:"Hora:"})," ",a.hora]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Paciente:"})," ",_.nombre," ",_.apellido]})]})]}),e.jsx(pe,{paciente:_,servicio:{key:"consulta",label:`Consulta - ${a.medico_nombre}`,medico_id:a.medico_id,consulta_id:a.id},detalles:i,total:d,onCobroCompleto:F,onCancelar:$})]}):e.jsxs("div",{className:"max-w-2xl mx-auto p-2 md:p-8 w-full overflow-x-auto",children:[e.jsx(Ls,{}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-4 text-center",children:"Agendar Consulta Médica"}),e.jsxs("form",{onSubmit:S,className:"flex flex-col gap-2 md:gap-4 mb-4 bg-white rounded-lg shadow border border-blue-200 p-2 md:p-8 w-full max-w-full text-xs md:text-base",children:[e.jsx("label",{className:"font-semibold mb-1",htmlFor:"medico-select",children:"Médico"}),e.jsxs("select",{id:"medico-select",value:m,onChange:R=>{j(R.target.value),L("")},className:"border rounded px-3 py-2 md:px-4 md:py-3 text-base md:text-lg",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un médico"}),C.map(R=>e.jsxs("option",{value:R.id,children:["Dr(a). ",R.nombre," ",R.apellido||""," - ",R.especialidad]},R.id))]}),e.jsx("label",{className:"font-semibold mb-1",htmlFor:"fecha-consulta",children:"Fecha de la consulta"}),e.jsx("input",{id:"fecha-consulta",type:"date",value:v,onChange:R=>{l(R.target.value),L("")},className:"border rounded px-3 py-2 md:px-4 md:py-3 text-base md:text-lg",required:!0}),e.jsx("label",{className:"font-semibold mb-1",htmlFor:"hora-select",children:"Horario disponible"}),e.jsxs("select",{id:"hora-select",value:k,onChange:R=>L(R.target.value),className:"border rounded px-3 py-2 md:px-4 md:py-3 text-base md:text-lg",required:!0,disabled:!m||!v||x,children:[e.jsx("option",{value:"",children:x?"Cargando horarios...":!m||!v?"Selecciona médico y fecha primero":g.length===0?"No hay horarios disponibles":"Selecciona un horario"}),g.map(R=>e.jsxs("option",{value:R.hora,children:[R.hora," - ",R.medico_nombre]},`${R.medico_id}-${R.hora}`))]}),e.jsx("button",{type:"submit",className:"bg-green-600 text-white rounded px-4 py-2 md:px-6 md:py-3 font-bold text-base md:text-lg",children:"Agendar Consulta"})]}),o&&e.jsx("div",{className:"mt-2 text-base md:text-lg text-center text-green-700",children:o})]})}function Ps(){const s=Ce(),i=ie(),r=s.state?.pacienteId;return r?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-800",children:"Agendar Consulta Médica"}),e.jsx("button",{onClick:()=>i("/seleccionar-servicio",{state:{pacienteId:r}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"})]}),e.jsx(Ms,{pacienteId:r})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow text-center",children:[e.jsx("p",{className:"text-lg font-bold text-red-600 mb-2",children:"No se ha seleccionado un paciente."}),e.jsx("button",{onClick:()=>i(-1),className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Volver"})]})})}function Fs({medicoId:s,onIniciarConsulta:i,onVerDetalle:r}){const d=ie(),[h,C]=t.useState([]),[y,m]=t.useState(1),[j,g]=t.useState(5),[w,v]=t.useState(!1),[l,k]=t.useState(""),[L,o]=t.useState(""),[p,a]=t.useState(""),[n,c]=t.useState("");t.useEffect(()=>{s&&(v(!0),fetch(`${z}api_consultas.php?medico_id=${s}`,{credentials:"include"}).then(N=>N.json()).then(N=>{C(N.consultas||[]),v(!1)}).catch(N=>{console.error("Error cargando consultas:",N),v(!1)}))},[s]);const u=async(N,T)=>{k(""),v(!0);try{await fetch(z+"api_consultas.php",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:N,estado:T})});const Q=await(await fetch(`${z}api_consultas.php?medico_id=${s}`,{credentials:"include"})).json();C(Q.consultas||[]),k(`Consulta ${T} correctamente`)}catch(U){console.error("Error actualizando estado:",U),k("Error al actualizar el estado")}finally{v(!1)}},_=h.filter(N=>{const T=L.trim().toLowerCase();return T&&!(N.paciente_nombre&&N.paciente_nombre.toLowerCase().includes(T)||N.paciente_apellido&&N.paciente_apellido.toLowerCase().includes(T)||N.historia_clinica&&N.historia_clinica.toLowerCase().includes(T)||N.dni&&N.dni.toLowerCase().includes(T))?!1:!p&&!n?!0:!(!N.fecha||p&&N.fecha<p||n&&N.fecha>n)}),E=_.length,x=Math.max(1,Math.ceil(E/j)),b=_.slice((y-1)*j,y*j),f=N=>{g(Number(N.target.value)),m(1)},S=()=>m(N=>Math.max(1,N-1)),F=()=>m(N=>Math.min(x,N+1)),$=N=>{if(!N)return"N/A";try{return new Date(N).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return N}},R=N=>{switch(N?.toLowerCase()){case"pendiente":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"completada":case"completado":return"bg-green-100 text-green-800 border-green-200";case"cancelada":case"cancelado":return"bg-red-100 text-red-800 border-red-200";case"en_proceso":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},P=N=>{switch(N?.toLowerCase()){case"pendiente":return"⏳ ";case"completada":case"completado":return"✅ ";case"cancelada":case"cancelado":return"❌ ";case"en_proceso":return"🔄 ";default:return"📋 "}},A=N=>{switch(N?.toLowerCase()){case"emergencia":return"bg-red-100 text-red-800 border-red-200 animate-pulse";case"urgente":case"urgencia":return"bg-orange-100 text-orange-800 border-orange-200";case"no urgente":case"normal":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},H=N=>{switch(N?.toLowerCase()){case"emergencia":return"🚨 ";case"urgente":case"urgencia":return"⚠️ ";case"no urgente":case"normal":return"🟢 ";default:return"⚪ "}};return e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:max-w-7xl lg:mx-auto",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-3 sm:p-6 mb-4 sm:mb-8 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 sm:w-5 sm:h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-800",children:"🔍 Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"col-span-full lg:col-span-2",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"Búsqueda general"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-2 sm:pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("input",{type:"text",value:L,onChange:N=>{o(N.target.value),m(1)},placeholder:"Buscar por nombre, HC o DNI...",className:"pl-8 sm:pl-10 w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white/80"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"📅 Desde"}),e.jsx("input",{type:"date",value:p,onChange:N=>{a(N.target.value),m(1)},className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white/80"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"📅 Hasta"}),e.jsx("input",{type:"date",value:n,onChange:N=>{c(N.target.value),m(1)},className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white/80"})]})]}),(L||p||n)&&e.jsx("div",{className:"mt-3 sm:mt-4 flex justify-center sm:justify-end",children:e.jsxs("button",{onClick:()=>{o(""),a(""),c(""),m(1)},className:"inline-flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Limpiar Filtros"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-6 mb-4 sm:mb-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-xs sm:text-sm font-medium",children:"Total Consultas"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:_.length})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-xs sm:text-sm font-medium",children:"Pendientes"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:_.filter(N=>N.estado==="pendiente").length})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-100 text-xs sm:text-sm font-medium",children:"Emergencias"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:_.filter(N=>N.clasificacion==="Emergencia").length})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})})]})})]}),w?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-8 sm:p-12 border border-white/50 flex justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600 font-medium text-sm sm:text-base",children:"🏥 Cargando consultas médicas..."})]})}):b.length===0?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-8 sm:p-12 border border-white/50 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-r from-gray-300 to-gray-400 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 sm:w-10 sm:h-10 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-700 mb-2",children:"📅 No hay consultas"}),e.jsx("p",{className:"text-gray-500 text-sm sm:text-base",children:"No se encontraron consultas con los filtros aplicados"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/50 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-600 to-indigo-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"👤 Paciente"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"🏥 HC / DNI"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"📅 Fecha"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"⏰ Hora"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"📊 Estado"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"🚨 Clasificación"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"🩺 Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:b.map((N,T)=>{const U=T%2===0;return e.jsxs("tr",{className:`${U?"bg-white/60":"bg-blue-50/40"} hover:bg-blue-100/60 transition-all duration-200 hover:shadow-lg transform hover:-translate-y-0.5`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:((N.paciente_nombre||"")+(N.paciente_apellido||"")).charAt(0)||"P"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:N.paciente_nombre?`${N.paciente_nombre} ${N.paciente_apellido||""}`.trim():`Paciente #${N.paciente_id}`}),e.jsx("div",{className:"text-sm text-gray-500",children:"Consulta médica"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:["HC: ",N.historia_clinica||"N/A"]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:["DNI: ",N.dni||"N/A"]})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"font-medium text-gray-900",children:$(N.fecha)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium text-gray-900",children:N.hora||"N/A"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${R(N.estado)}`,children:[P(N.estado),N.estado||"Sin estado"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${A(N.clasificacion)}`,children:[H(N.clasificacion),N.clasificacion||"Sin clasificar"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[N.estado==="pendiente"&&!N.clasificacion&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(N.id,"completada"),className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",title:"Completar consulta",children:e.jsx("span",{className:"text-sm",children:"✔️"})}),e.jsx("button",{onClick:()=>u(N.id,"cancelada"),className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",title:"Cancelar consulta",children:e.jsx("span",{className:"text-sm",children:"✖️"})})]}),e.jsx("button",{onClick:()=>d(`/historia-clinica/${N.paciente_id}/${N.id}`),className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",title:"Ver Historia Clínica",children:e.jsx("span",{className:"text-sm",children:"📖"})}),i&&e.jsxs("button",{onClick:()=>i(N),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Iniciar"]}),r&&e.jsxs("button",{onClick:()=>r(N),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Ver"]})]})})]},N.id)})})]})})}),e.jsx("div",{className:"lg:hidden space-y-3 sm:space-y-4",children:b.map(N=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/50 p-4 hover:shadow-xl transition-all duration-200 hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-semibold text-lg",children:((N.paciente_nombre||"")+(N.paciente_apellido||"")).charAt(0)||"P"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:N.paciente_nombre?`${N.paciente_nombre} ${N.paciente_apellido||""}`.trim():`Paciente #${N.paciente_id}`}),e.jsx("p",{className:"text-sm text-gray-500",children:"Consulta médica"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"📅 Fecha"}),e.jsx("p",{className:"text-gray-900",children:$(N.fecha)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"⏰ Hora"}),e.jsx("p",{className:"text-gray-900",children:N.hora||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"🏥 HC"}),e.jsx("p",{className:"text-gray-900",children:N.historia_clinica||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"👤 DNI"}),e.jsx("p",{className:"text-gray-900",children:N.dni||"N/A"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${R(N.estado)}`,children:[P(N.estado),N.estado||"Sin estado"]}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${A(N.clasificacion)}`,children:[H(N.clasificacion),N.clasificacion||"Sin clasificar"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[N.estado==="pendiente"&&!N.clasificacion&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>u(N.id,"completada"),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("span",{children:"✔️"}),e.jsx("span",{className:"hidden sm:inline",children:"Completar"})]}),e.jsxs("button",{onClick:()=>u(N.id,"cancelada"),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("span",{children:"✖️"}),e.jsx("span",{className:"hidden sm:inline",children:"Cancelar"})]})]}),e.jsxs("button",{onClick:()=>d(`/historia-clinica/${N.paciente_id}/${N.id}`),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("span",{children:"📖"}),e.jsx("span",{className:"hidden sm:inline",children:"Historia"})]}),i&&e.jsxs("button",{onClick:()=>i(N),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Iniciar"})]}),r&&e.jsxs("button",{onClick:()=>r(N),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),e.jsx("span",{className:"hidden sm:inline",children:"Ver"})]})]})]},N.id))})]}),l&&e.jsx("div",{className:"mt-3 sm:mt-4 p-3 sm:p-4 bg-blue-100 border border-blue-300 rounded-lg sm:rounded-xl text-blue-800 text-center text-sm sm:text-base",children:l}),_.length>0&&e.jsx("div",{className:"mt-4 sm:mt-8 bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-4 sm:p-6 border border-white/50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:S,disabled:y===1,className:"inline-flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),e.jsx("div",{className:"flex items-center gap-1 sm:gap-2",children:e.jsxs("span",{className:"text-gray-600 font-medium text-sm sm:text-base",children:[y,"/",x]})}),e.jsxs("button",{onClick:F,disabled:y===x,className:"inline-flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 sm:gap-3",children:[e.jsxs("label",{className:"text-xs sm:text-sm font-medium text-gray-700",children:["📄 ",e.jsx("span",{className:"hidden sm:inline",children:"Filas por página:"}),e.jsx("span",{className:"sm:hidden",children:"Por página:"})]}),e.jsxs("select",{value:j,onChange:f,className:"px-2 sm:px-3 py-1.5 sm:py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/80",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 text-center sm:text-left",children:[e.jsxs("span",{className:"block sm:inline",children:[b.length," de ",E]}),e.jsx("span",{className:"hidden sm:inline",children:" consultas"})]})]})]})})]})}function Ts({usuario:s}){const i=s?.id;return i?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 shadow-2xl",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 bg-white/10 rounded-full px-6 py-3 backdrop-blur-sm border border-white/20 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 9l6-6m-6 0l6 6"})})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Panel Médico"}),e.jsxs("p",{className:"text-blue-100 text-sm",children:["Dr(a). ",s?.nombre," ",s?.apellido||""]})]})]}),e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"📋 Mis Consultas Programadas"}),e.jsx("p",{className:"text-blue-100 max-w-2xl mx-auto",children:"Gestiona tus citas médicas, revisa el historial de pacientes y mantén un seguimiento completo de tus consultas"})]})})}),e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx(Fs,{medicoId:i})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-red-100 flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md mx-4 border border-red-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-red-800 mb-2",children:"Error de Acceso"}),e.jsx("p",{className:"text-red-600 font-medium",children:"No se encontró el médico logueado."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Por favor, inicia sesión nuevamente."})]})})})}const Ds=()=>{const[s,i]=t.useState([]),[r,d]=t.useState(!0),[h,C]=t.useState(null),[y,m]=t.useState(!1),[j,g]=t.useState({nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),[w,v]=t.useState(""),[l,k]=t.useState(!1),[L,o]=t.useState(!1),[p,a]=t.useState({id:null,nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),[n,c]=t.useState(""),[u,_]=t.useState(!1),[E,x]=t.useState(""),[b,f]=t.useState("id"),[S,F]=t.useState("asc"),[$,R]=t.useState(5),[P,A]=t.useState(1);t.useEffect(()=>{H()},[]);const H=async()=>{d(!0);try{const K=await fe.get(z+"api_medicos.php");i(K.data.medicos||[]),C(null)}catch(K){C("Error al cargar médicos"),console.error("Error fetching medicos:",K)}finally{d(!1)}},N=async K=>{k(!0),v("");try{const se=await fe.post(z+"api_medicos.php",K);se.data.success?(await H(),M(),I.fire({title:"¡Éxito!",text:"Médico registrado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})):v(se.data.message||"Error al registrar médico")}catch(se){v("Error de conexión al registrar médico"),console.error("Error creating medico:",se)}finally{k(!1)}},T=async K=>{_(!0),c("");try{const se=await fe.put(z+"api_medicos.php",K);se.data.success?(await H(),B(),I.fire({title:"¡Éxito!",text:"Médico actualizado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})):c(se.data.message||"Error al actualizar médico")}catch(se){c("Error de conexión al actualizar médico"),console.error("Error updating medico:",se)}finally{_(!1)}},U=async K=>{if((await I.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const re=await fe.delete(z+"api_medicos.php",{data:{id:K}});re.data.success?(await H(),I.fire({title:"¡Eliminado!",text:"Médico eliminado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})):I.fire({title:"Error",text:re.data.message||"Error al eliminar médico",icon:"error"})}catch(re){I.fire({title:"Error",text:"Error de conexión al eliminar médico",icon:"error"}),console.error("Error deleting medico:",re)}},Q=()=>{m(!0),g({nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),v("")},M=()=>{m(!1),g({nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),v("")},q=K=>{const{name:se,value:re}=K.target;g(ce=>({...ce,[se]:re}))},J=async K=>{K.preventDefault(),await N(j)},ee=K=>{o(!0),a({id:K.id,nombre:K.nombre,apellido:K.apellido||"",especialidad:K.especialidad,email:K.email,password:"",cmp:K.cmp||"",rne:K.rne||"",firma:K.firma||null}),c("")},B=()=>{o(!1),a({id:null,nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),c("")},O=K=>{const{name:se,value:re}=K.target;a(ce=>({...ce,[se]:re}))},G=async K=>{K.preventDefault(),await T(p)},D=K=>{b===K?F(S==="asc"?"desc":"asc"):(f(K),F("asc")),A(1)},X=[...s.filter(K=>{if(!E)return!0;const se=E.toLowerCase();return K.nombre.toLowerCase().includes(se)||K.apellido&&K.apellido.toLowerCase().includes(se)||K.especialidad.toLowerCase().includes(se)||K.email.toLowerCase().includes(se)})].sort((K,se)=>{let re=K[b],ce=se[b];return typeof re=="string"&&(re=re.toLowerCase(),ce=ce.toLowerCase()),S==="asc"?re<ce?-1:re>ce?1:0:re>ce?-1:re<ce?1:0}),te=X.length,ne=Math.ceil(te/$),le=(P-1)*$,oe=le+$;return{medicos:X.slice(le,oe),allMedicos:X,loading:r,error:h,showModal:y,form:j,formError:w,saving:l,editModal:L,editForm:p,editError:n,editSaving:u,busqueda:E,setBusqueda:x,sortBy:b,sortDir:S,rowsPerPage:$,setRowsPerPage:R,page:P,setPage:A,totalRows:te,totalPages:ne,startIdx:le,endIdx:oe,handleOpenModal:Q,handleCloseModal:M,handleInputChange:q,handleSubmit:J,handleEdit:ee,handleEditClose:B,handleEditChange:O,handleEditSubmit:G,handleSort:D,deleteMedico:U,fetchMedicos:H}},$s=s=>{try{const i=s.map(({id:j,nombre:g,especialidad:w,email:v})=>({ID:j,Nombre:g,Especialidad:w,Email:v})),r=be.json_to_sheet(i),d=be.book_new();be.book_append_sheet(d,r,"Médicos");const h=[{wch:8},{wch:25},{wch:20},{wch:30}];r["!cols"]=h;const C=We(d,{bookType:"xlsx",type:"array"}),y=new Blob([C],{type:"application/octet-stream"}),m=`medicos_${new Date().toISOString().slice(0,10)}.xlsx`;return qe.saveAs(y,m),{success:!0,fileName:m}}catch(i){return console.error("Error exportando a Excel:",i),{success:!1,error:i.message}}},As=s=>{try{const i=new De;i.setFontSize(18),i.setFont(void 0,"bold"),i.text("Lista de Médicos",14,15),i.setFontSize(10),i.setFont(void 0,"normal"),i.text(`Fecha de generación: ${new Date().toLocaleDateString()}`,14,25),i.text(`Total de médicos: ${s.length}`,14,30);const r=[{header:"ID",dataKey:"id"},{header:"Nombre",dataKey:"nombre"},{header:"Especialidad",dataKey:"especialidad"},{header:"Email",dataKey:"email"}],d=s.map(C=>({id:C.id,nombre:`${C.nombre} ${C.apellido||""}`.trim(),especialidad:C.especialidad,email:C.email}));$e(i,{columns:r,body:d,startY:35,styles:{fontSize:9,cellPadding:3},headStyles:{fillColor:[59,130,246],textColor:[255,255,255],fontStyle:"bold"},alternateRowStyles:{fillColor:[245,247,250]},tableLineColor:[209,213,219],tableLineWidth:.1,margin:{top:35,bottom:20,left:14,right:14}});const h=`medicos_${new Date().toISOString().slice(0,10)}.pdf`;return i.save(h),{success:!0,fileName:h}}catch(i){return console.error("Error exportando a PDF:",i),{success:!1,error:i.message}}},zs=({busqueda:s,setBusqueda:i,onAddNew:r,medicos:d,totalCount:h})=>{const C=()=>{const m=$s(d);m.success||console.error("Error al exportar:",m.error)},y=()=>{const m=As(d);m.success||console.error("Error al exportar:",m.error)};return e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-6 mb-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6",children:[e.jsxs("div",{className:"mb-4 lg:mb-0",children:[e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Gestión de Médicos"}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),h," médicos registrados"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:r,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 font-medium flex items-center justify-center gap-2 shadow-lg hover:shadow-xl",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Médico"}),e.jsx("span",{className:"sm:hidden",children:"Nuevo"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:C,className:"px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 font-medium flex items-center gap-2 shadow-lg hover:shadow-xl",title:"Exportar a Excel",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden lg:inline",children:"Excel"})]}),e.jsxs("button",{onClick:y,className:"px-4 py-3 bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-xl hover:from-red-600 hover:to-pink-700 transition-all duration-200 font-medium flex items-center gap-2 shadow-lg hover:shadow-xl",title:"Exportar a PDF",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),e.jsx("span",{className:"hidden lg:inline",children:"PDF"})]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Buscar médicos por nombre, especialidad o email...",value:s,onChange:m=>i(m.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-white/80 backdrop-blur-sm"}),s&&e.jsx("button",{onClick:()=>i(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("svg",{className:"h-4 w-4 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filtrando por: ",e.jsxs("span",{className:"font-medium text-blue-600",children:['"',s,'"']}),e.jsx("button",{onClick:()=>i(""),className:"text-blue-600 hover:text-blue-700 underline",children:"Limpiar"})]})]})},Rs=({medicos:s,loading:i,error:r,sortBy:d,sortDir:h,onSort:C,onEdit:y,onDelete:m,page:j,setPage:g,rowsPerPage:w,setRowsPerPage:v,totalPages:l,totalRows:k,startIdx:L,endIdx:o})=>{if(i)return e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-8 shadow-lg",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-gray-600",children:"Cargando médicos..."})]})})});if(r)return e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-8 shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-red-500 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error al cargar"}),e.jsx("p",{className:"text-gray-600",children:r})]})});if(s.length===0)return e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-8 shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay médicos"}),e.jsx("p",{className:"text-gray-600",children:"No se encontraron médicos que coincidan con los criterios de búsqueda."})]})});const p=a=>d!==a?e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):h==="asc"?e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"})}):e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:[e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>C("id"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["ID",p("id")]})}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>C("nombre"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Nombre",p("nombre")]})}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>C("especialidad"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"Especialidad",p("especialidad")]})}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>C("email"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),"Email",p("email")]})}),e.jsx("th",{className:"px-6 py-4 text-center font-semibold",children:"Acciones"})]})}),e.jsx("tbody",{children:s.map((a,n)=>e.jsxs("tr",{className:`border-b border-gray-200 hover:bg-blue-50/50 transition-colors ${n%2===0?"bg-white/50":"bg-gray-50/50"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold text-sm",children:a.id})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold",children:a.nombre.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["Dr(a). ",a.nombre," ",a.apellido||""]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",a.id]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:a.especialidad})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-gray-900",children:a.email})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>y(a),className:"p-2 text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-lg transition-colors",title:"Editar médico",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>m(a.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar médico",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},a.id))})]})})}),e.jsx("div",{className:"lg:hidden space-y-4",children:s.map(a=>e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg",children:a.nombre.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900",children:["Dr(a). ",a.nombre," ",a.apellido||""]}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["ID: #",a.id]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(a),className:"p-2 text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-lg transition-colors",title:"Editar médico",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>m(a.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar médico",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-purple-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),e.jsx("span",{className:"text-gray-600 text-sm",children:"Especialidad:"}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:a.especialidad})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),e.jsx("span",{className:"text-gray-600 text-sm",children:"Email:"}),e.jsx("span",{className:"text-gray-900 text-sm",children:a.email})]})]})]},a.id))}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-4 mt-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"Mostrar:"}),e.jsx("select",{value:w,onChange:a=>v(Number(a.target.value)),className:"border border-gray-300 rounded-lg px-3 py-1.5 text-sm bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent",children:[5,10,20,50].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("button",{onClick:()=>g(a=>Math.max(1,a-1)),disabled:j===1,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 font-medium",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),e.jsx("div",{className:"flex items-center gap-2 px-4 py-2 bg-white/80 rounded-lg border border-white/20",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Página ",j," de ",l||1]})}),e.jsxs("button",{onClick:()=>g(a=>a<l?a+1:a),disabled:j>=l,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 font-medium",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["Mostrando ",k===0?0:L+1," - ",Math.min(o,k)," de ",k," médicos"]})})]})]})},Me=({isOpen:s,onClose:i,mode:r="create",formData:d,onChange:h,onSubmit:C,error:y,isSaving:m})=>{const[j,g]=t.useState(d.firma||null),[w,v]=t.useState(""),l=t.useRef(null);if(!s)return null;const k=_=>{const E=_.target.files[0];if(!E)return;if(!E.type.match(/^image\/(png|jpeg|jpg)$/)){v("Solo se permiten archivos PNG, JPG o JPEG");return}if(E.size>2*1024*1024){v("El archivo es demasiado grande. Máximo 2MB.");return}const x=new FileReader;x.onload=b=>{const f=b.target.result;g(f),v(""),h({target:{name:"firma",value:f}})},x.readAsDataURL(E)},L=()=>{g(null),v(""),l.current&&(l.current.value=""),h({target:{name:"firma",value:null}})},o=r==="edit",p=o?"Editar Médico":"Registrar Nuevo Médico",a=o?"Actualizar información del médico":"Agregar médico al sistema",n=o?"Actualizar Médico":"Registrar Médico",c=o?"bg-gradient-to-r from-amber-500 to-orange-600":"bg-gradient-to-r from-blue-500 to-purple-600",u=o?"bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700";return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-md lg:max-w-2xl xl:max-w-3xl rounded-2xl shadow-2xl max-h-[95vh] sm:max-h-[88vh] lg:max-h-[85vh] flex flex-col",children:[e.jsx("div",{className:`${c} text-white p-4 sm:p-6 rounded-t-2xl flex-shrink-0`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:p}),e.jsx("p",{className:"text-white/80 text-sm",children:a})]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-2 sm:py-4",children:e.jsx("form",{id:`medico-form-${r}`,onSubmit:C,className:"h-full flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4 sm:space-y-6 pb-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Información Personal"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Nombre *"]})}),e.jsx("input",{type:"text",name:"nombre",value:d.nombre,onChange:h,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Juan",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Apellido *"]})}),e.jsx("input",{type:"text",name:"apellido",value:d.apellido||"",onChange:h,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Pérez García",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"Especialidad *"]})}),e.jsx("input",{type:"text",name:"especialidad",value:d.especialidad,onChange:h,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Cardiología",required:!0})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a1 1 0 011-1h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Códigos Profesionales"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a1 1 0 011-1h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"C.M.P. (Colegio Médico del Perú) *"]})}),e.jsx("input",{type:"text",name:"cmp",value:d.cmp||"",onChange:h,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"64201",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Obligatorio para todos los médicos"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"R.N.E. (Registro Nacional de Especialidad)"]})}),e.jsx("input",{type:"text",name:"rne",value:d.rne||"",onChange:h,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"36922"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Solo para médicos especialistas"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Información de Contacto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),"Email *"]})}),e.jsx("input",{type:"email",name:"email",value:d.email,onChange:h,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"doctor@clinica2demayo.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),o?"Nueva Contraseña":"Contraseña de Acceso *"]})}),e.jsx("input",{type:"password",name:"password",value:d.password,onChange:h,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"••••••••",required:!o,autoComplete:"new-password"}),o&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Dejar vacío para mantener la contraseña actual"}),!o&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Mínimo 8 caracteres recomendados"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"✍️ Firma Digital"})]}),j?e.jsxs("div",{className:"bg-white border-2 border-dashed border-indigo-300 rounded-lg p-4 text-center",children:[e.jsx("img",{src:j,alt:"Firma digital",className:"max-h-32 mx-auto object-contain",style:{maxWidth:"300px"}}),e.jsx("div",{className:"mt-3 flex justify-center gap-2",children:e.jsx("button",{type:"button",onClick:L,className:"px-3 py-1 text-sm bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",children:"🗑️ Eliminar"})})]}):e.jsxs("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("p",{className:"text-gray-500",children:"No hay firma registrada"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Subir Firma Digital"]})}),e.jsx("input",{ref:l,type:"file",accept:"image/png,image/jpeg,image/jpg",onChange:k,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white"}),w&&e.jsxs("div",{className:"text-red-600 text-sm flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),w]}),e.jsx("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-3",children:e.jsxs("div",{className:"text-sm text-indigo-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"📋 Requisitos de la firma:"}),e.jsxs("ul",{className:"space-y-1 text-indigo-700 text-xs",children:[e.jsx("li",{children:"• Formato: PNG, JPG o JPEG"}),e.jsx("li",{children:"• Tamaño máximo: 2MB"}),e.jsx("li",{children:"• Recomendado: Fondo transparente"}),e.jsx("li",{children:"• Dimensiones sugeridas: 300x100 píxeles"})]})]})})]}),(d.nombre||d.apellido||d.cmp||j)&&e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Vista Previa - Así aparecerá en los documentos"]}),e.jsxs("div",{className:"bg-white border-2 border-blue-200 rounded-lg p-3 text-center",children:[j&&e.jsx("img",{src:j,alt:"Firma",className:"max-h-12 mx-auto object-contain mb-2"}),e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-800",children:[d.nombre," ",d.apellido]}),d.especialidad&&e.jsx("div",{className:"text-xs text-gray-600",children:d.especialidad}),e.jsxs("div",{className:"text-xs text-gray-600",children:[d.cmp&&`C.M.P. ${d.cmp}`,d.rne&&` - R.N.E ${d.rne}`]})]})]})]})]})]})})}),y&&e.jsx("div",{className:"mx-4 sm:mx-6 mb-4",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-5 w-5 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-red-700 font-medium",children:y})]})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 p-4 sm:p-6 border-t border-gray-200 bg-gray-50/50 rounded-b-2xl flex-shrink-0",children:[e.jsxs("button",{type:"button",onClick:i,className:"flex-1 px-6 py-3 rounded-xl bg-gray-100 text-gray-700 hover:bg-gray-200 transition-all duration-200 font-medium flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Cancelar"]}),e.jsx("button",{type:"submit",form:`medico-form-${r}`,disabled:m,className:`flex-1 px-6 py-3 rounded-xl ${u} text-white disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all duration-200 font-medium flex items-center justify-center gap-2`,children:m?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),n]})})]})]})})};function Bs(){const{medicos:s,allMedicos:i,loading:r,error:d,showModal:h,form:C,formError:y,saving:m,editModal:j,editForm:g,editError:w,editSaving:v,busqueda:l,setBusqueda:k,sortBy:L,sortDir:o,rowsPerPage:p,setRowsPerPage:a,page:n,setPage:c,totalRows:u,totalPages:_,startIdx:E,endIdx:x,handleOpenModal:b,handleCloseModal:f,handleInputChange:S,handleSubmit:F,handleEdit:$,handleEditClose:R,handleEditChange:P,handleEditSubmit:A,handleSort:H,deleteMedico:N}=Ds();return e.jsx("div",{className:"bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(zs,{busqueda:l,setBusqueda:k,onAddNew:b,medicos:i,totalCount:u}),e.jsx(Rs,{medicos:s,loading:r,error:d,sortBy:L,sortDir:o,onSort:H,onEdit:$,onDelete:N,page:n,setPage:c,rowsPerPage:p,setRowsPerPage:a,totalPages:_,totalRows:u,startIdx:E,endIdx:x}),e.jsx(Me,{isOpen:h,onClose:f,mode:"create",formData:C,onChange:S,onSubmit:F,error:y,isSaving:m}),e.jsx(Me,{isOpen:j,onClose:R,mode:"edit",formData:g,onChange:P,onSubmit:A,error:w,isSaving:v})]})})})}function Os(){return e.jsx("div",{className:"container mx-auto py-8",children:e.jsx(Bs,{})})}function Is({onSave:s,bloquesGuardados:i=[]}){const[r,d]=t.useState([]),[h,C]=t.useState({}),[y,m]=t.useState(null),j=new Set(i.map(a=>a.fecha)),g=a=>new Date(a.getTime()-a.getTimezoneOffset()*6e4).toISOString().slice(0,10),w=a=>{const n=new Date,c=new Date(a);return n.setHours(0,0,0,0),c.setHours(0,0,0,0),c<n},v=a=>{let n=Array.isArray(a)?a:[a];n=n.map(c=>g(c)),n=n.filter(c=>!w(c)),d(n),C(c=>{const u={...c};return n.forEach(_=>{u[_]||(u[_]=[{hora_inicio:"08:00:00",hora_fin:"10:00:00"}])}),Object.keys(u).forEach(_=>{n.includes(_)||delete u[_]}),u})},l=a=>{const n=g(a);w(n)&&!j.has(n)||(m(n),!r.includes(n)&&!w(n)&&(d(c=>[...c,n]),C(c=>({...c,[n]:[{hora_inicio:"08:00:00",hora_fin:"10:00:00"}]}))))},k=(a,n,c,u)=>{C(_=>{const E={..._};return E[a][n][c]=u,{...E}})},L=a=>{C(n=>{const c={...n};return c[a]=[...c[a],{hora_inicio:"08:00:00",hora_fin:"10:00:00"}],c})},o=(a,n)=>{C(c=>{const u={...c};return u[a]=u[a].filter((_,E)=>E!==n),u})},p=()=>{const a=[];Object.entries(h).forEach(([n,c])=>{c.forEach(u=>a.push({fecha:n,...u}))}),s&&s(a)};return e.jsxs("div",{className:"max-w-xl mx-auto p-4 border rounded shadow bg-white",children:[e.jsx("h2",{className:"font-bold text-lg mb-2 text-center",children:"Definir Disponibilidad"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Selecciona fechas:"}),e.jsx(Te,{onChange:v,value:r.length===1?new Date(r[0]):r.map(a=>new Date(a)),selectRange:!1,minDetail:"month",maxDetail:"month",allowPartialRange:!1,showNeighboringMonth:!1,locale:"es-ES",selectMultiple:!0,tileClassName:({date:a})=>{const n=g(a);let c=[];return r.includes(n)&&c.push("selected-multiple"),h[n]&&h[n].length>0&&c.push("has-bloques"),j.has(n)&&(w(n)?c.push("fecha-pasada"):c.push("fecha-registrada")),c.join(" ")},onClickDay:l}),e.jsxs("div",{className:"mt-3 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"font-semibold mb-1 text-gray-700",children:"Leyenda:"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-100 border-2 border-green-500 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-green-500 text-xs font-bold",children:"✓"})}),e.jsx("span",{children:"Ya registrado"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-100 border-2 border-gray-400 rounded flex items-center justify-center opacity-70",children:e.jsx("span",{className:"text-gray-500 text-xs font-bold",children:"⏰"})}),e.jsx("span",{children:"Consulta pasada"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-sky-400 rounded"}),e.jsx("span",{children:"Seleccionado"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-100 border border-blue-300 rounded"}),e.jsx("span",{children:"Hoy"})]})]})]})]}),r.length===0&&e.jsx("div",{className:"text-gray-500 text-sm mb-2",children:"Selecciona al menos una fecha en el calendario."}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 min-w-[320px] max-w-md relative",children:[e.jsx("button",{onClick:()=>m(null),className:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold","aria-label":"Cerrar",children:"×"}),e.jsxs("div",{className:"font-semibold mb-2 text-blue-700",children:["Bloques para ",y]}),h[y]&&h[y].map((a,n)=>e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("input",{type:"time",value:a.hora_inicio,onChange:c=>k(y,n,"hora_inicio",c.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("span",{children:"a"}),e.jsx("input",{type:"time",value:a.hora_fin,onChange:c=>k(y,n,"hora_fin",c.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("button",{type:"button",onClick:()=>o(y,n),className:"text-red-600 hover:underline",children:"Eliminar"})]},n)),e.jsx("button",{type:"button",onClick:()=>L(y),className:"text-blue-600 hover:underline text-sm mt-1",children:"+ Agregar otro horario"}),e.jsx("button",{onClick:()=>m(null),className:"bg-blue-600 text-white px-4 py-2 rounded font-bold w-full mt-4",children:"Cerrar"})]})}),r.length>0&&!y&&r.map(a=>e.jsxs("div",{className:"mb-4 border rounded p-2 bg-gray-50",children:[e.jsx("div",{className:"font-semibold mb-1",children:a}),h[a].map((n,c)=>e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("input",{type:"time",value:n.hora_inicio,onChange:u=>k(a,c,"hora_inicio",u.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("span",{children:"a"}),e.jsx("input",{type:"time",value:n.hora_fin,onChange:u=>k(a,c,"hora_fin",u.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("button",{type:"button",onClick:()=>o(a,c),className:"text-red-600 hover:underline",children:"Eliminar"})]},c)),e.jsx("button",{type:"button",onClick:()=>L(a),className:"text-blue-600 hover:underline text-sm mt-1",children:"+ Agregar otro horario"})]},a)),e.jsx("button",{onClick:p,className:"bg-blue-600 text-white px-4 py-2 rounded font-bold w-full mt-2",children:"Guardar Disponibilidad"})]})}function Hs(){const i=JSON.parse(sessionStorage.getItem("medico")||"null")?.id,[r,d]=t.useState(null),[h,C]=t.useState({hora_inicio:"",hora_fin:""}),y=c=>{d(c.id),C({hora_inicio:c.hora_inicio,hora_fin:c.hora_fin})},m=async c=>{try{(await(await fetch(`${z}api_disponibilidad_medicos.php`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:c.id,fecha:c.fecha||"",hora_inicio:h.hora_inicio,hora_fin:h.hora_fin})})).json()).success?(d(null),L(),I.fire({icon:"success",title:"Bloque actualizado",showConfirmButton:!1,timer:1400})):I.fire({icon:"error",title:"No se pudo editar el bloque"})}catch{I.fire({icon:"error",title:"Error de red o servidor al editar"})}},j=()=>{d(null)},g=async c=>{if((await I.fire({title:"¿Seguro que deseas eliminar este bloque?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{(await(await fetch(`${z}api_disponibilidad_medicos.php`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:c})})).json()).success?(L(),I.fire({icon:"success",title:"Bloque eliminado",showConfirmButton:!1,timer:1400})):I.fire({icon:"error",title:"No se pudo eliminar el bloque"})}catch{I.fire({icon:"error",title:"Error de red o servidor al eliminar"})}},[w,v]=t.useState([]),[l,k]=t.useState(!1),L=t.useCallback(async()=>{k(!0);try{const u=await(await fetch(`${z}api_disponibilidad_medicos.php?medico_id=${i}`)).json();v(u.disponibilidad||[])}catch{v([])}k(!1)},[i]);t.useEffect(()=>{L()},[L]);const o=async c=>{try{(await(await fetch(`${z}api_disponibilidad_medicos.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({medico_id:i,bloques:c})})).json()).success?(I.fire({icon:"success",title:"Disponibilidad guardada correctamente",showConfirmButton:!1,timer:1400}),L()):I.fire({icon:"error",title:"Error al guardar disponibilidad"})}catch{I.fire({icon:"error",title:"Error de red o servidor"})}},p=w.reduce((c,u)=>(c[u.fecha]||(c[u.fecha]=[]),c[u.fecha].push(u),c),{}),a=c=>c?.slice(0,5),n=c=>{const u=new Date,_=new Date(c);return u.setHours(0,0,0,0),_.setHours(0,0,0,0),_<u};return e.jsxs("div",{className:"max-w-6xl mx-auto mt-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8 text-center col-span-2",children:"Panel del Médico"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"md:w-1/2 w-full",children:e.jsx(Is,{onSave:o,bloquesGuardados:w})}),e.jsxs("div",{className:"md:w-1/2 w-full max-h-[70vh] overflow-y-auto bg-white rounded-lg shadow-inner",children:[e.jsxs("h2",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Disponibilidad registrada"]}),l?e.jsx("div",{className:"text-center py-4",children:e.jsx(ue,{message:"Cargando disponibilidad registrada..."})}):Object.keys(p).length===0?e.jsx("div",{className:"text-gray-500 text-center py-6",children:"No hay bloques registrados aún."}):e.jsx("div",{className:"space-y-6",children:Object.keys(p).sort().map(c=>{const u=n(c);return e.jsxs("div",{className:`rounded-lg shadow p-4 ${u?"bg-gray-50 border-l-4 border-gray-400":"bg-blue-50"}`,children:[e.jsxs("div",{className:`font-semibold mb-2 flex items-center gap-2 ${u?"text-gray-600":"text-blue-700"}`,children:[u?e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(()=>{const[_,E,x]=c.split("-");return new Date(Number(_),Number(E)-1,Number(x)).toLocaleDateString()})(),u&&e.jsx("span",{className:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded-full ml-2",children:"Consulta pasada"})]}),e.jsxs("table",{className:`min-w-full text-sm border rounded overflow-hidden ${u?"opacity-70":""}`,children:[e.jsx("thead",{className:`${u?"bg-gray-200":"bg-blue-100"}`,children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1",children:"Hora inicio"}),e.jsx("th",{className:"px-2 py-1",children:"Hora fin"}),e.jsx("th",{className:"px-2 py-1 text-center",children:u?"Historial":"Acciones"})]})}),e.jsx("tbody",{children:p[c].map(_=>e.jsx("tr",{className:`${u?"hover:bg-gray-100":"hover:bg-blue-200"} transition group`,children:r===_.id&&!u?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-1 text-center",children:e.jsx("input",{type:"time",className:"border rounded px-1 py-0.5 text-green-700 font-mono",value:h.hora_inicio,onChange:E=>C(x=>({...x,hora_inicio:E.target.value}))})}),e.jsx("td",{className:"px-2 py-1 text-center",children:e.jsx("input",{type:"time",className:"border rounded px-1 py-0.5 text-red-700 font-mono",value:h.hora_fin,onChange:E=>C(x=>({...x,hora_fin:E.target.value}))})}),e.jsxs("td",{className:"px-2 py-1 text-center flex gap-1 justify-center",children:[e.jsx("button",{title:"Guardar",onClick:()=>m(_),className:"text-green-600 hover:text-green-800",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("button",{title:"Cancelar",onClick:j,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-1 text-center font-mono text-green-700",children:a(_.hora_inicio)}),e.jsx("td",{className:"px-2 py-1 text-center font-mono text-red-700",children:a(_.hora_fin)}),e.jsx("td",{className:"px-2 py-1 text-center flex gap-1 justify-center",children:u?e.jsx("span",{className:"text-xs text-gray-500 px-2 py-1 bg-gray-100 rounded",children:"Finalizado"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{title:"Editar",onClick:()=>y(_),className:"text-blue-500 hover:text-blue-700 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m2-2l-6 6"})})}),e.jsx("button",{title:"Eliminar",onClick:()=>g(_.id),className:"text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})})]})},_.id))})]})]},c)})})]})]})]})}function Vs(){return e.jsx(Hs,{})}function Ws({consultaId:s,resultadosLab:i,ordenesLab:r=[]}){const[d,h]=t.useState("laboratorio"),[C,y]=t.useState([]),m=ie();t.useEffect(()=>{fetch(`${z}/api_examenes_laboratorio.php`,{credentials:"include"}).then(g=>g.json()).then(g=>y(g.examenes||[])).catch(g=>console.error("Error al obtener exámenes:",g))},[]);const j=Ne.useMemo(()=>{const g={};for(const w of C)g[w.id]=w.nombre;return g},[C]);return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 mb-2",children:[e.jsxs("button",{onClick:()=>h("laboratorio"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${d==="laboratorio"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["🧪 ",e.jsx("span",{className:"hidden sm:inline",children:"Laboratorio"}),e.jsx("span",{className:"sm:hidden",children:"Lab"})]}),e.jsxs("button",{onClick:()=>h("rx"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${d==="rx"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["📸 ",e.jsx("span",{className:"hidden sm:inline",children:"RX"})]}),e.jsxs("button",{onClick:()=>h("ecografia"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${d==="ecografia"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["🫀 ",e.jsx("span",{className:"hidden sm:inline",children:"Ecografía"}),e.jsx("span",{className:"sm:hidden",children:"Eco"})]}),e.jsxs("button",{onClick:()=>h("tomografia"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${d==="tomografia"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["🔬 ",e.jsx("span",{className:"hidden sm:inline",children:"Tomografía"}),e.jsx("span",{className:"sm:hidden",children:"TAC"})]})]}),e.jsxs("div",{className:"border rounded-b bg-white p-3 overflow-hidden",children:[d==="laboratorio"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mb-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",onClick:()=>m(`/solicitud-laboratorio/${s}`),children:"Solicitar análisis de laboratorio"}),(!r||r.length===0)&&e.jsx("div",{className:"mb-3 p-2 bg-gray-50 border border-gray-200 rounded text-gray-600",children:"No hay exámenes solicitados para esta consulta."}),r&&r.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-yellow-50 border border-yellow-300 rounded",children:[e.jsx("div",{className:"font-semibold text-yellow-800 mb-1",children:"Exámenes solicitados:"}),r.map((g,w)=>e.jsxs("ul",{className:"list-disc ml-5 text-sm",children:[Array.isArray(g.examenes)&&g.examenes.length>0?g.examenes.map((v,l)=>typeof v=="string"||typeof v=="number"?e.jsx("li",{children:j[v]||v},l):e.jsx("li",{children:v.nombre||j[v.id]||JSON.stringify(v)},l)):e.jsx("li",{className:"text-gray-500",children:"Sin detalles de exámenes"}),e.jsxs("li",{className:"text-xs text-gray-500",children:["Estado: ",g.estado||"pendiente"]})]},g.id||w)),(!i||i.length===0||i.every(g=>!g.resultados||typeof g.resultados=="object"&&Object.keys(g.resultados).length===0||typeof g.resultados=="string"&&g.resultados.trim()===""))&&e.jsx("div",{className:"mt-2 text-sm text-gray-500",children:"Aún no hay resultados disponibles."})]}),i&&i.length>0&&i.some(g=>g.resultados&&(typeof g.resultados=="object"&&Object.keys(g.resultados).length>0||typeof g.resultados=="string"&&g.resultados.trim()!==""))&&e.jsxs("div",{className:"mb-6 p-3 sm:p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-green-800",children:"Resultados Disponibles"}),e.jsx("p",{className:"text-xs sm:text-sm text-green-600",children:"Los resultados de laboratorio ya están listos"})]})]}),e.jsxs("button",{className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg hover:shadow-xl text-sm sm:text-base",onClick:()=>m(`/resultados-laboratorio/${s}`),children:[e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden sm:inline",children:"📋 Ver Resultados de Laboratorio"}),e.jsx("span",{className:"sm:hidden",children:"📋 Ver Resultados"}),e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),d==="rx"&&e.jsx("div",{className:"text-gray-500",children:"(Próximamente: solicitud y resultados de Rayos X)"}),d==="ecografia"&&e.jsx("div",{className:"text-gray-500",children:"(Próximamente: solicitud y resultados de Ecografía)"}),d==="tomografia"&&e.jsx("div",{className:"text-gray-500",children:"(Próximamente: solicitud y resultados de Tomografía)"})]})]})}function qs({hc:s,setHc:i}){return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Anamnesis"}),e.jsxs("div",{className:"mb-2 flex flex-col md:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Tiempo de Enfermedad:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.tiempo_enfermedad,onChange:r=>i(d=>({...d,tiempo_enfermedad:r.target.value}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Forma de inicio:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.forma_inicio,onChange:r=>i(d=>({...d,forma_inicio:r.target.value}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Curso:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.curso,onChange:r=>i(d=>({...d,curso:r.target.value}))})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Descripción general del cuadro actual:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.descripcion_general||"",onChange:r=>i(d=>({...d,descripcion_general:r.target.value}))})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Antecedentes"}),e.jsx("div",{className:"mb-2",children:e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.antecedentes,onChange:r=>i(d=>({...d,antecedentes:r.target.value}))})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Examen Físico"}),e.jsx("div",{className:"mb-2",children:e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.examen_fisico,onChange:r=>i(d=>({...d,examen_fisico:r.target.value}))})})]})}function Us({triaje:s}){return s?e.jsxs("div",{className:"space-y-4",children:[s.motivo&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"📋 Motivo de Consulta"}),e.jsx("p",{className:"text-blue-800 leading-relaxed",children:s.motivo})]})]})}),s.sintomas&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-orange-900 mb-2",children:"🩺 Síntomas Principales"}),e.jsx("p",{className:"text-orange-800 leading-relaxed",children:s.sintomas})]})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),"❤️ Signos Vitales"]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:[s.presion_arterial&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Presión Arterial"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:s.presion_arterial}),e.jsx("div",{className:"text-xs text-gray-400",children:"mmHg"})]}),s.frecuencia_cardiaca&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Freq. Cardíaca"}),e.jsx("div",{className:"text-lg font-bold text-pink-600",children:s.frecuencia_cardiaca}),e.jsx("div",{className:"text-xs text-gray-400",children:"lpm"})]}),s.frecuencia_respiratoria&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Freq. Respiratoria"}),e.jsx("div",{className:"text-lg font-bold text-blue-600",children:s.frecuencia_respiratoria}),e.jsx("div",{className:"text-xs text-gray-400",children:"rpm"})]}),s.temperatura&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Temperatura"}),e.jsx("div",{className:"text-lg font-bold text-orange-600",children:s.temperatura}),e.jsx("div",{className:"text-xs text-gray-400",children:"°C"})]}),s.saturacion&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Sat. O₂"}),e.jsx("div",{className:"text-lg font-bold text-cyan-600",children:s.saturacion}),e.jsx("div",{className:"text-xs text-gray-400",children:"%"})]}),s.peso&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Peso"}),e.jsx("div",{className:"text-lg font-bold text-purple-600",children:s.peso}),e.jsx("div",{className:"text-xs text-gray-400",children:"kg"})]}),s.talla&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Talla"}),e.jsx("div",{className:"text-lg font-bold text-indigo-600",children:s.talla}),e.jsx("div",{className:"text-xs text-gray-400",children:"cm"})]}),s.peso&&s.talla&&e.jsxs("div",{className:"bg-gradient-to-r from-emerald-50 to-teal-50 rounded-lg p-3 shadow-sm border border-emerald-200",children:[e.jsx("div",{className:"text-xs text-emerald-700 font-medium uppercase",children:"IMC"}),e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:(parseFloat(s.peso)/Math.pow(parseFloat(s.talla)/100,2)).toFixed(1)}),e.jsx("div",{className:"text-xs text-emerald-500",children:"kg/m²"})]})]})]}),(s.nivel_conciencia||s.hidratacion||s.coloracion)&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-purple-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"👤 Estado General"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[s.nivel_conciencia&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Conciencia:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.nivel_conciencia==="Alerta"?"bg-green-100 text-green-800":s.nivel_conciencia==="Somnoliento"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.nivel_conciencia})]}),s.hidratacion&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Hidratación:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.hidratacion==="Normal"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:s.hidratacion})]}),s.coloracion&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Coloración:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.coloracion==="Normal"?"bg-green-100 text-green-800":s.coloracion==="Cianosis"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s.coloracion})]})]})]})]}):e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-yellow-700",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"font-medium",children:"No hay datos de triaje registrados"})]}),e.jsx("p",{className:"text-sm text-yellow-600 mt-2",children:"El triaje debe ser realizado por el personal de enfermería"})]})}function Gs({paciente:s}){return s?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",s.nombre," ",s.apellido]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",s.dni]}),e.jsxs("div",{children:[e.jsx("b",{children:"Historia Clínica:"})," ",s.historia_clinica]}),e.jsxs("div",{children:[e.jsx("b",{children:"Edad:"})," ",s.edad," ",s.edad_unidad]}),e.jsxs("div",{children:[e.jsx("b",{children:"Sexo:"})," ",s.sexo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Dirección:"})," ",s.direccion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Teléfono:"})," ",s.telefono]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",s.email]})]}):null}function Js({diagnosticos:s,setDiagnosticos:i}){const[r,d]=t.useState(""),[h,C]=t.useState([]),[y,m]=t.useState(null),[j,g]=t.useState({tipo:"principal",observaciones:""}),[w,v]=t.useState(!1);t.useEffect(()=>{if(r.length<2){C([]);return}v(!0);const p=setTimeout(async()=>{try{const n=await(await fetch(`http://localhost/clinica-2demayo/api_cie10.php?buscar=${encodeURIComponent(r)}&limite=15`)).json();n.success?C(n.data):(console.error("Error en la búsqueda:",n.message),C([]))}catch(a){console.error("Error al buscar códigos CIE10:",a),C([])}finally{v(!1)}},300);return()=>clearTimeout(p)},[r]);const l=()=>{y&&(i(o=>[...o,{...y,...j,fecha:new Date().toISOString().slice(0,10)}]),m(null),g({tipo:"secundario",observaciones:""}),d(""),C([]))},k=o=>{i(p=>p.filter(a=>a.codigo!==o))},L=(o,p)=>{i(a=>a.map(n=>n.codigo===o?{...n,tipo:p}:n))};return e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Diagnóstico (CIE10)"}),e.jsx("div",{className:"mb-2 flex flex-col sm:flex-row gap-2 items-stretch",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",className:"border rounded p-2 w-full pr-10",placeholder:"Buscar diagnóstico por nombre o código CIE10...",value:r,onChange:o=>{d(o.target.value),m(null)}}),w&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]})}),r.length>=2&&!w&&h.length===0&&e.jsxs("div",{className:"border rounded bg-yellow-50 p-3 mb-2 text-center",children:[e.jsxs("div",{className:"text-yellow-700",children:['No se encontraron códigos CIE10 para "',r,'"']}),e.jsx("div",{className:"text-xs text-yellow-600 mt-1",children:"Intenta con otros términos o códigos"})]}),h.length>0&&!y&&e.jsx("div",{className:"border rounded bg-white shadow-lg max-h-60 overflow-y-auto mb-2 z-10",children:h.map(o=>e.jsx("div",{className:"px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>m(o),children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm text-gray-900",children:o.nombre}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded mr-2",children:o.codigo}),o.categoria&&e.jsx("span",{className:"text-blue-600",children:o.categoria}),o.subcategoria&&e.jsxs("span",{className:"text-gray-500",children:[" • ",o.subcategoria]})]}),o.descripcion&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:o.descripcion})]})})},o.id))}),y&&e.jsxs("div",{className:"border rounded p-3 bg-blue-50 mb-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"font-semibold text-lg",children:y.nombre}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-mono bg-blue-100 px-2 py-1 rounded mr-2",children:y.codigo}),y.categoria&&e.jsx("span",{className:"text-blue-600",children:y.categoria}),y.subcategoria&&e.jsxs("span",{className:"text-gray-500",children:[" • ",y.subcategoria]})]}),y.descripcion&&e.jsx("div",{className:"text-sm text-gray-700 mt-2 p-2 bg-white rounded border-l-4 border-blue-400",children:y.descripcion})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-1",children:[e.jsxs("select",{className:"border rounded p-1",value:j.tipo,onChange:o=>g(p=>({...p,tipo:o.target.value})),children:[e.jsx("option",{value:"principal",children:"Principal"}),e.jsx("option",{value:"secundario",children:"Secundario"})]}),e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Observaciones",value:j.observaciones,onChange:o=>g(p=>({...p,observaciones:o.target.value}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:l,children:"Agregar diagnóstico"}),e.jsx("button",{type:"button",className:"bg-gray-400 text-white px-3 py-1 rounded",onClick:()=>m(null),children:"Cancelar"})]})]}),s.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Diagnósticos agregados:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border rounded min-w-max",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Código"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Nombre"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Tipo"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Observaciones"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Fecha"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap w-16",children:"Quitar"})]})}),e.jsx("tbody",{children:s.map((o,p)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1 font-mono text-xs whitespace-nowrap",children:o.codigo}),e.jsx("td",{className:"border px-2 py-1 max-w-xs truncate",title:o.nombre,children:o.nombre}),e.jsx("td",{className:"border px-2 py-1",children:e.jsxs("select",{className:"border rounded p-1 text-xs w-full min-w-0",value:o.tipo,onChange:a=>L(o.codigo,a.target.value),children:[e.jsx("option",{value:"principal",children:"Principal"}),e.jsx("option",{value:"secundario",children:"Secundario"})]})}),e.jsx("td",{className:"border px-2 py-1 max-w-xs truncate",title:o.observaciones,children:o.observaciones}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:o.fecha}),e.jsx("td",{className:"border px-2 py-1 text-center",children:e.jsx("button",{type:"button",className:"text-red-600 hover:text-red-800 bg-red-100 hover:bg-red-200 rounded px-2 py-1 text-xs font-medium transition-colors",onClick:()=>k(o.codigo),title:"Eliminar diagnóstico",children:"✕"})})]},o.codigo+p))})]})})]})]})}function Xs({receta:s,setReceta:i}){const r=Array.isArray(s)?s:[],[d,h]=t.useState(""),[C,y]=t.useState([]),[m,j]=t.useState(!1),[g,w]=t.useState(null),[v,l]=t.useState({dosis:"",frecuencia:"",duracion:"",observaciones:""});t.useEffect(()=>{if(d.length<2){y([]);return}j(!0),fetch(`${z}api_medicamentos.php?busqueda=${encodeURIComponent(d)}`,{credentials:"include"}).then(o=>o.json()).then(o=>y(o)).finally(()=>j(!1))},[d]);const k=()=>{if(!g)return;const o={codigo:g.codigo,nombre:g.nombre,dosis:v.dosis,frecuencia:v.frecuencia,duracion:v.duracion,observaciones:v.observaciones};i(p=>[o,...p]),w(null),l({dosis:"",frecuencia:"",duracion:"",observaciones:""}),h(""),y([])},L=o=>{i(p=>p.filter(a=>a.codigo!==o))};return e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Receta médica"}),e.jsxs("div",{className:"mb-2 flex flex-col sm:flex-row gap-2 items-stretch",children:[e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Buscar medicamento por nombre o código",value:d,onChange:o=>{h(o.target.value),w(null)}}),m&&e.jsx("span",{className:"text-xs text-gray-500",children:"Buscando..."})]}),C.length>0&&!g&&e.jsx("div",{className:"border rounded bg-white shadow max-h-40 overflow-y-auto mb-2",children:C.map(o=>e.jsxs("div",{className:"px-2 py-1 hover:bg-blue-100 cursor-pointer text-sm",onClick:()=>w(o),children:[o.nombre," ",e.jsxs("span",{className:"text-gray-500",children:["(",o.codigo,")"]})]},o.codigo))}),g&&e.jsxs("div",{className:"border rounded p-2 bg-blue-50 mb-2",children:[e.jsxs("div",{className:"font-semibold mb-1",children:[g.nombre," ",e.jsxs("span",{className:"text-gray-500",children:["(",g.codigo,")"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-1",children:[e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Dosis (ej: 500mg)",value:v.dosis,onChange:o=>l(p=>({...p,dosis:o.target.value}))}),e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Frecuencia (ej: cada 8h)",value:v.frecuencia,onChange:o=>l(p=>({...p,frecuencia:o.target.value}))}),e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Duración (ej: 5 días)",value:v.duracion,onChange:o=>l(p=>({...p,duracion:o.target.value}))})]}),e.jsx("textarea",{className:"border rounded p-1 w-full mb-2",placeholder:"Observaciones",value:v.observaciones,onChange:o=>l(p=>({...p,observaciones:o.target.value})),rows:2}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:k,children:"Agregar a receta"}),e.jsx("button",{type:"button",className:"bg-gray-400 text-white px-3 py-1 rounded",onClick:()=>w(null),children:"Cancelar"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Medicamentos seleccionados:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border rounded min-w-max",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Medicamento"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Dosis"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Frecuencia"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Duración"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Observaciones"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap w-16",children:"Quitar"})]})}),e.jsx("tbody",{children:r.length>0?r.map((o,p)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1 max-w-xs",children:e.jsxs("div",{className:"truncate",title:`${o.nombre} (${o.codigo})`,children:[o.nombre," ",e.jsxs("span",{className:"text-gray-500",children:["(",o.codigo,")"]})]})}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:o.dosis}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:o.frecuencia}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:o.duracion}),e.jsx("td",{className:"border px-2 py-1 max-w-xs truncate",title:o.observaciones,children:o.observaciones}),e.jsx("td",{className:"border px-2 py-1 text-center",children:e.jsx("button",{type:"button",className:"text-red-600 hover:text-red-800 bg-red-100 hover:bg-red-200 rounded px-2 py-1 text-xs font-medium transition-colors",onClick:()=>L(o.codigo),title:"Eliminar medicamento",children:"✕"})})]},o.codigo+p)):e.jsx("tr",{children:e.jsx("td",{className:"border px-2 py-1 text-center text-gray-500 italic",colSpan:6,children:"No hay medicamentos seleccionados"})})})]})})]})]})}function Ks({receta:s,setReceta:i,tratamiento:r,setTratamiento:d}){return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Tratamiento"}),e.jsx("div",{className:"mb-2",children:e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,placeholder:"Indicación general, reposo, dieta, fisioterapia, etc.",value:r||"",onChange:h=>d(h.target.value)})}),e.jsx(Xs,{receta:s,setReceta:i})]})}const Ys=({paciente:s,triaje:i,hc:r,diagnosticos:d,medicamentos:h,ordenesLaboratorio:C,medicoInfo:y,configuracionClinica:m})=>{const j=()=>window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?`${window.location.protocol}//${window.location.host}/2demayo.svg`:"/2demayo.svg",g=l=>l?new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",w=l=>l?new Date(l).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"",v=({titulo:l,mensaje:k="No hay información registrada"})=>e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"font-semibold text-gray-600 mb-2 border-b border-gray-300",children:l}),e.jsx("p",{className:"text-sm text-gray-500 italic text-center p-4",children:k})]});return e.jsxs("div",{className:"bg-white p-8 max-w-4xl mx-auto shadow-lg print:shadow-none print:max-w-none",children:[e.jsx("style",{jsx:!0,children:`
        @media print {
          .firma-medico {
            break-inside: avoid;
            page-break-inside: avoid;
          }
          .firma-imagen {
            print-color-adjust: exact;
            -webkit-print-color-adjust: exact;
          }
        }
      `}),e.jsx("div",{className:"text-center border-b-2 border-blue-600 pb-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-2",children:[e.jsx("img",{src:j(),alt:"Logo Clínica 2 de Mayo",className:"h-16 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-800",children:m?.nombre_clinica||"CLÍNICA 2 DE MAYO"}),e.jsx("p",{className:"text-sm text-gray-600",children:m?.direccion||"Dirección de la clínica"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Tel: ",m?.telefono||"123-456-789"," | Email: ",m?.email||"contacto@clinica2demayo.com"]})]})]})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 border-b border-gray-300 pb-2",children:"📋 HISTORIA CLÍNICA"}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mt-2",children:[e.jsxs("span",{children:["Fecha: ",g(new Date)]}),e.jsxs("span",{children:["Hora: ",w(new Date)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6 p-4 bg-blue-50 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2 border-b border-blue-200",children:"👤 DATOS DEL PACIENTE"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Nombre:"})," ",s?.nombres," ",s?.apellidos]}),e.jsxs("p",{children:[e.jsx("strong",{children:"DNI:"})," ",s?.dni]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Edad:"})," ",s?.edad," años"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Sexo:"})," ",s?.sexo]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Teléfono:"})," ",s?.telefono]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2 border-b border-blue-200",children:"🩺 INFORMACIÓN MÉDICA"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Médico:"})," Dr(a). ",y?.nombre," ",y?.apellido]}),e.jsxs("p",{children:[e.jsx("strong",{children:"CMP:"})," ",y?.cmp||"N/A"]}),y?.rne&&e.jsxs("p",{children:[e.jsx("strong",{children:"RNE:"})," ",y.rne]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Especialidad:"})," ",y?.especialidad]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha Consulta:"})," ",g(s?.fecha_consulta)]})]})]})]}),i?.motivo&&e.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-2 border-b border-yellow-300",children:"📝 MOTIVO DE CONSULTA"}),e.jsx("p",{className:"text-sm leading-relaxed",children:i.motivo})]}),i&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-2 border-b border-green-300",children:"❤️ SIGNOS VITALES"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[i.presion_arterial&&e.jsxs("div",{children:[e.jsx("strong",{children:"P/A:"})," ",i.presion_arterial," mmHg"]}),i.frecuencia_cardiaca&&e.jsxs("div",{children:[e.jsx("strong",{children:"FC:"})," ",i.frecuencia_cardiaca," lpm"]}),i.frecuencia_respiratoria&&e.jsxs("div",{children:[e.jsx("strong",{children:"FR:"})," ",i.frecuencia_respiratoria," rpm"]}),i.temperatura&&e.jsxs("div",{children:[e.jsx("strong",{children:"T°:"})," ",i.temperatura,"°C"]}),i.saturacion&&e.jsxs("div",{children:[e.jsx("strong",{children:"SpO₂:"})," ",i.saturacion,"%"]}),i.peso&&e.jsxs("div",{children:[e.jsx("strong",{children:"Peso:"})," ",i.peso," kg"]}),i.talla&&e.jsxs("div",{children:[e.jsx("strong",{children:"Talla:"})," ",i.talla," cm"]}),i.peso&&i.talla&&e.jsxs("div",{children:[e.jsx("strong",{children:"IMC:"})," ",(parseFloat(i.peso)/Math.pow(parseFloat(i.talla)/100,2)).toFixed(1)," kg/m²"]})]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"font-semibold text-purple-800 mb-3 border-b border-purple-300",children:"🔍 ANAMNESIS"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 text-sm",children:[r.tiempo_enfermedad&&e.jsxs("div",{children:[e.jsx("strong",{children:"Tiempo de Enfermedad:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:r.tiempo_enfermedad})]}),r.forma_inicio&&e.jsxs("div",{children:[e.jsx("strong",{children:"Forma de Inicio:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:r.forma_inicio})]}),r.curso&&e.jsxs("div",{children:[e.jsx("strong",{children:"Curso:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:r.curso})]})]}),r.descripcion_general&&e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Descripción General:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:r.descripcion_general})]})]}),r.antecedentes&&e.jsxs("div",{className:"mb-6 p-4 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"font-semibold text-orange-800 mb-2 border-b border-orange-300",children:"📚 ANTECEDENTES"}),e.jsx("p",{className:"text-sm leading-relaxed p-2 bg-white rounded border",children:r.antecedentes})]}),r.examen_fisico&&e.jsxs("div",{className:"mb-6 p-4 bg-teal-50 rounded-lg border border-teal-200",children:[e.jsx("h3",{className:"font-semibold text-teal-800 mb-2 border-b border-teal-300",children:"🔬 EXAMEN FÍSICO"}),e.jsx("p",{className:"text-sm leading-relaxed p-2 bg-white rounded border",children:r.examen_fisico})]}),d&&d.length>0?e.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg border border-red-200 seccion-diagnosticos",children:[e.jsx("h3",{className:"font-semibold text-red-800 mb-2 border-b border-red-300",children:"🎯 DIAGNÓSTICOS CIE-10"}),e.jsx("div",{className:"space-y-3",children:d.map((l,k)=>e.jsx("div",{className:"text-sm p-3 bg-white rounded border border-red-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"inline-block w-6 h-6 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center flex-shrink-0",children:k+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[e.jsx("span",{className:"inline-block px-2 py-1 bg-red-100 text-red-800 text-xs font-semibold rounded",children:l.tipo||"Principal"}),e.jsx("span",{className:"inline-block px-2 py-1 bg-gray-100 text-gray-800 text-xs font-mono rounded",children:l.codigo})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900 leading-relaxed",children:l.descripcion})]})]})},k))})]}):e.jsx(v,{titulo:"🎯 DIAGNÓSTICOS CIE-10",mensaje:"No se han registrado diagnósticos para esta consulta"}),r.tratamiento&&e.jsxs("div",{className:"mb-6 p-4 bg-indigo-50 rounded-lg border border-indigo-200",children:[e.jsx("h3",{className:"font-semibold text-indigo-800 mb-2 border-b border-indigo-300",children:"💊 PLAN DE TRATAMIENTO"}),e.jsx("p",{className:"text-sm leading-relaxed p-2 bg-white rounded border",children:r.tratamiento})]}),h&&h.length>0?e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200 seccion-medicamentos",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-2 border-b border-green-300",children:"💉 RECETA MÉDICA"}),e.jsx("div",{className:"space-y-3",children:h.map((l,k)=>e.jsxs("div",{className:"text-sm p-3 bg-white rounded border border-green-100",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Medicamento:"})," ",l.medicamento]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Concentración:"})," ",l.concentracion]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Forma Farmacéutica:"})," ",l.forma_farmaceutica]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Dosis:"})," ",l.dosis]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Frecuencia:"})," ",l.frecuencia]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duración:"})," ",l.duracion]})]})]}),l.indicaciones&&e.jsx("div",{className:"mt-2 pt-2 border-t border-green-100",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Indicaciones:"})," ",l.indicaciones]})})]},k))})]}):e.jsx(v,{titulo:"💉 RECETA MÉDICA",mensaje:"No se han prescrito medicamentos para esta consulta"}),C&&C.length>0?e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200 seccion-laboratorio",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2 border-b border-blue-300",children:"🔬 EXÁMENES DE LABORATORIO SOLICITADOS"}),e.jsx("div",{className:"space-y-3",children:C.map((l,k)=>e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-blue-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded",children:["Orden #",l.id||k+1]}),e.jsx("span",{className:"text-xs text-gray-500",children:g(l.fecha_solicitud)})]}),l.examenes&&l.examenes.length>0?e.jsx("div",{className:"space-y-2",children:l.examenes.map((L,o)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-blue-50 rounded border-l-4 border-blue-300",children:[e.jsx("span",{className:"w-5 h-5 bg-blue-500 text-white text-xs font-bold rounded-full flex items-center justify-center flex-shrink-0",children:o+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900",children:L.nombre}),L.descripcion&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:L.descripcion}),L.condicion_paciente&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:[e.jsx("strong",{children:"Condición:"})," ",L.condicion_paciente]}),L.tiempo_resultado&&e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[e.jsx("strong",{children:"Tiempo estimado:"})," ",L.tiempo_resultado]})]}),e.jsx("div",{className:"text-xs",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${l.estado==="pendiente"?"bg-yellow-100 text-yellow-800":l.estado==="completado"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:l.estado||"Pendiente"})})]},o))}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No hay exámenes específicos registrados"})]},k))})]}):e.jsx(v,{titulo:"🔬 EXÁMENES DE LABORATORIO SOLICITADOS",mensaje:"No se han solicitado exámenes de laboratorio para esta consulta"}),e.jsx("div",{className:"mt-8 pt-4 border-t-2 border-gray-300",children:e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("p",{children:"Documento generado digitalmente"}),e.jsxs("p",{children:["Fecha de impresión: ",g(new Date)," - ",w(new Date)]})]}),e.jsxs("div",{className:"text-center pie-firma",children:[y?.firma&&e.jsx("div",{className:"mb-4 firma-digital",children:e.jsx("img",{src:y.firma,alt:"Firma digital del médico",className:"mx-auto border border-gray-300 rounded bg-white p-1 firma-img-hc"})}),e.jsxs("div",{className:"border-t-2 border-gray-400 pt-2 min-w-[200px]",children:[e.jsxs("p",{className:"font-semibold text-sm",children:["Dr(a). ",y?.nombre," ",y?.apellido]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["CMP: ",y?.cmp||"N/A"]}),y?.rne&&e.jsxs("p",{className:"text-xs text-gray-600",children:["RNE: ",y.rne]}),e.jsx("p",{className:"text-xs text-gray-600",children:y?.especialidad}),!y?.firma&&e.jsx("div",{className:"mt-2 mb-4 h-16 flex items-center justify-center border border-dashed border-gray-300 text-xs text-gray-400",children:"[Espacio para firma manual]"})]})]})]})})]})},Qs=({paciente:s,ordenesLaboratorio:i,medicoInfo:r,configuracionClinica:d})=>{const h=()=>window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?`${window.location.protocol}//${window.location.host}/2demayo.svg`:"/2demayo.svg",C=m=>m?new Date(m).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",y=m=>m?new Date(m).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"";return e.jsxs("div",{className:"bg-white max-w-2xl mx-auto print:shadow-none print:max-w-none",style:{minHeight:"210mm",maxWidth:"148mm",padding:"10mm",fontFamily:"Arial, sans-serif",fontSize:"12px"},children:[e.jsxs("div",{className:"border-2 border-black p-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-black pb-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:h(),alt:"Logo Clínica 2 de Mayo",className:"h-10 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-bold text-black uppercase leading-tight",children:d?.nombre_clinica||"CLÍNICA 2 DE MAYO"}),e.jsx("p",{className:"text-xs text-black",children:d?.direccion||"Dirección de la clínica"}),e.jsxs("p",{className:"text-xs text-black",children:["Tel: ",d?.telefono||"123-456-789"]}),d?.ruc&&e.jsxs("p",{className:"text-xs text-black",children:["RUC: ",d.ruc]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("h2",{className:"text-sm font-bold text-black leading-tight",children:["Dr(a). ",r?.nombre," ",r?.apellido]}),e.jsx("p",{className:"text-xs text-black",children:r?.especialidad}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",r?.cmp||"N/A"]}),r?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",r.rne]})]})]}),e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-black border-b border-black pb-1",children:"📋 ORDEN DE LABORATORIO"}),e.jsxs("div",{className:"flex justify-between text-xs text-black mt-1",children:[e.jsxs("span",{children:["Fecha: ",C(new Date)]}),e.jsxs("span",{children:["Hora: ",y(new Date)]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-3",children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"👤 DATOS DEL PACIENTE"}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 text-xs",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Paciente:"})," ",s?.nombres," ",s?.apellidos]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"DNI:"})," ",s?.dni]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Edad:"})," ",s?.edad," años"]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Sexo:"})," ",s?.sexo]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"🔬 EXÁMENES SOLICITADOS"}),i&&i.length>0?e.jsx("div",{className:"space-y-2",children:i.map((m,j)=>e.jsxs("div",{className:"border border-gray-300 p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"font-bold text-black text-xs bg-blue-200 px-1 rounded",children:["#",j+1]}),e.jsxs("span",{className:"text-xs text-black",children:["Solicitud: ",C(m.fecha_solicitud)]})]}),m.examenes&&m.examenes.length>0?e.jsx("ul",{className:"list-disc pl-5 text-xs text-black",children:m.examenes.map((g,w)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:g.nombre}),g.condicion_paciente&&e.jsxs("span",{className:"ml-2 bg-yellow-100 px-1 rounded border",children:["⚠️ ",g.condicion_paciente]}),g.tiempo_resultado&&e.jsxs("span",{className:"ml-2 bg-blue-100 px-1 rounded border",children:["⏱️ ",g.tiempo_resultado]})]},w))}):e.jsx("p",{className:"text-xs text-black",children:"Sin detalles disponibles"})]},j))}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{className:"text-xs",children:"No hay órdenes de laboratorio"})})]}),e.jsx("div",{className:"space-y-2 mb-4",children:e.jsxs("div",{className:"border border-black p-2",children:[e.jsx("h3",{className:"text-xs font-bold text-black mb-1",children:"📝 INSTRUCCIONES"}),e.jsxs("div",{className:"text-xs text-black space-y-1",children:[e.jsx("p",{children:"• Presentar DNI original"}),e.jsx("p",{children:"• Seguir preparación específica"}),e.jsx("p",{children:"• Resultados según tiempo indicado"})]})]})}),e.jsx("div",{className:"border-t border-black pt-3 mt-4",children:e.jsxs("div",{className:"flex justify-between items-end text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-16 border border-dashed border-gray-400 flex items-center justify-center mb-1",children:e.jsxs("span",{className:"text-xs text-gray-500 text-center leading-tight",children:["SELLO",e.jsx("br",{}),"LAB"]})}),e.jsx("p",{className:"text-xs text-black font-bold",children:"PROCESADO"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xs text-gray-600",children:["Emitido: ",C(new Date)]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Válido 15 días"})]}),e.jsxs("div",{className:"text-center",children:[r?.firma&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:r.firma,alt:"Firma digital del médico",className:"mx-auto border border-gray-300 rounded bg-white p-1 firma-img-lab"})}),e.jsxs("div",{className:"border-t border-black pt-1 min-w-24",children:[e.jsxs("p",{className:"font-bold text-black text-xs",children:["Dr(a). ",r?.nombre," ",r?.apellido]}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",r?.cmp||"N/A"]}),r?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",r.rne]}),e.jsx("p",{className:"text-xs text-black",children:r?.especialidad}),!r?.firma&&e.jsx("div",{className:"mt-1 mb-2 h-8 flex items-center justify-center border border-dashed border-gray-400 text-xs text-gray-500",children:"[Firma Manual]"}),e.jsx("p",{className:"text-xs text-black font-bold",children:"FIRMA MÉDICO"})]})]})]})})]})},Zs=({paciente:s,medicamentos:i,medicoInfo:r,configuracionClinica:d})=>{const h=()=>window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?`${window.location.protocol}//${window.location.host}/2demayo.svg`:"/2demayo.svg",C=m=>m?new Date(m).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",y=m=>m?new Date(m).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"";return e.jsxs("div",{className:"bg-white max-w-2xl mx-auto print:shadow-none print:max-w-none",style:{minHeight:"210mm",maxWidth:"148mm",padding:"10mm",fontFamily:"Arial, sans-serif",fontSize:"12px"},children:[e.jsxs("div",{className:"border-2 border-black p-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-black pb-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:h(),alt:"Logo Clínica 2 de Mayo",className:"h-10 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-bold text-black uppercase leading-tight",children:d?.nombre_clinica||"CLÍNICA 2 DE MAYO"}),e.jsx("p",{className:"text-xs text-black",children:d?.direccion||"Dirección de la clínica"}),e.jsxs("p",{className:"text-xs text-black",children:["Tel: ",d?.telefono||"123-456-789"]}),d?.ruc&&e.jsxs("p",{className:"text-xs text-black",children:["RUC: ",d.ruc]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("h2",{className:"text-sm font-bold text-black leading-tight",children:["Dr(a). ",r?.nombre," ",r?.apellido]}),e.jsx("p",{className:"text-xs text-black",children:r?.especialidad}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",r?.cmp||"N/A"]}),r?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",r.rne]})]})]}),e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-black border-b border-black pb-1",children:"💊 RECETA MÉDICA"}),e.jsxs("div",{className:"flex justify-between text-xs text-black mt-1",children:[e.jsxs("span",{children:["Fecha: ",C(new Date)]}),e.jsxs("span",{children:["Hora: ",y(new Date)]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-3",children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"👤 DATOS DEL PACIENTE"}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 text-xs",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Paciente:"})," ",s?.nombres," ",s?.apellidos]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"DNI:"})," ",s?.dni]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Edad:"})," ",s?.edad," años"]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Sexo:"})," ",s?.sexo]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-3",style:{minHeight:"80px"},children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"💊 MEDICAMENTOS PRESCRITOS"}),i&&i.length>0?e.jsx("ul",{className:"list-disc pl-5 text-xs text-black space-y-1",children:i.map((m,j)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold uppercase",children:m.nombre||"Medicamento no especificado"}),m.dosis&&e.jsxs("span",{className:"ml-2",children:[e.jsx("strong",{children:"Dosis:"})," ",m.dosis]}),m.frecuencia&&e.jsxs("span",{className:"ml-2",children:[e.jsx("strong",{children:"Frecuencia:"})," ",m.frecuencia]}),m.duracion&&e.jsxs("span",{className:"ml-2",children:[e.jsx("strong",{children:"Duración:"})," ",m.duracion]}),m.observaciones&&e.jsxs("span",{className:"ml-2 italic",children:[e.jsx("strong",{children:"Obs:"})," ",m.observaciones]})]},j))}):e.jsx("p",{className:"text-xs text-black italic text-center py-4",children:"No se han prescrito medicamentos."})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"border border-black p-2",children:[e.jsx("h3",{className:"text-xs font-bold text-black mb-1",children:"📋 INSTRUCCIONES"}),e.jsxs("div",{className:"text-xs text-black space-y-1",children:[e.jsx("p",{children:"• Tomar según indicación médica"}),e.jsx("p",{children:"• Completar tratamiento"}),e.jsx("p",{children:"• Contactar médico si efectos adversos"})]})]}),e.jsxs("div",{className:"border border-red-500 bg-red-50 p-2",children:[e.jsx("h3",{className:"text-xs font-bold text-red-800 mb-1",children:"⚠️ ADVERTENCIAS"}),e.jsx("p",{className:"text-xs text-red-800",children:"• Receta personal e intransferible • Fuera del alcance de niños"})]})]}),e.jsx("div",{className:"border-t border-black pt-3 mt-4",children:e.jsxs("div",{className:"flex justify-between items-end text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-16 border border-dashed border-gray-400 flex items-center justify-center mb-1",children:e.jsxs("span",{className:"text-xs text-gray-500 text-center leading-tight",children:["SELLO",e.jsx("br",{}),"FARMACIA"]})}),e.jsx("p",{className:"text-xs text-black font-bold",children:"DESPACHADO"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xs text-gray-600",children:["Emitido: ",C(new Date)]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Válido 30 días"})]}),e.jsxs("div",{className:"text-center",children:[r?.firma&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:r.firma,alt:"Firma digital del médico",className:"mx-auto border border-gray-300 rounded bg-white p-1 firma-img-receta"})}),e.jsxs("div",{className:"border-t border-black pt-1 min-w-24",children:[e.jsxs("p",{className:"font-bold text-black text-xs",children:["Dr(a). ",r?.nombre," ",r?.apellido]}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",r?.cmp||"N/A"]}),r?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",r.rne]}),e.jsx("p",{className:"text-xs text-black",children:r?.especialidad}),!r?.firma&&e.jsx("div",{className:"mt-1 mb-2 h-8 flex items-center justify-center border border-dashed border-gray-400 text-xs text-gray-500",children:"[Firma Manual]"}),e.jsx("p",{className:"text-xs text-black font-bold",children:"FIRMA MÉDICO"})]})]})]})})]})},et=()=>{const s=t.useRef(),i=ke.useReactToPrint({contentRef:s,documentTitle:"Historia Clínica",onBeforeGetContent:t.useCallback(()=>new Promise(r=>{setTimeout(r,100)}),[]),pageStyle:`
      @page {
        size: A4;
        margin: 10mm;
      }
      
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
        }
        
        .print\\:shadow-none {
          box-shadow: none !important;
        }
        
        .print\\:max-w-none {
          max-width: none !important;
        }
        
        .no-print {
          display: none !important;
        }
        
        /* Colores de fondo para impresión */
        .bg-blue-50, .bg-yellow-50, .bg-green-50, 
        .bg-purple-50, .bg-orange-50, .bg-teal-50, 
        .bg-red-50, .bg-indigo-50 {
          background-color: #f8f9fa !important;
          border: 1px solid #dee2e6 !important;
        }
        
        /* Asegurar que los bordes se impriman */
        .border, .border-b, .border-t-2 {
          border-color: #6c757d !important;
        }
        
        /* Mejorar legibilidad de texto */
        .text-gray-600, .text-gray-800 {
          color: #333 !important;
        }
      }
    `});return{componentRef:s,handlePrint:i}},st=()=>{const s=t.useRef(),i=ke.useReactToPrint({contentRef:s,documentTitle:"Orden de Laboratorio",onBeforeGetContent:t.useCallback(()=>new Promise(r=>{setTimeout(r,100)}),[]),pageStyle:`
      @page {
        size: A4;
        margin: 15mm;
      }
      
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
          font-family: 'Times New Roman', serif;
        }
        
        .no-print {
          display: none !important;
        }
        
        .print\\:border-black {
          border-color: black !important;
        }
        
        .print\\:text-black {
          color: black !important;
        }
      }
    `});return{componentRef:s,handlePrint:i}},tt=()=>{const s=t.useRef(),i=ke.useReactToPrint({contentRef:s,documentTitle:"Receta Médica",onBeforeGetContent:t.useCallback(()=>new Promise(r=>{setTimeout(r,100)}),[]),pageStyle:`
      @page {
        size: A4;
        margin: 15mm;
      }
      
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
          font-family: 'Times New Roman', serif;
        }
        
        .no-print {
          display: none !important;
        }
        
        .print\\:border-black {
          border-color: black !important;
        }
        
        .print\\:text-black {
          color: black !important;
        }
      }
    `});return{componentRef:s,handlePrint:i}};function Pe(){const{pacienteId:s,consultaId:i}=de(),{componentRef:r,handlePrint:d}=et(),{componentRef:h,handlePrint:C}=st(),{componentRef:y,handlePrint:m}=tt(),[j,g]=t.useState(null),[w,v]=t.useState(null),[l,k]=t.useState(null),[L,o]=t.useState([]),[p,a]=t.useState([]);t.useEffect(()=>{i&&(fetch(`${z}api_resultados_laboratorio.php?consulta_id=${i}`).then(T=>T.json()).then(T=>{T.success&&T.resultados?o(T.resultados):o([])}).catch(()=>o([])),fetch(`${z}api_ordenes_laboratorio.php?consulta_id=${i}`).then(T=>T.json()).then(T=>{T.success&&Array.isArray(T.ordenes)?a(T.ordenes):a([])}).catch(T=>{console.error("Error al cargar órdenes de laboratorio:",T),a([])}))},[i]);const[n,c]=t.useState(null),[u,_]=t.useState(null),[E,x]=t.useState(!0),[b,f]=t.useState(""),[S,F]=t.useState({tiempo_enfermedad:"",forma_inicio:"",curso:"",antecedentes:"",examen_fisico:"",tratamiento:"",receta:[]}),[$,R]=t.useState(!1),[P,A]=t.useState(""),[H,N]=t.useState([]);return t.useEffect(()=>{i&&fetch(`${z}api_historia_clinica.php?consulta_id=${i}`,{credentials:"include"}).then(T=>T.json()).then(T=>{T.success&&T.datos&&(F({...T.datos,receta:Array.isArray(T.datos.receta)?T.datos.receta:[]}),Array.isArray(T.datos.diagnosticos)?N(T.datos.diagnosticos):N([]))})},[i]),t.useEffect(()=>{s&&(x(!0),fetch(`${z}api_pacientes.php?id=${s}`).then(T=>T.json()).then(T=>{T.success&&T.paciente?c(T.paciente):f(T.error||"No se encontró el paciente"),x(!1)}).catch(()=>{f("Error de conexión con el servidor"),x(!1)}))},[s]),t.useEffect(()=>{i&&fetch(`${z}api_triaje.php?consulta_id=${i}`).then(T=>T.json()).then(T=>{T.success&&T.triaje&&T.triaje.datos?_(T.triaje.datos):_(null)}).catch(()=>_(null))},[i]),t.useEffect(()=>{fetch(`${z}api_get_configuracion.php`,{credentials:"include"}).then(T=>T.json()).then(T=>{T.success&&T.data&&v(T.data)}).catch(()=>v(null))},[]),t.useEffect(()=>{const T=JSON.parse(sessionStorage.getItem("medico")||"null");T?(g(T),k(T.firma||null)):(g(null),k(null))},[]),E?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-white/50 flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"🏥 Cargando historia clínica..."})]})}):b?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-red-200 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Error"}),e.jsx("p",{className:"text-red-600",children:b})]})}):n?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 py-4 sm:py-8 px-2 sm:px-4 overflow-x-hidden",children:[e.jsxs("div",{className:"max-w-6xl mx-auto w-full",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-4 sm:p-6 lg:p-8 mb-6 border border-white/50 w-full",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 sm:w-8 sm:h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"text-center sm:text-left flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-blue-800 to-indigo-800 bg-clip-text text-transparent",children:"📋 Historia Clínica"}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:"Sistema Médico Integral - Clínica 2 de Mayo"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-green-100 to-blue-100 rounded-full flex-shrink-0",children:[e.jsx("div",{className:"w-2 h-2 sm:w-3 sm:h-3 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-700",children:"En línea"})]})]})}),j&&e.jsx("div",{className:`mb-6 p-4 rounded-2xl border ${l?"bg-green-50/80 border-green-200 backdrop-blur-sm":"bg-amber-50/80 border-amber-200 backdrop-blur-sm"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${l?"bg-green-500":"bg-amber-500"}`,children:l?e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${l?"text-green-800":"text-amber-800"}`,children:l?e.jsxs(e.Fragment,{children:["✍️ ",e.jsx("strong",{children:"Firma Digital Activa:"})," Los documentos impresos incluirán su firma digital."]}):e.jsxs(e.Fragment,{children:["⚠️ ",e.jsx("strong",{children:"Sin Firma Digital:"})," Los documentos impresos tendrán espacio para firma manual."]})}),e.jsxs("p",{className:`text-xs mt-1 ${l?"text-green-600":"text-amber-600"}`,children:["Dr(a). ",j.nombre," ",j.apellido," - CMP: ",j.cmp||"N/A"]})]})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"👤 Información del Paciente"})]}),e.jsx(Gs,{paciente:n})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"🚨 Triaje y Signos Vitales"})]}),e.jsx(Us,{triaje:u})]}),e.jsxs("form",{onSubmit:async T=>{T.preventDefault(),R(!0),A("");const U={...S,diagnosticos:H,receta:S.receta},M=await(await fetch(`${z}api_historia_clinica.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:i,datos:U}),credentials:"include"})).json();R(!1),A(M.success?"Guardado correctamente":M.error||"Error al guardar")},className:"space-y-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-500 to-violet-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"📝 Anamnesis y Examen Físico"})]}),e.jsx(qs,{hc:S,setHc:F})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"🔬 Laboratorio y Apoyo Diagnóstico"})]}),e.jsx(Ws,{consultaId:i,resultadosLab:L,ordenesLab:p})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"🩺 Diagnósticos CIE10"})]}),e.jsx(Js,{diagnosticos:H,setDiagnosticos:N})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-emerald-500 to-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"💊 Tratamiento y Receta Médica"})]}),e.jsx(Ks,{receta:S.receta||[],setReceta:T=>F(U=>({...U,receta:typeof T=="function"?T(U.receta):T})),tratamiento:S.tratamiento||"",setTratamiento:T=>F(U=>({...U,tratamiento:T}))})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 w-full",children:[e.jsx("button",{type:"submit",className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm whitespace-nowrap",disabled:$,children:$?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Guardando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),e.jsx("span",{children:"💾 Guardar HC"})]})}),e.jsxs("button",{type:"button",onClick:()=>{r.current?d():console.warn("Referencia de impresión no disponible")},className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg text-sm whitespace-nowrap",title:l?"Imprimir HC con firma digital":"Imprimir HC (sin firma digital)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),e.jsx("span",{children:"🖨️ HC"}),l&&e.jsx("span",{className:"text-xs bg-white/20 px-1 rounded",children:"✍️"})]}),e.jsxs("button",{type:"button",onClick:()=>{h.current&&p&&p.length>0?C():console.warn("Referencia de laboratorio no disponible o sin órdenes de laboratorio")},className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg text-sm whitespace-nowrap",disabled:!p||p.length===0,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),e.jsx("span",{children:"🔬 Lab"})]}),e.jsxs("button",{type:"button",onClick:()=>{y.current&&S.receta&&S.receta.length>0?m():console.warn("Referencia de receta no disponible o sin medicamentos")},className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg text-sm whitespace-nowrap",disabled:!S.receta||S.receta.length===0,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),e.jsx("span",{children:"💊 Receta"})]})]}),e.jsxs("div",{className:"text-center w-full mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"✍️ Firma Digital"})]}),l?e.jsxs("div",{className:"flex flex-col items-center gap-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-3 shadow-sm",children:e.jsx("img",{src:l,alt:"Firma del médico",className:"max-h-16 max-w-[200px] object-contain"})}),e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2 w-full",children:[e.jsxs("div",{className:"text-xs text-gray-600 font-medium",children:[j?.nombre," ",j?.apellido]}),j?.especialidad&&e.jsx("div",{className:"text-xs text-gray-500",children:j.especialidad}),e.jsxs("div",{className:"text-xs text-gray-500",children:["C.M.P. ",j?.cmp||"N/A",j?.rne&&` - R.N.E ${j.rne}`]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Sistema Médico Digitalizado"})]})]}):e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"FIRMA Y SELLO MÉDICO"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Sistema Médico Digitalizado"}),e.jsx("div",{className:"text-xs text-orange-500 mt-2 italic",children:"⚠️ No hay firma registrada"})]})]})]}),P&&e.jsx("div",{className:`mt-4 p-4 rounded-xl border text-center font-medium ${P.includes("correctamente")?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[P.includes("correctamente")?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),P]})})]})]})]}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px"},children:e.jsx("div",{ref:r,children:e.jsx(Ys,{paciente:n,triaje:u,hc:S,diagnosticos:H,medicamentos:S.receta,ordenesLaboratorio:p,medicoInfo:j,configuracionClinica:w})})}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px"},children:e.jsx("div",{ref:h,children:e.jsx(Qs,{paciente:n,ordenesLaboratorio:p,medicoInfo:j,configuracionClinica:w})})}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px"},children:e.jsx("div",{ref:y,children:e.jsx(Zs,{paciente:n,medicamentos:S.receta,medicoInfo:j,configuracionClinica:w})})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-gray-200 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Paciente no encontrado"}),e.jsx("p",{className:"text-gray-600",children:"No se encontró información del paciente."})]})})}function at({medicoId:s}){const[i,r]=t.useState([]),[d,h]=t.useState(!0),[C,y]=t.useState(""),[m,j]=t.useState(""),[g,w]=t.useState(3),[v,l]=t.useState(1),k=ie();t.useEffect(()=>{h(!0),fetch(`${z}api_historial_consultas_medico.php?medico_id=${s}`,{credentials:"include"}).then(u=>u.json()).then(u=>{u.success?r(u.historial):y(u.error||"Error al cargar historial"),h(!1)}).catch(()=>{y("Error de conexión"),h(!1)})},[s]);const L=i.filter(u=>u.paciente_nombre.toLowerCase().includes(m.toLowerCase())||u.motivo.toLowerCase().includes(m.toLowerCase())||u.diagnostico.toLowerCase().includes(m.toLowerCase())),o=L.length,p=Math.ceil(o/g),a=(v-1)*g,n=a+g,c=L.slice(a,n);return t.useEffect(()=>{l(1)},[m,g]),e.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Historial de Consultas"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",className:"border rounded p-2 w-full",placeholder:"Buscar por paciente, motivo o diagnóstico",value:m,onChange:u=>j(u.target.value)}),e.jsx("label",{className:"text-xs",children:"Filas por página:"}),e.jsxs("select",{value:g,onChange:u=>w(Number(u.target.value)),className:"border rounded p-1 text-xs",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]}),d?e.jsx("div",{children:"Cargando..."}):C?e.jsx("div",{className:"text-red-600",children:C}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full text-sm border rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1",children:"Fecha"}),e.jsx("th",{className:"px-2 py-1",children:"Paciente"}),e.jsx("th",{className:"px-2 py-1 hidden sm:table-cell",children:"Motivo"}),e.jsx("th",{className:"px-2 py-1 hidden md:table-cell",children:"Diagnóstico"}),e.jsx("th",{className:"px-2 py-1 hidden md:table-cell",children:"Estado"}),e.jsx("th",{className:"px-2 py-1",children:"Detalle"})]})}),e.jsx("tbody",{children:L.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-2",children:"Sin resultados"})}):c.map(u=>e.jsxs("tr",{className:"hover:bg-blue-50",children:[e.jsx("td",{className:"border px-2 py-1",children:u.fecha}),e.jsx("td",{className:"border px-2 py-1",children:u.paciente_nombre}),e.jsx("td",{className:"border px-2 py-1 hidden sm:table-cell",children:u.motivo}),e.jsx("td",{className:"border px-2 py-1 hidden md:table-cell",children:u.diagnostico}),e.jsx("td",{className:"border px-2 py-1 hidden md:table-cell",children:u.estado}),e.jsx("td",{className:"border px-2 py-1 text-center",children:e.jsx("button",{className:"text-blue-600 underline",onClick:()=>k(`/historia-clinica/${u.paciente_id}/${u.consulta_id}`),children:"Ver"})})]},u.id))})]}),o>0&&e.jsxs("div",{className:"flex justify-end items-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>l(v-1),disabled:v===1,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{className:"text-sm",children:["Página ",v," de ",p]}),e.jsx("button",{onClick:()=>l(v+1),disabled:v===p,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Siguiente"})]})]})]})}function rt({consulta:s,initialData:i,onGuardar:r,onCancelar:d}){const[h,C]=t.useState({presion_arterial:"",frecuencia_cardiaca:"",frecuencia_respiratoria:"",temperatura:"",saturacion:"",peso:"",talla:"",motivo:"",sintomas:"",nivel_conciencia:"Alerta",hidratacion:"Normal",coloracion:"Normal",clasificacion:"No urgente"});t.useEffect(()=>{i&&C({presion_arterial:i.presion_arterial||"",frecuencia_cardiaca:i.frecuencia_cardiaca||"",frecuencia_respiratoria:i.frecuencia_respiratoria||"",temperatura:i.temperatura||"",saturacion:i.saturacion||"",peso:i.peso||"",talla:i.talla||"",motivo:i.motivo||"",sintomas:i.sintomas||"",nivel_conciencia:i.nivel_conciencia||"Alerta",hidratacion:i.hidratacion||"Normal",coloracion:i.coloracion||"Normal",clasificacion:i.clasificacion||"No urgente"})},[i]);const[y,m]=t.useState(!1),j=w=>{C({...h,[w.target.name]:w.target.value})},g=w=>{w.preventDefault(),m(!0);const v={...h,clasificacion:h.clasificacion&&h.clasificacion.trim()?h.clasificacion:"No urgente"};r(v),m(!1)};return e.jsxs("form",{onSubmit:g,className:"space-y-3 p-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{name:"presion_arterial",value:h.presion_arterial,onChange:j,placeholder:"Presión arterial (mmHg)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"frecuencia_cardiaca",value:h.frecuencia_cardiaca,onChange:j,placeholder:"Frecuencia cardíaca (lpm)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"frecuencia_respiratoria",value:h.frecuencia_respiratoria,onChange:j,placeholder:"Frecuencia respiratoria (rpm)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"temperatura",value:h.temperatura,onChange:j,placeholder:"Temperatura (°C)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"saturacion",value:h.saturacion,onChange:j,placeholder:"Saturación O₂ (%)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"peso",value:h.peso,onChange:j,placeholder:"Peso (kg)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"talla",value:h.talla,onChange:j,placeholder:"Talla (cm)",className:"border rounded px-2 py-1"})]}),e.jsx("textarea",{name:"motivo",value:h.motivo,onChange:j,placeholder:"Motivo de consulta",className:"border rounded px-2 py-1 w-full"}),e.jsx("textarea",{name:"sintomas",value:h.sintomas,onChange:j,placeholder:"Síntomas principales",className:"border rounded px-2 py-1 w-full"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("select",{name:"nivel_conciencia",value:h.nivel_conciencia,onChange:j,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"Alerta",children:"Alerta"}),e.jsx("option",{value:"Somnoliento",children:"Somnoliento"}),e.jsx("option",{value:"Inconsciente",children:"Inconsciente"})]}),e.jsxs("select",{name:"hidratacion",value:h.hidratacion,onChange:j,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"Normal",children:"Hidratación normal"}),e.jsx("option",{value:"Deshidratado",children:"Deshidratado"})]}),e.jsxs("select",{name:"coloracion",value:h.coloracion,onChange:j,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"Normal",children:"Coloración normal"}),e.jsx("option",{value:"Cianosis",children:"Cianosis"}),e.jsx("option",{value:"Palidez",children:"Palidez"}),e.jsx("option",{value:"Ictericia",children:"Ictericia"})]})]}),e.jsxs("select",{name:"clasificacion",value:h.clasificacion,onChange:j,className:"border rounded px-2 py-1 w-full",children:[e.jsx("option",{value:"No urgente",children:"No urgente"}),e.jsx("option",{value:"Urgente",children:"Urgente"}),e.jsx("option",{value:"Emergencia",children:"Emergencia"})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-2",children:[e.jsx("button",{type:"button",onClick:d,className:"bg-gray-300 px-3 py-1 rounded",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-3 py-1 rounded",disabled:y,children:"Guardar triaje"})]})]})}function it(){const[s,i]=t.useState([]),[r,d]=t.useState({}),[h,C]=t.useState(!0),[y,m]=t.useState(null),[j,g]=t.useState(null),[w,v]=t.useState(null),[l,k]=t.useState(!1),[L,o]=t.useState(!1),[p,a]=t.useState(5),[n,c]=t.useState(1),[u,_]=t.useState(""),[E,x]=t.useState(""),[b,f]=t.useState(""),S=()=>{C(!0),fetch(z+"api_consultas.php",{credentials:"include"}).then(N=>N.json()).then(async N=>{if(N.success){i(N.consultas);const T={};await Promise.all(N.consultas.map(async U=>{try{const M=await(await fetch(z+`api_triaje.php?consulta_id=${U.id}`)).json();T[U.id]=M.success&&M.triaje?"Completado":"Pendiente"}catch{T[U.id]="Pendiente"}})),d(T)}else m(N.error||"Error al cargar consultas");C(!1)}).catch(N=>{m("Error de red"),C(!1)})};if(t.useEffect(()=>{S()},[]),h)return e.jsx(ue,{message:"Cargando pacientes en triaje..."});if(y)return e.jsx("div",{className:"text-red-600",children:y});let F=s.filter(N=>{const T=u.trim().toLowerCase();return T&&!(N.historia_clinica&&N.historia_clinica.toLowerCase().includes(T)||N.paciente_nombre&&N.paciente_nombre.toLowerCase().includes(T)||N.paciente_apellido&&N.paciente_apellido.toLowerCase().includes(T)||N.medico_nombre&&N.medico_nombre.toLowerCase().includes(T))?!1:!E&&!b?!0:!(!N.fecha||E&&N.fecha<E||b&&N.fecha>b)});const $=F.length,R=Math.ceil($/p),P=(n-1)*p,A=P+p,H=F.slice(P,A);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-600 rounded-2xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl",children:e.jsx(W,{iconName:"People",className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:$}),e.jsx("div",{className:"text-sm text-emerald-100",children:"Total Pacientes"})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-yellow-500 to-orange-600 rounded-2xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl",children:e.jsx(W,{iconName:"Clock",className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.values(r).filter(N=>N==="Pendiente").length}),e.jsx("div",{className:"text-sm text-yellow-100",children:"Triajes Pendientes"})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl",children:e.jsx(W,{iconName:"CheckMark",className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.values(r).filter(N=>N==="Completado").length}),e.jsx("div",{className:"text-sm text-blue-100",children:"Triajes Completados"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(W,{iconName:"Filter",className:"text-xl text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Filtros de búsqueda"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{iconName:"Search",className:"text-lg text-gray-400"})}),e.jsx("input",{type:"text",value:u,onChange:N=>{_(N.target.value),c(1)},placeholder:"Buscar paciente, médico...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{iconName:"Calendar",className:"text-lg text-gray-400"})}),e.jsx("input",{type:"date",value:E,onChange:N=>{x(N.target.value),c(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300",placeholder:"Fecha desde"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{iconName:"Calendar",className:"text-lg text-gray-400"})}),e.jsx("input",{type:"date",value:b,onChange:N=>{f(N.target.value),c(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300",placeholder:"Fecha hasta"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{iconName:"NumberedList",className:"text-lg text-gray-400"})}),e.jsxs("select",{value:p,onChange:N=>{a(Number(N.target.value)),c(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300 appearance-none bg-white",children:[e.jsx("option",{value:5,children:"5 por página"}),e.jsx("option",{value:10,children:"10 por página"}),e.jsx("option",{value:25,children:"25 por página"})]})]})]}),(u||E||b)&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:()=>{_(""),x(""),f(""),c(1)},className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors duration-300",children:[e.jsx(W,{iconName:"Clear",className:"text-lg"}),e.jsx("span",{children:"Limpiar filtros"})]})})]}),j?e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(W,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold",children:["Triaje: ",j.paciente_nombre," ",j.paciente_apellido]}),e.jsxs("p",{className:"text-emerald-100",children:["Historia Clínica: ",j.historia_clinica||"N/A"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-white/20 rounded-xl px-3 py-2",children:[e.jsx(W,{iconName:"Calendar",className:"text-lg"}),e.jsxs("span",{children:[j.fecha," - ",j.hora]})]})]})}),e.jsx("div",{className:"p-6",children:L?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-emerald-200 border-t-emerald-500 rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Cargando datos de triaje..."})]})}):e.jsx(rt,{consulta:j,initialData:w,onGuardar:async N=>{k(!0);const T={consulta_id:j.id,datos:{...N,paciente_id:j.paciente_id}};try{const Q=await(await fetch(z+"api_triaje.php",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(T)})).json();Q.success||(console.error("Error al guardar triaje:",Q.error),alert("Error al guardar triaje: "+(Q.error||"Error desconocido")))}catch(U){console.error("Error de red al guardar triaje:",U),alert("Error de red al guardar triaje")}k(!1),g(null),v(null),S()},onCancelar:()=>{g(null),v(null)},guardando:l})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{iconName:"Table",className:"text-xl text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Lista de Pacientes para Triaje"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:F.length>0?`Mostrando ${H.length} de ${F.length} pacientes`:"No hay pacientes"})]})}),e.jsx("div",{className:"overflow-x-auto",children:F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex items-center justify-center w-20 h-20 bg-gray-100 rounded-full mx-auto mb-4",children:e.jsx(W,{iconName:"Health",className:"text-4xl text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No hay pacientes"}),e.jsx("p",{className:"text-gray-500",children:"No se encontraron pacientes pendientes de triaje"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Historia Clínica"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Paciente"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Médico"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Fecha y Hora"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Estado"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Acción"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:H.map(N=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-200",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{iconName:"NumberField",className:"text-lg text-gray-400"}),e.jsx("span",{className:"font-mono text-sm",children:N.historia_clinica||"-"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-emerald-100 rounded-full",children:e.jsx(W,{iconName:"Contact",className:"text-lg text-emerald-600"})}),e.jsx("div",{children:e.jsxs("div",{className:"font-semibold text-gray-800",children:[N.paciente_nombre," ",N.paciente_apellido]})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{iconName:"Health",className:"text-lg text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:N.medico_nombre||"-"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{iconName:"Calendar",className:"text-lg text-gray-400"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-800",children:N.fecha}),e.jsx("div",{className:"text-gray-500",children:N.hora})]})]})}),e.jsx("td",{className:"px-6 py-4",children:r[N.id]==="Completado"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:[e.jsx(W,{iconName:"CheckMark",className:"text-sm"}),"Completado"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(W,{iconName:"Clock",className:"text-sm"}),"Pendiente"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-emerald-500 to-green-600 text-white font-semibold rounded-xl hover:from-emerald-600 hover:to-green-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",onClick:async()=>{g(N),o(!0),v(null);try{const U=await(await fetch(z+`api_triaje.php?consulta_id=${N.id}`)).json();U.success&&U.triaje&&U.triaje.datos?v(U.triaje.datos):v(null)}catch{v(null)}o(!1)},children:[e.jsx(W,{iconName:"Health",className:"text-lg"}),"Realizar Triaje"]})})]},N.id))})]})}),e.jsx("div",{className:"lg:hidden p-4 space-y-4",children:H.map(N=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 shadow-sm hover:shadow-md transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-emerald-100 rounded-full",children:e.jsx(W,{iconName:"Contact",className:"text-xl text-emerald-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-800 text-lg",children:[N.paciente_nombre," ",N.paciente_apellido]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(W,{iconName:"NumberField",className:"text-sm"}),"HC: ",N.historia_clinica||"N/A"]})]})]}),r[N.id]==="Completado"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(W,{iconName:"CheckMark",className:"text-xs"}),"Completado"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(W,{iconName:"Clock",className:"text-xs"}),"Pendiente"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{iconName:"Health",className:"text-lg text-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Médico"}),e.jsx("div",{className:"text-sm text-gray-800",children:N.medico_nombre||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{iconName:"Calendar",className:"text-lg text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Fecha y Hora"}),e.jsxs("div",{className:"text-sm text-gray-800",children:[N.fecha," - ",N.hora]})]})]})]}),e.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-emerald-500 to-green-600 text-white font-semibold rounded-xl hover:from-emerald-600 hover:to-green-700 transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl",onClick:async()=>{g(N),o(!0),v(null);try{const U=await(await fetch(z+`api_triaje.php?consulta_id=${N.id}`)).json();U.success&&U.triaje&&U.triaje.datos?v(U.triaje.datos):v(null)}catch{v(null)}o(!1)},children:[e.jsx(W,{iconName:"Health",className:"text-xl"}),"Realizar Triaje"]})]},N.id))})]})})]}),F.length>0&&R>1&&e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",P+1," - ",Math.min(A,$)," de ",$," pacientes"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>c(n-1),disabled:n===1,className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 text-gray-700 rounded-xl transition-all duration-300 disabled:cursor-not-allowed",children:[e.jsx(W,{iconName:"ChevronLeft",className:"text-lg"}),e.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"px-3 py-2 text-sm font-medium text-gray-600",children:["Página ",n," de ",R]})}),e.jsxs("button",{onClick:()=>c(n+1),disabled:n===R,className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 text-gray-700 rounded-xl transition-all duration-300 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx(W,{iconName:"ChevronRight",className:"text-lg"})]})]})]})})]})]})}function nt(){const[s,i]=t.useState("triage"),r=[{key:"triage",label:"Triaje",icon:"Health",color:"emerald",description:"Evaluación inicial de pacientes"},{key:"tratamientos",label:"Tratamientos",icon:"Health",color:"blue",description:"Gestión de tratamientos"},{key:"hospitalizacion",label:"Hospitalización",icon:"Hospital",color:"purple",description:"Control de hospitalización"}],d=(h,C)=>({emerald:C?"bg-gradient-to-r from-emerald-500 to-green-600 text-white shadow-lg border-emerald-300":"bg-white text-emerald-700 border-emerald-200 hover:bg-emerald-50 hover:border-emerald-300",blue:C?"bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg border-blue-300":"bg-white text-blue-700 border-blue-200 hover:bg-blue-50 hover:border-blue-300",purple:C?"bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg border-purple-300":"bg-white text-purple-700 border-purple-200 hover:bg-purple-50 hover:border-purple-300"})[h];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 via-cyan-50 to-blue-50 p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-teal-600 via-cyan-600 to-blue-600 rounded-2xl p-6 sm:p-8 text-white shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-12 -translate-x-12"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-white/20 rounded-2xl backdrop-blur-sm",children:e.jsx(W,{iconName:"Health",className:"text-3xl text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold drop-shadow-lg",children:"Panel de Enfermería"}),e.jsx("p",{className:"text-lg text-white/90 mt-1",children:"Gestión integral de cuidados médicos"})]})]})})]})}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto",children:r.map(h=>e.jsxs("button",{className:`group relative p-6 rounded-2xl border-2 font-semibold transition-all duration-300 transform hover:scale-[1.02] ${d(h.color,s===h.key)}`,onClick:()=>i(h.key),children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:`flex items-center justify-center w-12 h-12 rounded-xl ${s===h.key?"bg-white/20":`bg-${h.color}-100`}`,children:e.jsx(W,{iconName:h.icon,className:`text-2xl ${s===h.key?"text-white":`text-${h.color}-600`}`})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:h.label}),e.jsx("div",{className:`text-sm ${s===h.key?"text-white/80":"text-gray-600"}`,children:h.description})]})]}),s===h.key&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-white rounded-full shadow-lg flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"})})]},h.key))})}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[s==="triage"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(W,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Control de Triaje"}),e.jsx("p",{className:"text-emerald-100",children:"Evaluación y clasificación de pacientes"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx(it,{})})]}),s==="tratamientos"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(W,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gestión de Tratamientos"}),e.jsx("p",{className:"text-blue-100",children:"Control y seguimiento de tratamientos"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full mx-auto mb-4",children:e.jsx(W,{iconName:"Health",className:"text-4xl text-blue-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Módulo en Desarrollo"}),e.jsx("p",{className:"text-gray-600",children:"La gestión de tratamientos estará disponible próximamente"})]})})]}),s==="hospitalizacion"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(W,{iconName:"Hospital",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Control de Hospitalización"}),e.jsx("p",{className:"text-purple-100",children:"Gestión de pacientes hospitalizados"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex items-center justify-center w-20 h-20 bg-purple-100 rounded-full mx-auto mb-4",children:e.jsx(W,{iconName:"Hospital",className:"text-4xl text-purple-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Módulo en Desarrollo"}),e.jsx("p",{className:"text-gray-600",children:"El control de hospitalización estará disponible próximamente"})]})})]})]})]})}function lt(){return e.jsx(nt,{})}Ne.createElement;function ot({selected:s,setSelected:i}){const[r,d]=t.useState([]),[h,C]=t.useState(""),[y,m]=t.useState(!1);t.useEffect(()=>{m(!0),fetch(z+"api_examenes_laboratorio.php",{credentials:"include"}).then(w=>w.json()).then(w=>d(w.examenes||[])).finally(()=>m(!1))},[]);const j=r.filter(w=>w.nombre.toLowerCase().includes(h.toLowerCase())||w.metodologia&&w.metodologia.toLowerCase().includes(h.toLowerCase())),g=w=>{i(v=>v.includes(w)?v.filter(l=>l!==w):[...v,w])};return e.jsxs("div",{className:"mb-2",children:[e.jsx("input",{type:"text",value:h,onChange:w=>C(w.target.value),placeholder:"Buscar examen...",className:"border rounded p-2 text-xs w-full mb-2"}),e.jsx("div",{className:"max-h-48 overflow-y-auto border rounded bg-white",children:y?e.jsx("div",{className:"p-2 text-center text-gray-500 text-xs",children:"Cargando..."}):j.length===0?e.jsx("div",{className:"p-2 text-center text-gray-500 text-xs",children:"Sin exámenes"}):j.map(w=>e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 border-b last:border-b-0 cursor-pointer hover:bg-blue-50 text-xs",children:[e.jsx("input",{type:"checkbox",checked:s.includes(w.id),onChange:()=>g(w.id)}),e.jsx("span",{className:"font-medium",children:w.nombre}),e.jsx("span",{className:"text-gray-400",children:w.metodologia})]},w.id))})]})}function ct({consultaId:s,mostrarPrecios:i=!0}){const[r,d]=t.useState([]),[h,C]=t.useState([]),[y,m]=t.useState(!1),[j,g]=t.useState("");t.useEffect(()=>{fetch(z+"api_examenes_laboratorio.php",{credentials:"include"}).then(k=>k.json()).then(k=>C(k.examenes||[]))},[]);const w=h.filter(k=>r.includes(k.id)),v=w.reduce((k,L)=>k+(parseFloat(L.precio_publico)||0),0),l=async k=>{k.preventDefault(),m(!0),g("");try{if((await fetch(z+"api_ordenes_laboratorio.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:s,examenes:r})})).ok)g("Orden enviada correctamente"),d([]),setTimeout(()=>g(""),3e3);else throw new Error("Error al enviar la orden")}catch{g("Error al enviar la orden. Intente nuevamente."),setTimeout(()=>g(""),5e3)}finally{m(!1)}};return t.useEffect(()=>{fetch(z+"api_examenes_laboratorio.php",{credentials:"include"}).then(k=>k.json()).then(k=>C(k.examenes||[]))},[]),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 border border-emerald-200 rounded-xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx("svg",{className:"w-7 h-7 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-emerald-800",children:"🔬 Solicitud de Análisis de Laboratorio"}),e.jsx("p",{className:"text-sm text-emerald-600",children:"Seleccione los exámenes requeridos para el diagnóstico"})]})]}),e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-emerald-100 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),e.jsx("label",{className:"font-semibold text-emerald-800",children:"Exámenes Disponibles:"})]}),e.jsx(ot,{selected:r,setSelected:d})]}),r.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"font-semibold text-blue-800",children:["📋 Exámenes Seleccionados (",r.length,")"]})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-3",children:w.map(k=>e.jsx("div",{className:"bg-white rounded-lg p-3 border border-blue-100 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:k.nombre}),i&&e.jsxs("div",{className:"text-sm text-green-700 font-semibold mt-1",children:["Precio público: S/ ",parseFloat(k.precio_publico).toFixed(2)]}),(k.condicion_paciente||k.tiempo_resultado)&&e.jsxs("div",{className:"mt-1 space-y-1",children:[k.condicion_paciente&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3 text-amber-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-xs text-amber-700 font-medium",children:k.condicion_paciente})]}),k.tiempo_resultado&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-xs text-gray-600",children:["⏱️ ",k.tiempo_resultado]})]})]})]})]})},k.id))}),i&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800 font-bold text-lg flex justify-end",children:["Total cotización: S/ ",v.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"submit",className:`
              px-6 py-3 rounded-lg font-semibold text-white shadow-lg transition-all duration-200
              flex items-center gap-2 min-w-[140px] justify-center
              ${r.length===0||y?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-emerald-600 to-teal-700 hover:from-emerald-700 hover:to-teal-800 hover:shadow-xl transform hover:-translate-y-0.5"}
            `,disabled:y||r.length===0,children:y?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Enviando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),e.jsx("span",{children:"Solicitar Exámenes"})]})}),e.jsx("div",{className:"text-sm text-emerald-700 font-medium",children:r.length===0?e.jsx("span",{className:"text-gray-500",children:"Ningún examen seleccionado"}):e.jsxs("span",{children:["✅ ",r.length," examen",r.length!==1?"es":""," seleccionado",r.length!==1?"s":""]})})]}),j&&e.jsxs("div",{className:`
            rounded-lg p-4 border shadow-sm flex items-center gap-3
            ${j.includes("correctamente")?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}
          `,children:[j.includes("correctamente")?e.jsx("svg",{className:"w-6 h-6 text-green-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-6 h-6 text-red-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"font-semibold",children:j})]})]})]})}function dt(){const{consultaId:s}=de();let i=!0;try{const r=sessionStorage.getItem("usuario"),d=sessionStorage.getItem("medico"),h=r?JSON.parse(r):d?JSON.parse(d):null;h&&h.rol==="medico"&&(i=!1)}catch{i=!0}return e.jsxs("div",{className:"max-w-xl mx-auto p-6 bg-white rounded shadow mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Solicitud de Análisis de Laboratorio"}),e.jsxs("div",{className:"mb-4 text-center text-gray-600",children:[e.jsx("b",{children:"Consulta ID:"})," ",s]}),e.jsx(ct,{consultaId:s,mostrarPrecios:i}),e.jsx("div",{className:"text-center",children:e.jsx(ae,{to:-1,className:"text-blue-600 hover:underline",children:"← Volver a la historia clínica"})})]})}function xt(){const[s,i]=t.useState(!1),[r,d]=t.useState([]),[h,C]=t.useState(0),y=ie(),{pacienteId:m}=de(),[j,g]=t.useState([]),[w,v]=t.useState([]),[l,k]=t.useState([]),[L,o]=t.useState([]),[p,a]=t.useState(!0),[n,c]=t.useState(""),[u,_]=t.useState(""),[E,x]=t.useState(""),[b,f]=t.useState(0),[S,F]=t.useState(3),[$,R]=t.useState(null),[P,A]=t.useState(null);t.useEffect(()=>{Promise.all([fetch(`${z}api_examenes_laboratorio.php`,{credentials:"include"}).then(O=>O.json()),fetch(`${z}api_tarifas.php`,{credentials:"include"}).then(O=>O.json()),fetch(`${z}api_examenes_laboratorio_ranking.php`,{credentials:"include"}).then(O=>O.json()),m?fetch(`${z}api_pacientes.php?id=${m}`,{credentials:"include"}).then(O=>O.json()):Promise.resolve({success:!1})]).then(([O,G,D,V])=>{g(O.examenes||[]),o(G.tarifas||[]),v(D.ranking||[]),V&&V.success&&V.paciente&&A(V.paciente),a(!1)})},[m]);const H=O=>{k(G=>G.includes(O)?G.filter(D=>D!==O):[...G,O]),_("")},N=()=>l.reduce((O,G)=>{const D=L.find(V=>V.servicio_tipo==="laboratorio"&&V.examen_id===G&&V.activo===1);return O+(D?parseFloat(D.precio_particular):0)},0);if(p)return e.jsx("div",{children:"Cargando exámenes y tarifas..."});const T=Array.from(new Set(j.map(O=>O.categoria).filter(Boolean))),U=w.map(O=>parseInt(O.id)),M=[...j].sort((O,G)=>{const D=U.indexOf(O.id),V=U.indexOf(G.id);return D===-1&&V===-1?O.nombre.localeCompare(G.nombre):D===-1?1:V===-1?-1:D-V}).filter(O=>{const G=n.trim().length===0||O.nombre.toLowerCase().includes(n.toLowerCase()),D=E===""||O.categoria===E;return G&&D}),q=Math.max(1,Math.ceil(M.length/S)),J=M.slice(b*S,b*S+S),ee=()=>{k([]),_("")},B=()=>{if(l.length===0){_("Selecciona al menos un examen para cobrar.");return}const O=l.map(G=>{const D=j.find(te=>te.id===G),V=L.find(te=>te.servicio_tipo==="laboratorio"&&te.examen_id===G&&te.activo===1);let X=D&&typeof D.nombre=="string"&&D.nombre.trim()!==""&&D.nombre!=="0"?D.nombre:"Examen sin nombre";return{servicio_tipo:"laboratorio",servicio_id:G,descripcion:X,cantidad:1,precio_unitario:V?parseFloat(V.precio_particular):0,subtotal:V?parseFloat(V.precio_particular):0}});d(O),C(O.reduce((G,D)=>G+D.subtotal,0)),i(!0)};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 md:p-8 bg-white rounded-xl shadow-lg mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"🔬"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Cotización de Laboratorio"})]}),e.jsx("button",{onClick:()=>y("/seleccionar-servicio",{state:{pacienteId:m}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"})]}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("b",{children:"ID Paciente:"})," ",m]}),e.jsx("input",{type:"text",value:n,onChange:O=>c(O.target.value),placeholder:"Buscar examen...",className:"border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-64"})]}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-2 items-center",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Filtrar por categoría:"}),e.jsxs("select",{value:E,onChange:O=>x(O.target.value),className:"border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-64",children:[e.jsx("option",{value:"",children:"Todas"}),T.map(O=>e.jsx("option",{value:O,children:O},O))]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Selecciona los exámenes:"}),e.jsx("div",{className:"mb-2 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:e.jsxs("div",{className:"w-full bg-white shadow-md rounded-xl border border-gray-200 px-4 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"text-sm text-gray-700 flex gap-4 items-center",children:[e.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1",children:["Total exámenes: ",e.jsx("b",{children:M.length})]}),e.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1",children:["Páginas: ",e.jsx("b",{children:q})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("button",{disabled:b===0||q===1,onClick:()=>f(O=>Math.max(0,O-1)),className:"px-2 py-1 rounded-full bg-blue-100 text-blue-700 disabled:opacity-50 hover:bg-blue-200 transition-colors shadow-sm",title:"Página anterior",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("span",{className:"px-3 py-1 text-sm font-medium bg-gray-50 rounded",children:["Página ",b+1," de ",q||1]}),e.jsx("button",{disabled:b>=q-1||q===1,onClick:()=>f(O=>Math.min(q-1,O+1)),className:"px-2 py-1 rounded-full bg-blue-100 text-blue-700 disabled:opacity-50 hover:bg-blue-200 transition-colors shadow-sm",title:"Página siguiente",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsxs("select",{value:S,onChange:O=>{F(Number(O.target.value)),f(0)},className:"border border-gray-300 rounded-lg px-2 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 ml-2",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]})]})}),M.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No hay exámenes para mostrar."}):e.jsx("div",{className:"bg-white rounded-lg shadow border border-gray-200",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:J.map(O=>{const G=L.find(D=>D.servicio_tipo==="laboratorio"&&D.examen_id===O.id&&D.activo===1);return e.jsxs("li",{className:"flex items-center px-4 py-3 hover:bg-blue-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:l.includes(O.id),onChange:()=>H(O.id),className:"mr-3 accent-blue-600 w-5 h-5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:O.nombre}),O.categoria&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded mt-1 inline-block",children:O.categoria})]}),e.jsxs("div",{className:"font-bold text-green-700 text-lg",children:["S/ ",G?G.precio_particular:"-"]})]},O.id)})})})]})}),e.jsxs("div",{className:"w-full md:w-96 md:sticky md:top-8 h-fit",children:[l.length>0&&!s&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotización"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:l.map(O=>{const G=j.find(V=>V.id===O),D=L.find(V=>V.servicio_tipo==="laboratorio"&&V.examen_id===O&&V.activo===1);return e.jsxs("li",{className:"py-2 flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:G?.nombre}),G?.condicion_paciente&&e.jsxs("span",{className:"block text-xs text-gray-400 mt-1",children:["Condición: ",G.condicion_paciente]}),G?.tiempo_resultado&&e.jsxs("span",{className:"block text-xs text-gray-400",children:["Tiempo: ",G.tiempo_resultado]})]}),e.jsxs("div",{className:"font-bold text-green-700 text-right",children:["S/ ",D?D.precio_particular:"-"]})]},O)})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",N().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:ee,className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:B,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Cobrar"})]})]}),s&&P&&e.jsx(pe,{paciente:P,servicio:{key:"laboratorio",label:"Laboratorio"},detalles:r,total:h,onCobroCompleto:()=>{i(!1),_("Cotización procesada correctamente.")},onCancelar:()=>i(!1)})]})]}),u&&e.jsx("div",{className:`mt-6 text-center font-semibold ${u.includes("correctamente")?"text-green-600":"text-red-600"}`,children:u}),$&&e.jsxs("div",{className:"mt-8 mx-auto max-w-lg bg-white rounded-xl shadow-lg border border-blue-200 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-700 mb-2",children:"Comprobante de Cotización"}),e.jsxs("div",{className:"mb-2 text-blue-800 font-semibold",children:["Nº comprobante: ",$.numero]}),e.jsxs("div",{className:"mb-2 text-gray-600 text-sm",children:["Fecha: ",$.fecha]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-4",children:$.detalles.map((O,G)=>e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-800",children:O.descripcion}),e.jsxs("span",{className:"text-green-700 font-bold",children:["S/ ",O.precio_unitario.toFixed(2)]})]},G))}),e.jsxs("div",{className:"text-right text-lg font-bold text-blue-700 border-t pt-2",children:["Total: S/ ",$.total.toFixed(2)]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Imprimir"}),e.jsx("button",{onClick:()=>R(null),className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Cerrar"})]})]})]})}function mt(){const[s,i]=t.useState(!1),[r,d]=t.useState([]),[h,C]=t.useState(0),{pacienteId:y}=de(),m=ie(),[j,g]=t.useState(null),[w,v]=t.useState([]),[l,k]=t.useState([]),[L,o]=t.useState({}),[p,a]=t.useState("");t.useEffect(()=>{fetch(`${z}api_pacientes.php?id=${y}`).then(x=>x.json()).then(x=>{x.success&&x.paciente&&g(x.paciente)}),fetch(`${z}api_tarifas.php`,{credentials:"include"}).then(x=>x.json()).then(x=>{const b=(x.tarifas||[]).filter(f=>f.servicio_tipo==="rayosx");v(b)})},[y]);const n=x=>{k(b=>b.includes(x)?b:[...b,x]),o(b=>({...b,[x]:1}))},c=x=>{k(b=>b.filter(f=>f!==x)),o(b=>{const f={...b};return delete f[x],f})},u=(x,b)=>{o(f=>({...f,[x]:b}))},_=()=>l.reduce((x,b)=>{const f=w.find(F=>F.id===b),S=L[b]||1;return f?x+f.precio_particular*S:x},0),E=async()=>{if(l.length===0){a("Selecciona al menos un estudio de Rayos X.");return}const x=l.map(b=>{const f=w.find(F=>F.id===b),S=L[b]||1;return f?{servicio_tipo:"rayosx",servicio_id:b,descripcion:f.descripcion||f.nombre,cantidad:S,precio_unitario:f.precio_particular,subtotal:f.precio_particular*S}:null}).filter(Boolean);d(x),C(_()),i(!0)};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-2xl shadow-2xl mt-8 border border-blue-100",children:[e.jsx("button",{onClick:()=>m("/seleccionar-servicio",{state:{pacienteId:y}}),className:"mb-4 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded text-gray-700 font-semibold",children:"← Volver"}),e.jsxs("h2",{className:"text-2xl font-bold text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"rayosx",children:"🩻"})," Cotizador de Rayos X"]}),j&&e.jsxs("div",{className:"mb-4 p-2 bg-blue-50 rounded text-blue-800 text-sm",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",j.nombres||j.nombre," ",j.apellidos||j.apellido," (DNI: ",j.dni,")"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"mb-4 max-h-[500px] overflow-y-auto",children:[e.jsx("div",{className:"font-bold mb-2",children:"Estudios disponibles:"}),w.length===0?e.jsx("div",{className:"text-gray-500",children:"No hay estudios de Rayos X registrados."}):e.jsx("ul",{className:"divide-y divide-gray-100",children:w.map(x=>e.jsxs("li",{className:"flex items-center gap-4 py-3 px-2 hover:bg-blue-50 rounded-lg transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:x.descripcion||x.nombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Precio: S/ ",x.precio_particular]})]}),l.includes(x.id)?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:1,value:L[x.id]||1,onChange:b=>u(x.id,Math.max(1,Number(b.target.value))),className:"border rounded-lg px-2 w-16 bg-white"}),e.jsx("button",{onClick:()=>c(x.id),className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-xl shadow transition","aria-label":"Quitar",children:"✕"})]}):e.jsx("button",{onClick:()=>n(x.id),className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-100 hover:bg-green-200 text-green-700 text-xl shadow transition","aria-label":"Agregar",children:"+"})]},x.id))})]}),e.jsxs("div",{className:"w-full md:w-96 md:sticky md:top-8 h-fit",children:[l.length>0&&!s&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"font-semibold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"📝"}),"Resumen de Cotización"]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-2 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:l.map(x=>{const b=w.find(S=>S.id===x),f=L[x]||1;return b?e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{children:b.descripcion||b.nombre}),e.jsxs("span",{children:[f," estudio(s)"]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",(b.precio_particular*f).toFixed(2)]})]},x):null})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",_().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>{k([]),a("")},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:E,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Registrar Cotización"})]})]}),s&&e.jsx(pe,{paciente:j,servicio:{key:"rayosx",label:"Rayos X"},detalles:r,total:h,onCobroCompleto:()=>{i(!1),k([]),o({}),a("Cobro procesado correctamente.")},onCancelar:()=>i(!1)})]})]}),p&&e.jsx("div",{className:"mt-4 text-center font-semibold text-green-600",children:p})]})}function ht(){const[s,i]=t.useState(!1),[r,d]=t.useState([]),[h,C]=t.useState(0),{pacienteId:y}=de(),m=ie(),[j,g]=t.useState(null),[w,v]=t.useState([]),[l,k]=t.useState([]),[L,o]=t.useState({}),[p,a]=t.useState("");t.useEffect(()=>{fetch(`${z}api_pacientes.php?id=${y}`).then(x=>x.json()).then(x=>{x.success&&x.paciente&&g(x.paciente)}),fetch(`${z}api_tarifas.php`,{credentials:"include"}).then(x=>x.json()).then(x=>{const b=(x.tarifas||[]).filter(f=>f.servicio_tipo==="ecografia");v(b)})},[y]);const n=x=>{k(b=>b.includes(x)?b:[...b,x]),o(b=>({...b,[x]:1}))},c=x=>{k(b=>b.filter(f=>f!==x)),o(b=>{const f={...b};return delete f[x],f})},u=(x,b)=>{o(f=>({...f,[x]:b}))},_=()=>l.reduce((x,b)=>{const f=w.find(F=>F.id===b),S=L[b]||1;return f?x+f.precio_particular*S:x},0),E=async()=>{if(l.length===0){a("Selecciona al menos una ecografía.");return}const x=l.map(b=>{const f=w.find(R=>R.id===b),S=L[b]||1;let $=f&&f.descripcion&&f.descripcion!=="0"?f.descripcion:f&&f.nombre&&f.nombre!=="0"?f.nombre:"Ecografía sin nombre";return f?{servicio_tipo:"ecografia",servicio_id:b,descripcion:$,cantidad:S,precio_unitario:f.precio_particular,subtotal:f.precio_particular*S}:null}).filter(Boolean);d(x),C(_()),i(!0)};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-2xl shadow-2xl mt-8 border border-blue-100",children:[e.jsx("button",{onClick:()=>m("/seleccionar-servicio",{state:{pacienteId:y}}),className:"mb-4 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded text-gray-700 font-semibold",children:"← Volver"}),e.jsxs("h2",{className:"text-2xl font-bold text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"eco",children:"📡"})," Cotizador de Ecografías"]}),j&&e.jsxs("div",{className:"mb-4 p-2 bg-blue-50 rounded text-blue-800 text-sm",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",j.nombres||j.nombre," ",j.apellidos||j.apellido," (DNI: ",j.dni,")"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"mb-4 max-h-[500px] overflow-y-auto",children:[e.jsx("div",{className:"font-bold mb-2",children:"Ecografías disponibles:"}),w.length===0?e.jsx("div",{className:"text-gray-500",children:"No hay ecografías registradas."}):e.jsx("ul",{className:"divide-y divide-gray-100",children:w.map(x=>e.jsxs("li",{className:"flex items-center gap-4 py-3 px-2 hover:bg-blue-50 rounded-lg transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:x.descripcion||x.nombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Precio: S/ ",x.precio_particular]})]}),l.includes(x.id)?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:1,value:L[x.id]||1,onChange:b=>u(x.id,Math.max(1,Number(b.target.value))),className:"border rounded-lg px-2 w-16 bg-white"}),e.jsx("button",{onClick:()=>c(x.id),className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-xl shadow transition","aria-label":"Quitar",children:"✕"})]}):e.jsx("button",{onClick:()=>n(x.id),className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-100 hover:bg-green-200 text-green-700 text-xl shadow transition","aria-label":"Agregar",children:"+"})]},x.id))})]}),l.length>0&&!s&&e.jsxs("div",{className:"bg-blue-50 rounded-2xl p-6 border border-blue-200 shadow mb-4 max-h-[500px] overflow-y-auto",children:[e.jsxs("h4",{className:"font-semibold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"📝"}),"Resumen de Cotización"]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-2",children:l.map(x=>{const b=w.find(S=>S.id===x),f=L[x]||1;return b?e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{children:b.descripcion||b.nombre}),e.jsxs("span",{children:[f," estudio(s)"]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",(b.precio_particular*f).toFixed(2)]})]},x):null})}),e.jsxs("div",{className:"text-right text-xl font-bold text-blue-800 flex items-center gap-2",children:["Total: ",e.jsx("span",{children:"💲"})," S/ ",_().toFixed(2)]}),e.jsxs("button",{onClick:E,className:"mt-6 bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 flex items-center gap-2 text-lg",children:[e.jsx("span",{children:"🛒"}),"Registrar Cotización"]})]}),s&&j&&e.jsx(pe,{paciente:j,servicio:{key:"ecografia",label:"Ecografía"},detalles:r,total:h,onCobroCompleto:()=>{i(!1),a("Cotización procesada correctamente.")},onCancelar:()=>i(!1)})]}),p&&e.jsx("div",{className:"mt-4 text-center font-semibold text-green-600",children:p})]})}function ut({onSeleccionarOrden:s}){const[i,r]=t.useState("table"),[d,h]=t.useState(10),[C,y]=t.useState(0),[m,j]=t.useState([]),[g,w]=t.useState(!0),[v,l]=t.useState(""),[k,L]=t.useState([]),[o,p]=t.useState(""),[a,n]=t.useState(""),[c,u]=t.useState(""),[_,E]=t.useState("");if(t.useEffect(()=>{w(!0),fetch(z+"api_ordenes_laboratorio.php",{credentials:"include"}).then(P=>P.json()).then(P=>{P.success?j(P.ordenes):l(P.error||"Error al cargar órdenes"),w(!1)}).catch(P=>{l("Error de conexión con el servidor"),w(!1),console.error("Error al cargar órdenes:",P)}),fetch(z+"api_examenes_laboratorio.php",{credentials:"include"}).then(P=>P.json()).then(P=>{L(P.examenes||[])})},[]),g||k.length===0)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"flex items-center gap-3 text-purple-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),e.jsx("span",{children:"Cargando órdenes de laboratorio..."})]})});if(v)return e.jsx("div",{className:"p-4 text-red-600 bg-red-50 rounded-lg border border-red-200",children:v});const b=(P=>P.filter(A=>{if((o||a)&&A.fecha){const H=new Date(A.fecha),N=o?new Date(o):null,T=a?new Date(a):null;if(N&&H<N||T&&H>new Date(T+"T23:59:59"))return!1}if(c.trim()!==""){const H=c.toLowerCase(),N=(A.paciente_nombre+" "+A.paciente_apellido).toLowerCase(),T=(A.medico_nombre||"").toLowerCase();if(!N.includes(H)&&!T.includes(H))return!1}return!(_&&A.estado!==_)}))(m),f={total:m.length,pendientes:m.filter(P=>P.estado==="pendiente").length,completadas:m.filter(P=>P.estado==="completado").length,hoy:m.filter(P=>{if(!P.fecha)return!1;const A=new Date(P.fecha).toDateString(),H=new Date().toDateString();return A===H}).length},S=Math.ceil(b.length/d),F=b.slice(C*d,(C+1)*d),$=P=>Array.isArray(P)?P.map(A=>{const H=k.find(N=>N.id==A);return H?H.nombre:A}).join(", "):"",R=P=>P?new Date(P).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"N/A";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm",children:"Total Órdenes"}),e.jsx("p",{className:"text-2xl font-bold",children:f.total})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"📋"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-100 text-sm",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold",children:f.pendientes})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"⏳"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-emerald-100 text-sm",children:"Completadas"}),e.jsx("p",{className:"text-2xl font-bold",children:f.completadas})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"✅"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm",children:"Hoy"}),e.jsx("p",{className:"text-2xl font-bold",children:f.hoy})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"📅"})]})})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Desde"}),e.jsx("input",{type:"date",value:o,onChange:P=>{p(P.target.value),y(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hasta"}),e.jsx("input",{type:"date",value:a,onChange:P=>{n(P.target.value),y(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar"}),e.jsx("input",{type:"text",value:c,onChange:P=>{u(P.target.value),y(0)},placeholder:"Paciente o médico...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsxs("select",{value:_,onChange:P=>{E(P.target.value),y(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"completado",children:"Completado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Por página"}),e.jsxs("select",{value:d,onChange:P=>{h(Number(P.target.value)),y(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vista:"}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>r("table"),className:`px-3 py-1 rounded-md text-sm transition-colors ${i==="table"?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"📊 Tabla"}),e.jsx("button",{onClick:()=>r("cards"),className:`px-3 py-1 rounded-md text-sm transition-colors ${i==="cards"?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"🗃️ Tarjetas"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",F.length," de ",b.length," órdenes"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{disabled:C===0,onClick:()=>y(P=>Math.max(0,P-1)),className:"px-3 py-1 rounded-lg bg-gray-100 disabled:opacity-50 hover:bg-gray-200 transition-colors",children:"←"}),e.jsxs("span",{className:"px-3 py-1 text-sm",children:[C+1," / ",S||1]}),e.jsx("button",{disabled:C>=S-1,onClick:()=>y(P=>Math.min(S-1,P+1)),className:"px-3 py-1 rounded-lg bg-gray-100 disabled:opacity-50 hover:bg-gray-200 transition-colors",children:"→"})]})]})]}),b.length===0?e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No se encontraron órdenes con los filtros aplicados"})]}):e.jsxs(e.Fragment,{children:[i==="table"&&e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Paciente"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Tipo de Cotización"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden md:table-cell",children:"Médico"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden lg:table-cell",children:"Consulta"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden lg:table-cell",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Acciones"})]})}),e.jsx("tbody",{children:F.map(P=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-purple-50/50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:["#",P.id]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"font-medium",children:[P.paciente_nombre," ",P.paciente_apellido]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:P.consulta_id?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 border border-blue-200",children:"Médico"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-pink-100 text-pink-800 border border-pink-200",children:"Particular"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden md:table-cell",children:P.medico_nombre}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden lg:table-cell",children:P.consulta_id}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden lg:table-cell",children:R(P.fecha)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${P.estado==="completado"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,children:P.estado==="completado"?"✅ Completado":"⏳ Pendiente"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>s(P),className:"inline-flex items-center px-3 py-1.5 bg-gradient-to-r from-purple-500 to-indigo-500 text-white text-xs font-medium rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-all transform hover:scale-105 shadow-md",title:P.estado==="completado"?"Editar resultado":"Llenar resultados",children:P.estado==="completado"?"✏️ Editar":"📝 Procesar"})})})]},P.id))})]})})}),i==="cards"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:F.map(P=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6 hover:shadow-xl transition-all transform hover:scale-105",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"🧪"}),e.jsxs("span",{className:"font-bold text-gray-900",children:["#",P.id]})]}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${P.estado==="completado"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,children:P.estado==="completado"?"✅":"⏳"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Paciente"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[P.paciente_nombre," ",P.paciente_apellido]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Médico"}),e.jsx("p",{className:"text-sm text-gray-700",children:P.medico_nombre||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Consulta"}),e.jsx("p",{className:"text-sm text-gray-700",children:P.consulta_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Fecha"}),e.jsx("p",{className:"text-sm text-gray-700",children:R(P.fecha)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Exámenes"}),e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:$(P.examenes)})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>s(P),className:"flex-1 bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-2.5 px-4 rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-all font-medium text-sm shadow-md hover:shadow-lg transform hover:scale-105",children:P.estado==="completado"?"✏️ Editar Resultado":"📝 Procesar Orden"})})})]},P.id))})]})]})}function pt({orden:s,onVolver:i,onGuardado:r}){const[d,h]=t.useState([]),[C,y]=t.useState({}),[m,j]=t.useState(!1),[g,w]=t.useState(""),[v,l]=t.useState("success");t.useEffect(()=>{fetch(z+"api_examenes_laboratorio.php",{credentials:"include"}).then(a=>a.json()).then(a=>h(a.examenes||[]))},[]),t.useEffect(()=>{if(!(!d||d.length===0))if(s.resultados&&typeof s.resultados=="object")y({...s.resultados});else{const a={};let n=[];if(typeof s.examenes=="string")try{n=JSON.parse(s.examenes)}catch{n=s.examenes.split(",").map(c=>c.trim()).filter(c=>c)}else Array.isArray(s.examenes)?n=s.examenes:s.examenes&&(n=[s.examenes]);n.forEach(c=>{const u=typeof c=="object"?c.id:c,_=d.find(E=>E.id==u);_&&Array.isArray(_.valores_referenciales)&&_.valores_referenciales.length>0?_.valores_referenciales.forEach(E=>{(E.tipo===void 0||E.tipo==="Parámetro")&&E.nombre&&E.nombre.trim()!==""&&(a[`${u}__${E.nombre}`]="")}):a[`${u}`]=""}),y(a)}},[s,d]);function k(a,n){if(!a)return"";let c=a;Object.keys(n).sort((_,E)=>E.length-_.length).forEach(_=>{const E=n[_]||0,x=new RegExp(_.replace(/[.*+?^${}()|[\]\\]/g,"$&"),"g");c=c.replace(x,E===""?0:E)});try{const _=Ue(c);return typeof _=="number"&&!isNaN(_)?_.toFixed(1):_}catch{return""}}const L=a=>{const n={...C,[a.target.name]:a.target.value};y(n)},o=async a=>{a.preventDefault(),j(!0),w("");try{const n={...C};let c=[];if(typeof s.examenes=="string")try{c=JSON.parse(s.examenes)}catch{c=s.examenes.split(",").map(x=>x.trim()).filter(x=>x)}else Array.isArray(s.examenes)?c=s.examenes:s.examenes&&(c=[s.examenes]);c.forEach(x=>{const b=typeof x=="object"?x.id:x,f=d.find(F=>F.id==b);if(!f||!Array.isArray(f.valores_referenciales))return;const S={};f.valores_referenciales.forEach(F=>{(F.tipo===void 0||F.tipo==="Parámetro")&&F.nombre&&F.nombre.trim()!==""&&(S[F.nombre]=n[`${b}__${F.nombre}`]||"")}),f.valores_referenciales.forEach(F=>{if((F.tipo===void 0||F.tipo==="Parámetro")&&F.nombre&&F.nombre.trim()!==""&&F.formula&&F.formula.trim()!==""){const $=k(F.formula,S);S[F.nombre]=$??"",n[`${b}__${F.nombre}`]=$??""}})});const u=s.consulta_id?s.consulta_id:s.id,E=await(await fetch(z+"api_resultados_laboratorio.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:u,tipo_examen:"varios",resultados:n})})).json();E.success?(w("✅ Resultados guardados correctamente"),l("success"),setTimeout(()=>{r&&r()},1e3)):(w("❌ "+(E.error||"Error al guardar")),l("error"))}catch{w("❌ Error de conexión"),l("error")}finally{j(!1)}},p=(a,n)=>{let c=!1,u=null,_=null;!isNaN(parseFloat(a.min))&&a.min!==null&&a.min!==""?u=parseFloat(a.min):a.referencias&&a.referencias[0]&&!isNaN(parseFloat(a.referencias[0].valor_min))&&(u=parseFloat(a.referencias[0].valor_min)),!isNaN(parseFloat(a.max))&&a.max!==null&&a.max!==""?_=parseFloat(a.max):a.referencias&&a.referencias[0]&&!isNaN(parseFloat(a.referencias[0].valor_max))&&(_=parseFloat(a.referencias[0].valor_max));let E=parseFloat(n);return isNaN(E)||(u!==null&&E<u&&(c=!0),_!==null&&E>_&&(c=!0)),{fueraDeRango:c,min:u,max:_}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-2xl",children:"📊"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Procesar Resultados de Laboratorio"}),e.jsx("p",{className:"text-purple-100",children:"Complete los valores para cada examen solicitado"})]})]})}),e.jsxs("form",{onSubmit:o,className:"space-y-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6",children:e.jsx("div",{className:"max-h-[600px] overflow-y-auto space-y-6",children:(()=>{let a=[];if(typeof s.examenes=="string")try{a=JSON.parse(s.examenes)}catch{a=s.examenes.split(",").map(n=>n.trim()).filter(n=>n)}else Array.isArray(s.examenes)?a=s.examenes:s.examenes&&(a=[s.examenes]);return a.map(n=>{const c=typeof n=="object"?n.id:n,u=d.find(_=>_.id==c);if(u&&Array.isArray(u.valores_referenciales)&&u.valores_referenciales.length>0){const _={};return u.valores_referenciales.forEach(E=>{(E.tipo===void 0||E.tipo==="Parámetro")&&E.nombre&&E.nombre.trim()!==""&&(_[E.nombre]=C[`${c}__${E.nombre}`]||"")}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-4 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"🧪"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:u.nombre}),e.jsx("p",{className:"text-sm text-gray-600",children:"Complete todos los parámetros requeridos"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:u.valores_referenciales.map(E=>{if((E.tipo===void 0||E.tipo==="Parámetro")&&E.nombre&&E.nombre.trim()!==""){const x=E.formula&&E.formula.trim()!=="";let b=C[`${c}__${E.nombre}`]||"";x&&(b=k(E.formula,_)),typeof b=="number"&&isNaN(b)&&(b=""),b==null&&(b="");const{fueraDeRango:f,min:S,max:F}=p(E,b);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{children:E.nombre}),x&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"🧮 Calculado"})]}),x&&e.jsxs("span",{className:"text-xs text-blue-600 font-normal",children:["Fórmula: ",E.formula]}),(S!==null||F!==null)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Rango de referencia: ",S!==null?`${S}`:"∞"," - ",F!==null?`${F}`:"∞"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:`${c}__${E.nombre}`,value:b,onChange:x?void 0:L,readOnly:x,required:!0,className:`w-full px-4 py-3 border-2 rounded-lg transition-all duration-200 ${f?"border-red-400 bg-red-50 text-red-700 font-semibold focus:ring-2 focus:ring-red-500":x?"border-blue-200 bg-blue-50 text-blue-800 cursor-not-allowed":"border-gray-300 bg-white hover:border-purple-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:x?"Valor calculado automáticamente":"Ingrese el valor"}),b&&!x&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:f?e.jsx("span",{className:"text-red-500 font-bold",children:"⚠️"}):e.jsx("span",{className:"text-green-500 font-bold",children:"✓"})})]}),f&&(S!==null||F!==null)&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-600 font-medium bg-red-50 px-2 py-1 rounded-md",children:[e.jsx("span",{children:"⚠️"}),e.jsx("span",{children:"Valor fuera del rango de referencia"})]})]},E.nombre)}return null})})]},c)}else if(u)return e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"🧪"}),e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:u.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Resultado del examen"}),e.jsx("textarea",{name:`${c}`,value:C[`${c}`]||"",onChange:L,rows:4,required:!0,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200",placeholder:"Ingrese el resultado completo del examen..."})]})]},c);return null})})()})}),"        ",e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e.jsx("button",{type:"button",onClick:i,className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium border border-gray-300",children:"← Cancelar"}),e.jsx("button",{type:"submit",disabled:m,className:"px-8 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:m?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Guardando..."]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"💾"}),"Guardar Resultados"]})})]}),g&&e.jsx("div",{className:`p-4 rounded-lg border ${v==="success"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:e.jsx("div",{className:"flex items-center gap-2 font-medium",children:g})})]})]})}function gt(){const[s,i]=t.useState("ordenes"),[r,d]=t.useState(null),[h,C]=t.useState(0),[y,m]=t.useState([]);t.useEffect(()=>{fetch(z+"api_examenes_laboratorio.php",{credentials:"include"}).then(l=>l.json()).then(l=>m(l.examenes||[]))},[]);const j=async l=>{if(l.estado==="completado"){const k=l.consulta_id?l.consulta_id:l.id,o=await(await fetch(z+`api_get_resultados_laboratorio.php?orden_id=${k}`)).json();if(o.success&&o.resultado){d({...l,resultados:o.resultado.resultados}),i("procesar");return}}d(l),i("procesar")},g=()=>{d(null),C(l=>l+1),i("ordenes")},w=l=>{if(!l)return"";let k;if(typeof l=="string")try{k=JSON.parse(l)}catch{k=l.split(",").map(L=>L.trim()).filter(L=>L)}else if(Array.isArray(l))k=l;else return l.toString();return Array.isArray(k)?k.map(L=>{if(typeof L=="object"&&L.nombre)return L.nombre;const o=y.find(p=>p.id==L);return o?o.nombre:L}).join(", "):""},v=[{id:"ordenes",label:"Órdenes de Laboratorio",icon:"🧪",color:"from-purple-600 to-indigo-600"},{id:"procesar",label:"Procesar Resultados",icon:"📊",color:"from-blue-600 to-cyan-600",disabled:!r}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-indigo-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 text-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-2xl",children:"🔬"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Panel de Laboratorio"}),e.jsx("p",{className:"text-purple-100",children:"Gestión de órdenes y resultados de laboratorio"})]})]}),e.jsx("div",{className:"flex gap-1 bg-white/10 backdrop-blur-sm rounded-lg p-1",children:v.map(l=>e.jsxs("button",{onClick:()=>!l.disabled&&i(l.id),disabled:l.disabled,className:`flex items-center gap-2 px-4 py-2 rounded-md transition-all duration-200 text-sm font-medium ${s===l.id?"bg-white text-purple-600 shadow-lg":l.disabled?"text-purple-200 cursor-not-allowed opacity-50":"text-white hover:bg-white/20"}`,children:[e.jsx("span",{className:"text-lg",children:l.icon}),e.jsx("span",{className:"hidden sm:inline",children:l.label})]},l.id))})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[s==="ordenes"&&e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl shadow-xl border border-white/20",children:e.jsx(ut,{onSeleccionarOrden:j},h)}),s==="procesar"&&r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:g,className:"flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-sm rounded-lg shadow-md hover:bg-white transition-colors border border-white/20 text-gray-700 hover:text-gray-900",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Volver a órdenes"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Orden"}),e.jsxs("div",{className:"text-xl font-bold",children:["#",r.id]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Paciente"}),e.jsxs("div",{className:"text-xl font-bold",children:[r.paciente_nombre," ",r.paciente_apellido]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Consulta ID"}),e.jsx("div",{className:"text-xl font-bold",children:r.consulta_id})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Estado"}),e.jsx("div",{className:`text-xl font-bold ${r.estado==="completado"?"text-green-300":"text-yellow-300"}`,children:r.estado==="completado"?"Completado":"Pendiente"})]})]}),e.jsxs("div",{className:"mt-4 bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm mb-2",children:"Exámenes solicitados"}),e.jsx("div",{className:"text-lg",children:w(r.examenes)})]})]}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl shadow-xl border border-white/20 p-6",children:e.jsx(pt,{orden:r,onVolver:g,onGuardado:g})})]})]})]})}function bt(){const{consultaId:s}=de(),[i,r]=t.useState([]),[d,h]=t.useState([]),[C,y]=t.useState(!0),[m,j]=t.useState("");t.useEffect(()=>{y(!0),Promise.all([fetch(`${z}api_resultados_laboratorio.php?consulta_id=${s}`).then(o=>o.json()),fetch(`${z}api_examenes_laboratorio.php`,{credentials:"include"}).then(o=>o.json())]).then(([o,p])=>{o.success?r(o.resultados||[]):j(o.error||"No hay resultados"),h(p.examenes||[]),y(!1)}).catch(()=>{j("Error al cargar resultados"),y(!1)})},[s]);const g={},w={},v={};for(const o of d)g[o.id]=o.nombre,w[o.id]=o.unidad||"",v[o.id]=Array.isArray(o.valores_referenciales)?o.valores_referenciales:[];function l(o,p=null){if(!Array.isArray(o)||o.length===0)return null;if(p){const a=o.find(n=>n.nombre===p);if(a)return a}return o.find(a=>!a.desc||a.desc.toLowerCase()==="general")||o[0]}function k(o){let p=null,a=null;if(!o)return{min:p,max:a};if(Array.isArray(o.referencias)&&o.referencias.length>0){const n=o.referencias[0];isNaN(parseFloat(n.valor_min))||(p=parseFloat(n.valor_min)),isNaN(parseFloat(n.valor_max))||(a=parseFloat(n.valor_max))}return p===null&&!isNaN(parseFloat(o.valor_min))&&o.valor_min!==null&&o.valor_min!==""?p=parseFloat(o.valor_min):p===null&&o.min!==void 0&&!isNaN(parseFloat(o.min))&&(p=parseFloat(o.min)),a===null&&!isNaN(parseFloat(o.valor_max))&&o.valor_max!==null&&o.valor_max!==""?a=parseFloat(o.valor_max):a===null&&o.max!==void 0&&!isNaN(parseFloat(o.max))&&(a=parseFloat(o.max)),{min:p,max:a}}function L(o,p){if(!p||o==null||o==="")return!1;const{min:a,max:n}=k(p),c=parseFloat(o);return isNaN(c)?!1:a!==null&&c<a||n!==null&&c>n}return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-white rounded-xl shadow-xl mt-6",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("h2",{className:"text-3xl font-bold text-green-800",children:"📋 Resultados de Laboratorio"})]}),e.jsx("p",{className:"text-green-600",children:"Reporte completo de los análisis médicos"})]}),e.jsxs(ae,{to:-1,className:"mb-6 inline-flex items-center gap-2 px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg font-medium transition-colors duration-200 hover:scale-105",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"⬅️ Volver"]}),C?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando resultados..."})]}):m?e.jsx("div",{className:"p-6 text-red-600 bg-red-50 border border-red-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),m]})}):i.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("p",{className:"text-gray-500 text-lg",children:"No hay resultados registrados para esta consulta."})]}):e.jsx("div",{className:"space-y-6",children:i.map((o,p)=>e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-green-200",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-4 8v4m-4-4h8m-8-4h8a2 2 0 002-2V7a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})}),e.jsxs("span",{className:"text-sm font-bold text-green-800",children:["📅 Fecha del Análisis: ",new Date(o.fecha).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),o.resultados&&typeof o.resultados=="object"?e.jsx("div",{children:(()=>{const a={};return Object.entries(o.resultados).forEach(([n,c])=>{let u=n,_=null;n.includes("__")&&([u,_]=n.split("__")),a[u]||(a[u]=[]),a[u].push({nombreParam:_,val:c,ex:n})}),Object.entries(a).map(([n,c])=>{const u=g[n]||n;return e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-semibold text-base mb-1",children:u}),e.jsx("ul",{className:"list-disc ml-5",children:c.map(({nombreParam:_,val:E,ex:x})=>{const b=v[n]||[],f=l(b,_),S=w[n]?` ${w[n]}`:"",{min:F,max:$}=k(f),R=f&&L(E,f);return e.jsxs("li",{children:[e.jsxs("b",{children:[_||u,":"]})," ",e.jsxs("span",{className:R?"text-red-600 font-bold":"",children:[E,S]}),(F!==null||$!==null)&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["[",F!==null?`min: ${F}`:"",F!==null&&$!==null?", ":"",$!==null?`max: ${$}`:"","]"]}),R&&(F!==null||$!==null)&&e.jsx("span",{className:"text-xs text-red-600 ml-1 font-semibold",children:"Fuera de rango"})]},x)})})]},n)})})()}):e.jsx("div",{children:JSON.stringify(o.resultados)})]},p))})]})}function ft(){return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-center text-gray-800",children:"Módulo de Contabilidad"}),e.jsx("p",{className:"text-center text-gray-600",children:"Gestión de ingresos y egresos por área"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6",children:[e.jsxs(ae,{to:"/contabilidad/ingresos",className:"bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-8 text-center font-semibold shadow-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105",children:[e.jsx(me,{className:"text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Ingresos"}),e.jsx("p",{className:"text-green-100",children:"Registro de ingresos por área y servicio"})]}),e.jsxs(ae,{to:"/contabilidad/egresos",className:"bg-gradient-to-br from-red-500 to-red-600 text-white rounded-xl p-8 text-center font-semibold shadow-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105",children:[e.jsx(Ge,{className:"text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Egresos"}),e.jsx("p",{className:"text-red-100",children:"Registro de gastos y egresos operativos"})]}),e.jsxs(ae,{to:"/contabilidad/reportes",className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-8 text-center font-semibold shadow-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105",children:[e.jsx(ve,{className:"text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Reportes Financieros"}),e.jsx("p",{className:"text-blue-100",children:"Análisis y reportes contables"})]}),e.jsxs(ae,{to:"/contabilidad/balance",className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl p-8 text-center font-semibold shadow-lg hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-105",children:[e.jsx(Ae,{className:"text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Balance General"}),e.jsx("p",{className:"text-purple-100",children:"Estado financiero consolidado"})]})]}),e.jsxs("div",{className:"mt-8 bg-gray-50 rounded-lg p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-3",children:"¿Qué puedes hacer aquí?"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-green-700 mb-2",children:"📈 Ingresos:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Registro de consultas médicas"}),e.jsx("li",{children:"• Ingresos por laboratorio"}),e.jsx("li",{children:"• Ventas de farmacia"}),e.jsx("li",{children:"• Procedimientos médicos"})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-red-700 mb-2",children:"📉 Egresos:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Gastos operativos"}),e.jsx("li",{children:"• Compra de medicamentos"}),e.jsx("li",{children:"• Gastos administrativos"}),e.jsx("li",{children:"• Servicios y suministros"})]})]})]})]})]})}function jt({cajaActual:s,resumenHoy:i,onActualizar:r}){const d=ie(),[h,C]=t.useState([]),[y,m]=t.useState([]),[j,g]=t.useState(!1),[w,v]=t.useState(!1);t.useEffect(()=>{l()},[s]);const l=async()=>{try{g(!0);const n=await(await fetch(`${z}api_detalle_ingresos_hoy.php`,{credentials:"include"})).json();n.success&&(C(n.ultimas_transacciones||[]),m(n.ingresos_por_area||[]))}catch(a){console.error("Error cargando detalles:",a)}finally{g(!1)}},k=a=>a||"--:--",L=a=>`S/ ${parseFloat(a||0).toFixed(2)}`,o=a=>({consulta:"bg-blue-100 text-blue-800",laboratorio:"bg-yellow-100 text-yellow-800",farmacia:"bg-purple-100 text-purple-800",ecografia:"bg-green-100 text-green-800",rayosx:"bg-red-100 text-red-800",procedimiento:"bg-gray-100 text-gray-800",otros:"bg-indigo-100 text-indigo-800"})[a]||"bg-gray-100 text-gray-800",p=a=>({efectivo:"💵",tarjeta_debito:"💳",tarjeta_credito:"💳",transferencia:"🏦",yape:"📱",plin:"📱",otros:"💰"})[a]||"💰";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center",children:e.jsx(me,{className:"text-2xl text-white"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-green-400 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 bg-white rounded-full animate-pulse"})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-green-700",children:"Caja Abierta"}),e.jsxs("div",{className:"flex items-center gap-6 text-green-600 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{}),e.jsxs("span",{children:["Desde: ",s.hora_apertura]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{}),e.jsxs("span",{children:["Inicial: ",L(s.monto_apertura)]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{}),e.jsx("span",{children:new Date().toLocaleDateString("es-PE")})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{r(),l()},className:"bg-green-100 text-green-700 px-4 py-2 rounded-lg font-semibold hover:bg-green-200 transition-all flex items-center gap-2",disabled:j,children:[e.jsx(Xe,{className:j?"animate-spin":""}),"Actualizar"]}),e.jsxs("button",{onClick:()=>d("/contabilidad/cierre-caja"),className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-2 rounded-lg font-semibold hover:from-red-600 hover:to-red-700 transition-all flex items-center gap-2",children:[e.jsx(Re,{}),"Cerrar Caja"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500 transform hover:scale-105 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium uppercase tracking-wide",children:"Efectivo"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:L(i?.total_efectivo)}),e.jsx("p",{className:"text-green-500 text-sm mt-1",children:"💵 En caja física"})]}),e.jsx("div",{className:"text-5xl text-green-500 opacity-20",children:"💵"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500 transform hover:scale-105 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium uppercase tracking-wide",children:"Tarjetas"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:L(i?.total_tarjetas)}),e.jsx("p",{className:"text-blue-500 text-sm mt-1",children:"💳 Débito/Crédito"})]}),e.jsx("div",{className:"text-5xl text-blue-500 opacity-20",children:"💳"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500 transform hover:scale-105 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium uppercase tracking-wide",children:"Digital"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600 mt-2",children:L(i?.total_transferencias)}),e.jsx("p",{className:"text-purple-500 text-sm mt-1",children:"📱 Yape/Plin/Transfer"})]}),e.jsx("div",{className:"text-5xl text-purple-500 opacity-20",children:"📱"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500 transform hover:scale-105 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium uppercase tracking-wide",children:"Total del Día"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600 mt-2",children:L(i?.total_dia)}),e.jsx("p",{className:"text-yellow-500 text-sm mt-1",children:"📊 Todos los ingresos"})]}),e.jsx("div",{className:"text-5xl text-yellow-500 opacity-20",children:"📊"})]})})]}),y.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ve,{className:"text-blue-600"}),"Ingresos por Área del Día"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[y.length," áreas activas"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:y.slice(0,6).map((a,n)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${o(a.tipo_ingreso)}`,children:a.tipo_ingreso.toUpperCase()}),e.jsx("span",{className:"text-lg font-bold text-gray-800",children:L(a.total_monto)})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:a.area}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ke,{}),a.cantidad_transacciones," trans."]})})]},n))}),y.length>6&&e.jsxs("button",{onClick:()=>v(!0),className:"mt-4 text-blue-600 hover:text-blue-800 font-semibold text-sm",children:["Ver todas las áreas (",y.length,")"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(he,{className:"text-purple-600"}),"Últimas Transacciones"]}),e.jsx("button",{onClick:()=>d("/contabilidad/ingresos-detalle"),className:"text-purple-600 hover:text-purple-800 font-semibold text-sm",children:"Ver todas →"})]}),h.length>0?e.jsx("div",{className:"space-y-3",children:h.slice(0,5).map((a,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:p(a.metodo_pago)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${o(a.tipo_ingreso)}`,children:a.tipo_ingreso}),e.jsx("span",{className:"text-sm text-gray-600",children:a.area})]}),e.jsx("p",{className:"text-sm text-gray-800 mt-1",children:a.descripcion}),a.paciente_nombre&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Paciente: ",a.paciente_nombre]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-green-600",children:L(a.monto)}),e.jsx("p",{className:"text-xs text-gray-500",children:k(a.hora)})]})]},n))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(he,{className:"text-4xl mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No hay transacciones registradas hoy"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("button",{onClick:()=>d("/contabilidad/nuevo-ingreso"),className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-6 text-center font-semibold shadow-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105",children:[e.jsx(_e,{className:"text-3xl mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Registrar Ingreso"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Agregar nuevo ingreso manual"})]}),e.jsxs("button",{onClick:()=>d("/contabilidad/ingresos-detalle"),className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl p-6 text-center font-semibold shadow-lg hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-105",children:[e.jsx(he,{className:"text-3xl mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Ver Detalle Completo"}),e.jsx("p",{className:"text-purple-100 text-sm",children:"Historial completo del día"})]}),e.jsxs("button",{onClick:()=>d("/contabilidad/reportes-ingresos"),className:"bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-6 text-center font-semibold shadow-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105",children:[e.jsx(ve,{className:"text-3xl mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Reportes y Análisis"}),e.jsx("p",{className:"text-green-100 text-sm",children:"Análisis detallado de ingresos"})]})]})]})}function Nt(){const[s,i]=t.useState(!0),[r,d]=t.useState(null),[h,C]=t.useState(null),[y,m]=t.useState(null),j=ie(),[g,w]=t.useState(!1),[v,l]=t.useState(""),[k,L]=t.useState(""),[o,p]=t.useState(!1);t.useEffect(()=>{a()},[]);const a=async()=>{try{i(!0);const u=await(await fetch(`${z}api_auth_status.php`,{credentials:"include"})).json();if(!u.success||!u.authenticated){I.fire({icon:"warning",title:"Sesión expirada",text:"Debe iniciar sesión para acceder al módulo de ingresos",confirmButtonText:"Ir al Login"}).then(()=>{j("/")});return}C(u);const E=await(await fetch(`${z}api_caja_estado.php`,{credentials:"include"})).json();if(E.success){if(d(E.caja),E.caja){const b=await(await fetch(`${z}api_resumen_ingresos.php`,{credentials:"include"})).json();b.success&&m(b.resumen)}}else console.log("Estado de caja:",E.error)}catch(c){console.error("Error cargando datos:",c),I.fire({icon:"error",title:"Error de conexión",text:"No se pudo conectar con el servidor. Verifique su conexión.",confirmButtonText:"Reintentar"}).then(()=>{a()})}finally{i(!1)}},n=async()=>{if(!v||parseFloat(v)<0){I.fire("Error","Debe ingresar un monto válido","error");return}try{p(!0);const u=await(await fetch(`${z}api_caja_abrir.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({monto_apertura:parseFloat(v),observaciones:k})})).json();u.success?(I.fire("¡Éxito!","Caja abierta correctamente","success"),w(!1),l(""),L(""),a()):I.fire("Error",u.error||"Error al abrir caja","error")}catch(c){console.error("Error:",c),I.fire("Error","Error de conexión","error")}finally{p(!1)}};return s?e.jsx(ue,{}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"text-4xl text-green-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Módulo de Ingresos"}),e.jsx("p",{className:"text-gray-600",children:"Gestión de caja e ingresos diarios"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Be,{}),e.jsx("span",{children:new Date().toLocaleDateString("es-PE",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mt-1",children:[e.jsx(Oe,{}),e.jsx("span",{children:h?.nombre})]})]})]})}),r?e.jsx(jt,{cajaActual:r,resumenHoy:y,onActualizar:a}):e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-orange-50 border-2 border-red-200 rounded-xl p-8 text-center",children:[e.jsx(je,{className:"text-6xl text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-red-700 mb-2",children:"Caja Cerrada"}),e.jsx("p",{className:"text-red-600 mb-6",children:"Debe abrir la caja para comenzar a registrar ingresos del día"}),e.jsxs("button",{onClick:()=>w(!0),className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 flex items-center gap-2 mx-auto",children:[e.jsx(ye,{}),"Abrir Caja"]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(ye,{className:"text-5xl text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Apertura de Caja"}),e.jsx("p",{className:"text-gray-600",children:"Ingrese los datos para abrir la caja del día"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Monto Inicial (Efectivo) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",step:"0.01",value:v,onChange:c=>l(c.target.value),className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"0.00",disabled:o})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Observaciones (Opcional)"}),e.jsx("textarea",{value:k,onChange:c=>L(c.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-none",rows:"3",placeholder:"Notas adicionales sobre la apertura...",disabled:o})]})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsx("button",{onClick:()=>w(!1),className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-all",disabled:o,children:"Cancelar"}),e.jsx("button",{onClick:n,className:"flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all disabled:opacity-50 flex items-center justify-center gap-2",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Abriendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{}),"Abrir Caja"]})})]})]})})]})}function vt(){const s=ie(),[i,r]=t.useState(!0),[d,h]=t.useState(!1),[C,y]=t.useState([]),[m,j]=t.useState([]),[g,w]=t.useState({tipo_ingreso:"",categoria_id:"",area_personalizada:"",descripcion:"",monto:"",metodo_pago:"",referencia:"",paciente_nombre:"",observaciones:""});t.useEffect(()=>{v()},[]);const v=async()=>{try{r(!0);const a=await(await fetch(`${z}api_categorias_ingresos.php`,{credentials:"include"})).json();a.success&&y(a.categorias);const c=await(await fetch(`${z}api_metodos_pago.php`,{credentials:"include"})).json();console.log("Métodos de pago cargados:",c),c.success?j(c.metodos):console.error("Error cargando métodos de pago:",c.error)}catch(p){console.error("Error cargando datos:",p),I.fire("Error","Error al cargar los datos iniciales","error")}finally{r(!1)}},l=p=>{const{name:a,value:n}=p.target;w(c=>({...c,[a]:n})),a==="tipo_ingreso"&&w(c=>({...c,categoria_id:"",area_personalizada:""}))},k=C.filter(p=>p.tipo_ingreso===g.tipo_ingreso),L=C.find(p=>p.id===parseInt(g.categoria_id)),o=async()=>{if(!g.tipo_ingreso){I.fire("Error","Debe seleccionar un tipo de ingreso","error");return}if(!g.descripcion.trim()){I.fire("Error","Debe ingresar una descripción","error");return}if(!g.monto||parseFloat(g.monto)<=0){I.fire("Error","Debe ingresar un monto válido","error");return}if(!g.metodo_pago){I.fire("Error","Debe seleccionar un método de pago","error");return}let p="";g.categoria_id&&L?p=L.nombre:g.area_personalizada.trim()?p=g.area_personalizada.trim():p="Otros servicios";try{h(!0);const n=await(await fetch(`${z}api_registrar_ingreso.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({tipo_ingreso:g.tipo_ingreso,area:p,descripcion:g.descripcion.trim(),monto:parseFloat(g.monto),metodo_pago:g.metodo_pago,referencia:g.referencia.trim(),paciente_nombre:g.paciente_nombre.trim(),observaciones:g.observaciones.trim()})})).json();n.success?I.fire({icon:"success",title:"¡Ingreso Registrado!",text:`Ingreso de S/ ${parseFloat(g.monto).toFixed(2)} registrado correctamente`,confirmButtonText:"Continuar"}).then(()=>{s("/contabilidad/ingresos")}):I.fire("Error",n.error||"Error al registrar ingreso","error")}catch(a){console.error("Error:",a),I.fire("Error","Error de conexión","error")}finally{h(!1)}};return i?e.jsx(ue,{}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>s("/contabilidad/ingresos"),className:"mb-4 bg-gradient-to-r from-gray-200 to-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:from-gray-300 hover:to-gray-400 flex items-center gap-2 font-semibold transition-all",children:[e.jsx(Se,{}),"Volver a Ingresos"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_e,{className:"text-4xl text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Registrar Nuevo Ingreso"}),e.jsx("p",{className:"text-gray-600",children:"Agregar ingreso manual al sistema de caja"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Tipo de Ingreso *"}),e.jsxs("select",{name:"tipo_ingreso",value:g.tipo_ingreso,onChange:l,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar tipo..."}),e.jsx("option",{value:"consulta",children:"Consulta Médica"}),e.jsx("option",{value:"laboratorio",children:"Laboratorio"}),e.jsx("option",{value:"farmacia",children:"Farmacia"}),e.jsx("option",{value:"ecografia",children:"Ecografía"}),e.jsx("option",{value:"rayosx",children:"Rayos X"}),e.jsx("option",{value:"procedimiento",children:"Procedimiento"}),e.jsx("option",{value:"otros",children:"Otros"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Categoría/Área"}),k.length>0?e.jsxs("select",{name:"categoria_id",value:g.categoria_id,onChange:l,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Seleccionar categoría..."}),k.map(p=>e.jsx("option",{value:p.id,children:p.nombre},p.id))]}):e.jsx("input",{type:"text",name:"area_personalizada",value:g.area_personalizada,onChange:l,placeholder:"Especificar área o servicio",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Descripción del Servicio *"}),e.jsx("input",{type:"text",name:"descripcion",value:g.descripcion,onChange:l,placeholder:"Ej: Consulta medicina general, Hemograma completo...",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Monto (S/) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",name:"monto",value:g.monto,onChange:l,step:"0.01",min:"0",placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Método de Pago *"}),e.jsxs("select",{name:"metodo_pago",value:g.metodo_pago,onChange:l,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar método..."}),m.length>0?m.map(p=>e.jsx("option",{value:p.codigo,children:p.nombre},p.codigo)):e.jsx("option",{value:"efectivo",children:"Efectivo (por defecto)"})]}),m.length===0&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:"No se pudieron cargar los métodos de pago. Revise la consola para más detalles."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Número de Referencia",g.metodo_pago!=="efectivo"&&g.metodo_pago!=="otros"&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"text",name:"referencia",value:g.referencia,onChange:l,placeholder:"Nº operación, voucher, etc.",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Nombre del Paciente"}),e.jsx("input",{type:"text",name:"paciente_nombre",value:g.paciente_nombre,onChange:l,placeholder:"Nombre completo del paciente",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Observaciones"}),e.jsx("textarea",{name:"observaciones",value:g.observaciones,onChange:l,rows:"3",placeholder:"Notas adicionales sobre este ingreso...",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"})]})]}),e.jsxs("div",{className:"flex gap-4 mt-8",children:[e.jsx("button",{onClick:()=>s("/contabilidad/ingresos"),className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-all",disabled:d,children:"Cancelar"}),e.jsx("button",{onClick:o,className:"flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition-all disabled:opacity-50 flex items-center justify-center gap-2",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{}),"Registrar Ingreso"]})})]})]})]})}function yt(){const s=ie(),[i,r]=Qe(),[d,h]=t.useState(!0),[C,y]=t.useState([]),[m,j]=t.useState(null),[g,w]=t.useState([]),[v,l]=t.useState([]),[k,L]=t.useState({total:0,pagina_actual:1,total_paginas:1}),[o,p]=t.useState({fecha:i.get("fecha")||new Date().toISOString().split("T")[0],tipo:i.get("tipo")||"",metodo:i.get("metodo")||""}),[a,n]=t.useState(1),c=20;t.useEffect(()=>{u()},[o,a]);const u=async()=>{try{h(!0);const S=new URLSearchParams({fecha:o.fecha,limite:c.toString(),offset:((a-1)*c).toString()});o.tipo&&S.append("tipo",o.tipo),o.metodo&&S.append("metodo",o.metodo);const $=await(await fetch(`${z}api_historial_ingresos.php?${S}`,{credentials:"include"})).json();$.success&&(y($.ingresos),j($.estadisticas),w($.resumen_tipos),l($.resumen_metodos),L($.paginacion))}catch(S){console.error("Error cargando historial:",S)}finally{h(!1)}},_=(S,F)=>{const $={...o,[S]:F};p($),n(1);const R=new URLSearchParams;$.fecha!==new Date().toISOString().split("T")[0]&&R.set("fecha",$.fecha),$.tipo&&R.set("tipo",$.tipo),$.metodo&&R.set("metodo",$.metodo),r(R)},E=S=>`S/ ${parseFloat(S||0).toFixed(2)}`,x=S=>S?new Date(S).toLocaleTimeString("es-PE",{hour:"2-digit",minute:"2-digit"}):"--:--",b=S=>({consulta:"bg-blue-100 text-blue-800",laboratorio:"bg-yellow-100 text-yellow-800",farmacia:"bg-purple-100 text-purple-800",ecografia:"bg-green-100 text-green-800",rayosx:"bg-red-100 text-red-800",procedimiento:"bg-gray-100 text-gray-800",otros:"bg-indigo-100 text-indigo-800"})[S]||"bg-gray-100 text-gray-800",f=S=>({efectivo:"💵",tarjeta_debito:"💳",tarjeta_credito:"💳",transferencia:"🏦",yape:"📱",plin:"📱",otros:"💰"})[S]||"💰";return d?e.jsx(ue,{}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>s("/contabilidad/ingresos"),className:"mb-4 bg-gradient-to-r from-gray-200 to-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:from-gray-300 hover:to-gray-400 flex items-center gap-2 font-semibold transition-all",children:[e.jsx(Se,{}),"Volver a Ingresos"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"text-4xl text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Historial de Ingresos"}),e.jsx("p",{className:"text-gray-600",children:"Registro detallado de todas las transacciones"})]})]})]}),m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Transacciones"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:m.total_transacciones})]}),e.jsx(me,{className:"text-3xl text-blue-500 opacity-50"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Total Ingresos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:E(m.total_ingresos)})]}),e.jsx(ve,{className:"text-3xl text-green-500 opacity-50"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Tipos de Servicio"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:m.tipos_diferentes})]}),e.jsx(Ee,{className:"text-3xl text-purple-500 opacity-50"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Métodos de Pago"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:m.metodos_diferentes})]}),e.jsx(Be,{className:"text-3xl text-orange-500 opacity-50"})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ee,{className:"text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha"}),e.jsx("input",{type:"date",value:o.fecha,onChange:S=>_("fecha",S.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Servicio"}),e.jsxs("select",{value:o.tipo,onChange:S=>_("tipo",S.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:"consulta",children:"Consulta Médica"}),e.jsx("option",{value:"laboratorio",children:"Laboratorio"}),e.jsx("option",{value:"farmacia",children:"Farmacia"}),e.jsx("option",{value:"ecografia",children:"Ecografía"}),e.jsx("option",{value:"rayosx",children:"Rayos X"}),e.jsx("option",{value:"procedimiento",children:"Procedimiento"}),e.jsx("option",{value:"otros",children:"Otros"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Método de Pago"}),e.jsxs("select",{value:o.metodo,onChange:S=>_("metodo",S.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Todos los métodos"}),e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta_debito",children:"Tarjeta de Débito"}),e.jsx("option",{value:"tarjeta_credito",children:"Tarjeta de Crédito"}),e.jsx("option",{value:"transferencia",children:"Transferencia"}),e.jsx("option",{value:"yape",children:"Yape"}),e.jsx("option",{value:"plin",children:"Plin"}),e.jsx("option",{value:"otros",children:"Otros"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Transacciones (",k.total," registros)"]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2",children:[e.jsx(Ze,{}),"Exportar"]})]})}),C.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(he,{className:"text-4xl mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No se encontraron ingresos para los filtros seleccionados"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hora"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paciente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Método Pago"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuario"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:C.map(S=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:x(S.fecha_registro)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${b(S.tipo_ingreso)}`,children:S.tipo_ingreso})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:S.descripcion}),S.area&&e.jsx("div",{className:"text-xs text-gray-500",children:S.area})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:S.paciente_nombre||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:f(S.metodo_pago)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:S.metodo_pago.replace("_"," ")}),S.referencia_pago&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Ref: ",S.referencia_pago]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-lg font-bold text-green-600",children:E(S.monto)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:S.usuario_nombre})]})})]},S.id))})]})}),k.total_paginas>1&&e.jsx("div",{className:"px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",(a-1)*c+1," - ",Math.min(a*c,k.total)," de ",k.total," registros"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(Math.max(1,a-1)),disabled:a===1,className:"px-3 py-1 border rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(es,{})}),e.jsxs("span",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:[a," / ",k.total_paginas]}),e.jsx("button",{onClick:()=>n(Math.min(k.total_paginas,a+1)),disabled:a===k.total_paginas,className:"px-3 py-1 border rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(ss,{})})]})]})})]})]})}function wt(){const s=ie(),[i,r]=t.useState(!0),[d,h]=t.useState(!1),[C,y]=t.useState(null),[m,j]=t.useState(null),[g,w]=t.useState([]),[v,l]=t.useState({efectivo_contado:"",tarjetas_contado:"",transferencias_contado:"",otros_contado:""}),[k,L]=t.useState("");t.useEffect(()=>{o()},[]);const o=async()=>{try{r(!0);const _=await(await fetch(`${z}api_caja_actual.php`,{credentials:"include"})).json();if(!_.success||!_.caja){I.fire({icon:"warning",title:"No hay caja abierta",text:"No se puede realizar el cierre porque no hay una caja abierta",confirmButtonText:"Volver a Ingresos"}).then(()=>{s("/contabilidad/ingresos")});return}y(_.caja);const x=await(await fetch(`${z}api_resumen_ingresos.php?caja_id=${_.caja.id}`,{credentials:"include"})).json();x.success&&j(x.resumen);const f=await(await fetch(`${z}api_ingresos_detalle.php?caja_id=${_.caja.id}`,{credentials:"include"})).json();f.success&&w(f.ingresos||[])}catch(u){console.error("Error cargando datos:",u),I.fire("Error","Error al cargar los datos del cierre","error")}finally{r(!1)}},p=u=>{const{name:_,value:E}=u.target;l(x=>({...x,[_]:E}))},a=()=>{if(!m)return{};const u={},_=parseFloat(m.total_efectivo||0),E=parseFloat(m.total_tarjetas||0),x=parseFloat(m.total_transferencias||0),b=parseFloat(m.total_otros||0);return u.efectivo=parseFloat(v.efectivo_contado||0)-_,u.tarjetas=parseFloat(v.tarjetas_contado||0)-E,u.transferencias=parseFloat(v.transferencias_contado||0)-x,u.otros=parseFloat(v.otros_contado||0)-b,u.total=u.efectivo+u.tarjetas+u.transferencias+u.otros,u},n=async()=>{if(!v.efectivo_contado){I.fire("Error","Debe ingresar el monto de efectivo contado","error");return}const u=a();if((await I.fire({title:"Confirmar Cierre de Caja",html:`
        <div class="text-left">
          <p><strong>Fecha:</strong> ${C?.fecha}</p>
          <p><strong>Usuario:</strong> ${C?.usuario_nombre}</p>
          <br>
          <p><strong>Resumen de diferencias:</strong></p>
          <ul>
            <li>Efectivo: S/ ${u.efectivo.toFixed(2)}</li>
            <li>Tarjetas: S/ ${u.tarjetas.toFixed(2)}</li>
            <li>Transferencias: S/ ${u.transferencias.toFixed(2)}</li>
            <li>Otros: S/ ${u.otros.toFixed(2)}</li>
          </ul>
          <p><strong>Diferencia Total: S/ ${u.total.toFixed(2)}</strong></p>
        </div>
      `,icon:Math.abs(u.total)>10?"warning":"question",showCancelButton:!0,confirmButtonText:"Confirmar Cierre",cancelButtonText:"Cancelar",confirmButtonColor:u.total<0?"#d33":"#3085d6"})).isConfirmed)try{h(!0);const x=await(await fetch(`${z}api_cerrar_caja.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({caja_id:C.id,efectivo_contado:parseFloat(v.efectivo_contado),tarjetas_contado:parseFloat(v.tarjetas_contado||0),transferencias_contado:parseFloat(v.transferencias_contado||0),otros_contado:parseFloat(v.otros_contado||0),observaciones:k.trim(),diferencias:u})})).json();x.success?I.fire({icon:"success",title:"¡Caja Cerrada Exitosamente!",html:`
            <div class="text-left">
              <p>La caja ha sido cerrada correctamente.</p>
              <p><strong>Diferencia final:</strong> S/ ${u.total.toFixed(2)}</p>
              <br>
              <p>Se ha generado el reporte de cierre.</p>
            </div>
          `,confirmButtonText:"Continuar"}).then(()=>{s("/contabilidad/ingresos")}):I.fire("Error",x.error||"Error al cerrar la caja","error")}catch(E){console.error("Error:",E),I.fire("Error","Error de conexión","error")}finally{h(!1)}};if(i)return e.jsx(ue,{});if(!C)return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"No hay caja abierta"}),e.jsx("button",{onClick:()=>s("/contabilidad/ingresos"),className:"bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600",children:"Volver a Ingresos"})]});const c=a();return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>s("/contabilidad/ingresos"),className:"mb-4 bg-gradient-to-r from-gray-200 to-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:from-gray-300 hover:to-gray-400 flex items-center gap-2 font-semibold transition-all",children:[e.jsx(Se,{}),"Volver a Ingresos"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(je,{className:"text-4xl text-red-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Cierre de Caja"}),e.jsx("p",{className:"text-gray-600",children:"Finalizar jornada y generar reporte de cierre"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-blue-800",children:"Fecha:"}),e.jsx("p",{className:"text-blue-700",children:C.fecha})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-blue-800",children:"Hora apertura:"}),e.jsx("p",{className:"text-blue-700",children:C.hora_apertura})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-blue-800",children:"Monto apertura:"}),e.jsxs("p",{className:"text-blue-700",children:["S/ ",parseFloat(C.monto_apertura||0).toFixed(2)]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-6 flex items-center gap-2",children:[e.jsx(Ae,{}),"Resumen del Sistema"]}),m&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"text-green-600"}),e.jsx("span",{className:"font-semibold",children:"Efectivo"})]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",parseFloat(m.total_efectivo||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"text-blue-600"}),e.jsx("span",{className:"font-semibold",children:"Tarjetas"})]}),e.jsxs("span",{className:"font-bold text-blue-700",children:["S/ ",parseFloat(m.total_tarjetas||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"text-purple-600"}),e.jsx("span",{className:"font-semibold",children:"Transferencias"})]}),e.jsxs("span",{className:"font-bold text-purple-700",children:["S/ ",parseFloat(m.total_transferencias||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"text-gray-600"}),e.jsx("span",{className:"font-semibold",children:"Otros"})]}),e.jsxs("span",{className:"font-bold text-gray-700",children:["S/ ",parseFloat(m.total_otros||0).toFixed(2)]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold",children:[e.jsx("span",{children:"Total del Sistema:"}),e.jsxs("span",{className:"text-blue-600",children:["S/ ",parseFloat(m.total_dia||0).toFixed(2)]})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-6",children:"Conteo Real"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Efectivo Contado *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",name:"efectivo_contado",value:v.efectivo_contado,onChange:p,step:"0.01",min:"0",placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),m&&v.efectivo_contado&&e.jsxs("div",{className:`text-sm mt-1 ${c.efectivo===0?"text-green-600":"text-red-600"}`,children:["Diferencia: S/ ",c.efectivo.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Tarjetas Reportadas"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",name:"tarjetas_contado",value:v.tarjetas_contado,onChange:p,step:"0.01",min:"0",placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),m&&v.tarjetas_contado&&e.jsxs("div",{className:`text-sm mt-1 ${c.tarjetas===0?"text-green-600":"text-red-600"}`,children:["Diferencia: S/ ",c.tarjetas.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Transferencias Confirmadas"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",name:"transferencias_contado",value:v.transferencias_contado,onChange:p,step:"0.01",min:"0",placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),m&&v.transferencias_contado&&e.jsxs("div",{className:`text-sm mt-1 ${c.transferencias===0?"text-green-600":"text-red-600"}`,children:["Diferencia: S/ ",c.transferencias.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Otros Métodos"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",name:"otros_contado",value:v.otros_contado,onChange:p,step:"0.01",min:"0",placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),m&&v.otros_contado&&e.jsxs("div",{className:`text-sm mt-1 ${c.otros===0?"text-green-600":"text-red-600"}`,children:["Diferencia: S/ ",c.otros.toFixed(2)]})]}),m&&Object.values(v).some(u=>u)&&e.jsx("div",{className:`p-4 rounded-lg ${Math.abs(c.total)<=1?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"font-semibold",children:"Diferencia Total:"}),e.jsxs("div",{className:`text-2xl font-bold ${c.total>=0?"text-green-600":"text-red-600"}`,children:["S/ ",c.total.toFixed(2)]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Observaciones del Cierre"}),e.jsx("textarea",{value:k,onChange:u=>L(u.target.value),rows:"3",placeholder:"Notas sobre diferencias, incidencias, etc.",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"})]}),e.jsx("button",{onClick:n,disabled:!v.efectivo_contado||d,className:"w-full px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg font-semibold hover:from-red-600 hover:to-red-700 transition-all disabled:opacity-50 flex items-center justify-center gap-2 text-lg",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}),"Procesando Cierre..."]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{}),"Cerrar Caja"]})})]})]})]}),g.length>0&&e.jsxs("div",{className:"mt-8 bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Detalle de Ingresos del Día"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50",children:[e.jsx("th",{className:"text-left p-3",children:"Hora"}),e.jsx("th",{className:"text-left p-3",children:"Tipo"}),e.jsx("th",{className:"text-left p-3",children:"Área"}),e.jsx("th",{className:"text-left p-3",children:"Descripción"}),e.jsx("th",{className:"text-left p-3",children:"Método"}),e.jsx("th",{className:"text-right p-3",children:"Monto"})]})}),e.jsx("tbody",{children:g.map((u,_)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:new Date(u.fecha_hora).toLocaleTimeString("es-PE",{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"p-3 capitalize",children:u.tipo_ingreso}),e.jsx("td",{className:"p-3",children:u.area}),e.jsx("td",{className:"p-3",children:u.descripcion}),e.jsx("td",{className:"p-3 capitalize",children:u.metodo_pago}),e.jsxs("td",{className:"p-3 text-right font-semibold",children:["S/ ",parseFloat(u.monto).toFixed(2)]})]},_))})]})})]})]})}const Ct=()=>{const[s,i]=t.useState([]),[r,d]=t.useState([]),[h,C]=t.useState(!0),[y,m]=t.useState(!1),[j,g]=t.useState(!1),[w,v]=t.useState(null),[l,k]=t.useState("");t.useEffect(()=>{L()},[]);const L=async()=>{try{C(!0);const a=await fetch("http://localhost:8001/api_cajas_cerradas.php",{credentials:"include"});if(a.ok){const n=await a.json();n.success&&(i(n.cajas_cerradas),d(n.historial_reaperturas))}}catch(a){console.error("Error al cargar datos:",a)}finally{C(!1)}},o=a=>{v(a),k(""),g(!0)},p=async()=>{if(!l.trim()){alert("Por favor ingresa el motivo de la reapertura");return}try{m(!0);const n=await(await fetch("http://localhost:8001/api_reabrir_caja.php",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({caja_id:w.id,motivo:l.trim()})})).json();n.success?(alert(`✅ Caja ID ${w.id} reabierta exitosamente`),g(!1),v(null),k(""),L()):alert(`❌ Error: ${n.error}`)}catch(a){console.error("Error al reabrir caja:",a),alert("❌ Error de conexión")}finally{m(!1)}};return h?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando cajas cerradas..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("svg",{className:"w-8 h-8 mr-3 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})}),"Reabrir Cajas Cerradas"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Función exclusiva para administradores"})]}),e.jsx("div",{className:"bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium",children:"🔐 Solo Administradores"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Cajas Cerradas Recientes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Últimas 20 cajas cerradas"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"H. Cierre"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Monto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Diferencia"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"No hay cajas cerradas"})}):s.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:a.id}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:a.fecha}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:a.hora_cierre?a.hora_cierre.substr(0,8):"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:["S/ ",parseFloat(a.monto_cierre||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:`inline-flex px-2 py-1 text-xs rounded-full ${parseFloat(a.diferencia||0)===0?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:["S/ ",parseFloat(a.diferencia||0).toFixed(2)]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>o(a),className:"bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs font-medium transition-colors",children:"🔓 Reabrir"})})]},a.id))})]})})]})}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Historial de Reaperturas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Últimas 10 reaperturas"})]}),e.jsx("div",{className:"p-4 space-y-3",children:r.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No hay reaperturas registradas"}):r.map((a,n)=>e.jsx("div",{className:"border-l-4 border-yellow-400 pl-3 py-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Caja ID ",a.caja_id]}),e.jsx("p",{className:"text-xs text-gray-600",children:a.usuario_nombre}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a.motivo})]}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(a.fecha_reapertura).toLocaleString()})]})},n))})]})})]})]}),j&&w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("svg",{className:"w-8 h-8 text-yellow-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirmar Reapertura"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Caja ID:"})," ",w.id]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Fecha:"})," ",w.fecha]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Cerrada:"})," ",w.hora_cierre]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Monto:"})," S/ ",parseFloat(w.monto_cierre||0).toFixed(2)]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo de la reapertura *"}),e.jsx("textarea",{value:l,onChange:a=>k(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Describe el motivo de esta reapertura..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>g(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition-colors",disabled:y,children:"Cancelar"}),e.jsx("button",{onClick:p,disabled:y||!l.trim(),className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:opacity-50 transition-colors",children:y?"Reabriendo...":"🔓 Reabrir Caja"})]})]})})})]})};function kt(){const[s,i]=t.useState({nombre_clinica:"",direccion:"",telefono:"",email:"",horario_atencion:"",logo_url:"",website:"",ruc:"",especialidades:"",mision:"",vision:"",valores:"",director_general:"",jefe_enfermeria:"",contacto_emergencias:""}),[r,d]=t.useState(!1),[h,C]=t.useState(!0),[y,m]=t.useState(!1),[j,g]=t.useState("");t.useEffect(()=>{w()},[]);const w=async()=>{try{C(!0);const p=await fetch(z+"api_get_configuracion.php",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(p.ok){const a=await p.json();if(a.success)i(a.data),a.data&&a.data.logo_url&&g(a.data.logo_url);else throw new Error(a.error||"Error al cargar la configuración")}else if(p.status===401){const a=await p.json();throw new Error("🔒 Acceso denegado: "+(a.error||"No está autenticado como administrador"))}else{const a=await p.text();throw console.error("❌ Error del servidor:",a),new Error(`Error del servidor: ${p.status} - ${a}`)}}catch(p){console.error("🚨 Error al cargar configuración:",p),p.message.includes("🔒 Acceso denegado")?I.fire({title:"🔒 Acceso Denegado",text:"Necesita estar autenticado como administrador para ver la configuración.",icon:"warning",confirmButtonText:"Ir a Login",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(a=>{a.isConfirmed&&(window.location.href="/")}):I.fire({title:"Error",text:"No se pudo cargar la configuración: "+p.message,icon:"error",confirmButtonText:"OK"})}finally{C(!1)}},v=(p,a)=>{i(n=>({...n,[p]:a}))},l=async()=>{if(!s.nombre_clinica||!s.direccion||!s.telefono||!s.email){I.fire({title:"Error",text:"Por favor, complete todos los campos obligatorios.",icon:"error",confirmButtonText:"OK"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)){I.fire({title:"Error",text:"Por favor, ingrese un email válido.",icon:"error",confirmButtonText:"OK"});return}d(!0);try{const a=await fetch(z+"api_configuracion.php",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(a.ok){const n=await a.json();if(n.success)I.fire({title:"¡Configuración guardada!",text:n.message||"Los cambios se han aplicado exitosamente.",icon:"success",confirmButtonText:"OK"}),s.logo_url&&g(s.logo_url);else throw new Error(n.error||"Error al guardar la configuración")}else if(a.status===401){await a.json(),I.fire({title:"🔒 Acceso Denegado",text:"Necesita estar autenticado como administrador para modificar la configuración.",icon:"warning",confirmButtonText:"Ir a Login",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed&&(window.location.href="/")});return}else{const n=await a.text();throw console.error("❌ Error del servidor:",n),new Error(`Error del servidor: ${a.status} - ${n}`)}}catch(a){console.error("🚨 Error al guardar configuración:",a),I.fire({title:"Error",text:"No se pudo guardar la configuración: "+a.message,icon:"error",confirmButtonText:"OK"})}finally{d(!1)}},k=p=>{const a=p.target.files&&p.target.files[0];if(!a)return;const n=URL.createObjectURL(a);g(n),i(c=>({...c,_logo_file:a}))},L=async()=>{const p=s._logo_file;if(!p){I.fire({title:"Info",text:"Seleccione un archivo primero.",icon:"info"});return}m(!0);try{const a=new FormData;a.append("logo",p);const n=await fetch(z+"api_upload_logo.php",{method:"POST",credentials:"include",body:a}),c=await n.json();if(n.ok&&c.success)i(u=>({...u,logo_url:c.path,_logo_file:null})),g(c.path),I.fire({title:"Listo",text:"Logo subido correctamente.",icon:"success"});else throw new Error(c.error||"Error subiendo archivo")}catch(a){console.error("Error upload logo",a),I.fire({title:"Error",text:"No se pudo subir el logo: "+a.message,icon:"error"})}finally{m(!1)}},o=()=>{i(p=>({...p,logo_url:""})),g("")};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-blue-800",children:"⚙️ Configuración del Sistema"}),h?e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando configuración..."})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-800",children:"Información de la Clínica"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la Clínica *"}),e.jsx("input",{type:"text",value:s.nombre_clinica,onChange:p=>v("nombre_clinica",p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Teléfono *"}),e.jsx("input",{type:"tel",value:s.telefono,onChange:p=>v("telefono",p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",value:s.email,onChange:p=>v("email",p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"RUC (opcional)"}),e.jsx("input",{type:"text",value:s.ruc||"",onChange:p=>v("ruc",p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dirección *"}),e.jsx("input",{type:"text",value:s.direccion,onChange:p=>v("direccion",p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Director General"}),e.jsx("input",{type:"text",value:s.director_general||"",onChange:p=>v("director_general",p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Dr. Juan Pérez"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Jefe de Enfermería"}),e.jsx("input",{type:"text",value:s.jefe_enfermeria||"",onChange:p=>v("jefe_enfermeria",p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enf. María González"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL del Logo (opcional) / Subir logo"}),e.jsx("input",{type:"url",value:s.logo_url||"",onChange:p=>v("logo_url",p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2",placeholder:"https://ejemplo.com/logo.png"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:k,className:"text-sm"}),e.jsx("button",{type:"button",onClick:L,disabled:y,className:"bg-green-600 text-white px-3 py-1 rounded-md hover:bg-green-700 disabled:bg-gray-300 text-sm",children:y?"Subiendo...":"Subir Logo"}),e.jsx("button",{type:"button",onClick:o,className:"bg-red-100 text-red-700 px-3 py-1 rounded-md hover:bg-red-200 text-sm",children:"Eliminar"})]}),j?e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Vista previa:"}),e.jsx("img",{src:j.startsWith("http")?j:"/"+j.replace(/^\/+/,""),alt:"Logo preview",style:{maxHeight:96}})]}):null]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sitio Web (opcional)"}),e.jsx("input",{type:"url",value:s.website||"",onChange:p=>v("website",p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://www.ejemplo.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contacto de Emergencias"}),e.jsx("input",{type:"tel",value:s.contacto_emergencias||"",onChange:p=>v("contacto_emergencias",p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Emergencias 24h: +51 987-654-321"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Especialidades"}),e.jsx("textarea",{value:s.especialidades||"",onChange:p=>v("especialidades",p.target.value),rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Medicina General, Pediatría, Ginecología, Traumatología..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Horario de Atención"}),e.jsx("textarea",{value:s.horario_atencion||"",onChange:p=>v("horario_atencion",p.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Lunes a Viernes: 7:00 AM - 8:00 PM..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Misión Institucional"}),e.jsx("textarea",{value:s.mision||"",onChange:p=>v("mision",p.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brindar servicios de salud de calidad..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Visión Institucional"}),e.jsx("textarea",{value:s.vision||"",onChange:p=>v("vision",p.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ser el centro de salud de referencia..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valores Institucionales"}),e.jsx("textarea",{value:s.valores||"",onChange:p=>v("valores",p.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Compromiso, Excelencia, Humanización, Integridad..."})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"* Campos obligatorios"}),e.jsx("button",{onClick:l,disabled:r,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 font-medium transition-colors",children:r?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Guardando..."]}):"💾 Guardar Configuración"})]})})]}),e.jsxs("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"ℹ️ Información del Sistema"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Versión:"})," 1.0.0"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Base de datos:"})," MySQL"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Servidor web:"})," Apache (Laragon)"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Framework:"})," React + Vite"]})]})]})]})}function _t(){const[s,i]=t.useState([]),[r,d]=t.useState([]),[h,C]=t.useState(!0),[y,m]=t.useState(!1),[j,g]=t.useState(null),[w,v]=t.useState("todos"),[l,k]=t.useState(1),[L,o]=t.useState(5),p=[{value:"consulta",label:"Consultas Médicas"},{value:"rayosx",label:"Rayos X"},{value:"ecografia",label:"Ecografía"},{value:"ocupacional",label:"Medicina Ocupacional"},{value:"procedimientos",label:"Procedimientos Médicos"},{value:"cirugias",label:"Cirugías Menores"},{value:"tratamientos",label:"Tratamientos Especializados"},{value:"emergencias",label:"Emergencias"}],a=[...p],[n,c]=t.useState({servicio_tipo:"consulta",medico_id:"",descripcion_base:"",descripcion:"",precio_particular:"",precio_seguro:"",precio_convenio:"",activo:1});t.useEffect(()=>{E(),u()},[]);const u=async()=>{try{const q=await(await fetch(`${z}api_medicos.php`)).json();if(q.success){const J=(q.medicos||[]).map(ee=>({...ee,id:parseInt(ee.id)}));d(J)}}catch(M){console.error("Error al cargar médicos:",M)}},_=t.useCallback((M,q)=>{if(!M||M==="general"||M==="")return q||"Consulta General";const J=r.find(ee=>ee.id===parseInt(M));if(J){const ee=J.nombre,B=J.especialidad?` - ${J.especialidad}`:"";return`${ee}${B} - ${q||"Consulta"}`}return q||"Consulta"},[r]),E=async()=>{try{C(!0);const q=await(await fetch(`${z}api_tarifas.php`,{credentials:"include"})).json();q.success?i(q.tarifas||[]):console.error("Error al cargar tarifas:",q.error)}catch(M){console.error("Error:",M),I.fire("Error","Error de conexión al cargar tarifas","error")}finally{C(!1)}},x=(M=null)=>{if(M&&(M.fuente==="medicamentos"||M.fuente==="examenes_laboratorio")){I.fire({title:"No Editable",text:M.fuente==="medicamentos"?"Los precios de medicamentos se gestionan desde el módulo de farmacia.":"Los precios de exámenes se gestionan desde el módulo de laboratorio.",icon:"info",confirmButtonText:"Entendido"});return}if(M){g(M);const q=M.descripcion;let J="general",ee=q;const B=r.find(O=>q.includes(O.nombre));if(B){J=B.id.toString();const O=new RegExp(`^${B.nombre}(\\s*-\\s*${B.especialidad})?\\s*-\\s*`,"i");ee=q.replace(O,"").trim()}c({servicio_tipo:M.servicio_tipo,medico_id:J,descripcion_base:ee,descripcion:q,precio_particular:M.precio_particular,precio_seguro:M.precio_seguro||"",precio_convenio:M.precio_convenio||"",activo:M.activo})}else g(null),c({servicio_tipo:"consulta",medico_id:"general",descripcion_base:"",descripcion:"",precio_particular:"",precio_seguro:"",precio_convenio:"",activo:1});m(!0)},b=()=>{m(!1),g(null),c({servicio_tipo:"consulta",medico_id:"general",descripcion_base:"",descripcion:"",precio_particular:"",precio_seguro:"",precio_convenio:"",activo:1})},f=async()=>{if(!n.descripcion.trim()){I.fire("Error","La descripción es obligatoria","error");return}if(!n.precio_particular||parseFloat(n.precio_particular)<=0){I.fire("Error","El precio particular debe ser mayor a 0","error");return}try{const M=j?`${z}api_tarifas.php`:`${z}api_tarifas.php`,q=j?"PUT":"POST",J=j?{...n,id:j.id}:n,B=await(await fetch(M,{method:q,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(J)})).json();B.success?(I.fire({title:"¡Éxito!",text:j?"Tarifa actualizada correctamente":"Tarifa creada correctamente",icon:"success",confirmButtonText:"OK"}),b(),E()):I.fire("Error",B.error||"Error al guardar la tarifa","error")}catch(M){console.error("Error:",M),I.fire("Error","Error de conexión","error")}},S=async(M,q)=>{if(typeof M=="string"&&(M.startsWith("med_")||M.startsWith("lab_"))){I.fire({title:"No Eliminable",text:M.startsWith("med_")?"Los medicamentos se eliminan desde el módulo de farmacia.":"Los exámenes se eliminan desde el módulo de laboratorio.",icon:"info",confirmButtonText:"Entendido"});return}if((await I.fire({title:"¿Estás seguro?",text:`¿Deseas eliminar la tarifa "${q}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33"})).isConfirmed)try{const B=await(await fetch(`${z}api_tarifas.php`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:M})})).json();B.success?(I.fire("¡Eliminado!","La tarifa ha sido eliminada","success"),E()):I.fire("Error",B.error||"Error al eliminar la tarifa","error")}catch(ee){console.error("Error:",ee),I.fire("Error","Error de conexión","error")}},F=async(M,q)=>{try{const ee=await(await fetch(`${z}api_tarifas.php`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:M,activo:q})})).json();ee.success?E():I.fire("Error",ee.error||"Error al cambiar estado","error")}catch(J){console.error("Error:",J),I.fire("Error","Error de conexión","error")}},$=w==="todos"?s.filter(M=>!["laboratorio","farmacia"].includes(M.servicio_tipo)):s.filter(M=>M.servicio_tipo===w&&!["laboratorio","farmacia"].includes(M.servicio_tipo)),R=$.length,P=Math.ceil(R/L),A=(l-1)*L,H=A+L,N=$.slice(A,H),T=M=>{k(M)},U=M=>{o(M),k(1)};t.useEffect(()=>{k(1)},[w]),t.useEffect(()=>{if(r.length>0&&n.medico_id&&n.descripcion_base){const M=_(n.medico_id,n.descripcion_base);c(q=>({...q,descripcion:M}))}},[r,n.medico_id,n.descripcion_base,_]);const Q=M=>{const q=a.find(J=>J.value===M);return q?q.label:M};return h?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"text-xl",children:"Cargando tarifas..."})}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-blue-800",children:"💰 Gestión de Tarifas"}),e.jsx("button",{onClick:()=>x(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-medium",children:"➕ Nueva Tarifa"})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Filtrar por servicio:"}),e.jsxs("select",{value:w,onChange:M=>v(M.target.value),className:"border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"todos",children:"Todos los servicios"}),a.map(M=>e.jsx("option",{value:M.value,children:M.label},M.value))]}),e.jsxs("span",{className:"text-gray-600",children:["(",R," tarifa",R!==1?"s":""," - Página ",l," de ",P,")"]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"font-medium text-gray-700 text-sm sm:text-base",children:"Elementos por página:"}),e.jsxs("select",{value:L,onChange:M=>U(parseInt(M.target.value)),className:"border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]}),P>1&&e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>T(1),disabled:l===1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 whitespace-nowrap",children:[e.jsx("span",{className:"hidden sm:inline",children:"Primera"}),e.jsx("span",{className:"sm:hidden",children:"❮❮"})]}),e.jsxs("button",{onClick:()=>T(l-1),disabled:l===1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:[e.jsx("span",{className:"hidden sm:inline",children:"Anterior"}),e.jsx("span",{className:"sm:hidden",children:"❮"})]}),e.jsx("div",{className:"hidden sm:flex items-center gap-2",children:Array.from({length:Math.min(5,P)},(M,q)=>{let J;return P<=5?J=q+1:J=Math.max(1,Math.min(l-2,P-4))+q,e.jsx("button",{onClick:()=>T(J),className:`px-3 py-1 text-sm border rounded ${l===J?"bg-blue-500 text-white":"hover:bg-gray-100"}`,children:J},J)})}),e.jsx("div",{className:"flex sm:hidden items-center gap-1",children:Array.from({length:Math.min(3,P)},(M,q)=>{let J;return P<=3?J=q+1:J=Math.max(1,Math.min(l-1,P-2))+q,e.jsx("button",{onClick:()=>T(J),className:`px-2 py-1 text-xs border rounded ${l===J?"bg-blue-500 text-white":"hover:bg-gray-100"}`,children:J},`mobile-${J}`)})}),e.jsxs("button",{onClick:()=>T(l+1),disabled:l===P,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx("span",{className:"sm:hidden",children:"❯"})]}),e.jsxs("button",{onClick:()=>T(P),disabled:l===P,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 whitespace-nowrap",children:[e.jsx("span",{className:"hidden sm:inline",children:"Última"}),e.jsx("span",{className:"sm:hidden",children:"❯❯"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Servicio"}),e.jsx("th",{className:"hidden sm:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Particular"}),e.jsx("th",{className:"hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Seguro"}),e.jsx("th",{className:"hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Convenio"}),e.jsx("th",{className:"hidden md:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(M=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex items-center mb-1 sm:mb-0",children:[e.jsx("span",{className:"text-lg mr-2",children:M.fuente==="medicamentos"?"💊":M.fuente==="examenes_laboratorio"?"🔬":"🏥"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:Q(M.servicio_tipo)})]}),M.fuente&&M.fuente!=="tarifas"&&e.jsx("span",{className:"ml-0 sm:ml-2 px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full",children:M.fuente==="medicamentos"?"Desde Farmacia":"Desde Laboratorio"}),e.jsx("div",{className:"sm:hidden mt-2 text-sm font-medium text-gray-900",children:M.descripcion})]})}),e.jsx("td",{className:"hidden sm:table-cell px-6 py-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:M.descripcion})}),e.jsxs("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.jsxs("div",{className:"font-medium",children:["S/ ",parseFloat(M.precio_particular).toFixed(2)]}),e.jsxs("div",{className:"block lg:hidden text-xs text-gray-500 mt-1",children:[M.precio_seguro&&e.jsxs("div",{children:["Seguro: S/ ",parseFloat(M.precio_seguro).toFixed(2)]}),M.precio_convenio&&e.jsxs("div",{children:["Convenio: S/ ",parseFloat(M.precio_convenio).toFixed(2)]})]})]}),e.jsx("td",{className:"hidden lg:table-cell px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:M.precio_seguro?`S/ ${parseFloat(M.precio_seguro).toFixed(2)}`:"-"}),e.jsx("td",{className:"hidden lg:table-cell px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:M.precio_convenio?`S/ ${parseFloat(M.precio_convenio).toFixed(2)}`:"-"}),e.jsx("td",{className:"hidden md:table-cell px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>F(M.id,M.activo===1?0:1),className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${M.activo===1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:M.activo===1?"✓ Activo":"✗ Inactivo"})}),e.jsx("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-2 space-y-1 sm:space-y-0",children:[e.jsx("div",{className:"block md:hidden mb-2",children:e.jsx("button",{onClick:()=>F(M.id,M.activo===1?0:1),className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${M.activo===1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:M.activo===1?"✓ Activo":"✗ Inactivo"})}),M.fuente==="medicamentos"?e.jsxs("button",{onClick:()=>window.open("/farmacia-medicamentos","_blank"),className:"text-blue-600 hover:text-blue-900 px-2 sm:px-3 py-1 bg-blue-100 rounded text-xs sm:text-sm",children:["🏥 ",e.jsx("span",{className:"hidden sm:inline",children:"Gestionar en"})," Farmacia"]}):M.fuente==="examenes_laboratorio"?e.jsxs("button",{onClick:()=>window.open("/laboratorio-examenes","_blank"),className:"text-green-600 hover:text-green-900 px-2 sm:px-3 py-1 bg-green-100 rounded text-xs sm:text-sm",children:["🧪 ",e.jsx("span",{className:"hidden sm:inline",children:"Gestionar en"})," Lab"]}):e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-1 sm:space-y-0 sm:space-x-2",children:[e.jsx("button",{onClick:()=>x(M),className:"text-blue-600 hover:text-blue-900 px-2 py-1 bg-blue-100 rounded text-xs sm:text-sm",children:"✏️ Editar"}),e.jsx("button",{onClick:()=>S(M.id,M.descripcion),className:"text-red-600 hover:text-red-900 px-2 py-1 bg-red-100 rounded text-xs sm:text-sm",children:"🗑️ Eliminar"})]})]})})]},M.id))})]})}),$.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay tarifas registradas para este filtro"})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:j?"Editar Tarifa":"Nueva Tarifa"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Servicio *"}),e.jsx("select",{value:n.servicio_tipo,onChange:M=>c({...n,servicio_tipo:M.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:p.map(M=>e.jsx("option",{value:M.value,children:M.label},M.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Médico * ",r.length===0&&e.jsx("span",{className:"text-gray-400",children:"(Cargando...)"})]}),e.jsxs("select",{value:n.medico_id,onChange:M=>{const q=M.target.value,J=_(q,n.descripcion_base);c({...n,medico_id:q,descripcion:J})},className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:r.length===0,children:[e.jsx("option",{value:"general",children:"Tarifa General (Todos los médicos)"}),r.map(M=>e.jsxs("option",{value:M.id,children:["Dr(a). ",M.nombre," ",M.apellido||""," - ",M.especialidad||"General"]},M.id))]}),r.length===0&&e.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"⚠️ No se pudieron cargar los médicos. Verifique la conexión."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción Base *"}),e.jsx("input",{type:"text",value:n.descripcion_base,onChange:M=>{const q=M.target.value,J=_(n.medico_id,q);c({...n,descripcion_base:q,descripcion:J})},className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ej: Consulta Especializada, Procedimiento, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción Final (Se genera automáticamente)"}),e.jsx("input",{type:"text",value:n.descripcion,readOnly:!0,className:"w-full border rounded px-3 py-2 bg-gray-100 text-gray-600",placeholder:"Se generará automáticamente al seleccionar médico y descripción base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Particular * (S/)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:n.precio_particular,onChange:M=>c({...n,precio_particular:M.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Seguro (S/) - Opcional"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:n.precio_seguro,onChange:M=>c({...n,precio_seguro:M.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Convenio (S/) - Opcional"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:n.precio_convenio,onChange:M=>c({...n,precio_convenio:M.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.activo===1,onChange:M=>c({...n,activo:M.target.checked?1:0}),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Activo"})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-6",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:j?"Actualizar":"Crear"})]})]})})]})}const St={administrador:"/usuarios",recepcionista:"/pacientes",enfermero:"/panel-enfermero",medico:"/mis-consultas",laboratorista:"/panel-laboratorio"};function Z({usuario:s,rolesPermitidos:i,children:r}){if(!s)return e.jsx(ge,{to:"/",replace:!0});if(i&&!i.includes(s.rol)){const d=St[s.rol]||"/";return e.jsx(ge,{to:d,replace:!0})}return r}function Et({medicamento:s,usuario:i,onClose:r}){const[d,h]=t.useState([]),[C,y]=t.useState(!0),[m,j]=t.useState(null),[g,w]=t.useState({tipo:"entrada",cantidad:1,observaciones:"",usuario_id:""}),[v,l]=t.useState(!1),[k,L]=t.useState([]);t.useEffect(()=>{fe.get(z+"api_medicos.php").then(c=>L(c.data.medicos||[])).catch(()=>L([]))},[]);const o=`${z}api_movimientos_medicamento.php`,p=()=>{y(!0),j(null);let c=o+`?medicamento_id=${s.id}`;fetch(c,{credentials:"include"}).then(async u=>{const _=await u.json();if(!u.ok||_.error)throw new Error(_.error||`Error HTTP: ${u.status}`);return _}).then(h).catch(u=>j(u.message)).finally(()=>y(!1))};t.useEffect(()=>{p()},[s.id]);const a=c=>{const{name:u,value:_}=c.target;w(E=>({...E,[u]:u==="cantidad"?Number(_):_}))},n=c=>{c.preventDefault(),l(!0),fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({medicamento_id:s.id,tipo:g.tipo,cantidad:g.cantidad,usuario_id:i?.id?Number(i.id):1,medico_id:g.usuario_id?Number(g.usuario_id):null,observaciones:g.observaciones})}).then(u=>u.json()).then(()=>{w({tipo:"entrada",cantidad:1,observaciones:"",usuario_id:""}),p()}).finally(()=>l(!1))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-2xl w-full p-6 relative",children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 text-gray-500 hover:text-black",children:"✕"}),e.jsx("h2",{className:"text-xl font-bold mb-2 text-center",children:"Historial de Movimientos"}),e.jsxs("div",{className:"mb-4 text-center text-lg font-semibold text-purple-700",children:[s.nombre," (",s.codigo,")"]}),e.jsxs("form",{onSubmit:n,className:"flex flex-wrap gap-2 items-end mb-6",children:[e.jsxs("select",{name:"tipo",value:g.tipo,onChange:a,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"entrada",children:"Entrada"}),e.jsx("option",{value:"salida",children:"Salida"})]}),e.jsx("input",{name:"cantidad",type:"number",min:1,value:g.cantidad,onChange:a,className:"border rounded px-2 py-1 w-24",required:!0}),e.jsxs("select",{name:"usuario_id",value:g.usuario_id,onChange:a,className:"border rounded px-2 py-1 w-56",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona médico responsable"}),k.map(c=>e.jsxs("option",{value:c.id,children:[c.nombre," ",c.apellido," (",c.email,")"]},c.id))]}),e.jsx("input",{name:"observaciones",value:g.observaciones,onChange:a,className:"border rounded px-2 py-1 flex-1",placeholder:"Observaciones"}),e.jsx("button",{type:"submit",disabled:v,className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Registrar"})]}),C?e.jsx("div",{className:"text-center text-gray-500",children:"Cargando movimientos..."}):m?e.jsx("div",{className:"text-center text-red-500",children:m}):e.jsx("div",{className:"overflow-x-auto max-h-72",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200 rounded-lg text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-purple-100",children:[e.jsx("th",{className:"py-1 px-2 border-b",children:"Fecha"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Tipo"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Cantidad"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Usuario"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Médico responsable"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Observaciones"})]})}),e.jsx("tbody",{children:Array.isArray(d)&&d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-3 text-gray-400",children:"Sin movimientos registrados"})}):Array.isArray(d)?d.map(c=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-1 px-2 border-b",children:new Date(c.fecha_hora).toLocaleString()}),e.jsx("td",{className:"py-1 px-2 border-b",children:c.tipo_movimiento}),e.jsx("td",{className:"py-1 px-2 border-b text-right",children:c.cantidad}),e.jsx("td",{className:"py-1 px-2 border-b",children:c.usuario_nombre||c.usuario_id||"-"}),e.jsx("td",{className:"py-1 px-2 border-b",children:c.medico_nombre||"-"}),e.jsx("td",{className:"py-1 px-2 border-b",children:c.observaciones})]},c.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-3 text-red-500",children:"Error al cargar movimientos o sesión/rol incorrecto"})})})]})})]})})}function Lt({initialData:s,onSave:i,onCancel:r}){const[d,h]=t.useState({codigo:s?.codigo||"",nombre:s?.nombre||"",presentacion:s?.presentacion||"",concentracion:s?.concentracion||"",laboratorio:s?.laboratorio||"",stock:s?.stock??0,unidades_por_caja:s?.unidades_por_caja??30,fecha_vencimiento:s?.fecha_vencimiento||"",estado:s?.estado||"activo",precio_compra:s?.precio_compra!==void 0&&s?.precio_compra!==null?String(s.precio_compra):"",margen_ganancia:s?.margen_ganancia!==void 0&&s?.margen_ganancia!==null?String(s.margen_ganancia):"30",id:s?.id||void 0}),[C,y]=t.useState(""),m=g=>{const{name:w,value:v}=g.target;h(l=>w==="stock"||w==="unidades_por_caja"?{...l,[w]:Number(v)}:{...l,[w]:v})},j=async g=>{if(g.preventDefault(),!d.codigo.trim()||!d.nombre.trim()){y("El código y el nombre son obligatorios");return}if(!d.fecha_vencimiento){y("La fecha de vencimiento es obligatoria");return}if(!d.unidades_por_caja||d.unidades_por_caja<1){y("Las unidades por caja deben ser mayor a 0");return}y("");const w={...d,precio_compra:parseFloat(d.precio_compra)||0,margen_ganancia:parseFloat(d.margen_ganancia)||0,unidades_por_caja:parseInt(d.unidades_por_caja)||1};if(i){const v=await i(w);v&&v.error&&v.error.toLowerCase().includes("código ya existe")&&I.fire({icon:"error",title:"Código duplicado",text:v.error,confirmButtonColor:"#e53e3e"})}};return e.jsxs("form",{onSubmit:j,className:"bg-white rounded shadow max-w-lg mx-auto flex flex-col max-h-full",children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:[e.jsx("h2",{className:"text-lg font-bold text-center",children:s?"Editar Medicamento":"Nuevo Medicamento"}),C&&e.jsx("div",{className:"text-red-500 text-center mt-2",children:C})]}),e.jsx("div",{className:"p-4 overflow-y-auto flex-1",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Código *"}),e.jsx("input",{name:"codigo",value:d.codigo,onChange:m,className:"w-full border rounded px-2 py-1",maxLength:30,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Nombre *"}),e.jsx("input",{name:"nombre",value:d.nombre,onChange:m,className:"w-full border rounded px-2 py-1",maxLength:100,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Presentación"}),e.jsx("input",{name:"presentacion",value:d.presentacion,onChange:m,className:"w-full border rounded px-2 py-1",maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Concentración"}),e.jsx("input",{name:"concentracion",value:d.concentracion,onChange:m,className:"w-full border rounded px-2 py-1",maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Laboratorio"}),e.jsx("input",{name:"laboratorio",value:d.laboratorio,onChange:m,className:"w-full border rounded px-2 py-1",maxLength:100})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Stock (unidades)"}),e.jsx("input",{name:"stock",type:"number",min:0,value:d.stock,onChange:m,className:"w-full border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Unidades por caja *"}),e.jsx("input",{name:"unidades_por_caja",type:"number",min:1,value:d.unidades_por_caja,onChange:m,className:"w-full border rounded px-2 py-1",required:!0}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ejemplo: 30 pastillas por caja, 100 jeringas por caja"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Fecha de vencimiento *"}),e.jsx("input",{name:"fecha_vencimiento",type:"date",value:d.fecha_vencimiento,onChange:m,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Estado"}),e.jsxs("select",{name:"estado",value:d.estado,onChange:m,className:"w-full border rounded px-2 py-1",children:[e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"inactivo",children:"Inactivo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Precio de compra (S/)"}),e.jsx("input",{name:"precio_compra",type:"number",min:0,step:"0.01",value:d.precio_compra!==void 0&&d.precio_compra!==null?String(d.precio_compra):"",onChange:m,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Margen de ganancia (%)"}),e.jsx("input",{name:"margen_ganancia",type:"number",min:0,max:100,step:"0.1",value:d.margen_ganancia!==void 0&&d.margen_ganancia!==null?String(d.margen_ganancia):"",onChange:m,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Precio de venta sugerido (S/)"}),e.jsx("input",{value:Number(d.precio_compra)+Number(d.precio_compra)*Number(d.margen_ganancia)/100,readOnly:!0,className:"w-full border rounded px-2 py-1 bg-gray-100 text-gray-700"})]})]})}),e.jsx("div",{className:"p-4 border-t bg-gray-50 rounded-b-lg",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:r,className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors",children:"Guardar"})]})})]})}function Fe(){const[s,i]=t.useState(null),[r,d]=t.useState(""),[h,C]=t.useState(""),[y,m]=t.useState(null),[j,g]=t.useState([]),[w,v]=t.useState(!0),[l,k]=t.useState(null),[L,o]=t.useState(!1),[p,a]=t.useState(null),[n,c]=t.useState(""),[u,_]=t.useState(1),[E,x]=t.useState(3),[b,f]=t.useState(!1),[S,F]=t.useState(null),[$,R]=t.useState(""),[P,A]=t.useState(!1),H=()=>{v(!0),k(null);const B=`${z}api_medicamentos.php`;fetch(B,{credentials:"include"}).then(O=>{if(!O.ok)throw new Error("Error al cargar medicamentos");return O.json()}).then(g).catch(k).finally(()=>v(!1))};t.useEffect(()=>{H()},[]);const N=()=>{a(null),o(!0)},T=B=>{a(B),o(!0)},U=B=>{const O=`${z}api_medicamentos.php`;return fetch(O,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)}).then(G=>G.json()).then(G=>G.success?(o(!1),H(),{success:!0}):{error:G.error||"Error al guardar"}).catch(()=>({error:"Error de red o servidor"}))};let Q=j.filter(B=>B.nombre.toLowerCase().includes(n.toLowerCase())||B.codigo.toLowerCase().includes(n.toLowerCase()));Q.sort((B,O)=>B.id&&O.id?O.id-B.id:0),P&&(Q=Q.filter(B=>B.estado==="cuarentena")),r&&(Q=Q.filter(B=>B.fecha_vencimiento&&B.fecha_vencimiento>=r)),h&&(Q=Q.filter(B=>B.fecha_vencimiento&&B.fecha_vencimiento<=h));const M=Math.ceil(Q.length/E),q=Q.slice((u-1)*E,u*E),J=B=>{x(Number(B.target.value)),_(1)},ee=B=>{B>=1&&B<=M&&_(B)};return e.jsxs("div",{className:"max-w-7xl mx-auto p-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-blue-600 mb-2",children:"💊 Gestión de Medicamentos"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Sistema integral de inventario farmacéutico"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-4 gap-2",children:[e.jsx("input",{type:"text",placeholder:"Buscar por código o nombre...",value:n,onChange:B=>c(B.target.value),className:"border rounded px-3 py-2 w-full sm:w-72"}),e.jsxs("select",{value:E,onChange:J,className:"border rounded px-2 py-2 ml-2",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]}),e.jsx("span",{className:"ml-2 text-sm",children:"por página"}),e.jsxs("button",{onClick:N,className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-lg shadow-lg hover:from-purple-700 hover:to-blue-700 transform hover:scale-105 transition-all duration-200 font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"+"}),"Nuevo Medicamento"]})]}),e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-2 sm:p-4 mb-6 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-base font-semibold text-yellow-900 flex-wrap",children:[e.jsx("span",{className:"inline-block text-yellow-600 mr-1",children:"🗓️"}),e.jsx("label",{className:"text-xs sm:text-base",children:"Filtrar por vencimiento:"}),e.jsx("span",{className:"ml-1 text-xs font-normal text-gray-700",children:"Desde"}),e.jsx("input",{type:"date",value:r,onChange:B=>d(B.target.value),className:"border border-yellow-400 rounded px-1 py-1 focus:ring-2 focus:ring-yellow-300 w-16 sm:w-24 md:w-28"}),e.jsx("span",{className:"ml-1 text-xs font-normal text-gray-700",children:"Hasta"}),e.jsx("input",{type:"date",value:h,onChange:B=>C(B.target.value),className:"border border-yellow-400 rounded px-1 py-1 focus:ring-2 focus:ring-yellow-300 w-16 sm:w-24 md:w-28"}),e.jsx("button",{type:"button",onClick:()=>{d(""),C("")},className:"ml-1 px-2 py-1 rounded bg-yellow-300 text-yellow-900 font-semibold border border-yellow-400 hover:bg-yellow-400 transition text-xs sm:text-sm",title:"Limpiar filtros de vencimiento",children:"Limpiar"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 sm:mt-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:B=>A(B.target.checked)}),"Solo cuarentena"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Medicamentos en cuarentena deben ser llevados a puntos de acopio autorizados (DIGEMID)."})]})]}),w&&e.jsx("div",{className:"text-center text-gray-500",children:"Cargando..."}),l&&e.jsx("div",{className:"text-center text-red-500",children:l.message||"Error"}),!w&&!l&&e.jsxs("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 rounded-lg",children:[e.jsxs("table",{className:"w-full bg-white border border-gray-200 rounded-lg text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white",children:[e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider",children:"Código"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider sm:hidden",children:"Acciones"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider hidden md:table-cell",children:"Presentación"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider hidden lg:table-cell",children:"Concentración"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden md:table-cell",children:"Stock"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden lg:table-cell",children:"Vencimiento"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden xl:table-cell",children:"Precio Compra"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden xl:table-cell",children:"Margen %"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden xl:table-cell",children:"Precio Venta"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden lg:table-cell",children:"Estado"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Acciones"})]})}),e.jsx("tbody",{children:q.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:12,className:"text-center py-4 text-gray-400",children:"No hay medicamentos registrados"})}):q.map((B,O)=>{let G=O%2===0?"bg-white":"bg-gray-50",D="";if(B.fecha_vencimiento){const V=new Date,te=(new Date(B.fecha_vencimiento)-V)/(1e3*60*60*24);te<0?(D="bg-red-100 border-l-4 border-red-500",G=""):te<90&&(D="bg-orange-100 border-l-4 border-orange-500",G="")}return e.jsxs("tr",{className:`transition-colors duration-200 hover:bg-purple-100 hover:shadow-sm ${G} ${D}`,children:[e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 font-medium text-gray-900",children:B.codigo}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 font-semibold text-gray-800",children:B.nombre}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-center sm:hidden",children:e.jsxs("div",{className:"flex flex-row gap-1 justify-center",children:[e.jsx("button",{onClick:()=>i(B),className:"p-1 text-blue-600 hover:text-white hover:bg-blue-600 rounded-md transition-all duration-200",title:"Ver detalles",children:e.jsx(is,{size:12})}),e.jsx("button",{onClick:()=>T(B),className:"p-1 text-indigo-600 hover:text-white hover:bg-indigo-600 rounded-md transition-all duration-200",title:"Editar",children:e.jsx(Le,{size:12})}),e.jsx("button",{onClick:()=>m(B),className:"p-1 text-purple-600 hover:text-white hover:bg-purple-600 rounded-md transition-all duration-200",title:"Historial",children:e.jsx(he,{size:12})}),B.estado!=="cuarentena"&&e.jsx("button",{onClick:()=>{F(B),f(!0),R("")},className:"p-1 text-yellow-600 hover:text-white hover:bg-yellow-600 rounded-md transition-all duration-200",title:"Cuarentena",children:e.jsx(je,{size:12})})]})}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 hidden md:table-cell",children:B.presentacion}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 hidden lg:table-cell",children:B.concentracion}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-right font-medium text-gray-700 hidden md:table-cell",children:B.stock}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-center hidden lg:table-cell",children:B.fecha_vencimiento?new Date(B.fecha_vencimiento).toLocaleDateString():"-"}),e.jsxs("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-right font-mono text-xs hidden xl:table-cell",children:["S/ ",B.precio_compra!==void 0?Number(B.precio_compra).toFixed(2):"-"]}),e.jsxs("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-right hidden xl:table-cell",children:[B.margen_ganancia!==void 0?Number(B.margen_ganancia).toFixed(1):"-","%"]}),e.jsxs("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-right font-semibold text-green-700 font-mono text-xs hidden xl:table-cell",children:["S/ ",B.precio_compra!==void 0&&B.margen_ganancia!==void 0?(Number(B.precio_compra)+Number(B.precio_compra)*Number(B.margen_ganancia)/100).toFixed(2):"-"]}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 hidden lg:table-cell font-medium text-center text-xs "+(B.estado==="cuarentena"?"bg-yellow-200 text-yellow-900 font-bold":""),children:B.estado==="cuarentena"?"CUARENTENA":B.estado}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-center hidden sm:table-cell",children:e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx("button",{onClick:()=>T(B),className:"p-1 text-indigo-600 hover:text-white hover:bg-indigo-600 rounded-md transition-all duration-200",title:"Editar",children:e.jsx(Le,{size:14})}),e.jsx("button",{onClick:()=>m(B),className:"p-1 text-purple-600 hover:text-white hover:bg-purple-600 rounded-md transition-all duration-200",title:"Historial",children:e.jsx(he,{size:14})}),B.estado!=="cuarentena"&&e.jsx("button",{onClick:()=>{F(B),f(!0),R("")},className:"p-1 text-yellow-600 hover:text-white hover:bg-yellow-600 rounded-md transition-all duration-200",title:"Cuarentena",children:e.jsx(je,{size:14})})]})})]},B.id)})})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-xs w-full relative",children:[e.jsx("button",{onClick:()=>i(null),className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-xl",children:"×"}),e.jsx("h2",{className:"text-lg font-bold mb-2 text-blue-800",children:"Detalles del Medicamento"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Código:"})," ",s.codigo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",s.nombre]}),e.jsxs("div",{children:[e.jsx("b",{children:"Presentación:"})," ",s.presentacion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Concentración:"})," ",s.concentracion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Laboratorio:"})," ",s.laboratorio]}),e.jsxs("div",{children:[e.jsx("b",{children:"Stock:"})," ",s.stock]}),e.jsxs("div",{children:[e.jsx("b",{children:"Vencimiento:"})," ",s.fecha_vencimiento?new Date(s.fecha_vencimiento).toLocaleDateString():"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Precio compra:"})," S/"," ",s.precio_compra!==void 0?Number(s.precio_compra).toFixed(2):"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Margen ganancia:"})," ",s.margen_ganancia!==void 0?Number(s.margen_ganancia).toFixed(1):"-","%"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Precio venta:"})," S/"," ",s.precio_compra!==void 0&&s.margen_ganancia!==void 0?(Number(s.precio_compra)+Number(s.precio_compra)*Number(s.margen_ganancia)/100).toFixed(2):"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Estado:"})," ",s.estado]})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full relative",children:[e.jsx("h2",{className:"text-lg font-bold mb-2 text-yellow-800",children:"Enviar a cuarentena"}),e.jsxs("p",{className:"mb-2 text-sm",children:["Medicamento: ",e.jsx("b",{children:S?.nombre})," (",S?.codigo,")"]}),e.jsxs("label",{className:"block mb-2 text-sm",children:["Motivo de cuarentena ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{className:"w-full border rounded px-2 py-1 mb-4",rows:3,value:$,onChange:B=>R(B.target.value),required:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>f(!1),className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Cancelar"}),e.jsx("button",{className:"bg-yellow-600 text-white px-4 py-2 rounded",disabled:!$.trim(),onClick:async()=>{if(!S)return;const B=`${z}api_medicamentos.php`,O=new Date().toISOString().slice(0,10),G={...S,estado:"cuarentena",fecha_cuarentena:O,motivo_cuarentena:$};await fetch(B,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(G)}),f(!1),F(null),R(""),H()},children:"Confirmar"})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Página ",u," de ",M," (",Q.length," ","resultados)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ee(1),disabled:u===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"«"}),e.jsx("button",{onClick:()=>ee(u-1),disabled:u===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"‹"}),e.jsx("span",{className:"px-2 py-1",children:u}),e.jsx("button",{onClick:()=>ee(u+1),disabled:u===M||M===0,className:"px-2 py-1 border rounded disabled:opacity-50",children:"›"}),e.jsx("button",{onClick:()=>ee(M),disabled:u===M||M===0,className:"px-2 py-1 border rounded disabled:opacity-50",children:"»"})]})]})]}),L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-0 max-w-lg w-full relative max-h-[90vh] overflow-y-auto",children:e.jsx(Lt,{initialData:p,onSave:U,onCancel:()=>o(!1)})})}),y&&e.jsx(Et,{medicamento:y,usuario:null,onClose:()=>{m(null),H()}})]})}function we(){const s=()=>{if(a.length===0){U("Selecciona al menos un medicamento.");return}const D=a.map(V=>{const X=k.find(re=>re.id===V),te=_[V]||"unidad",ne=c[V]||1,le=x[V]||30,oe=M(X);let xe=0,se=X&&X.nombre&&X.nombre!=="0"?X.nombre:"Medicamento sin nombre";return te==="caja"?(xe=oe*le*ne,se+=" (Caja)"):(xe=oe*ne,se+=" (Unidad)"),{servicio_tipo:"farmacia",servicio_id:V,descripcion:se,cantidad:ne,precio_unitario:oe,subtotal:xe}});h(D),y(G()),r(!0)},[i,r]=t.useState(!1),[d,h]=t.useState([]),[C,y]=t.useState(0),m=ie(),j=de(),[g,w]=t.useState(!1),[v,l]=t.useState(!1),[k,L]=t.useState([]),[o,p]=t.useState(""),[a,n]=t.useState([]),[c,u]=t.useState({}),[_,E]=t.useState({}),[x,b]=t.useState({}),f=j.pacienteId||null,[S,F]=t.useState(null),[$,R]=t.useState(""),[P,A]=t.useState(""),[H,N]=t.useState(""),[T,U]=t.useState(""),Q=()=>{fetch(`${z}api_medicamentos.php`,{credentials:"include"}).then(D=>D.json()).then(D=>{L(D.medicamentos||D||[]);const V={};(D.medicamentos||D||[]).forEach(X=>{V[X.id]=X.unidades_por_caja||1}),b(V)})};t.useEffect(()=>{Q()},[]),t.useEffect(()=>{f&&fetch(`${z}api_pacientes.php?id=${f}`).then(D=>D.json()).then(D=>{D.success&&D.paciente&&F({id:D.paciente.id,dni:D.paciente.dni,nombre:(D.paciente.nombres||D.paciente.nombre||"")+" "+(D.paciente.apellidos||D.paciente.apellido||""),historia_clinica:D.paciente.historia_clinica||""})})},[f]);const M=D=>{if(!D)return 0;const V=Number(D.precio_compra||0),X=Number(D.margen_ganancia||0);return V+V*X/100},q=k.filter(D=>D.nombre.toLowerCase().includes(o.toLowerCase())||D.codigo&&D.codigo.toLowerCase().includes(o.toLowerCase())),J=D=>{n(V=>V.includes(D)?V:[...V,D]),u(V=>({...V,[D]:1})),E(V=>({...V,[D]:"unidad"}))},ee=D=>{n(V=>V.filter(X=>X!==D)),u(V=>{const X={...V};return delete X[D],X}),E(V=>{const X={...V};return delete X[D],X})},B=(D,V)=>{u(X=>({...X,[D]:V}))},O=(D,V)=>{E(X=>({...X,[D]:V})),V==="caja"&&u(X=>({...X,[D]:1}))},G=()=>a.reduce((D,V)=>{const X=k.find(le=>le.id===V),te=c[V]||1,ne=_[V]||"unidad";return X?ne==="caja"?D+M(X)*x[V]*te:D+M(X)*te:D},0);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 bg-white rounded-2xl shadow-2xl mt-8 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-blue-900 flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"medicamentos",children:"💊"}),"Cotizador de Medicamentos"]}),e.jsx("button",{className:"bg-blue-100 text-blue-800 px-4 py-2 rounded font-semibold border border-blue-300 hover:bg-blue-200 transition",onClick:()=>{f?m("/seleccionar-servicio",{state:{pacienteId:f}}):m("/seleccionar-servicio")},children:"← Volver a Servicios"})]}),e.jsxs("div",{className:"mb-4",children:[!j.pacienteId&&e.jsx(Ie,{onPacienteEncontrado:D=>{F({id:D.id,dni:D.dni||"",nombre:((D.nombre||"")+" "+(D.apellido||"")).trim(),historia_clinica:D.historia_clinica||""}),R(""),A(""),N(""),l(!0),U("")},onNoEncontrado:()=>{F(null),w(!0),l(!0),U("Paciente no encontrado. Verifica el DNI, nombre o historia clínica.")},onNuevaBusqueda:()=>{F(null),w(!1),l(!1)}}),!j.pacienteId&&!f&&!$&&!g&&v&&!S&&e.jsx("button",{className:"mt-2 px-3 py-1 bg-yellow-100 text-yellow-800 rounded border border-yellow-300 text-sm",onClick:()=>w(!0),children:"Paciente no encontrado"}),!j.pacienteId&&g&&!f&&e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx("input",{type:"text",value:$,onChange:D=>R(D.target.value),placeholder:"DNI",className:"border px-2 py-1 rounded w-32"}),e.jsx("input",{type:"text",value:P,onChange:D=>A(D.target.value),placeholder:"Nombres",className:"border px-2 py-1 rounded w-40",required:!0}),e.jsx("input",{type:"text",value:H,onChange:D=>N(D.target.value),placeholder:"Apellidos",className:"border px-2 py-1 rounded w-40",required:!0})]}),(f||$)&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded text-blue-800 text-sm",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",S?`${S.nombre} (DNI: ${S.dni})`:`${P} ${H} (DNI: ${$})`]})]}),e.jsxs("div",{className:"mb-4 flex gap-2 items-center",children:[e.jsx("span",{className:"text-blue-700 text-xl",children:"🔍"}),e.jsx("input",{type:"text",value:o,onChange:D=>p(D.target.value),placeholder:"Buscar medicamento...",className:"border px-3 py-2 rounded-lg w-full max-w-md focus:ring-2 focus:ring-blue-300"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:k.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No hay medicamentos registrados en el sistema."}):q.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-8",children:['Sin coincidencias para "',o,'".']}):e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:q.map(D=>{const V=x[D.id]||30,X=D.stock,te=Math.floor(X/V);return e.jsxs("li",{className:"flex items-center gap-4 py-3 px-2 hover:bg-blue-50 rounded-lg transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"🧪"}),D.nombre]}),e.jsxs("div",{className:"text-xs text-gray-500 flex gap-2 items-center",children:[e.jsxs("span",{children:["📦 ",te," cajas"]}),e.jsxs("span",{children:["💊 ",X," unidades"]}),e.jsxs("span",{children:["💲 S/ ",M(D).toFixed(2)," / unidad"]})]})]}),a.includes(D.id)?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:_[D.id]||"unidad",onChange:ne=>O(D.id,ne.target.value),className:"border rounded-lg px-2 py-1 mr-2 bg-white",children:[e.jsx("option",{value:"unidad",children:"Unidad"}),e.jsx("option",{value:"caja",children:"Caja"})]}),_[D.id]==="caja"?e.jsx("input",{type:"number",min:1,max:te,value:c[D.id]||1,onChange:ne=>B(D.id,Math.max(1,Math.min(te,Number(ne.target.value)))),className:"border rounded-lg px-2 w-16 bg-white"}):e.jsx("input",{type:"number",min:1,max:X,value:c[D.id]||1,onChange:ne=>B(D.id,Math.max(1,Math.min(X,Number(ne.target.value)))),className:"border rounded-lg px-2 w-16 bg-white"}),e.jsx("button",{onClick:()=>ee(D.id),className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-xl shadow transition","aria-label":"Quitar",children:e.jsx(Re,{})})]}):e.jsx("button",{onClick:()=>J(D.id),className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-100 hover:bg-green-200 text-green-700 text-xl shadow transition","aria-label":"Agregar",children:e.jsx(_e,{})})]},D.id)})})})}),e.jsxs("div",{className:"col-span-1 md:sticky md:top-24 md:ml-8 w-full md:w-96",children:[a.length>0&&!i&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotización"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:a.map(D=>{const V=k.find(K=>K.id===D),X=_[D]||"unidad",te=c[D]||1,ne=x[D]||30,le=M(V);let oe=0,xe=V?.nombre||"";return X==="caja"?(oe=le*ne*te,xe+=" (Caja)"):(oe=le*te,xe+=" (Unidad)"),e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"💊"}),xe]}),e.jsxs("span",{children:[te," ",X==="caja"?"caja(s)":"unidad(es)"]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",oe.toFixed(2)]})]},D)})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",G().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>{n([]),U("")},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:s,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Registrar Venta"})]})]}),i&&(S&&S.nombre&&S.dni||$&&P&&H?e.jsx(pe,{paciente:S||{id:null,dni:$,nombre:`${P} ${H}`,historia_clinica:`MANUAL-${$}`},servicio:{key:"farmacia",label:"Farmacia"},detalles:d,total:C,onCobroCompleto:()=>{r(!1),n([]),u({}),E({}),U("Venta procesada correctamente. Stock actualizado."),Q()},onCancelar:()=>r(!1)}):e.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-lg font-semibold text-center",children:"Faltan datos completos del paciente. Por favor, busca un paciente registrado o completa los campos de DNI, nombres y apellidos para continuar con el cobro."}))]})]})}),T&&e.jsx("div",{className:`mt-4 text-center font-semibold ${T.includes("registrada")?"text-green-600":"text-red-600"}`,children:T})]})}function Mt(){const{pacienteId:s}=de(),i=ie(),[r,d]=t.useState([]),[h,C]=t.useState([]),[y,m]=t.useState({}),[j,g]=t.useState(!1),[w,v]=t.useState([]),[l,k]=t.useState(0),[L,o]=t.useState(""),[p,a]=t.useState(null);t.useEffect(()=>{fetch(`${z}api_tarifas.php`,{credentials:"include"}).then(x=>x.json()).then(x=>{const b=(x.tarifas||[]).filter(f=>(f.servicio_tipo==="procedimiento"||f.servicio_tipo==="procedimientos")&&f.activo===1);d(b)}),fetch(`${z}api_pacientes.php?id=${s}`).then(x=>x.json()).then(x=>{x.success&&x.paciente&&a(x.paciente)}),C([]),m({}),g(!1),o("")},[s]);const n=x=>{C(b=>b.includes(x)?b:[...b,x]),m(b=>({...b,[x]:1}))},c=x=>{C(b=>b.filter(f=>f!==x)),m(b=>{const f={...b};return delete f[x],f})},u=(x,b)=>{m(f=>({...f,[x]:b}))},_=()=>h.reduce((x,b)=>{const f=r.find(F=>F.id===b),S=y[b]||1;return f?x+f.precio_particular*S:x},0),E=()=>{if(h.length===0){o("Selecciona al menos un procedimiento.");return}const x=h.map(b=>{const f=r.find($=>$.id===b),S=y[b]||1;let F=f&&f.descripcion?f.descripcion:f&&f.nombre?f.nombre:"";return(F===0||F==="0"||F===null||F===void 0)&&(F=f&&f.nombre?f.nombre:""),f?{servicio_tipo:"procedimiento",servicio_id:b,descripcion:F,cantidad:S,precio_unitario:f.precio_particular,subtotal:f.precio_particular*S}:null}).filter(Boolean);v(x),k(_()),g(!0)};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 md:p-8 bg-white rounded-xl shadow-lg mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"🛠️"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Cotización de Procedimientos"})]}),e.jsx("button",{onClick:()=>i("/seleccionar-servicio",{state:{pacienteId:s}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"})]}),e.jsx("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:e.jsxs("div",{className:"text-gray-600",children:[e.jsx("b",{children:"ID Paciente:"})," ",s]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Selecciona los procedimientos:"}),r.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No hay procedimientos para mostrar."}):e.jsx("div",{className:"bg-white rounded-lg shadow border border-gray-200",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:r.map(x=>e.jsxs("li",{className:"flex items-center px-4 py-3 hover:bg-blue-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:h.includes(x.id),onChange:()=>h.includes(x.id)?c(x.id):n(x.id),className:"mr-3 accent-orange-600 w-5 h-5"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"font-semibold text-gray-800",children:x.descripcion||x.nombre})}),e.jsxs("div",{className:"font-bold text-green-700 text-lg",children:["S/ ",x.precio_particular]}),h.includes(x.id)&&e.jsx("input",{type:"number",min:1,value:y[x.id]||1,onChange:b=>u(x.id,Math.max(1,Number(b.target.value))),className:"border rounded-lg px-2 w-16 bg-white ml-2"})]},x.id))})})]})}),e.jsxs("div",{className:"w-full md:w-96 md:sticky md:top-8 h-fit",children:[h.length>0&&!j&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotización"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:h.map(x=>{const b=r.find(S=>S.id===x),f=y[x]||1;return b?e.jsxs("li",{className:"py-2 flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx("div",{children:e.jsx("span",{className:"font-medium text-gray-900",children:b.descripcion||b.nombre})}),e.jsxs("div",{className:"font-bold text-green-700 text-right",children:["S/ ",(b.precio_particular*f).toFixed(2)]})]},x):null})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",_().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>{C([]),o("")},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:E,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Cotizar"})]})]}),j&&e.jsx(pe,{paciente:p,servicio:{key:"procedimiento",label:"Procedimiento"},detalles:w,total:l,onCobroCompleto:()=>{g(!1),C([]),m({}),o("Cotización procesada correctamente.")},onCancelar:()=>g(!1)})]})]}),L&&e.jsx("div",{className:`mt-6 text-center font-semibold ${L.includes("correctamente")?"text-green-600":"text-red-600"}`,children:L})]})}function Pt(){const[s,i]=t.useState(!1),[r,d]=t.useState(null),[h,C]=t.useState([]),[y,m]=t.useState(""),[j,g]=t.useState(""),{pacienteId:w}=de(),v=ie(),[l,k]=t.useState(null),[L,o]=t.useState(!0),[p,a]=t.useState(""),[n,c]=t.useState(1),[u,_]=t.useState(3);if(t.useEffect(()=>{c(1)},[u,y,j]),t.useEffect(()=>{fetch(`${z}api_consumos_paciente.php?paciente_id=${w}`,{credentials:"include"}).then(A=>A.json()).then(A=>{A.success?k(A):a(A.error||"Error al cargar consumo"),o(!1)}).catch(()=>{a("Error de conexión con el servidor"),o(!1)})},[w]),L)return e.jsx(ue,{});if(p)return e.jsx("div",{className:"text-red-600 font-bold p-6",children:p});let E=l.historial;function x(A){return A.split(" ")[0]}y&&(E=E.filter(A=>x(A.fecha)>=y)),j&&(E=E.filter(A=>x(A.fecha)<=j));const b=E.length,f=Math.max(1,Math.ceil(b/u)),S=(n-1)*u,F=S+u,$=E.slice(S,F),R=()=>{const H=[],N=[];for(let T=Math.max(2,n-2);T<=Math.min(f-1,n+2);T++)H.push(T);return n-2>2?N.push(1,"..."):N.push(1),N.push(...H),n+2<f-1?N.push("...",f):f>1&&N.push(f),N.filter((T,U,Q)=>Q.indexOf(T)===U)};function P(){if(!r||!h)return;const A=new Date(r.fecha).toLocaleString("es-PE"),H=l.apellido?`${l.nombre} ${l.apellido}`:l.nombre,N=r.tipo_pago?r.tipo_pago.toUpperCase():r.detalles&&r.detalles[0]?.tipo_pago?r.detalles[0].tipo_pago.toUpperCase():"EFECTIVO",T=r.cobertura?r.cobertura.toUpperCase():r.detalles&&r.detalles[0]?.cobertura?r.detalles[0].cobertura.toUpperCase():"PARTICULAR",U=`
      <div style="font-family: monospace; width: 320px; margin: 0 auto;">
        <h3 style="text-align: center; margin-bottom: 10px;">🏥 CLÍNICA 2 DE MAYO</h3>
        <hr>
        <p><strong>COMPROBANTE DE PAGO #${r.cobro_id||""}</strong></p>
        <p>Fecha: ${A}</p>
        <p>Paciente: ${H}</p>
        <p>DNI: ${l.dni}</p>
        <p>H.C.: ${l.historia_clinica}</p>
        <hr>
        <p><strong>DETALLE:</strong></p>
        ${h.map(Q=>`<p>${Q.descripcion} x${Q.cantidad||1} .... S/ ${(Q.subtotal||Q.monto).toFixed(2)}</p>`).join("")}
        <hr>
        <p style="font-weight:bold; font-size:17px; color:#008000;">TOTAL: S/ ${h.reduce((Q,M)=>Q+Number(M.subtotal||M.monto),0).toFixed(2)}</p>
        <p>Tipo de pago: ${N}</p>
        <p>Cobertura: ${T}</p>
        <hr>
        <div style="text-align: center; font-size: 12px;">Gracias por su preferencia<br>Conserve este comprobante</div>
      </div>
    `;I.fire({title:"Ticket de Cobro",html:U,icon:"info",confirmButtonText:"Imprimir",showCancelButton:!0,cancelButtonText:"Cerrar"}).then(Q=>{if(Q.isConfirmed){const M=window.open("","_blank","width=400,height=600");M.document.write(`<html><head><title>Ticket</title></head><body>${U}</body></html>`),M.document.close(),M.print()}})}return e.jsxs("div",{className:"max-w-3xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8 font-sans",children:[s&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-red-600 text-xl font-bold",onClick:()=>i(!1),children:"×"}),e.jsx("h3",{className:"text-lg font-bold mb-2 text-blue-800",children:"Detalle del Cobro"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Fecha:"})," ",r.fecha,e.jsx("br",{})]}),e.jsxs("table",{className:"min-w-full border rounded mb-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1 border text-left",children:"Servicio"}),e.jsx("th",{className:"px-2 py-1 border text-left",children:"Descripción"}),e.jsx("th",{className:"px-2 py-1 border text-right",children:"Monto (S/)"})]})}),e.jsx("tbody",{children:h.map((A,H)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:A.servicio_tipo||r.servicio}),e.jsx("td",{className:"border px-2 py-1",children:A.descripcion&&A.descripcion!=="0"?A.descripcion:e.jsx("span",{className:"italic text-gray-500",children:"Sin detalle"})}),e.jsx("td",{className:"border px-2 py-1 text-right",children:Number(A.subtotal||A.monto).toFixed(2)})]},H))})]}),e.jsxs("div",{className:"font-bold text-right text-green-700 text-lg mb-4",children:["Total: S/ ",h.reduce((A,H)=>A+Number(H.subtotal||H.monto),0).toFixed(2)]}),e.jsx("button",{className:"w-full py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded shadow",onClick:P,children:"Imprimir ticket"})]})}),e.jsx("button",{onClick:()=>v(-1),className:"mb-4 bg-gradient-to-r from-blue-200 to-purple-200 px-4 py-2 rounded hover:bg-blue-300 flex items-center gap-2 text-blue-900 font-semibold",children:"← Volver"}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ns,{className:"text-3xl text-blue-700"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Consumo del Paciente"})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-2 gap-4 bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"ID:"})," ",l.paciente_id," ",e.jsx("br",{}),e.jsx("span",{className:"font-semibold text-gray-700",children:"Nombre:"})," ",l.nombre," ",l.apellido," ",e.jsx("br",{}),e.jsx("span",{className:"font-semibold text-gray-700",children:"DNI:"})," ",l.dni]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Historia Clínica:"})," ",l.historia_clinica," ",e.jsx("br",{}),e.jsxs("span",{className:"inline-flex items-center gap-2 font-bold text-green-700 text-lg mt-2",children:[e.jsx(me,{className:"text-2xl"}),"Consumo Total: S/ ",l.consumo_total.toFixed(2)]}),l.deuda_total>0&&e.jsxs("span",{className:"inline-flex items-center gap-2 font-bold text-red-600 text-lg mt-2 ml-4",children:[e.jsx(me,{className:"text-2xl"}),"Deuda: S/ ",l.deuda_total.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-8 mb-2",children:[e.jsx(ls,{className:"text-xl text-purple-700"}),e.jsx("h4",{className:"font-semibold text-lg text-purple-800",children:"Historial de Servicios"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"fechaInicio",className:"font-semibold text-gray-700",children:"Desde:"}),e.jsx("input",{type:"date",id:"fechaInicio",value:y,onChange:A=>m(A.target.value),className:"border rounded px-2 py-1 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"fechaFin",className:"font-semibold text-gray-700",children:"Hasta:"}),e.jsx("input",{type:"date",id:"fechaFin",value:j,onChange:A=>g(A.target.value),className:"border rounded px-2 py-1 text-sm"})]}),e.jsx("button",{onClick:()=>{m(""),g("")},className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 font-semibold",children:"Limpiar Filtros"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border rounded-lg shadow-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-purple-100",children:[e.jsx("th",{className:"px-3 py-2 border text-left",children:"Fecha"}),e.jsx("th",{className:"px-3 py-2 border text-left",children:"Servicio"}),e.jsx("th",{className:"px-3 py-2 border text-left",children:"Descripción"}),e.jsx("th",{className:"px-3 py-2 border text-right",children:"Monto (S/)"})]})}),e.jsx("tbody",{children:E.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-6 text-gray-500",children:l.historial.length===0?"No hay servicios registrados.":"No se encontraron servicios en el rango de fechas seleccionado."})}):$.map((A,H)=>e.jsxs("tr",{className:H%2===0?"bg-white":"bg-blue-50",children:[e.jsx("td",{className:"border px-3 py-2",children:A.fecha}),e.jsx("td",{className:"border px-3 py-2",children:e.jsxs("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold ${A.servicio==="consulta"?"bg-green-100 text-green-700":A.servicio==="laboratorio"?"bg-yellow-100 text-yellow-700":A.servicio==="farmacia"?"bg-purple-100 text-purple-700":A.servicio==="procedimiento"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:[A.servicio,A.servicio==="laboratorio"&&A.resultados_laboratorio&&e.jsx("button",{className:"ml-2 text-purple-700 hover:text-purple-900",title:"Descargar resultados",onClick:()=>window.open(A.resultados_laboratorio,"_blank"),children:e.jsx("span",{role:"img","aria-label":"descargar",children:"📥"})})]})}),e.jsx("td",{className:"border px-3 py-2",children:e.jsx("button",{className:"px-3 py-1 bg-blue-100 hover:bg-blue-200 rounded text-blue-900 font-semibold text-xs shadow",onClick:()=>{d(A),C(A.detalles),i(!0)},children:"Ver detalle"})}),e.jsx("td",{className:"border px-3 py-2 text-right font-semibold text-green-700",children:Number(A.monto).toFixed(2)})]},H))})]})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:["Mostrando ",b===0?0:S+1," - ",Math.min(F,b)," de ",b," servicios"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-semibold",children:"Filas:"}),e.jsxs("select",{id:"itemsPerPage",value:u,onChange:A=>_(Number(A.target.value)),className:"border rounded px-2 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]})]}),b>0&&e.jsxs("span",{className:"text-blue-600 font-medium",children:["Total de servicios: S/ ",E.reduce((A,H)=>A+Number(H.monto),0).toFixed(2)]})]}),f>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>c(1),disabled:n===1,title:"Primera página",children:"«"}),e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>c(n-1),disabled:n===1,children:"‹ Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:R().map((A,H)=>e.jsx(Ne.Fragment,{children:A==="..."?e.jsx("span",{className:"px-3 py-2 text-gray-500",children:"..."}):e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===A?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>c(A),children:A})},H))}),e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===f?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>c(n+1),disabled:n===f,children:"Siguiente ›"}),e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===f?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>c(f),disabled:n===f,title:"Última página",children:"»"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Ir a página:"}),e.jsx("input",{type:"number",min:"1",max:f,value:n,onChange:A=>{const H=parseInt(A.target.value);H>=1&&H<=f&&c(H)},className:"w-16 px-2 py-1 border rounded text-center focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsxs("span",{className:"text-gray-600",children:["de ",f]})]})]})]})]})}function Ft(){const[s,i]=t.useState([]),[r,d]=t.useState(!0),[h,C]=t.useState(null),[y,m]=t.useState([]),[j,g]=t.useState(!1),[w,v]=t.useState(""),[l,k]=t.useState(""),[L,o]=t.useState(1),[p,a]=t.useState(3),[n,c]=t.useState(0),u=()=>{d(!0);let b=`${z}api_cobros.php`;const f=[`page=${L}`,`limit=${p}`,"servicio=farmacia"];let S=w,F=l;(S&&!F||!S&&F)&&(S=S||F,F=F||S),S&&F&&(f.push(`fecha_inicio=${S}`),f.push(`fecha_fin=${F}`)),b+="?"+f.join("&"),fetch(b,{credentials:"include"}).then($=>{if(!$.ok)throw new Error(`Error HTTP: ${$.status}`);return $.json()}).then($=>{i($.cobros||[]),c($.total||0),d(!1)}).catch($=>{d(!1),console.error("Error al cargar ventas:",$),alert("Error al cargar ventas: "+$.message)})};t.useEffect(()=>{u()},[w,l,L,p]);const _=b=>{C(b),g(!0),fetch(`${z}api_cobros.php?cobro_id=${b.id}`,{credentials:"include"}).then(f=>f.json()).then(f=>{if(f.success&&f.cobro){const S=f.cobro.detalles||[];let F=[];S.forEach($=>{if($.servicio_tipo==="farmacia")try{F=JSON.parse($.descripcion)}catch{F.push({descripcion:$.descripcion,cantidad:$.cantidad,precio_unitario:$.precio_unitario,subtotal:$.subtotal})}}),m(F)}})},E=()=>{const b=new De;b.text("Ventas de Farmacia",14,14),$e(b,{head:[["Fecha","Paciente","DNI","Usuario","Total","Estado"]],body:s.map(f=>[new Date(f.fecha_cobro).toLocaleDateString(),f.nombre?`${f.nombre} ${f.apellido||""}`.trim():"-",f.dni||"-",f.usuario_nombre||f.usuario_id,`S/ ${parseFloat(f.total).toFixed(2)}`,f.estado])}),b.save("ventas_farmacia.pdf")},x=()=>{const b=be.json_to_sheet(s.map(S=>({Fecha:new Date(S.fecha_cobro).toLocaleDateString(),Paciente:S.nombre?`${S.nombre} ${S.apellido||""}`.trim():"-",DNI:S.dni||"-",Usuario:S.usuario_nombre||S.usuario_id,Total:parseFloat(S.total).toFixed(2),Estado:S.estado}))),f=be.book_new();be.book_append_sheet(f,b,"Ventas"),os(f,"ventas_farmacia.xlsx")};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-800 mb-4",children:"Ventas de Farmacia"}),e.jsxs("div",{className:"flex gap-4 mb-4 items-center",children:[e.jsxs("label",{className:"text-sm",children:["Mostrar:",e.jsxs("select",{value:p,onChange:b=>{a(Number(b.target.value)),o(1)},className:"ml-2 border rounded px-2 py-1",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]}),e.jsx("button",{className:"px-3 py-1 bg-green-600 text-white rounded",onClick:E,children:"Exportar PDF"}),e.jsx("button",{className:"px-3 py-1 bg-amber-500 text-white rounded",onClick:x,children:"Exportar Excel"}),e.jsxs("label",{className:"text-sm",children:["Desde:",e.jsx("input",{type:"date",value:w,onChange:b=>v(b.target.value),className:"ml-2 border rounded px-2 py-1"})]}),e.jsxs("label",{className:"text-sm",children:["Hasta:",e.jsx("input",{type:"date",value:l,onChange:b=>k(b.target.value),className:"ml-2 border rounded px-2 py-1"})]}),e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded",onClick:u,children:"Filtrar"}),(w||l)&&e.jsx("button",{className:"px-2 py-1 bg-gray-200 text-gray-700 rounded",onClick:()=>{v(""),k("")},children:"Limpiar"})]}),r?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Cargando ventas..."}):s.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No hay ventas registradas."}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-50",children:[e.jsx("th",{className:"p-2",children:"Fecha"}),e.jsx("th",{className:"p-2",children:"Paciente"}),e.jsx("th",{className:"p-2",children:"DNI"}),e.jsx("th",{className:"p-2",children:"Usuario"}),e.jsx("th",{className:"p-2",children:"Total"}),e.jsx("th",{className:"p-2",children:"Estado"}),e.jsx("th",{className:"p-2",children:"Detalle"})]})}),e.jsx("tbody",{children:s.map(b=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:new Date(b.fecha_cobro).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:b.nombre?`${b.nombre} ${b.apellido||""}`.trim():"-"}),e.jsx("td",{className:"p-2",children:b.dni||"-"}),e.jsx("td",{className:"p-2",children:b.usuario_nombre||b.usuario_id}),e.jsxs("td",{className:"p-2 font-bold text-blue-700",children:["S/ ",parseFloat(b.total).toFixed(2)]}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${b.estado==="pagado"?"bg-green-100 text-green-800":b.estado==="anulado"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:b.estado})}),e.jsx("td",{className:"p-2",children:e.jsx("button",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200",onClick:()=>_(b),children:"Ver"})})]},b.id))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("span",{className:"text-sm",children:["Página ",L," de ",Math.max(1,Math.ceil(n/p))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded",disabled:L===1,onClick:()=>o(L-1),children:"Anterior"}),e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded",disabled:L>=Math.ceil(n/p),onClick:()=>o(L+1),children:"Siguiente"})]})]})]}),j&&h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 text-xl",onClick:()=>g(!1),children:"✕"}),e.jsx("h3",{className:"text-xl font-bold mb-2 text-blue-700",children:"Detalle de Venta"}),e.jsxs("div",{className:"mb-2 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Paciente:"})," ",h.nombre?`${h.nombre} ${h.apellido||""}`.trim():"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",h.dni||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Usuario:"})," ",h.usuario_nombre||h.usuario_id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Fecha:"})," ",new Date(h.fecha_cobro).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("b",{children:"Total:"})," S/ ",parseFloat(h.total).toFixed(2)]}),e.jsxs("div",{children:[e.jsx("b",{children:"Tipo de Pago:"})," ",h.tipo_pago]})]}),e.jsxs("table",{className:"w-full text-sm border mb-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-50",children:[e.jsx("th",{className:"p-2",children:"Medicamento"}),e.jsx("th",{className:"p-2",children:"Cantidad"}),e.jsx("th",{className:"p-2",children:"Precio Unitario"}),e.jsx("th",{className:"p-2",children:"Subtotal"})]})}),e.jsx("tbody",{children:y.map(b=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:b.descripcion}),e.jsx("td",{className:"p-2",children:b.cantidad}),e.jsxs("td",{className:"p-2",children:["S/ ",b.precio_unitario]}),e.jsxs("td",{className:"p-2",children:["S/ ",b.subtotal]})]},b.id))})]})]})})]})}function Tt(){const s=Ce(),i=ie(),[r,d]=t.useState(null),h=s.state?.pacienteId,[C,y]=t.useState([]);return t.useEffect(()=>{fetch(z+"api_tarifas.php",{credentials:"include"}).then(m=>m.json()).then(m=>{if(m.success&&Array.isArray(m.tarifas)){const j=["consulta","laboratorio","farmacia","ecografia","rayosx","ocupacional"],g=m.tarifas.filter(w=>w.activo===1&&!j.includes(w.servicio_tipo)).map(w=>({key:w.servicio_tipo+"_"+w.id,label:w.descripcion,tarifaId:w.id}));y(g)}})},[]),t.useEffect(()=>{h&&fetch(`${z}api_pacientes.php?id=${h}`).then(m=>m.json()).then(m=>{m.success&&m.paciente?d(m.paciente):d(null)})},[h]),e.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-blue-400 rounded-t-xl p-4 mb-0",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"🗂️"})," Atención en Recepción"]}),e.jsx("p",{className:"text-white text-sm",children:"Gestión de pacientes y servicios"})]}),e.jsxs("div",{className:"bg-white rounded-b-xl shadow p-4",children:[e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded font-bold hover:bg-blue-600 mb-4",onClick:()=>i("/"),children:"Volver al Dashboard"}),r?e.jsxs("div",{className:"bg-blue-50 rounded p-4 mb-4",children:[e.jsx("div",{className:"font-bold text-blue-800 mb-2",children:"Paciente encontrado:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",r.nombre]}),e.jsxs("div",{children:[e.jsx("b",{children:"Apellido:"})," ",r.apellido]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",r.dni]}),e.jsxs("div",{children:[e.jsx("b",{children:"Fecha de nacimiento:"})," ",r.fecha_nacimiento]}),e.jsxs("div",{children:[e.jsx("b",{children:"Sexo:"})," ",r.sexo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Dirección:"})," ",r.direccion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Teléfono:"})," ",r.telefono]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",r.email]}),e.jsxs("div",{children:[e.jsx("b",{children:"Tipo de seguro:"})," ",r.tipo_seguro]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Historia Clínica:"})," ",r.historia_clinica]}),e.jsxs("div",{children:[e.jsx("b",{children:"Edad:"})," ",r.edad?r.edad+" años":r.fecha_nacimiento?(()=>{const m=new Date(r.fecha_nacimiento);return isNaN(m)?"Edad no disponible":Math.floor((new Date-m)/(365.25*24*60*60*1e3))+" años"})():"Edad no disponible"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Procedencia:"})," ",r.procedencia]})]})]})]}):e.jsx("div",{className:"text-center text-gray-500 mb-4",children:"Busca un paciente por DNI para mostrar los servicios."}),r&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-2",children:[e.jsxs("div",{className:"font-semibold text-blue-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"🔽"})," Seleccionar Servicio para: ",e.jsxs("span",{className:"text-black",children:[r.nombre," ",r.apellido]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-100 font-bold",onClick:()=>i("/agendar-consulta",{state:{pacienteId:r.id}}),children:"👨‍⚕️ Consulta Médica"}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-green-100 font-bold",onClick:()=>i(`/cotizar-laboratorio/${r.id}`),children:["🧪 Laboratorio ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-purple-100 font-bold",onClick:()=>i(`/cotizar-farmacia/${r.id}`),children:["💊 Farmacia ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-50 font-bold",onClick:()=>i(`/cotizar-rayosx/${r.id}`),children:["🩻 Rayos X ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-50 font-bold",onClick:()=>i(`/cotizar-ecografia/${r.id}`),children:["🩺 Ecografías ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-orange-100 font-bold",onClick:()=>i(`/cotizar-procedimientos/${r.id}`),children:["🛠️ Procedimientos ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-50 font-bold",onClick:()=>{I.fire({title:"Página en construcción",text:"La funcionalidad de Medicina Ocupacional estará disponible próximamente.",icon:"info",confirmButtonText:"OK"})},children:["👨‍⚕️ Medicina Ocupacional ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 flex gap-4 items-center",children:[e.jsx("span",{children:"💰 = Requiere pago previo"}),e.jsx("span",{children:"📅 = Agendar primero, cobrar después"})]})]})]})]})})}function Dt(){const[s,i]=t.useState(()=>{const d=sessionStorage.getItem("usuario"),h=sessionStorage.getItem("medico");return d?JSON.parse(d):h?JSON.parse(h):null}),r=async()=>{try{await fetch("/policlinico-2demayo/api_logout.php",{method:"POST",credentials:"include"})}catch(d){console.error("Error al cerrar sesión en el backend:",d)}i(null),sessionStorage.removeItem("usuario"),sessionStorage.removeItem("medico"),window.location.href="/"};return t.useEffect(()=>{s&&(s.rol==="medico"?(sessionStorage.setItem("medico",JSON.stringify(s)),sessionStorage.removeItem("usuario")):(sessionStorage.setItem("usuario",JSON.stringify(s)),sessionStorage.removeItem("medico")))},[s]),e.jsx(cs,{children:s?e.jsx(Ns,{usuario:s,onLogout:r,children:e.jsxs(ds,{children:[e.jsx(Y,{path:"/",element:s?.rol==="medico"?e.jsx(ge,{to:"/mis-consultas",replace:!0}):s?.rol==="laboratorista"?e.jsx(ge,{to:"/panel-laboratorio",replace:!0}):s?.rol==="enfermero"?e.jsx(ge,{to:"/panel-enfermero",replace:!0}):s?.rol==="químico"||s?.rol==="quimico"?e.jsx(ge,{to:"/medicamentos",replace:!0}):e.jsx(_s,{usuario:s})}),e.jsx(Y,{path:"/pacientes",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Ss,{})})}),e.jsx(Y,{path:"/usuarios",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(Es,{})})}),e.jsx(Y,{path:"/agendar-consulta",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Ps,{})})}),s?.rol==="medico"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{path:"/mis-consultas",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Ts,{usuario:s})})}),e.jsx(Y,{path:"/panel-medico",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Vs,{})})}),e.jsx(Y,{path:"/historia-clinica/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Pe,{})})}),e.jsx(Y,{path:"/historia-clinica/:pacienteId/:consultaId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Pe,{})})}),e.jsx(Y,{path:"/historial-consultas",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(at,{medicoId:s.id})})}),e.jsx(Y,{path:"/solicitud-laboratorio/:consultaId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(dt,{})})}),e.jsx(Y,{path:"/resultados-laboratorio/:consultaId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(bt,{})})})]}),(s?.rol==="químico"||s?.rol==="quimico")&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{path:"/medicamentos",element:e.jsx(Z,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(Fe,{})})}),e.jsx(Y,{path:"/farmacia/cotizador",element:e.jsx(Z,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(we,{})})}),e.jsx(Y,{path:"/farmacia/ventas",element:e.jsx(Z,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(Ft,{})})})]}),s?.rol==="enfermero"&&e.jsx(Y,{path:"/panel-enfermero",element:e.jsx(Z,{usuario:s,rolesPermitidos:["enfermero"],children:e.jsx(lt,{})})}),(s?.rol==="administrador"||s?.rol==="recepcionista")&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{path:"/medicos",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(Os,{})})}),e.jsx(Y,{path:"/reportes",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(ft,{})})}),e.jsx(Y,{path:"/contabilidad/ingresos",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Nt,{})})}),e.jsx(Y,{path:"/contabilidad/nuevo-ingreso",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(vt,{})})}),e.jsx(Y,{path:"/contabilidad/ingresos-detalle",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(yt,{})})}),e.jsx(Y,{path:"/contabilidad/cierre-caja",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(wt,{})})}),e.jsx(Y,{path:"/contabilidad/egresos",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Módulo de Egresos"}),e.jsx("p",{className:"text-gray-600",children:"En construcción..."})]})})}),e.jsx(Y,{path:"/contabilidad/reportes",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Reportes Financieros"}),e.jsx("p",{className:"text-gray-600",children:"En construcción..."})]})})}),e.jsx(Y,{path:"/contabilidad/balance",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Balance General"}),e.jsx("p",{className:"text-gray-600",children:"En construcción..."})]})})}),e.jsx(Y,{path:"/configuracion",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(kt,{})})}),e.jsx(Y,{path:"/reabrir-caja",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(Ct,{})})}),e.jsx(Y,{path:"/gestion-tarifas",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(_t,{})})}),e.jsx(Y,{path:"/cotizar-laboratorio/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(xt,{})})}),e.jsx(Y,{path:"/cotizar-rayosx/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(mt,{})})}),e.jsx(Y,{path:"/cotizar-ecografia/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(ht,{})})}),e.jsx(Y,{path:"/cotizar-farmacia/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(we,{})})}),e.jsx(Y,{path:"/cotizar-procedimientos/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Mt,{})})}),e.jsx(Y,{path:"/seleccionar-servicio",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Tt,{})})}),e.jsx(Y,{path:"/consumo-paciente/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Pt,{})})})]}),s?.rol==="laboratorista"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{path:"/panel-laboratorio",element:e.jsx(Z,{usuario:s,rolesPermitidos:["laboratorista"],children:e.jsx(gt,{})})}),e.jsx(Y,{path:"/examenes-laboratorio",element:e.jsx(Z,{usuario:s,rolesPermitidos:["laboratorista"],children:e.jsx(ms,{})})})]}),(s?.rol==="químico"||s?.rol==="quimico")&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{path:"/medicamentos",element:e.jsx(Z,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(Fe,{})})}),e.jsx(Y,{path:"/farmacia/cotizador",element:e.jsx(Z,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(we,{})})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-800 via-blue-500 to-green-400",children:e.jsx(gs,{onLogin:i})})})}class $t extends Ne.Component{constructor(i){super(i),this.state={hasError:!1}}static getDerivedStateFromError(i){return{hasError:!0}}componentDidCatch(i,r){console.error("Error capturado por ErrorBoundary:",i,r)}render(){return this.state.hasError?e.jsxs("div",{className:"max-w-md mx-auto mt-6 p-4 bg-red-100 text-red-700 rounded shadow text-center",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"¡Ups! Algo salió mal."}),e.jsx("p",{children:"Por favor, recarga la página o intenta más tarde."})]}):this.props.children}}xs.createRoot(document.getElementById("root")).render(e.jsx(Ne.StrictMode,{children:e.jsx($t,{children:e.jsx(Dt,{})})}));
