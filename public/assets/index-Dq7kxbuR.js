import{r as t,c as ie,j as e,I as U,i as He,L as te,S as V,d as Ce,C as Te,e as Ve,f as fe,u as be,w as We,b as qe,E as De,a as $e,R as Ne,l as ke,g as de,h as Ue,k as me,m as Ge,n as ve,o as Ae,p as ze,q as Je,s as Xe,t as Oe,v as Ke,x as he,y as _e,z as Be,A as Re,B as je,D as ye,G as Se,H as Ye,J as Qe,K as Ee,M as Ze,N as es,O as ss,P as ts,Q as as,T as rs,U as ge,V as is,W as Me,X as ns,Y as os,Z as ls,_ as cs,$ as ds,a0 as Z,a1 as xs}from"./vendor-C2qQlVqX.js";import{B as I,E as ms}from"./examenes-laboratorio-crud-BEw66v2w.js";import{P as hs,a as us,S as ue}from"./paciente-list-J7losCFV.js";import{U as ps}from"./usuario-list-BPL8m8QU.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))x(p);new MutationObserver(p=>{for(const C of p)if(C.type==="childList")for(const w of C.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&x(w)}).observe(document,{childList:!0,subtree:!0});function r(p){const C={};return p.integrity&&(C.integrity=p.integrity),p.referrerPolicy&&(C.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?C.credentials="include":p.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function x(p){if(p.ep)return;p.ep=!0;const C=r(p);fetch(p.href,C)}})();function gs({onLogin:s}){const[i,r]=t.useState(""),[x,p]=t.useState(""),[C,w]=t.useState(""),[h,N]=t.useState(!1),[g,v]=t.useState(!1),y=ie(),o=()=>window.location.protocol!=="https:"&&window.location.hostname!=="localhost"?{isValid:!1,message:"⚠️ Conexión insegura detectada. Se requiere HTTPS para proteger tus credenciales."}:{isValid:!0},E=async S=>{S.preventDefault(),w(""),N(!0);const c=o();if(!c.isValid){w(c.message),N(!1);return}const u=i.includes("@")&&i.includes(".");try{if(u){let a,n;try{a=await fetch(I+"api_login_medico.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:i,password:x}),credentials:"include"}),n=await a.json()}catch{a={ok:!1},n={}}if(a.ok&&n.success){const k={...n.medico,rol:"medico"};sessionStorage.setItem("medico",JSON.stringify(k)),s&&s(k),y("/");return}let d,l;try{d=await fetch(I+"api_login.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({usuario:i,password:x}),credentials:"include"}),l=await d.json()}catch{d={ok:!1},l={}}if(d.ok&&l.success){sessionStorage.setItem("usuario",JSON.stringify(l.usuario)),s&&s(l.usuario),y("/");return}}else{let a,n;try{a=await fetch(I+"api_login.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({usuario:i,password:x}),credentials:"include"}),n=await a.json()}catch{a={ok:!1},n={}}if(a.ok&&n.success){sessionStorage.setItem("usuario",JSON.stringify(n.usuario)),s&&s(n.usuario),y("/");return}let d,l;try{d=await fetch(I+"api_login_medico.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:i,password:x}),credentials:"include"}),l=await d.json()}catch{d={ok:!1},l={}}if(d.ok&&l.success){const k={...l.medico,rol:"medico"};sessionStorage.setItem("medico",JSON.stringify(k)),s&&s(k),y("/");return}}w("Usuario o contraseña incorrectos")}catch{w("Error de conexión con el servidor")}finally{N(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-900 via-purple-800 to-indigo-900 flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-blue-400/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-80 h-80 bg-purple-400/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-3/4 left-1/2 w-64 h-64 bg-indigo-400/20 rounded-full blur-3xl"})]}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl border border-white/20 shadow-2xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"relative mx-auto w-20 h-20 mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full blur-lg opacity-60"}),e.jsx("img",{src:"/2demayo.svg",alt:"Logo clínica",className:"relative w-20 h-20 object-contain bg-white/90 rounded-full p-3 shadow-lg ring-4 ring-white/30"})]}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2 drop-shadow-lg",children:"Clínica 2 de Mayo"}),e.jsx("p",{className:"text-lg text-white/80",children:"Acceso al Sistema Médico"})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(U,{iconName:"Contact",className:"text-xl text-white/60"})}),e.jsx("input",{type:"text",placeholder:"Usuario o email del médico",value:i,onChange:S=>r(S.target.value),className:"w-full bg-white/10 border border-white/20 rounded-2xl pl-12 pr-4 py-4 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:border-transparent backdrop-blur-sm transition-all duration-300",required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(U,{iconName:"Lock",className:"text-xl text-white/60"})}),e.jsx("input",{type:g?"text":"password",placeholder:"Contraseña",value:x,onChange:S=>p(S.target.value),className:"w-full bg-white/10 border border-white/20 rounded-2xl pl-12 pr-12 py-4 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:border-transparent backdrop-blur-sm transition-all duration-300",required:!0}),e.jsx("button",{type:"button",onClick:()=>v(!g),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-white/60 hover:text-white transition-colors",children:e.jsx(U,{iconName:g?"Hide":"RedEye",className:"text-xl"})})]}),e.jsxs("button",{type:"submit",disabled:h,className:"w-full bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 hover:from-blue-700 hover:via-purple-700 hover:to-indigo-800 text-white font-bold rounded-2xl py-4 px-6 shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-3 relative overflow-hidden",children:[h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Verificando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{iconName:"SignIn",className:"text-xl"}),e.jsx("span",{children:"Ingresar al Sistema"})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"})]}),C&&e.jsx("div",{className:"bg-red-500/20 backdrop-blur-sm border border-red-400/30 rounded-2xl p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-200",children:[e.jsx(U,{iconName:"ErrorBadge",className:"text-xl"}),e.jsx("span",{className:"font-medium",children:C})]})})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-white/60 text-sm",children:[e.jsx(U,{iconName:"Shield",className:"text-lg"}),e.jsx("span",{children:"Sistema Seguro y Confiable"})]})})]})})]})}function bs(){return e.jsx("footer",{className:"w-full bg-purple-800 py-4 border-t border-blue-500 shadow-inner",children:e.jsx("div",{className:"container mx-auto text-center",children:e.jsxs("span",{className:"text-white text-sm font-medium drop-shadow",children:["© ",new Date().getFullYear()," Clínica 2 de Mayo. Todos los derechos reservados."]})})})}He();function fs({open:s,onClose:i,onLogout:r,usuario:x}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed inset-0 z-40 bg-black bg-opacity-40 transition-opacity duration-200 md:hidden ${s?"block":"hidden"}`,onClick:i,"aria-hidden":"true"}),e.jsx("aside",{className:`fixed z-50 top-0 left-0 h-full w-64 bg-white border-r border-blue-500 shadow-lg transform transition-transform duration-200 ease-in-out
        ${s?"translate-x-0":"-translate-x-full"}
        md:translate-x-0 md:static md:flex md:flex-col md:z-10 md:h-auto md:shadow-none md:bg-white md:w-64`,children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsxs("div",{className:"flex flex-col items-center py-6 bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 text-white rounded-b-2xl mx-2 mb-4 shadow-lg",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-full blur-md"}),e.jsx("img",{src:"/2demayo.svg",alt:"Logo",className:"relative h-16 w-16 object-contain bg-white rounded-full p-2 shadow-lg ring-4 ring-white/30",onError:p=>{p.target.onerror=null,p.target.src="/logo.svg"}})]}),e.jsx("h5",{className:"text-lg font-bold text-white mt-3 text-center drop-shadow-lg",children:"Clínica 2 de Mayo"}),e.jsx("div",{className:"w-12 h-0.5 bg-white/30 rounded-full mt-2"})]}),e.jsx("nav",{className:"flex flex-col gap-3 px-4 flex-1 overflow-y-auto",children:x?.rol==="medico"?e.jsxs(e.Fragment,{children:[e.jsxs(te,{to:"/mis-consultas",className:"py-2 px-3 rounded-lg text-indigo-700 hover:bg-indigo-100 font-medium flex items-center gap-2",onClick:i,children:[e.jsx(U,{iconName:"Contact",className:"text-xl"}),"Mis Consultas"]}),e.jsxs(te,{to:"/panel-medico",className:"py-2 px-3 rounded-lg text-blue-700 hover:bg-blue-100 font-medium flex items-center gap-2",onClick:i,children:[e.jsx(U,{iconName:"Calendar",className:"text-xl"}),"Disponibilidad"]}),e.jsxs(te,{to:"/historial-consultas",className:"py-2 px-3 rounded-lg text-blue-700 hover:bg-blue-100 font-medium flex items-center gap-2",onClick:i,children:[e.jsx(U,{iconName:"History",className:"text-xl"}),"Historial de consultas"]})]}):x?.rol==="enfermero"?e.jsx(e.Fragment,{children:e.jsx(te,{to:"/panel-enfermero",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:i,children:"Panel Enfermería"})}):x?.rol==="laboratorista"?e.jsxs(e.Fragment,{children:[e.jsx(te,{to:"/panel-laboratorio",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:i,children:"Panel Laboratorio"}),e.jsx(te,{to:"/examenes-laboratorio",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:i,children:"Gestión de Exámenes"})]}):x?.rol==="químico"||x?.rol==="quimico"?e.jsxs(e.Fragment,{children:[e.jsx(te,{to:"/medicamentos",className:"py-2 px-3 rounded-lg text-pink-700 hover:bg-pink-100 font-medium",onClick:i,children:"Medicamentos"}),e.jsx(te,{to:"/farmacia/cotizador",className:"py-2 px-3 rounded-lg text-blue-700 hover:bg-blue-100 font-medium",onClick:i,children:"Cotizador Farmacia"}),e.jsx(te,{to:"/farmacia/ventas",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:i,children:"Ventas de Farmacia"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(te,{to:"/",className:"group relative py-3 px-4 rounded-xl bg-gradient-to-r from-purple-600 via-purple-700 to-indigo-800 text-white font-semibold shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 flex items-center gap-3 overflow-hidden",onClick:i,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"relative z-10 flex items-center justify-center w-8 h-8 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(U,{iconName:"ViewDashboard",className:"text-xl text-white"})}),e.jsx("span",{className:"relative z-10 text-lg",children:"Dashboard"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"})]}),e.jsxs(te,{to:"/pacientes",className:"py-3 px-4 rounded-lg text-cyan-700 hover:bg-gradient-to-r hover:from-cyan-50 hover:to-blue-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-cyan-100 rounded-lg",children:e.jsx(U,{iconName:"People",className:"text-xl text-cyan-600"})}),e.jsx("span",{children:"Pacientes"})]}),x?.rol==="administrador"&&e.jsxs(e.Fragment,{children:[e.jsxs(te,{to:"/usuarios",className:"py-3 px-4 rounded-lg text-blue-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 rounded-lg",children:e.jsx(U,{iconName:"People",className:"text-xl text-blue-600"})}),e.jsx("span",{children:"Usuarios"})]}),e.jsxs(te,{to:"/medicos",className:"py-3 px-4 rounded-lg text-emerald-700 hover:bg-gradient-to-r hover:from-emerald-50 hover:to-green-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-emerald-100 rounded-lg",children:e.jsx(U,{iconName:"Health",className:"text-xl text-emerald-600"})}),e.jsx("span",{children:"Médicos"})]}),e.jsxs(te,{to:"/gestion-tarifas",className:"py-3 px-4 rounded-lg text-amber-700 hover:bg-gradient-to-r hover:from-amber-50 hover:to-yellow-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-amber-100 rounded-lg",children:e.jsx(U,{iconName:"Money",className:"text-xl text-amber-600"})}),e.jsx("span",{children:"💰 Gestión de Tarifas"})]}),e.jsxs(te,{to:"/gestion-honorarios",className:"py-3 px-4 rounded-lg text-green-700 hover:bg-gradient-to-r hover:from-green-50 hover:to-emerald-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-green-100 rounded-lg",children:e.jsx(U,{iconName:"Calculator",className:"text-xl text-green-600"})}),e.jsx("span",{children:"⚖️ Honorarios Médicos"})]})]}),(x?.rol==="administrador"||x?.rol==="recepcionista")&&e.jsxs(te,{to:"/pagos-honorarios",className:"py-3 px-4 rounded-lg text-blue-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-cyan-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 rounded-lg",children:e.jsx(U,{iconName:"PaymentCard",className:"text-xl text-blue-600"})}),e.jsx("span",{children:"💳 Pagos Honorarios"})]}),e.jsxs(te,{to:"/reportes",className:"py-3 px-4 rounded-lg text-violet-700 hover:bg-gradient-to-r hover:from-violet-50 hover:to-purple-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-violet-100 rounded-lg",children:e.jsx(U,{iconName:"BarChart4",className:"text-xl text-violet-600"})}),e.jsx("span",{children:"Reportes"})]}),e.jsxs(te,{to:"/configuracion",className:"py-3 px-4 rounded-lg text-gray-700 hover:bg-gradient-to-r hover:from-gray-50 hover:to-slate-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-gray-100 rounded-lg",children:e.jsx(U,{iconName:"Settings",className:"text-xl text-gray-600"})}),e.jsx("span",{children:"Configuración"})]}),x?.rol==="administrador"&&e.jsxs(te,{to:"/reabrir-caja",className:"py-3 px-4 rounded-lg text-gray-700 hover:bg-gradient-to-r hover:from-yellow-50 hover:to-orange-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:i,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-yellow-100 rounded-lg",children:e.jsx(U,{iconName:"Unlock",className:"text-xl text-yellow-600"})}),e.jsx("span",{children:"🔓 Reabrir Cajas"})]})]})}),e.jsx("div",{className:"mt-auto p-4",children:e.jsxs("button",{onClick:r,className:"group w-full bg-gradient-to-r from-red-600 via-red-700 to-rose-800 text-white font-bold rounded-xl py-3 px-4 shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 flex items-center justify-center gap-3 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-700 via-rose-600 to-pink-700 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"relative z-10 flex items-center justify-center w-6 h-6 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(U,{iconName:"SignOut",className:"text-lg text-white"})}),e.jsx("span",{className:"relative z-10",children:"Cerrar sesión"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"})]})})]})})]})}function js({usuario:s,onMenu:i}){return e.jsxs("header",{className:"flex items-center justify-between px-6 py-3 bg-purple-800 shadow text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"/2demayo.svg",alt:"Logo",className:"h-10 w-10 object-contain bg-white rounded-full p-1 shadow"}),e.jsx("span",{className:"text-xl font-bold drop-shadow",children:"Clínica 2 de Mayo"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-white/90",children:[s?.nombre," ",s?.apellido||""]}),e.jsx("button",{className:"md:hidden ml-2",onClick:i,"aria-label":"Abrir menú",children:e.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]})]})}function Ns({usuario:s,onLogout:i,children:r}){const[x,p]=t.useState(!1);return t.useEffect(()=>{const C=()=>{window.innerWidth>=768&&p(!1)};return window.addEventListener("resize",C),C(),()=>window.removeEventListener("resize",C)},[]),e.jsxs("div",{className:"min-h-screen flex flex-col bg-blue-50 overflow-x-hidden",children:[e.jsx(js,{usuario:s,onMenu:()=>p(!0)}),e.jsxs("div",{className:"flex flex-1 max-w-full",children:[e.jsx(fs,{open:x,onClose:()=>p(!1),onLogout:i,usuario:s}),e.jsx("main",{className:"flex-1 px-2 sm:px-4 md:px-8 min-w-0 max-w-full overflow-x-auto",children:r})]}),e.jsx(bs,{})]})}function Ie({onPacienteEncontrado:s,onNoEncontrado:i,onNuevaBusqueda:r}){const[x,p]=t.useState(""),[C,w]=t.useState("dni"),[h,N]=t.useState([]),[g,v]=t.useState(!1),[y,o]=t.useState(!1),E=async u=>{if(u.preventDefault(),!!x.trim()){v(!0),N([]);try{const n=await(await fetch(I+"api_pacientes_buscar.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tipo:C,valor:x})})).json();n.success&&Array.isArray(n.pacientes)&&n.pacientes.length>0?(N(n.pacientes),o(!1),n.pacientes.length===1&&s&&(o(!1),s(n.pacientes[0]))):(N([]),o(!0),i())}catch{N([]),i()}v(!1)}},S=u=>{p(u.target.value),o(!1),r&&r()},c=u=>{w(u.target.value),o(!1),r&&r()};return e.jsxs("div",{className:"mb-4",children:[e.jsxs("form",{onSubmit:E,className:"flex flex-col md:flex-row gap-2 mb-4",children:[e.jsxs("select",{value:C,onChange:c,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"dni",children:"DNI"}),e.jsx("option",{value:"nombre",children:"Nombre y Apellido"}),e.jsx("option",{value:"historia",children:"Historia Clínica"})]}),e.jsx("input",{type:"text",value:x,onChange:S,placeholder:`Buscar por ${C}`,className:"border rounded px-2 py-1 flex-1"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white rounded px-4 py-1 font-bold",disabled:g,children:"Buscar"})]}),g&&e.jsx("div",{className:"text-blue-600",children:"Buscando..."}),h.length>0&&e.jsxs("div",{className:"mt-2 bg-blue-50 rounded-lg p-2",children:[e.jsx("div",{className:"font-bold mb-2",children:"Selecciona un paciente:"}),e.jsx("ul",{className:"divide-y divide-blue-100",children:h.length===1?e.jsx("li",{className:"py-2 flex flex-col md:flex-row md:items-center gap-2",children:e.jsxs("span",{className:"w-full px-3 py-2 rounded bg-blue-100 font-semibold text-blue-900",children:[h[0].nombre," ",h[0].apellido," | DNI: ",h[0].dni," | HC: ",h[0].historia_clinica]})},h[0].id):h.map(u=>e.jsx("li",{className:"py-2 flex flex-col md:flex-row md:items-center gap-2",children:e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 rounded bg-blue-100 hover:bg-blue-200 font-semibold text-blue-900",onClick:()=>{o(!1),s(u)},children:[u.nombre," ",u.apellido," | DNI: ",u.dni," | HC: ",u.historia_clinica]})},u.id))})]}),y&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded border border-yellow-300 text-sm",disabled:!0,children:"Paciente no encontrado"})})]})}function vs({paciente:s}){return e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4",children:[e.jsx("div",{className:"font-bold text-blue-800 mb-2",children:"Paciente encontrado:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Nombre:"})," ",s.nombre]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Apellido:"})," ",s.apellido]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"DNI:"})," ",s.dni]}),s.fecha_nacimiento&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Fecha de nacimiento:"})," ",s.fecha_nacimiento]}),s.sexo&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Sexo:"})," ",s.sexo]}),s.direccion&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Dirección:"})," ",s.direccion]}),s.telefono&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Teléfono:"})," ",s.telefono]}),s.email&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",s.email]}),s.tipo_seguro&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Tipo de seguro:"})," ",s.tipo_seguro]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Historia Clínica:"})," ",s.historia_clinica]}),s.edad&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Edad:"})," ",s.edad," ",s.edad_unidad||""]}),s.procedencia&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Procedencia:"})," ",s.procedencia]})]})]})]})}function pe({paciente:s,servicio:i,onCobroCompleto:r,onCancelar:x,detalles:p,total:C}){const[w,h]=t.useState([]),[N,g]=t.useState("particular"),[v,y]=t.useState("efectivo"),[o,E]=t.useState(""),[S,c]=t.useState(!1);t.useEffect(()=>{p||u()},[p]);const u=async()=>{try{const m=await(await fetch(`${I}api_tarifas.php`,{credentials:"include"})).json();m.success&&h(m.tarifas||[])}catch(M){console.error("Error al cargar tarifas:",M)}},a=t.useMemo(()=>Array.isArray(p)&&p.length>0?p:[],[p]),n=()=>typeof C=="number"&&C>0?C:a.reduce((M,m)=>M+m.subtotal,0),d=async()=>{if(a.length===0){V.fire("Error","No hay servicios para cobrar","error");return}if(!s||!s.nombre||!s.dni){V.fire("Error","Faltan datos del paciente (nombre y DNI son requeridos)","error");return}c(!0);try{const M=JSON.parse(sessionStorage.getItem("usuario")||"{}"),m={paciente_id:s.id,usuario_id:M.id,total:n(),tipo_pago:v,observaciones:o,detalles:a,servicio_info:i,paciente_nombre:s.nombre,paciente_dni:s.dni,paciente_historia_clinica:s.historia_clinica||`MANUAL-${s.dni}`},j=await(await fetch(`${I}api_cobros.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(m)})).json();if(j.success){if(i?.key==="laboratorio"&&!i?.consulta_id){const P=a.map(H=>H.servicio_id),O=await(await fetch(`${I}api_ordenes_laboratorio.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({consulta_id:null,examenes:P,paciente_id:s?.id||null,cobro_id:j.cobro_id})})).json()}await l(j.cobro_id,m),r&&r(j.cobro_id,i)}else V.fire("Error",j.error||"Error al procesar el cobro","error")}catch(M){console.error("Error:",M),V.fire("Error","Error de conexión con el servidor","error")}finally{c(!1)}},l=async(M,m)=>{const b=new Date().toLocaleString("es-PE"),j=s.apellido?`${s.nombre} ${s.apellido}`:s.nombre,P=`
      <div style="text-align: left; font-family: monospace;">
        <h3 style="text-align: center; margin-bottom: 20px;">🏥 CLÍNICA 2 DE MAYO</h3>
        <hr>
        <p><strong>COMPROBANTE DE PAGO #${M}</strong></p>
        <p>Fecha: ${b}</p>
        <p>Paciente: ${j}</p>
        <p>DNI: ${s.dni}</p>
        <p>H.C.: ${s.historia_clinica}</p>
        <hr>
        <p><strong>DETALLE:</strong></p>
        ${m.detalles.map(D=>`<p>${D.descripcion} x${D.cantidad} .... S/ ${D.subtotal.toFixed(2)}</p>`).join("")}
        <hr>
        <p><strong>TOTAL: S/ ${m.total.toFixed(2)}</strong></p>
  <p>Tipo de pago: ${v==="yape"?"Yape":v.toUpperCase()}</p>
        <p>Cobertura: ${N.toUpperCase()}</p>
        <hr>
        <p style="text-align: center; font-size: 12px;">
          Gracias por su preferencia<br>
          Conserve este comprobante
        </p>
      </div>
    `;await V.fire({title:"Cobro Procesado ✅",html:P,icon:"success",confirmButtonText:"Imprimir Comprobante",showCancelButton:!0,cancelButtonText:"Solo Continuar"}).then(D=>{if(D.isConfirmed){const O=window.open("","_blank");O.document.write(P),O.document.close(),O.print()}})};if(!i)return e.jsx("div",{children:"Seleccione un servicio primero"});const k=n();return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-blue-200",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-blue-800",children:"💰 Módulo de Cobros"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Paciente:"}),e.jsx("p",{children:s.nombre}),e.jsxs("p",{children:["DNI: ",s.dni," | H.C.: ",s.historia_clinica]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Tipo de Cobertura:"}),e.jsxs("select",{value:N,onChange:M=>g(M.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"particular",children:"Particular"}),e.jsx("option",{value:"seguro",children:"Seguro"}),e.jsx("option",{value:"convenio",children:"Convenio"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Detalle del Servicio:"}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded",children:[a.map((M,m)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:M.descripcion}),e.jsxs("span",{className:"font-bold",children:["S/ ",M.subtotal.toFixed(2)]})]},m)),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between items-center font-bold text-lg",children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{className:"text-green-600",children:["S/ ",k.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Método de Pago:"}),e.jsxs("select",{value:v,onChange:M=>y(M.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"}),e.jsx("option",{value:"transferencia",children:"Transferencia"}),e.jsx("option",{value:"yape",children:"Yape"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Observaciones:"}),e.jsx("textarea",{value:o,onChange:M=>E(M.target.value),className:"w-full border rounded px-3 py-2 h-20",placeholder:"Observaciones adicionales (opcional)"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:d,disabled:S||k<=0,className:"flex-1 bg-green-600 text-white py-3 px-6 rounded font-bold text-lg hover:bg-green-700 disabled:bg-gray-400",children:S?"Procesando...":`💳 Cobrar S/ ${k.toFixed(2)}`}),e.jsx("button",{onClick:x,className:"bg-gray-500 text-white py-3 px-6 rounded font-bold hover:bg-gray-600",children:"Cancelar"})]})]})}const ys=[{key:"consulta",label:"Consulta Médica",icon:"👨‍⚕️",requiresPayment:!1},{key:"laboratorio",label:"Laboratorio",icon:"🔬",requiresPayment:!0},{key:"farmacia",label:"Farmacia",icon:"💊",requiresPayment:!0},{key:"rayosx",label:"Rayos X",icon:"🩻",requiresPayment:!0},{key:"ecografia",label:"Ecografía",icon:"🩺",requiresPayment:!0},{key:"ocupacional",label:"Medicina Ocupacional",icon:"👷‍⚕️",requiresPayment:!0}],ws=["consulta","laboratorio","farmacia","ecografia","rayosx","ocupacional"];function Cs({paciente:s}){const i=ie(),[r,x]=t.useState(null),[p,C]=t.useState(!1),[w,h]=t.useState([]);t.useEffect(()=>{fetch(I+"api_tarifas.php",{credentials:"include"}).then(o=>o.json()).then(o=>{if(o.success&&Array.isArray(o.tarifas)){const E=o.tarifas.filter(S=>S.activo===1&&!ws.includes(S.servicio_tipo)).map(S=>({key:S.servicio_tipo+"_"+S.id,label:S.descripcion,icon:"🛠️",requiresPayment:!0,tarifaId:S.id}));h(E)}})},[]);const N=o=>{o.key==="consulta"?i("/agendar-consulta",{state:{pacienteId:s.id}}):o.key==="laboratorio"?i(`/cotizar-laboratorio/${s.id}`):o.key==="farmacia"?i(`/cotizar-farmacia/${s.id}`):o.key==="rayosx"?i(`/cotizar-rayosx/${s.id}`):o.key==="ecografia"?i(`/cotizar-ecografia/${s.id}`):o.key==="ocupacional"?V.fire({title:"Página en construcción",text:"La funcionalidad de Medicina Ocupacional estará disponible próximamente.",icon:"info",confirmButtonText:"OK"}):o.key==="procedimiento"?i(`/cotizar-procedimientos/${s.id}`):o.requiresPayment?(x(o),C(!0)):y(o)},g=async(o,E)=>{C(!1),V.fire({title:"💰 Pago Procesado",text:`Servicio de ${E.label} pagado exitosamente.`,icon:"success",confirmButtonText:"OK"})},v=()=>{C(!1),x(null)},y=async o=>{const E=JSON.parse(sessionStorage.getItem("usuario")||"{}");if(!E.id){V.fire("Error","No se pudo identificar al usuario","error");return}try{const c=await(await fetch(I+"api_atenciones.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paciente_id:s.id,usuario_id:E.id,servicio:o.key,observaciones:""})})).json();c.success?V.fire({title:"Atención registrada",text:`Atención registrada para ${o.label}.`,icon:"success",confirmButtonText:"OK"}):V.fire({title:"Error",text:c.error||"No se pudo registrar la atención",icon:"error",confirmButtonText:"OK"})}catch(S){console.error("Error:",S),V.fire("Error","Error de conexión","error")}};return p&&r&&r.key!=="laboratorio"?e.jsx(pe,{paciente:s,servicio:r,onCobroCompleto:g,onCancelar:v}):e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 text-blue-800",children:["🏥 Seleccionar Servicio para: ",s.nombre," ",s.apellido]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[ys.map(o=>o.key==="ocupacional"?e.jsxs("button",{onClick:()=>{V.fire({title:"Página en construcción",text:"La funcionalidad de Medicina Ocupacional estará disponible próximamente.",icon:"info",confirmButtonText:"OK"})},className:"flex items-center justify-center gap-2 p-4 bg-white border border-blue-300 rounded-lg hover:bg-blue-100 hover:border-blue-400 transition-colors font-medium text-blue-700 hover:text-blue-800",children:[e.jsx("span",{className:"text-2xl",children:o.icon}),e.jsx("span",{children:o.label}),o.requiresPayment&&e.jsx("span",{className:"text-green-600 text-sm",children:"💰"})]},o.key):e.jsxs("button",{onClick:()=>N(o),className:"flex items-center justify-center gap-2 p-4 bg-white border border-blue-300 rounded-lg hover:bg-blue-100 hover:border-blue-400 transition-colors font-medium text-blue-700 hover:text-blue-800",children:[e.jsx("span",{className:"text-2xl",children:o.icon}),e.jsx("span",{children:o.label}),o.requiresPayment&&e.jsx("span",{className:"text-green-600 text-sm",children:"💰"})]},o.key)),e.jsxs("button",{onClick:()=>N({key:"procedimiento",label:"Procedimientos",icon:"🛠️",requiresPayment:!0}),className:"flex items-center justify-center gap-2 p-4 bg-white border border-orange-300 rounded-lg hover:bg-orange-100 hover:border-orange-400 transition-colors font-medium text-orange-700 hover:text-orange-800",children:[e.jsx("span",{className:"text-2xl",children:"🛠️"}),e.jsx("span",{children:"Procedimientos"}),e.jsx("span",{className:"text-green-600 text-sm",children:"💰"})]},"procedimientos")]}),e.jsx("div",{className:"mt-3 text-sm text-gray-600 text-center",children:"💰 = Requiere pago previo | 🏥 = Agendar primero, cobrar después"})]})}function ks({onPacienteRegistrado:s}){const[i,r]=t.useState(null),[x,p]=t.useState(!1),C=()=>{r(null),p(!1)},w=h=>{r(h),s&&s()};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ie,{onPacienteEncontrado:r,onNoEncontrado:()=>p(!0),onNuevaBusqueda:C}),i&&e.jsxs(e.Fragment,{children:[e.jsx(vs,{paciente:i}),e.jsx(Cs,{paciente:i})]}),x&&!i&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"mb-2 text-blue-700",children:"Paciente no encontrado. ¿Desea registrarlo?"}),e.jsx(hs,{initialData:{},onRegistroExitoso:w})]})]})}function _s({usuario:s}){const[i,r]=t.useState(null),[x,p]=t.useState({pacientesHoy:0,consultasHoy:0,totalPacientes:0}),C=Ce(),w=t.useCallback(async()=>{try{const v=await(await fetch(I+"api_estadisticas_dashboard.php")).json();v.success?p({pacientesHoy:v.estadisticas.pacientes_hoy,consultasHoy:v.estadisticas.consultas_hoy,totalPacientes:v.estadisticas.total_pacientes}):(console.error("Error al obtener estadísticas:",v.error),p({pacientesHoy:0,consultasHoy:0,totalPacientes:0}))}catch(g){console.error("Error de conexión al obtener estadísticas:",g),p({pacientesHoy:0,consultasHoy:0,totalPacientes:0})}},[]),h=t.useCallback(()=>{fetch(I+"api_ultima_hc.php").then(g=>g.json()).then(g=>{g.success&&r(g.ultima_hc)}),w()},[w]);t.useEffect(()=>{h(),w()},[s,C.pathname,h,w]);const N=()=>new Intl.DateTimeFormat("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(new Date);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 rounded-2xl p-6 sm:p-8 text-white shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white/10 rounded-full -translate-y-20 translate-x-20"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-white/5 rounded-full translate-y-16 -translate-x-16"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-white/20 rounded-2xl backdrop-blur-sm",children:e.jsx(U,{iconName:"Hospital",className:"text-3xl text-white"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold drop-shadow-lg",children:["¡Bienvenido, ",s?.nombre," ",s?.apellido||"","!"]}),e.jsx("p",{className:"text-lg text-white/90 mt-1",children:N()})]})]}),e.jsx("p",{className:"text-xl text-white/95 font-medium",children:"Panel de Control - Clínica 2 de Mayo"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"group bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border border-cyan-100 hover:border-cyan-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-xl",children:e.jsx(U,{iconName:"People",className:"text-2xl text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:x.pacientesHoy}),e.jsx("p",{className:"text-sm text-gray-500",children:"Hoy"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Pacientes Atendidos"}),e.jsx("p",{className:"text-sm text-gray-600",children:"En el día de hoy"})]}),e.jsxs("div",{className:"group bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border border-emerald-100 hover:border-emerald-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-emerald-400 to-green-500 rounded-xl",children:e.jsx(U,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:x.consultasHoy}),e.jsx("p",{className:"text-sm text-gray-500",children:"Hoy"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Consultas Médicas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"En el día de hoy"})]}),e.jsxs("div",{className:"group bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border border-purple-100 hover:border-purple-200 sm:col-span-2 lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-xl",children:e.jsx(U,{iconName:"Contact",className:"text-2xl text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:x.totalPacientes}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Pacientes Registrados"}),e.jsx("p",{className:"text-sm text-gray-600",children:"En la base de datos"})]})]}),i&&e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-amber-100",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl",children:e.jsx(U,{iconName:"DocumentSearch",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Última Historia Clínica"}),e.jsx("p",{className:"text-gray-600",children:"Registro más reciente en el sistema"})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-amber-100 rounded-lg",children:e.jsx(U,{iconName:"NumberField",className:"text-lg text-amber-700"})}),e.jsx("span",{className:"text-lg font-mono font-bold text-amber-800",children:i}),e.jsxs("span",{className:"text-sm text-amber-600 bg-amber-100 px-2 py-1 rounded-full",children:["HC #",i]})]})})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(U,{iconName:"ContactCard",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Atención en Recepción"}),e.jsx("p",{className:"text-indigo-100",children:"Gestión de pacientes y servicios"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx(ks,{onPacienteRegistrado:h})})]})]})}function Ss(){return e.jsx("div",{children:e.jsx(us,{})})}function Es(){return e.jsxs("div",{className:"container py-4",children:[e.jsx("h2",{className:"mb-4 text-2xl font-bold text-purple-800",children:"Gestión de Usuarios"}),e.jsx(ps,{})]})}function Ms(){const[s,i]=t.useState([]),[r,x]=t.useState([]),[p,C]=t.useState([]),[w,h]=t.useState(!1),[N,g]=t.useState(""),[v,y]=t.useState(1),[o,E]=t.useState(new Date),S=["#22c55e","#3b82f6","#f59e42","#e11d48","#a21caf","#facc15","#0ea5e9","#14b8a6","#6366f1","#f472b6"],c=Array.isArray(s)?s:[],u=c.reduce((m,b,j)=>(m[b.id]=S[j%S.length],m),{});t.useEffect(()=>{h(!0),Promise.all([fetch(I+"api_medicos.php").then(m=>m.json()),fetch(I+"api_disponibilidad_medicos.php").then(m=>m.json()),fetch(I+"api_consultas.php").then(m=>m.json())]).then(([m,b,j])=>{i(m.medicos||[]),x(b.disponibilidad||[]),C(j.consultas||[]),h(!1)})},[]);const a={};r.forEach(m=>{m.fecha&&(a[m.fecha]||(a[m.fecha]=[]),a[m.fecha].push(m))});function n(m){const b=m.toISOString().slice(0,10),j=r.filter(O=>O.fecha===b);if(j.length>0)return j;const D=["domingo","lunes","martes","miércoles","jueves","viernes","sábado"][m.getDay()];return r.filter(O=>O.dia_semana===D&&!O.fecha)}const d=n(o);c.filter(m=>d.some(b=>b.medico_id==m.id));const l=N.trim().toLowerCase();let k=[];l?k=r.filter(m=>{const b=c.find(j=>j.id==m.medico_id);return b?b.nombre&&b.nombre.toLowerCase().includes(l)||b.especialidad&&b.especialidad.toLowerCase().includes(l):!1}):k=d;const M=k;return e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-2 text-center",children:"Disponibilidad de Médicos"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4 items-start",children:[e.jsx(Te,{onChange:E,value:o,className:"border rounded shadow !text-base w-full max-w-xs md:!text-base md:w-[350px] md:h-[350px] !h-[320px] md:!h-[350px]",tileContent:({date:m,view:b})=>{if(b!=="month")return null;const j=n(m);if(!j.length)return null;const P=[...new Set(j.map(D=>D.medico_id))];return e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:2},children:P.map((D,O)=>e.jsx("span",{style:{display:"inline-block",width:8,height:8,borderRadius:"50%",background:u[D]||"#888",marginLeft:O>0?2:0}},D))})}}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("input",{type:"text",placeholder:"Buscar por nombre o especialidad...",value:N,onChange:m=>{g(m.target.value),y(1)},className:"border rounded px-3 py-1"})}),w?e.jsx("div",{children:"Cargando..."}):e.jsx("div",{className:"overflow-x-auto",style:{maxHeight:260,minHeight:80},children:e.jsxs("table",{className:"min-w-full text-[11px] md:text-sm border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Médico"}),e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Especialidad"}),e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Horario"}),e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Cupos libres"})]})}),e.jsx("tbody",{children:M.map((m,b)=>{const j=c.find(A=>A.id==m.medico_id);if(!j)return null;let P=m.fecha;!P&&m.dia_semana&&(P=m.dia_semana);const D=m.hora_inicio.split(":").map(Number),O=m.hora_fin.split(":").map(Number);let H=0,$=D[0],B=D[1];for(;$<O[0]||$===O[0]&&B<O[1];)H++,B+=30,B>=60&&($++,B=0);const W=p.filter(A=>A.medico_id==j.id&&(m.fecha?A.fecha===m.fecha:!0)&&A.hora>=m.hora_inicio&&A.hora<m.hora_fin&&A.estado==="pendiente"),f=H-W.length;return e.jsxs("tr",{className:f>0?"bg-green-50":"bg-yellow-100",children:[e.jsxs("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1 font-bold",style:{color:u[j.id]||void 0},children:["Dr(a). ",j.nombre," ",j.apellido||""]}),e.jsx("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1",children:j.especialidad}),e.jsxs("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1",children:[m.hora_inicio," - ",m.hora_fin," ",P?e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",P,")"]}):null]}),e.jsx("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1 font-bold",children:f>0?f:"Sin cupos"})]},m.medico_id+"-"+b)})})]})})]})]})]})}function Ps({pacienteId:s}){const[i,r]=t.useState([]),[x,p]=t.useState(0),[C,w]=t.useState([]),[h,N]=t.useState(""),[g,v]=t.useState([]),[y,o]=t.useState(""),[E,S]=t.useState(""),[c,u]=t.useState(""),[a,n]=t.useState(null),[d,l]=t.useState(!1),[k,M]=t.useState(null),[m,b]=t.useState(!1),j=Ve(V);t.useEffect(()=>{d&&a?fetch(I+"api_tarifas.php",{credentials:"include"}).then(H=>H.json()).then(H=>{if(H.success&&Array.isArray(H.tarifas)){let $=H.tarifas.find(B=>B.servicio_tipo==="consulta"&&B.activo===1&&Number(B.medico_id)===Number(a.medico_id));if($||($=H.tarifas.find(B=>B.servicio_tipo==="consulta"&&B.activo===1&&(!B.medico_id||B.medico_id===null))),$){const B={servicio_tipo:"consulta",servicio_id:a.id,descripcion:$.descripcion||`Consulta - ${a.medico_nombre}`,cantidad:1,precio_unitario:parseFloat($.precio_particular)||0,subtotal:parseFloat($.precio_particular)||0};r([B]),p(B.subtotal)}else r([]),p(0)}}):(r([]),p(0))},[d,a]),t.useEffect(()=>{fetch(I+"api_medicos.php").then(H=>H.json()).then(H=>w(H.medicos||[]))},[]),t.useEffect(()=>{h&&y?(b(!0),fetch(`${I}api_horarios_disponibles.php?medico_id=${h}&fecha=${y}`).then(H=>H.json()).then(H=>{H.success?v(H.horarios_disponibles||[]):(v([]),console.error("Error:",H.error))}).catch(H=>{console.error("Error:",H),v([])}).finally(()=>b(!1))):v([])},[h,y]),t.useEffect(()=>{s&&fetch(`${I}api_pacientes.php?id=${s}`).then(H=>H.json()).then(H=>{H.success&&H.paciente&&M(H.paciente)}).catch(console.error)},[s]);const P=async H=>{if(H.preventDefault(),u(""),!s||!h||!y||!E){u("Completa todos los campos");return}try{const B=await(await fetch(I+"api_consultas.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paciente_id:s,medico_id:h,fecha:y,hora:E,estado:"programada"})})).json();if(B.success){const W=C.find(A=>String(A.id)===String(h)),f=`${W?.nombre} ${W?.apellido||""}`.trim();n({id:B.consulta_id||B.id,medico_id:h,medico_nombre:f,medico_especialidad:W?.especialidad,fecha:y,hora:E,paciente_id:s}),l(!0),u("")}else u(B.error||"Error al agendar")}catch($){console.error("Error:",$),u("Error de conexión")}},D=async(H,$)=>{l(!1),j.fire({icon:"success",title:"¡Consulta Agendada y Pagada!",html:`
        <div class="text-left">
          <p><strong>Consulta:</strong> ${a.medico_nombre}</p>
          <p><strong>Especialidad:</strong> ${a.medico_especialidad}</p>
          <p><strong>Fecha:</strong> ${a.fecha}</p>
          <p><strong>Hora:</strong> ${a.hora}</p>
          <p><strong>Cobro ID:</strong> ${H}</p>
        </div>
      `,confirmButtonColor:"#22c55e",confirmButtonText:"Aceptar"}),o(""),S(""),N(""),n(null)},O=()=>{l(!1),j.fire({title:"Cobro Cancelado",text:"La consulta fue agendada pero no se realizó el cobro. Puede cobrarse posteriormente.",icon:"info",confirmButtonText:"Entendido"})};return d&&a&&k?e.jsxs("div",{className:"max-w-2xl mx-auto p-2 md:p-8 w-full",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-4 border border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"✅ Consulta Agendada Exitosamente"}),e.jsxs("div",{className:"text-sm text-blue-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Médico:"})," ",a.medico_nombre," (",a.medico_especialidad,")"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",a.fecha," - ",e.jsx("strong",{children:"Hora:"})," ",a.hora]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Paciente:"})," ",k.nombre," ",k.apellido]})]})]}),e.jsx(pe,{paciente:k,servicio:{key:"consulta",label:`Consulta - ${a.medico_nombre}`,medico_id:a.medico_id,consulta_id:a.id},detalles:i,total:x,onCobroCompleto:D,onCancelar:O})]}):e.jsxs("div",{className:"max-w-2xl mx-auto p-2 md:p-8 w-full overflow-x-auto",children:[e.jsx(Ms,{}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-4 text-center",children:"Agendar Consulta Médica"}),e.jsxs("form",{onSubmit:P,className:"flex flex-col gap-2 md:gap-4 mb-4 bg-white rounded-lg shadow border border-blue-200 p-2 md:p-8 w-full max-w-full text-xs md:text-base",children:[e.jsx("label",{className:"font-semibold mb-1",htmlFor:"medico-select",children:"Médico"}),e.jsxs("select",{id:"medico-select",value:h,onChange:H=>{N(H.target.value),S("")},className:"border rounded px-3 py-2 md:px-4 md:py-3 text-base md:text-lg",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un médico"}),C.map(H=>e.jsxs("option",{value:H.id,children:["Dr(a). ",H.nombre," ",H.apellido||""," - ",H.especialidad]},H.id))]}),e.jsx("label",{className:"font-semibold mb-1",htmlFor:"fecha-consulta",children:"Fecha de la consulta"}),e.jsx("input",{id:"fecha-consulta",type:"date",value:y,onChange:H=>{o(H.target.value),S("")},className:"border rounded px-3 py-2 md:px-4 md:py-3 text-base md:text-lg",required:!0}),e.jsx("label",{className:"font-semibold mb-1",htmlFor:"hora-select",children:"Horario disponible"}),e.jsxs("select",{id:"hora-select",value:E,onChange:H=>S(H.target.value),className:"border rounded px-3 py-2 md:px-4 md:py-3 text-base md:text-lg",required:!0,disabled:!h||!y||m,children:[e.jsx("option",{value:"",children:m?"Cargando horarios...":!h||!y?"Selecciona médico y fecha primero":g.length===0?"No hay horarios disponibles":"Selecciona un horario"}),g.map(H=>e.jsxs("option",{value:H.hora,children:[H.hora," - ",H.medico_nombre]},`${H.medico_id}-${H.hora}`))]}),e.jsx("button",{type:"submit",className:"bg-green-600 text-white rounded px-4 py-2 md:px-6 md:py-3 font-bold text-base md:text-lg",children:"Agendar Consulta"})]}),c&&e.jsx("div",{className:"mt-2 text-base md:text-lg text-center text-green-700",children:c})]})}function Ls(){const s=Ce(),i=ie(),r=s.state?.pacienteId;return r?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-800",children:"Agendar Consulta Médica"}),e.jsx("button",{onClick:()=>i("/seleccionar-servicio",{state:{pacienteId:r}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"})]}),e.jsx(Ps,{pacienteId:r})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow text-center",children:[e.jsx("p",{className:"text-lg font-bold text-red-600 mb-2",children:"No se ha seleccionado un paciente."}),e.jsx("button",{onClick:()=>i(-1),className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Volver"})]})})}function Fs({medicoId:s,onIniciarConsulta:i,onVerDetalle:r}){const x=ie(),[p,C]=t.useState([]),[w,h]=t.useState(1),[N,g]=t.useState(5),[v,y]=t.useState(!1),[o,E]=t.useState(""),[S,c]=t.useState(""),[u,a]=t.useState(""),[n,d]=t.useState("");t.useEffect(()=>{s&&(y(!0),fetch(`${I}api_consultas.php?medico_id=${s}`,{credentials:"include"}).then(f=>f.json()).then(f=>{C(f.consultas||[]),y(!1)}).catch(f=>{console.error("Error cargando consultas:",f),y(!1)}))},[s]);const l=async(f,A)=>{E(""),y(!0);try{await fetch(I+"api_consultas.php",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:f,estado:A})});const Y=await(await fetch(`${I}api_consultas.php?medico_id=${s}`,{credentials:"include"})).json();C(Y.consultas||[]),E(`Consulta ${A} correctamente`)}catch(G){console.error("Error actualizando estado:",G),E("Error al actualizar el estado")}finally{y(!1)}},k=p.filter(f=>{const A=S.trim().toLowerCase();return A&&!(f.paciente_nombre&&f.paciente_nombre.toLowerCase().includes(A)||f.paciente_apellido&&f.paciente_apellido.toLowerCase().includes(A)||f.historia_clinica&&f.historia_clinica.toLowerCase().includes(A)||f.dni&&f.dni.toLowerCase().includes(A))?!1:!u&&!n?!0:!(!f.fecha||u&&f.fecha<u||n&&f.fecha>n)}),M=k.length,m=Math.max(1,Math.ceil(M/N)),b=k.slice((w-1)*N,w*N),j=f=>{g(Number(f.target.value)),h(1)},P=()=>h(f=>Math.max(1,f-1)),D=()=>h(f=>Math.min(m,f+1)),O=f=>{if(!f)return"N/A";try{return new Date(f).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return f}},H=f=>{switch(f?.toLowerCase()){case"pendiente":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"completada":case"completado":return"bg-green-100 text-green-800 border-green-200";case"cancelada":case"cancelado":return"bg-red-100 text-red-800 border-red-200";case"en_proceso":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},$=f=>{switch(f?.toLowerCase()){case"pendiente":return"⏳ ";case"completada":case"completado":return"✅ ";case"cancelada":case"cancelado":return"❌ ";case"en_proceso":return"🔄 ";default:return"📋 "}},B=f=>{switch(f?.toLowerCase()){case"emergencia":return"bg-red-100 text-red-800 border-red-200 animate-pulse";case"urgente":case"urgencia":return"bg-orange-100 text-orange-800 border-orange-200";case"no urgente":case"normal":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},W=f=>{switch(f?.toLowerCase()){case"emergencia":return"🚨 ";case"urgente":case"urgencia":return"⚠️ ";case"no urgente":case"normal":return"🟢 ";default:return"⚪ "}};return e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:max-w-7xl lg:mx-auto",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-3 sm:p-6 mb-4 sm:mb-8 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 sm:w-5 sm:h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-800",children:"🔍 Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"col-span-full lg:col-span-2",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"Búsqueda general"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-2 sm:pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("input",{type:"text",value:S,onChange:f=>{c(f.target.value),h(1)},placeholder:"Buscar por nombre, HC o DNI...",className:"pl-8 sm:pl-10 w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white/80"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"📅 Desde"}),e.jsx("input",{type:"date",value:u,onChange:f=>{a(f.target.value),h(1)},className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white/80"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"📅 Hasta"}),e.jsx("input",{type:"date",value:n,onChange:f=>{d(f.target.value),h(1)},className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white/80"})]})]}),(S||u||n)&&e.jsx("div",{className:"mt-3 sm:mt-4 flex justify-center sm:justify-end",children:e.jsxs("button",{onClick:()=>{c(""),a(""),d(""),h(1)},className:"inline-flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Limpiar Filtros"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-6 mb-4 sm:mb-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-xs sm:text-sm font-medium",children:"Total Consultas"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:k.length})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-xs sm:text-sm font-medium",children:"Pendientes"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:k.filter(f=>f.estado==="pendiente").length})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-100 text-xs sm:text-sm font-medium",children:"Emergencias"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:k.filter(f=>f.clasificacion==="Emergencia").length})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})})]})})]}),v?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-8 sm:p-12 border border-white/50 flex justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600 font-medium text-sm sm:text-base",children:"🏥 Cargando consultas médicas..."})]})}):b.length===0?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-8 sm:p-12 border border-white/50 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-r from-gray-300 to-gray-400 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 sm:w-10 sm:h-10 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-700 mb-2",children:"📅 No hay consultas"}),e.jsx("p",{className:"text-gray-500 text-sm sm:text-base",children:"No se encontraron consultas con los filtros aplicados"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/50 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-600 to-indigo-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"👤 Paciente"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"🏥 HC / DNI"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"📅 Fecha"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"⏰ Hora"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"📊 Estado"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"🚨 Clasificación"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"🩺 Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:b.map((f,A)=>{const G=A%2===0;return e.jsxs("tr",{className:`${G?"bg-white/60":"bg-blue-50/40"} hover:bg-blue-100/60 transition-all duration-200 hover:shadow-lg transform hover:-translate-y-0.5`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:((f.paciente_nombre||"")+(f.paciente_apellido||"")).charAt(0)||"P"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:f.paciente_nombre?`${f.paciente_nombre} ${f.paciente_apellido||""}`.trim():`Paciente #${f.paciente_id}`}),e.jsx("div",{className:"text-sm text-gray-500",children:"Consulta médica"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:["HC: ",f.historia_clinica||"N/A"]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:["DNI: ",f.dni||"N/A"]})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"font-medium text-gray-900",children:O(f.fecha)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium text-gray-900",children:f.hora||"N/A"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${H(f.estado)}`,children:[$(f.estado),f.estado||"Sin estado"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${B(f.clasificacion)}`,children:[W(f.clasificacion),f.clasificacion||"Sin clasificar"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[f.estado==="pendiente"&&!f.clasificacion&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l(f.id,"completada"),className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",title:"Completar consulta",children:e.jsx("span",{className:"text-sm",children:"✔️"})}),e.jsx("button",{onClick:()=>l(f.id,"cancelada"),className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",title:"Cancelar consulta",children:e.jsx("span",{className:"text-sm",children:"✖️"})})]}),e.jsx("button",{onClick:()=>x(`/historia-clinica/${f.paciente_id}/${f.id}`),className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",title:"Ver Historia Clínica",children:e.jsx("span",{className:"text-sm",children:"📖"})}),i&&e.jsxs("button",{onClick:()=>i(f),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Iniciar"]}),r&&e.jsxs("button",{onClick:()=>r(f),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Ver"]})]})})]},f.id)})})]})})}),e.jsx("div",{className:"lg:hidden space-y-3 sm:space-y-4",children:b.map(f=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/50 p-4 hover:shadow-xl transition-all duration-200 hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-semibold text-lg",children:((f.paciente_nombre||"")+(f.paciente_apellido||"")).charAt(0)||"P"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:f.paciente_nombre?`${f.paciente_nombre} ${f.paciente_apellido||""}`.trim():`Paciente #${f.paciente_id}`}),e.jsx("p",{className:"text-sm text-gray-500",children:"Consulta médica"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"📅 Fecha"}),e.jsx("p",{className:"text-gray-900",children:O(f.fecha)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"⏰ Hora"}),e.jsx("p",{className:"text-gray-900",children:f.hora||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"🏥 HC"}),e.jsx("p",{className:"text-gray-900",children:f.historia_clinica||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"👤 DNI"}),e.jsx("p",{className:"text-gray-900",children:f.dni||"N/A"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${H(f.estado)}`,children:[$(f.estado),f.estado||"Sin estado"]}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${B(f.clasificacion)}`,children:[W(f.clasificacion),f.clasificacion||"Sin clasificar"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[f.estado==="pendiente"&&!f.clasificacion&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>l(f.id,"completada"),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("span",{children:"✔️"}),e.jsx("span",{className:"hidden sm:inline",children:"Completar"})]}),e.jsxs("button",{onClick:()=>l(f.id,"cancelada"),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("span",{children:"✖️"}),e.jsx("span",{className:"hidden sm:inline",children:"Cancelar"})]})]}),e.jsxs("button",{onClick:()=>x(`/historia-clinica/${f.paciente_id}/${f.id}`),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("span",{children:"📖"}),e.jsx("span",{className:"hidden sm:inline",children:"Historia"})]}),i&&e.jsxs("button",{onClick:()=>i(f),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Iniciar"})]}),r&&e.jsxs("button",{onClick:()=>r(f),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),e.jsx("span",{className:"hidden sm:inline",children:"Ver"})]})]})]},f.id))})]}),o&&e.jsx("div",{className:"mt-3 sm:mt-4 p-3 sm:p-4 bg-blue-100 border border-blue-300 rounded-lg sm:rounded-xl text-blue-800 text-center text-sm sm:text-base",children:o}),k.length>0&&e.jsx("div",{className:"mt-4 sm:mt-8 bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-4 sm:p-6 border border-white/50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:P,disabled:w===1,className:"inline-flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),e.jsx("div",{className:"flex items-center gap-1 sm:gap-2",children:e.jsxs("span",{className:"text-gray-600 font-medium text-sm sm:text-base",children:[w,"/",m]})}),e.jsxs("button",{onClick:D,disabled:w===m,className:"inline-flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 sm:gap-3",children:[e.jsxs("label",{className:"text-xs sm:text-sm font-medium text-gray-700",children:["📄 ",e.jsx("span",{className:"hidden sm:inline",children:"Filas por página:"}),e.jsx("span",{className:"sm:hidden",children:"Por página:"})]}),e.jsxs("select",{value:N,onChange:j,className:"px-2 sm:px-3 py-1.5 sm:py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/80",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 text-center sm:text-left",children:[e.jsxs("span",{className:"block sm:inline",children:[b.length," de ",M]}),e.jsx("span",{className:"hidden sm:inline",children:" consultas"})]})]})]})})]})}function Ts({usuario:s}){const i=s?.id;return i?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 shadow-2xl",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 bg-white/10 rounded-full px-6 py-3 backdrop-blur-sm border border-white/20 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 9l6-6m-6 0l6 6"})})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Panel Médico"}),e.jsxs("p",{className:"text-blue-100 text-sm",children:["Dr(a). ",s?.nombre," ",s?.apellido||""]})]})]}),e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"📋 Mis Consultas Programadas"}),e.jsx("p",{className:"text-blue-100 max-w-2xl mx-auto",children:"Gestiona tus citas médicas, revisa el historial de pacientes y mantén un seguimiento completo de tus consultas"})]})})}),e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx(Fs,{medicoId:i})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-red-100 flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md mx-4 border border-red-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-red-800 mb-2",children:"Error de Acceso"}),e.jsx("p",{className:"text-red-600 font-medium",children:"No se encontró el médico logueado."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Por favor, inicia sesión nuevamente."})]})})})}const Ds=()=>{const[s,i]=t.useState([]),[r,x]=t.useState(!0),[p,C]=t.useState(null),[w,h]=t.useState(!1),[N,g]=t.useState({nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),[v,y]=t.useState(""),[o,E]=t.useState(!1),[S,c]=t.useState(!1),[u,a]=t.useState({id:null,nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),[n,d]=t.useState(""),[l,k]=t.useState(!1),[M,m]=t.useState(""),[b,j]=t.useState("id"),[P,D]=t.useState("asc"),[O,H]=t.useState(5),[$,B]=t.useState(1);t.useEffect(()=>{W()},[]);const W=async()=>{x(!0);try{const Q=await fe.get(I+"api_medicos.php");i(Q.data.medicos||[]),C(null)}catch(Q){C("Error al cargar médicos"),console.error("Error fetching medicos:",Q)}finally{x(!1)}},f=async Q=>{E(!0),y("");try{const se=await fe.post(I+"api_medicos.php",Q);se.data.success?(await W(),L(),V.fire({title:"¡Éxito!",text:"Médico registrado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})):y(se.data.message||"Error al registrar médico")}catch(se){y("Error de conexión al registrar médico"),console.error("Error creating medico:",se)}finally{E(!1)}},A=async Q=>{k(!0),d("");try{const se=await fe.put(I+"api_medicos.php",Q);se.data.success?(await W(),T(),V.fire({title:"¡Éxito!",text:"Médico actualizado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})):d(se.data.message||"Error al actualizar médico")}catch(se){d("Error de conexión al actualizar médico"),console.error("Error updating medico:",se)}finally{k(!1)}},G=async Q=>{if((await V.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const re=await fe.delete(I+"api_medicos.php",{data:{id:Q}});re.data.success?(await W(),V.fire({title:"¡Eliminado!",text:"Médico eliminado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})):V.fire({title:"Error",text:re.data.message||"Error al eliminar médico",icon:"error"})}catch(re){V.fire({title:"Error",text:"Error de conexión al eliminar médico",icon:"error"}),console.error("Error deleting medico:",re)}},Y=()=>{h(!0),g({nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),y("")},L=()=>{h(!1),g({nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),y("")},J=Q=>{const{name:se,value:re}=Q.target;g(ce=>({...ce,[se]:re}))},F=async Q=>{Q.preventDefault(),await f(N)},_=Q=>{c(!0),a({id:Q.id,nombre:Q.nombre,apellido:Q.apellido||"",especialidad:Q.especialidad,email:Q.email,password:"",cmp:Q.cmp||"",rne:Q.rne||"",firma:Q.firma||null}),d("")},T=()=>{c(!1),a({id:null,nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),d("")},R=Q=>{const{name:se,value:re}=Q.target;a(ce=>({...ce,[se]:re}))},X=async Q=>{Q.preventDefault(),await A(u)},z=Q=>{b===Q?D(P==="asc"?"desc":"asc"):(j(Q),D("asc")),B(1)},K=[...s.filter(Q=>{if(!M)return!0;const se=M.toLowerCase();return Q.nombre.toLowerCase().includes(se)||Q.apellido&&Q.apellido.toLowerCase().includes(se)||Q.especialidad.toLowerCase().includes(se)||Q.email.toLowerCase().includes(se)})].sort((Q,se)=>{let re=Q[b],ce=se[b];return typeof re=="string"&&(re=re.toLowerCase(),ce=ce.toLowerCase()),P==="asc"?re<ce?-1:re>ce?1:0:re>ce?-1:re<ce?1:0}),ae=K.length,ne=Math.ceil(ae/O),oe=($-1)*O,le=oe+O;return{medicos:K.slice(oe,le),allMedicos:K,loading:r,error:p,showModal:w,form:N,formError:v,saving:o,editModal:S,editForm:u,editError:n,editSaving:l,busqueda:M,setBusqueda:m,sortBy:b,sortDir:P,rowsPerPage:O,setRowsPerPage:H,page:$,setPage:B,totalRows:ae,totalPages:ne,startIdx:oe,endIdx:le,handleOpenModal:Y,handleCloseModal:L,handleInputChange:J,handleSubmit:F,handleEdit:_,handleEditClose:T,handleEditChange:R,handleEditSubmit:X,handleSort:z,deleteMedico:G,fetchMedicos:W}},$s=s=>{try{const i=s.map(({id:N,nombre:g,especialidad:v,email:y})=>({ID:N,Nombre:g,Especialidad:v,Email:y})),r=be.json_to_sheet(i),x=be.book_new();be.book_append_sheet(x,r,"Médicos");const p=[{wch:8},{wch:25},{wch:20},{wch:30}];r["!cols"]=p;const C=We(x,{bookType:"xlsx",type:"array"}),w=new Blob([C],{type:"application/octet-stream"}),h=`medicos_${new Date().toISOString().slice(0,10)}.xlsx`;return qe.saveAs(w,h),{success:!0,fileName:h}}catch(i){return console.error("Error exportando a Excel:",i),{success:!1,error:i.message}}},As=s=>{try{const i=new De;i.setFontSize(18),i.setFont(void 0,"bold"),i.text("Lista de Médicos",14,15),i.setFontSize(10),i.setFont(void 0,"normal"),i.text(`Fecha de generación: ${new Date().toLocaleDateString()}`,14,25),i.text(`Total de médicos: ${s.length}`,14,30);const r=[{header:"ID",dataKey:"id"},{header:"Nombre",dataKey:"nombre"},{header:"Especialidad",dataKey:"especialidad"},{header:"Email",dataKey:"email"}],x=s.map(C=>({id:C.id,nombre:`${C.nombre} ${C.apellido||""}`.trim(),especialidad:C.especialidad,email:C.email}));$e(i,{columns:r,body:x,startY:35,styles:{fontSize:9,cellPadding:3},headStyles:{fillColor:[59,130,246],textColor:[255,255,255],fontStyle:"bold"},alternateRowStyles:{fillColor:[245,247,250]},tableLineColor:[209,213,219],tableLineWidth:.1,margin:{top:35,bottom:20,left:14,right:14}});const p=`medicos_${new Date().toISOString().slice(0,10)}.pdf`;return i.save(p),{success:!0,fileName:p}}catch(i){return console.error("Error exportando a PDF:",i),{success:!1,error:i.message}}},zs=({busqueda:s,setBusqueda:i,onAddNew:r,medicos:x,totalCount:p})=>{const C=()=>{const h=$s(x);h.success||console.error("Error al exportar:",h.error)},w=()=>{const h=As(x);h.success||console.error("Error al exportar:",h.error)};return e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-6 mb-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6",children:[e.jsxs("div",{className:"mb-4 lg:mb-0",children:[e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Gestión de Médicos"}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),p," médicos registrados"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:r,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 font-medium flex items-center justify-center gap-2 shadow-lg hover:shadow-xl",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Médico"}),e.jsx("span",{className:"sm:hidden",children:"Nuevo"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:C,className:"px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 font-medium flex items-center gap-2 shadow-lg hover:shadow-xl",title:"Exportar a Excel",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden lg:inline",children:"Excel"})]}),e.jsxs("button",{onClick:w,className:"px-4 py-3 bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-xl hover:from-red-600 hover:to-pink-700 transition-all duration-200 font-medium flex items-center gap-2 shadow-lg hover:shadow-xl",title:"Exportar a PDF",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),e.jsx("span",{className:"hidden lg:inline",children:"PDF"})]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Buscar médicos por nombre, especialidad o email...",value:s,onChange:h=>i(h.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-white/80 backdrop-blur-sm"}),s&&e.jsx("button",{onClick:()=>i(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("svg",{className:"h-4 w-4 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filtrando por: ",e.jsxs("span",{className:"font-medium text-blue-600",children:['"',s,'"']}),e.jsx("button",{onClick:()=>i(""),className:"text-blue-600 hover:text-blue-700 underline",children:"Limpiar"})]})]})},Os=({medicos:s,loading:i,error:r,sortBy:x,sortDir:p,onSort:C,onEdit:w,onDelete:h,page:N,setPage:g,rowsPerPage:v,setRowsPerPage:y,totalPages:o,totalRows:E,startIdx:S,endIdx:c})=>{if(i)return e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-8 shadow-lg",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-gray-600",children:"Cargando médicos..."})]})})});if(r)return e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-8 shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-red-500 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error al cargar"}),e.jsx("p",{className:"text-gray-600",children:r})]})});if(s.length===0)return e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-8 shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay médicos"}),e.jsx("p",{className:"text-gray-600",children:"No se encontraron médicos que coincidan con los criterios de búsqueda."})]})});const u=a=>x!==a?e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):p==="asc"?e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"})}):e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:[e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>C("id"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["ID",u("id")]})}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>C("nombre"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Nombre",u("nombre")]})}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>C("especialidad"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"Especialidad",u("especialidad")]})}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>C("email"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),"Email",u("email")]})}),e.jsx("th",{className:"px-6 py-4 text-center font-semibold",children:"Acciones"})]})}),e.jsx("tbody",{children:s.map((a,n)=>e.jsxs("tr",{className:`border-b border-gray-200 hover:bg-blue-50/50 transition-colors ${n%2===0?"bg-white/50":"bg-gray-50/50"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold text-sm",children:a.id})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold",children:a.nombre.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["Dr(a). ",a.nombre," ",a.apellido||""]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",a.id]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:a.especialidad})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-gray-900",children:a.email})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>w(a),className:"p-2 text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-lg transition-colors",title:"Editar médico",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>h(a.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar médico",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},a.id))})]})})}),e.jsx("div",{className:"lg:hidden space-y-4",children:s.map(a=>e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg",children:a.nombre.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900",children:["Dr(a). ",a.nombre," ",a.apellido||""]}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["ID: #",a.id]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w(a),className:"p-2 text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-lg transition-colors",title:"Editar médico",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>h(a.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar médico",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-purple-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),e.jsx("span",{className:"text-gray-600 text-sm",children:"Especialidad:"}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:a.especialidad})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),e.jsx("span",{className:"text-gray-600 text-sm",children:"Email:"}),e.jsx("span",{className:"text-gray-900 text-sm",children:a.email})]})]})]},a.id))}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-4 mt-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"Mostrar:"}),e.jsx("select",{value:v,onChange:a=>y(Number(a.target.value)),className:"border border-gray-300 rounded-lg px-3 py-1.5 text-sm bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent",children:[5,10,20,50].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("button",{onClick:()=>g(a=>Math.max(1,a-1)),disabled:N===1,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 font-medium",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),e.jsx("div",{className:"flex items-center gap-2 px-4 py-2 bg-white/80 rounded-lg border border-white/20",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Página ",N," de ",o||1]})}),e.jsxs("button",{onClick:()=>g(a=>a<o?a+1:a),disabled:N>=o,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 font-medium",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["Mostrando ",E===0?0:S+1," - ",Math.min(c,E)," de ",E," médicos"]})})]})]})},Pe=({isOpen:s,onClose:i,mode:r="create",formData:x,onChange:p,onSubmit:C,error:w,isSaving:h})=>{const[N,g]=t.useState(x.firma||null),[v,y]=t.useState(""),o=t.useRef(null);if(!s)return null;const E=k=>{const M=k.target.files[0];if(!M)return;if(!M.type.match(/^image\/(png|jpeg|jpg)$/)){y("Solo se permiten archivos PNG, JPG o JPEG");return}if(M.size>2*1024*1024){y("El archivo es demasiado grande. Máximo 2MB.");return}const m=new FileReader;m.onload=b=>{const j=b.target.result;g(j),y(""),p({target:{name:"firma",value:j}})},m.readAsDataURL(M)},S=()=>{g(null),y(""),o.current&&(o.current.value=""),p({target:{name:"firma",value:null}})},c=r==="edit",u=c?"Editar Médico":"Registrar Nuevo Médico",a=c?"Actualizar información del médico":"Agregar médico al sistema",n=c?"Actualizar Médico":"Registrar Médico",d=c?"bg-gradient-to-r from-amber-500 to-orange-600":"bg-gradient-to-r from-blue-500 to-purple-600",l=c?"bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700";return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-md lg:max-w-2xl xl:max-w-3xl rounded-2xl shadow-2xl max-h-[95vh] sm:max-h-[88vh] lg:max-h-[85vh] flex flex-col",children:[e.jsx("div",{className:`${d} text-white p-4 sm:p-6 rounded-t-2xl flex-shrink-0`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:u}),e.jsx("p",{className:"text-white/80 text-sm",children:a})]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-2 sm:py-4",children:e.jsx("form",{id:`medico-form-${r}`,onSubmit:C,className:"h-full flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4 sm:space-y-6 pb-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Información Personal"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Nombre *"]})}),e.jsx("input",{type:"text",name:"nombre",value:x.nombre,onChange:p,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Juan",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Apellido *"]})}),e.jsx("input",{type:"text",name:"apellido",value:x.apellido||"",onChange:p,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Pérez García",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"Especialidad *"]})}),e.jsx("input",{type:"text",name:"especialidad",value:x.especialidad,onChange:p,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Cardiología",required:!0})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a1 1 0 011-1h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Códigos Profesionales"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a1 1 0 011-1h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"C.M.P. (Colegio Médico del Perú) *"]})}),e.jsx("input",{type:"text",name:"cmp",value:x.cmp||"",onChange:p,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"64201",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Obligatorio para todos los médicos"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"R.N.E. (Registro Nacional de Especialidad)"]})}),e.jsx("input",{type:"text",name:"rne",value:x.rne||"",onChange:p,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"36922"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Solo para médicos especialistas"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Información de Contacto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),"Email *"]})}),e.jsx("input",{type:"email",name:"email",value:x.email,onChange:p,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"doctor@clinica2demayo.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),c?"Nueva Contraseña":"Contraseña de Acceso *"]})}),e.jsx("input",{type:"password",name:"password",value:x.password,onChange:p,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"••••••••",required:!c,autoComplete:"new-password"}),c&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Dejar vacío para mantener la contraseña actual"}),!c&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Mínimo 8 caracteres recomendados"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"✍️ Firma Digital"})]}),N?e.jsxs("div",{className:"bg-white border-2 border-dashed border-indigo-300 rounded-lg p-4 text-center",children:[e.jsx("img",{src:N,alt:"Firma digital",className:"max-h-32 mx-auto object-contain",style:{maxWidth:"300px"}}),e.jsx("div",{className:"mt-3 flex justify-center gap-2",children:e.jsx("button",{type:"button",onClick:S,className:"px-3 py-1 text-sm bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",children:"🗑️ Eliminar"})})]}):e.jsxs("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("p",{className:"text-gray-500",children:"No hay firma registrada"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Subir Firma Digital"]})}),e.jsx("input",{ref:o,type:"file",accept:"image/png,image/jpeg,image/jpg",onChange:E,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white"}),v&&e.jsxs("div",{className:"text-red-600 text-sm flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),v]}),e.jsx("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-3",children:e.jsxs("div",{className:"text-sm text-indigo-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"📋 Requisitos de la firma:"}),e.jsxs("ul",{className:"space-y-1 text-indigo-700 text-xs",children:[e.jsx("li",{children:"• Formato: PNG, JPG o JPEG"}),e.jsx("li",{children:"• Tamaño máximo: 2MB"}),e.jsx("li",{children:"• Recomendado: Fondo transparente"}),e.jsx("li",{children:"• Dimensiones sugeridas: 300x100 píxeles"})]})]})})]}),(x.nombre||x.apellido||x.cmp||N)&&e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Vista Previa - Así aparecerá en los documentos"]}),e.jsxs("div",{className:"bg-white border-2 border-blue-200 rounded-lg p-3 text-center",children:[N&&e.jsx("img",{src:N,alt:"Firma",className:"max-h-12 mx-auto object-contain mb-2"}),e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-800",children:[x.nombre," ",x.apellido]}),x.especialidad&&e.jsx("div",{className:"text-xs text-gray-600",children:x.especialidad}),e.jsxs("div",{className:"text-xs text-gray-600",children:[x.cmp&&`C.M.P. ${x.cmp}`,x.rne&&` - R.N.E ${x.rne}`]})]})]})]})]})]})})}),w&&e.jsx("div",{className:"mx-4 sm:mx-6 mb-4",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-5 w-5 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-red-700 font-medium",children:w})]})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 p-4 sm:p-6 border-t border-gray-200 bg-gray-50/50 rounded-b-2xl flex-shrink-0",children:[e.jsxs("button",{type:"button",onClick:i,className:"flex-1 px-6 py-3 rounded-xl bg-gray-100 text-gray-700 hover:bg-gray-200 transition-all duration-200 font-medium flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Cancelar"]}),e.jsx("button",{type:"submit",form:`medico-form-${r}`,disabled:h,className:`flex-1 px-6 py-3 rounded-xl ${l} text-white disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all duration-200 font-medium flex items-center justify-center gap-2`,children:h?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),n]})})]})]})})};function Bs(){const{medicos:s,allMedicos:i,loading:r,error:x,showModal:p,form:C,formError:w,saving:h,editModal:N,editForm:g,editError:v,editSaving:y,busqueda:o,setBusqueda:E,sortBy:S,sortDir:c,rowsPerPage:u,setRowsPerPage:a,page:n,setPage:d,totalRows:l,totalPages:k,startIdx:M,endIdx:m,handleOpenModal:b,handleCloseModal:j,handleInputChange:P,handleSubmit:D,handleEdit:O,handleEditClose:H,handleEditChange:$,handleEditSubmit:B,handleSort:W,deleteMedico:f}=Ds();return e.jsx("div",{className:"bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(zs,{busqueda:o,setBusqueda:E,onAddNew:b,medicos:i,totalCount:l}),e.jsx(Os,{medicos:s,loading:r,error:x,sortBy:S,sortDir:c,onSort:W,onEdit:O,onDelete:f,page:n,setPage:d,rowsPerPage:u,setRowsPerPage:a,totalPages:k,totalRows:l,startIdx:M,endIdx:m}),e.jsx(Pe,{isOpen:p,onClose:j,mode:"create",formData:C,onChange:P,onSubmit:D,error:w,isSaving:h}),e.jsx(Pe,{isOpen:N,onClose:H,mode:"edit",formData:g,onChange:$,onSubmit:B,error:v,isSaving:y})]})})})}function Rs(){return e.jsx("div",{className:"container mx-auto py-8",children:e.jsx(Bs,{})})}function Is({onSave:s,bloquesGuardados:i=[]}){const[r,x]=t.useState([]),[p,C]=t.useState({}),[w,h]=t.useState(null),N=new Set(i.map(a=>a.fecha)),g=a=>new Date(a.getTime()-a.getTimezoneOffset()*6e4).toISOString().slice(0,10),v=a=>{const n=new Date,d=new Date(a);return n.setHours(0,0,0,0),d.setHours(0,0,0,0),d<n},y=a=>{let n=Array.isArray(a)?a:[a];n=n.map(d=>g(d)),n=n.filter(d=>!v(d)),x(n),C(d=>{const l={...d};return n.forEach(k=>{l[k]||(l[k]=[{hora_inicio:"08:00:00",hora_fin:"10:00:00"}])}),Object.keys(l).forEach(k=>{n.includes(k)||delete l[k]}),l})},o=a=>{const n=g(a);v(n)&&!N.has(n)||(h(n),!r.includes(n)&&!v(n)&&(x(d=>[...d,n]),C(d=>({...d,[n]:[{hora_inicio:"08:00:00",hora_fin:"10:00:00"}]}))))},E=(a,n,d,l)=>{C(k=>{const M={...k};return M[a][n][d]=l,{...M}})},S=a=>{C(n=>{const d={...n};return d[a]=[...d[a],{hora_inicio:"08:00:00",hora_fin:"10:00:00"}],d})},c=(a,n)=>{C(d=>{const l={...d};return l[a]=l[a].filter((k,M)=>M!==n),l})},u=()=>{const a=[];Object.entries(p).forEach(([n,d])=>{d.forEach(l=>a.push({fecha:n,...l}))}),s&&s(a)};return e.jsxs("div",{className:"max-w-xl mx-auto p-4 border rounded shadow bg-white",children:[e.jsx("h2",{className:"font-bold text-lg mb-2 text-center",children:"Definir Disponibilidad"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Selecciona fechas:"}),e.jsx(Te,{onChange:y,value:r.length===1?new Date(r[0]):r.map(a=>new Date(a)),selectRange:!1,minDetail:"month",maxDetail:"month",allowPartialRange:!1,showNeighboringMonth:!1,locale:"es-ES",selectMultiple:!0,tileClassName:({date:a})=>{const n=g(a);let d=[];return r.includes(n)&&d.push("selected-multiple"),p[n]&&p[n].length>0&&d.push("has-bloques"),N.has(n)&&(v(n)?d.push("fecha-pasada"):d.push("fecha-registrada")),d.join(" ")},onClickDay:o}),e.jsxs("div",{className:"mt-3 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"font-semibold mb-1 text-gray-700",children:"Leyenda:"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-100 border-2 border-green-500 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-green-500 text-xs font-bold",children:"✓"})}),e.jsx("span",{children:"Ya registrado"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-100 border-2 border-gray-400 rounded flex items-center justify-center opacity-70",children:e.jsx("span",{className:"text-gray-500 text-xs font-bold",children:"⏰"})}),e.jsx("span",{children:"Consulta pasada"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-sky-400 rounded"}),e.jsx("span",{children:"Seleccionado"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-100 border border-blue-300 rounded"}),e.jsx("span",{children:"Hoy"})]})]})]})]}),r.length===0&&e.jsx("div",{className:"text-gray-500 text-sm mb-2",children:"Selecciona al menos una fecha en el calendario."}),w&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 min-w-[320px] max-w-md relative",children:[e.jsx("button",{onClick:()=>h(null),className:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold","aria-label":"Cerrar",children:"×"}),e.jsxs("div",{className:"font-semibold mb-2 text-blue-700",children:["Bloques para ",w]}),p[w]&&p[w].map((a,n)=>e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("input",{type:"time",value:a.hora_inicio,onChange:d=>E(w,n,"hora_inicio",d.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("span",{children:"a"}),e.jsx("input",{type:"time",value:a.hora_fin,onChange:d=>E(w,n,"hora_fin",d.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("button",{type:"button",onClick:()=>c(w,n),className:"text-red-600 hover:underline",children:"Eliminar"})]},n)),e.jsx("button",{type:"button",onClick:()=>S(w),className:"text-blue-600 hover:underline text-sm mt-1",children:"+ Agregar otro horario"}),e.jsx("button",{onClick:()=>h(null),className:"bg-blue-600 text-white px-4 py-2 rounded font-bold w-full mt-4",children:"Cerrar"})]})}),r.length>0&&!w&&r.map(a=>e.jsxs("div",{className:"mb-4 border rounded p-2 bg-gray-50",children:[e.jsx("div",{className:"font-semibold mb-1",children:a}),p[a].map((n,d)=>e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("input",{type:"time",value:n.hora_inicio,onChange:l=>E(a,d,"hora_inicio",l.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("span",{children:"a"}),e.jsx("input",{type:"time",value:n.hora_fin,onChange:l=>E(a,d,"hora_fin",l.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("button",{type:"button",onClick:()=>c(a,d),className:"text-red-600 hover:underline",children:"Eliminar"})]},d)),e.jsx("button",{type:"button",onClick:()=>S(a),className:"text-blue-600 hover:underline text-sm mt-1",children:"+ Agregar otro horario"})]},a)),e.jsx("button",{onClick:u,className:"bg-blue-600 text-white px-4 py-2 rounded font-bold w-full mt-2",children:"Guardar Disponibilidad"})]})}function Hs(){const i=JSON.parse(sessionStorage.getItem("medico")||"null")?.id,[r,x]=t.useState(null),[p,C]=t.useState({hora_inicio:"",hora_fin:""}),w=d=>{x(d.id),C({hora_inicio:d.hora_inicio,hora_fin:d.hora_fin})},h=async d=>{try{(await(await fetch(`${I}api_disponibilidad_medicos.php`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:d.id,fecha:d.fecha||"",hora_inicio:p.hora_inicio,hora_fin:p.hora_fin})})).json()).success?(x(null),S(),V.fire({icon:"success",title:"Bloque actualizado",showConfirmButton:!1,timer:1400})):V.fire({icon:"error",title:"No se pudo editar el bloque"})}catch{V.fire({icon:"error",title:"Error de red o servidor al editar"})}},N=()=>{x(null)},g=async d=>{if((await V.fire({title:"¿Seguro que deseas eliminar este bloque?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{(await(await fetch(`${I}api_disponibilidad_medicos.php`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:d})})).json()).success?(S(),V.fire({icon:"success",title:"Bloque eliminado",showConfirmButton:!1,timer:1400})):V.fire({icon:"error",title:"No se pudo eliminar el bloque"})}catch{V.fire({icon:"error",title:"Error de red o servidor al eliminar"})}},[v,y]=t.useState([]),[o,E]=t.useState(!1),S=t.useCallback(async()=>{E(!0);try{const l=await(await fetch(`${I}api_disponibilidad_medicos.php?medico_id=${i}`)).json();y(l.disponibilidad||[])}catch{y([])}E(!1)},[i]);t.useEffect(()=>{S()},[S]);const c=async d=>{try{(await(await fetch(`${I}api_disponibilidad_medicos.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({medico_id:i,bloques:d})})).json()).success?(V.fire({icon:"success",title:"Disponibilidad guardada correctamente",showConfirmButton:!1,timer:1400}),S()):V.fire({icon:"error",title:"Error al guardar disponibilidad"})}catch{V.fire({icon:"error",title:"Error de red o servidor"})}},u=v.reduce((d,l)=>(d[l.fecha]||(d[l.fecha]=[]),d[l.fecha].push(l),d),{}),a=d=>d?.slice(0,5),n=d=>{const l=new Date,k=new Date(d);return l.setHours(0,0,0,0),k.setHours(0,0,0,0),k<l};return e.jsxs("div",{className:"max-w-6xl mx-auto mt-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8 text-center col-span-2",children:"Panel del Médico"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"md:w-1/2 w-full",children:e.jsx(Is,{onSave:c,bloquesGuardados:v})}),e.jsxs("div",{className:"md:w-1/2 w-full max-h-[70vh] overflow-y-auto bg-white rounded-lg shadow-inner",children:[e.jsxs("h2",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Disponibilidad registrada"]}),o?e.jsx("div",{className:"text-center py-4",children:e.jsx(ue,{message:"Cargando disponibilidad registrada..."})}):Object.keys(u).length===0?e.jsx("div",{className:"text-gray-500 text-center py-6",children:"No hay bloques registrados aún."}):e.jsx("div",{className:"space-y-6",children:Object.keys(u).sort().map(d=>{const l=n(d);return e.jsxs("div",{className:`rounded-lg shadow p-4 ${l?"bg-gray-50 border-l-4 border-gray-400":"bg-blue-50"}`,children:[e.jsxs("div",{className:`font-semibold mb-2 flex items-center gap-2 ${l?"text-gray-600":"text-blue-700"}`,children:[l?e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(()=>{const[k,M,m]=d.split("-");return new Date(Number(k),Number(M)-1,Number(m)).toLocaleDateString()})(),l&&e.jsx("span",{className:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded-full ml-2",children:"Consulta pasada"})]}),e.jsxs("table",{className:`min-w-full text-sm border rounded overflow-hidden ${l?"opacity-70":""}`,children:[e.jsx("thead",{className:`${l?"bg-gray-200":"bg-blue-100"}`,children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1",children:"Hora inicio"}),e.jsx("th",{className:"px-2 py-1",children:"Hora fin"}),e.jsx("th",{className:"px-2 py-1 text-center",children:l?"Historial":"Acciones"})]})}),e.jsx("tbody",{children:u[d].map(k=>e.jsx("tr",{className:`${l?"hover:bg-gray-100":"hover:bg-blue-200"} transition group`,children:r===k.id&&!l?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-1 text-center",children:e.jsx("input",{type:"time",className:"border rounded px-1 py-0.5 text-green-700 font-mono",value:p.hora_inicio,onChange:M=>C(m=>({...m,hora_inicio:M.target.value}))})}),e.jsx("td",{className:"px-2 py-1 text-center",children:e.jsx("input",{type:"time",className:"border rounded px-1 py-0.5 text-red-700 font-mono",value:p.hora_fin,onChange:M=>C(m=>({...m,hora_fin:M.target.value}))})}),e.jsxs("td",{className:"px-2 py-1 text-center flex gap-1 justify-center",children:[e.jsx("button",{title:"Guardar",onClick:()=>h(k),className:"text-green-600 hover:text-green-800",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("button",{title:"Cancelar",onClick:N,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-1 text-center font-mono text-green-700",children:a(k.hora_inicio)}),e.jsx("td",{className:"px-2 py-1 text-center font-mono text-red-700",children:a(k.hora_fin)}),e.jsx("td",{className:"px-2 py-1 text-center flex gap-1 justify-center",children:l?e.jsx("span",{className:"text-xs text-gray-500 px-2 py-1 bg-gray-100 rounded",children:"Finalizado"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{title:"Editar",onClick:()=>w(k),className:"text-blue-500 hover:text-blue-700 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m2-2l-6 6"})})}),e.jsx("button",{title:"Eliminar",onClick:()=>g(k.id),className:"text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})})]})},k.id))})]})]},d)})})]})]})]})}function Vs(){return e.jsx(Hs,{})}function Ws({consultaId:s,resultadosLab:i,ordenesLab:r=[]}){const[x,p]=t.useState("laboratorio"),[C,w]=t.useState([]),h=ie();t.useEffect(()=>{fetch(`${I}/api_examenes_laboratorio.php`,{credentials:"include"}).then(g=>g.json()).then(g=>w(g.examenes||[])).catch(g=>console.error("Error al obtener exámenes:",g))},[]);const N=Ne.useMemo(()=>{const g={};for(const v of C)g[v.id]=v.nombre;return g},[C]);return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 mb-2",children:[e.jsxs("button",{onClick:()=>p("laboratorio"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${x==="laboratorio"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["🧪 ",e.jsx("span",{className:"hidden sm:inline",children:"Laboratorio"}),e.jsx("span",{className:"sm:hidden",children:"Lab"})]}),e.jsxs("button",{onClick:()=>p("rx"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${x==="rx"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["📸 ",e.jsx("span",{className:"hidden sm:inline",children:"RX"})]}),e.jsxs("button",{onClick:()=>p("ecografia"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${x==="ecografia"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["🫀 ",e.jsx("span",{className:"hidden sm:inline",children:"Ecografía"}),e.jsx("span",{className:"sm:hidden",children:"Eco"})]}),e.jsxs("button",{onClick:()=>p("tomografia"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${x==="tomografia"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["🔬 ",e.jsx("span",{className:"hidden sm:inline",children:"Tomografía"}),e.jsx("span",{className:"sm:hidden",children:"TAC"})]})]}),e.jsxs("div",{className:"border rounded-b bg-white p-3 overflow-hidden",children:[x==="laboratorio"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mb-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",onClick:()=>h(`/solicitud-laboratorio/${s}`),children:"Solicitar análisis de laboratorio"}),(!r||r.length===0)&&e.jsx("div",{className:"mb-3 p-2 bg-gray-50 border border-gray-200 rounded text-gray-600",children:"No hay exámenes solicitados para esta consulta."}),r&&r.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-yellow-50 border border-yellow-300 rounded",children:[e.jsx("div",{className:"font-semibold text-yellow-800 mb-1",children:"Exámenes solicitados:"}),r.map((g,v)=>e.jsxs("ul",{className:"list-disc ml-5 text-sm",children:[Array.isArray(g.examenes)&&g.examenes.length>0?g.examenes.map((y,o)=>typeof y=="string"||typeof y=="number"?e.jsx("li",{children:N[y]||y},o):e.jsx("li",{children:y.nombre||N[y.id]||JSON.stringify(y)},o)):e.jsx("li",{className:"text-gray-500",children:"Sin detalles de exámenes"}),e.jsxs("li",{className:"text-xs text-gray-500",children:["Estado: ",g.estado||"pendiente"]})]},g.id||v)),(!i||i.length===0||i.every(g=>!g.resultados||typeof g.resultados=="object"&&Object.keys(g.resultados).length===0||typeof g.resultados=="string"&&g.resultados.trim()===""))&&e.jsx("div",{className:"mt-2 text-sm text-gray-500",children:"Aún no hay resultados disponibles."})]}),i&&i.length>0&&i.some(g=>g.resultados&&(typeof g.resultados=="object"&&Object.keys(g.resultados).length>0||typeof g.resultados=="string"&&g.resultados.trim()!==""))&&e.jsxs("div",{className:"mb-6 p-3 sm:p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-green-800",children:"Resultados Disponibles"}),e.jsx("p",{className:"text-xs sm:text-sm text-green-600",children:"Los resultados de laboratorio ya están listos"})]})]}),e.jsxs("button",{className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg hover:shadow-xl text-sm sm:text-base",onClick:()=>h(`/resultados-laboratorio/${s}`),children:[e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden sm:inline",children:"📋 Ver Resultados de Laboratorio"}),e.jsx("span",{className:"sm:hidden",children:"📋 Ver Resultados"}),e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),x==="rx"&&e.jsx("div",{className:"text-gray-500",children:"(Próximamente: solicitud y resultados de Rayos X)"}),x==="ecografia"&&e.jsx("div",{className:"text-gray-500",children:"(Próximamente: solicitud y resultados de Ecografía)"}),x==="tomografia"&&e.jsx("div",{className:"text-gray-500",children:"(Próximamente: solicitud y resultados de Tomografía)"})]})]})}function qs({hc:s,setHc:i}){return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Anamnesis"}),e.jsxs("div",{className:"mb-2 flex flex-col md:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Tiempo de Enfermedad:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.tiempo_enfermedad,onChange:r=>i(x=>({...x,tiempo_enfermedad:r.target.value}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Forma de inicio:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.forma_inicio,onChange:r=>i(x=>({...x,forma_inicio:r.target.value}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Curso:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.curso,onChange:r=>i(x=>({...x,curso:r.target.value}))})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Descripción general del cuadro actual:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.descripcion_general||"",onChange:r=>i(x=>({...x,descripcion_general:r.target.value}))})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Antecedentes"}),e.jsx("div",{className:"mb-2",children:e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.antecedentes,onChange:r=>i(x=>({...x,antecedentes:r.target.value}))})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Examen Físico"}),e.jsx("div",{className:"mb-2",children:e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.examen_fisico,onChange:r=>i(x=>({...x,examen_fisico:r.target.value}))})})]})}function Us({triaje:s}){return s?e.jsxs("div",{className:"space-y-4",children:[s.motivo&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"📋 Motivo de Consulta"}),e.jsx("p",{className:"text-blue-800 leading-relaxed",children:s.motivo})]})]})}),s.sintomas&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-orange-900 mb-2",children:"🩺 Síntomas Principales"}),e.jsx("p",{className:"text-orange-800 leading-relaxed",children:s.sintomas})]})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),"❤️ Signos Vitales"]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:[s.presion_arterial&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Presión Arterial"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:s.presion_arterial}),e.jsx("div",{className:"text-xs text-gray-400",children:"mmHg"})]}),s.frecuencia_cardiaca&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Freq. Cardíaca"}),e.jsx("div",{className:"text-lg font-bold text-pink-600",children:s.frecuencia_cardiaca}),e.jsx("div",{className:"text-xs text-gray-400",children:"lpm"})]}),s.frecuencia_respiratoria&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Freq. Respiratoria"}),e.jsx("div",{className:"text-lg font-bold text-blue-600",children:s.frecuencia_respiratoria}),e.jsx("div",{className:"text-xs text-gray-400",children:"rpm"})]}),s.temperatura&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Temperatura"}),e.jsx("div",{className:"text-lg font-bold text-orange-600",children:s.temperatura}),e.jsx("div",{className:"text-xs text-gray-400",children:"°C"})]}),s.saturacion&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Sat. O₂"}),e.jsx("div",{className:"text-lg font-bold text-cyan-600",children:s.saturacion}),e.jsx("div",{className:"text-xs text-gray-400",children:"%"})]}),s.peso&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Peso"}),e.jsx("div",{className:"text-lg font-bold text-purple-600",children:s.peso}),e.jsx("div",{className:"text-xs text-gray-400",children:"kg"})]}),s.talla&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Talla"}),e.jsx("div",{className:"text-lg font-bold text-indigo-600",children:s.talla}),e.jsx("div",{className:"text-xs text-gray-400",children:"cm"})]}),s.peso&&s.talla&&e.jsxs("div",{className:"bg-gradient-to-r from-emerald-50 to-teal-50 rounded-lg p-3 shadow-sm border border-emerald-200",children:[e.jsx("div",{className:"text-xs text-emerald-700 font-medium uppercase",children:"IMC"}),e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:(parseFloat(s.peso)/Math.pow(parseFloat(s.talla)/100,2)).toFixed(1)}),e.jsx("div",{className:"text-xs text-emerald-500",children:"kg/m²"})]})]})]}),(s.nivel_conciencia||s.hidratacion||s.coloracion)&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-purple-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"👤 Estado General"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[s.nivel_conciencia&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Conciencia:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.nivel_conciencia==="Alerta"?"bg-green-100 text-green-800":s.nivel_conciencia==="Somnoliento"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.nivel_conciencia})]}),s.hidratacion&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Hidratación:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.hidratacion==="Normal"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:s.hidratacion})]}),s.coloracion&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Coloración:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.coloracion==="Normal"?"bg-green-100 text-green-800":s.coloracion==="Cianosis"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s.coloracion})]})]})]})]}):e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-yellow-700",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"font-medium",children:"No hay datos de triaje registrados"})]}),e.jsx("p",{className:"text-sm text-yellow-600 mt-2",children:"El triaje debe ser realizado por el personal de enfermería"})]})}function Gs({paciente:s}){return s?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",s.nombre," ",s.apellido]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",s.dni]}),e.jsxs("div",{children:[e.jsx("b",{children:"Historia Clínica:"})," ",s.historia_clinica]}),e.jsxs("div",{children:[e.jsx("b",{children:"Edad:"})," ",s.edad," ",s.edad_unidad]}),e.jsxs("div",{children:[e.jsx("b",{children:"Sexo:"})," ",s.sexo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Dirección:"})," ",s.direccion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Teléfono:"})," ",s.telefono]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",s.email]})]}):null}function Js({diagnosticos:s,setDiagnosticos:i}){const[r,x]=t.useState(""),[p,C]=t.useState([]),[w,h]=t.useState(null),[N,g]=t.useState({tipo:"principal",observaciones:""}),[v,y]=t.useState(!1);t.useEffect(()=>{if(r.length<2){C([]);return}y(!0);const u=setTimeout(async()=>{try{const n=await(await fetch(`http://localhost/clinica-2demayo/api_cie10.php?buscar=${encodeURIComponent(r)}&limite=15`)).json();n.success?C(n.data):(console.error("Error en la búsqueda:",n.message),C([]))}catch(a){console.error("Error al buscar códigos CIE10:",a),C([])}finally{y(!1)}},300);return()=>clearTimeout(u)},[r]);const o=()=>{w&&(i(c=>[...c,{...w,...N,fecha:new Date().toISOString().slice(0,10)}]),h(null),g({tipo:"secundario",observaciones:""}),x(""),C([]))},E=c=>{i(u=>u.filter(a=>a.codigo!==c))},S=(c,u)=>{i(a=>a.map(n=>n.codigo===c?{...n,tipo:u}:n))};return e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Diagnóstico (CIE10)"}),e.jsx("div",{className:"mb-2 flex flex-col sm:flex-row gap-2 items-stretch",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",className:"border rounded p-2 w-full pr-10",placeholder:"Buscar diagnóstico por nombre o código CIE10...",value:r,onChange:c=>{x(c.target.value),h(null)}}),v&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]})}),r.length>=2&&!v&&p.length===0&&e.jsxs("div",{className:"border rounded bg-yellow-50 p-3 mb-2 text-center",children:[e.jsxs("div",{className:"text-yellow-700",children:['No se encontraron códigos CIE10 para "',r,'"']}),e.jsx("div",{className:"text-xs text-yellow-600 mt-1",children:"Intenta con otros términos o códigos"})]}),p.length>0&&!w&&e.jsx("div",{className:"border rounded bg-white shadow-lg max-h-60 overflow-y-auto mb-2 z-10",children:p.map(c=>e.jsx("div",{className:"px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>h(c),children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm text-gray-900",children:c.nombre}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded mr-2",children:c.codigo}),c.categoria&&e.jsx("span",{className:"text-blue-600",children:c.categoria}),c.subcategoria&&e.jsxs("span",{className:"text-gray-500",children:[" • ",c.subcategoria]})]}),c.descripcion&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:c.descripcion})]})})},c.id))}),w&&e.jsxs("div",{className:"border rounded p-3 bg-blue-50 mb-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"font-semibold text-lg",children:w.nombre}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-mono bg-blue-100 px-2 py-1 rounded mr-2",children:w.codigo}),w.categoria&&e.jsx("span",{className:"text-blue-600",children:w.categoria}),w.subcategoria&&e.jsxs("span",{className:"text-gray-500",children:[" • ",w.subcategoria]})]}),w.descripcion&&e.jsx("div",{className:"text-sm text-gray-700 mt-2 p-2 bg-white rounded border-l-4 border-blue-400",children:w.descripcion})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-1",children:[e.jsxs("select",{className:"border rounded p-1",value:N.tipo,onChange:c=>g(u=>({...u,tipo:c.target.value})),children:[e.jsx("option",{value:"principal",children:"Principal"}),e.jsx("option",{value:"secundario",children:"Secundario"})]}),e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Observaciones",value:N.observaciones,onChange:c=>g(u=>({...u,observaciones:c.target.value}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:o,children:"Agregar diagnóstico"}),e.jsx("button",{type:"button",className:"bg-gray-400 text-white px-3 py-1 rounded",onClick:()=>h(null),children:"Cancelar"})]})]}),s.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Diagnósticos agregados:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border rounded min-w-max",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Código"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Nombre"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Tipo"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Observaciones"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Fecha"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap w-16",children:"Quitar"})]})}),e.jsx("tbody",{children:s.map((c,u)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1 font-mono text-xs whitespace-nowrap",children:c.codigo}),e.jsx("td",{className:"border px-2 py-1 max-w-xs truncate",title:c.nombre,children:c.nombre}),e.jsx("td",{className:"border px-2 py-1",children:e.jsxs("select",{className:"border rounded p-1 text-xs w-full min-w-0",value:c.tipo,onChange:a=>S(c.codigo,a.target.value),children:[e.jsx("option",{value:"principal",children:"Principal"}),e.jsx("option",{value:"secundario",children:"Secundario"})]})}),e.jsx("td",{className:"border px-2 py-1 max-w-xs truncate",title:c.observaciones,children:c.observaciones}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:c.fecha}),e.jsx("td",{className:"border px-2 py-1 text-center",children:e.jsx("button",{type:"button",className:"text-red-600 hover:text-red-800 bg-red-100 hover:bg-red-200 rounded px-2 py-1 text-xs font-medium transition-colors",onClick:()=>E(c.codigo),title:"Eliminar diagnóstico",children:"✕"})})]},c.codigo+u))})]})})]})]})}function Xs({receta:s,setReceta:i}){const r=Array.isArray(s)?s:[],[x,p]=t.useState(""),[C,w]=t.useState([]),[h,N]=t.useState(!1),[g,v]=t.useState(null),[y,o]=t.useState({dosis:"",frecuencia:"",duracion:"",observaciones:""});t.useEffect(()=>{if(x.length<2){w([]);return}N(!0),fetch(`${I}api_medicamentos.php?busqueda=${encodeURIComponent(x)}`,{credentials:"include"}).then(c=>c.json()).then(c=>w(c)).finally(()=>N(!1))},[x]);const E=()=>{if(!g)return;const c={codigo:g.codigo,nombre:g.nombre,dosis:y.dosis,frecuencia:y.frecuencia,duracion:y.duracion,observaciones:y.observaciones};i(u=>[c,...u]),v(null),o({dosis:"",frecuencia:"",duracion:"",observaciones:""}),p(""),w([])},S=c=>{i(u=>u.filter(a=>a.codigo!==c))};return e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Receta médica"}),e.jsxs("div",{className:"mb-2 flex flex-col sm:flex-row gap-2 items-stretch",children:[e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Buscar medicamento por nombre o código",value:x,onChange:c=>{p(c.target.value),v(null)}}),h&&e.jsx("span",{className:"text-xs text-gray-500",children:"Buscando..."})]}),C.length>0&&!g&&e.jsx("div",{className:"border rounded bg-white shadow max-h-40 overflow-y-auto mb-2",children:C.map(c=>e.jsxs("div",{className:"px-2 py-1 hover:bg-blue-100 cursor-pointer text-sm",onClick:()=>v(c),children:[c.nombre," ",e.jsxs("span",{className:"text-gray-500",children:["(",c.codigo,")"]})]},c.codigo))}),g&&e.jsxs("div",{className:"border rounded p-2 bg-blue-50 mb-2",children:[e.jsxs("div",{className:"font-semibold mb-1",children:[g.nombre," ",e.jsxs("span",{className:"text-gray-500",children:["(",g.codigo,")"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-1",children:[e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Dosis (ej: 500mg)",value:y.dosis,onChange:c=>o(u=>({...u,dosis:c.target.value}))}),e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Frecuencia (ej: cada 8h)",value:y.frecuencia,onChange:c=>o(u=>({...u,frecuencia:c.target.value}))}),e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Duración (ej: 5 días)",value:y.duracion,onChange:c=>o(u=>({...u,duracion:c.target.value}))})]}),e.jsx("textarea",{className:"border rounded p-1 w-full mb-2",placeholder:"Observaciones",value:y.observaciones,onChange:c=>o(u=>({...u,observaciones:c.target.value})),rows:2}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:E,children:"Agregar a receta"}),e.jsx("button",{type:"button",className:"bg-gray-400 text-white px-3 py-1 rounded",onClick:()=>v(null),children:"Cancelar"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Medicamentos seleccionados:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border rounded min-w-max",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Medicamento"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Dosis"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Frecuencia"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Duración"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Observaciones"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap w-16",children:"Quitar"})]})}),e.jsx("tbody",{children:r.length>0?r.map((c,u)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1 max-w-xs",children:e.jsxs("div",{className:"truncate",title:`${c.nombre} (${c.codigo})`,children:[c.nombre," ",e.jsxs("span",{className:"text-gray-500",children:["(",c.codigo,")"]})]})}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:c.dosis}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:c.frecuencia}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:c.duracion}),e.jsx("td",{className:"border px-2 py-1 max-w-xs truncate",title:c.observaciones,children:c.observaciones}),e.jsx("td",{className:"border px-2 py-1 text-center",children:e.jsx("button",{type:"button",className:"text-red-600 hover:text-red-800 bg-red-100 hover:bg-red-200 rounded px-2 py-1 text-xs font-medium transition-colors",onClick:()=>S(c.codigo),title:"Eliminar medicamento",children:"✕"})})]},c.codigo+u)):e.jsx("tr",{children:e.jsx("td",{className:"border px-2 py-1 text-center text-gray-500 italic",colSpan:6,children:"No hay medicamentos seleccionados"})})})]})})]})]})}function Ks({receta:s,setReceta:i,tratamiento:r,setTratamiento:x}){return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Tratamiento"}),e.jsx("div",{className:"mb-2",children:e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,placeholder:"Indicación general, reposo, dieta, fisioterapia, etc.",value:r||"",onChange:p=>x(p.target.value)})}),e.jsx(Xs,{receta:s,setReceta:i})]})}const Ys=({paciente:s,triaje:i,hc:r,diagnosticos:x,medicamentos:p,ordenesLaboratorio:C,medicoInfo:w,configuracionClinica:h})=>{const N=()=>window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?`${window.location.protocol}//${window.location.host}/2demayo.svg`:"/2demayo.svg",g=o=>o?new Date(o).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",v=o=>o?new Date(o).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"",y=({titulo:o,mensaje:E="No hay información registrada"})=>e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"font-semibold text-gray-600 mb-2 border-b border-gray-300",children:o}),e.jsx("p",{className:"text-sm text-gray-500 italic text-center p-4",children:E})]});return e.jsxs("div",{className:"bg-white p-8 max-w-4xl mx-auto shadow-lg print:shadow-none print:max-w-none",children:[e.jsx("style",{jsx:!0,children:`
        @media print {
          .firma-medico {
            break-inside: avoid;
            page-break-inside: avoid;
          }
          .firma-imagen {
            print-color-adjust: exact;
            -webkit-print-color-adjust: exact;
          }
        }
      `}),e.jsx("div",{className:"text-center border-b-2 border-blue-600 pb-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-2",children:[e.jsx("img",{src:N(),alt:"Logo Clínica 2 de Mayo",className:"h-16 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-800",children:h?.nombre_clinica||"CLÍNICA 2 DE MAYO"}),e.jsx("p",{className:"text-sm text-gray-600",children:h?.direccion||"Dirección de la clínica"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Tel: ",h?.telefono||"123-456-789"," | Email: ",h?.email||"contacto@clinica2demayo.com"]})]})]})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 border-b border-gray-300 pb-2",children:"📋 HISTORIA CLÍNICA"}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mt-2",children:[e.jsxs("span",{children:["Fecha: ",g(new Date)]}),e.jsxs("span",{children:["Hora: ",v(new Date)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6 p-4 bg-blue-50 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2 border-b border-blue-200",children:"👤 DATOS DEL PACIENTE"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Nombre:"})," ",s?.nombres," ",s?.apellidos]}),e.jsxs("p",{children:[e.jsx("strong",{children:"DNI:"})," ",s?.dni]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Edad:"})," ",s?.edad," años"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Sexo:"})," ",s?.sexo]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Teléfono:"})," ",s?.telefono]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2 border-b border-blue-200",children:"🩺 INFORMACIÓN MÉDICA"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Médico:"})," Dr(a). ",w?.nombre," ",w?.apellido]}),e.jsxs("p",{children:[e.jsx("strong",{children:"CMP:"})," ",w?.cmp||"N/A"]}),w?.rne&&e.jsxs("p",{children:[e.jsx("strong",{children:"RNE:"})," ",w.rne]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Especialidad:"})," ",w?.especialidad]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha Consulta:"})," ",g(s?.fecha_consulta)]})]})]})]}),i?.motivo&&e.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-2 border-b border-yellow-300",children:"📝 MOTIVO DE CONSULTA"}),e.jsx("p",{className:"text-sm leading-relaxed",children:i.motivo})]}),i&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-2 border-b border-green-300",children:"❤️ SIGNOS VITALES"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[i.presion_arterial&&e.jsxs("div",{children:[e.jsx("strong",{children:"P/A:"})," ",i.presion_arterial," mmHg"]}),i.frecuencia_cardiaca&&e.jsxs("div",{children:[e.jsx("strong",{children:"FC:"})," ",i.frecuencia_cardiaca," lpm"]}),i.frecuencia_respiratoria&&e.jsxs("div",{children:[e.jsx("strong",{children:"FR:"})," ",i.frecuencia_respiratoria," rpm"]}),i.temperatura&&e.jsxs("div",{children:[e.jsx("strong",{children:"T°:"})," ",i.temperatura,"°C"]}),i.saturacion&&e.jsxs("div",{children:[e.jsx("strong",{children:"SpO₂:"})," ",i.saturacion,"%"]}),i.peso&&e.jsxs("div",{children:[e.jsx("strong",{children:"Peso:"})," ",i.peso," kg"]}),i.talla&&e.jsxs("div",{children:[e.jsx("strong",{children:"Talla:"})," ",i.talla," cm"]}),i.peso&&i.talla&&e.jsxs("div",{children:[e.jsx("strong",{children:"IMC:"})," ",(parseFloat(i.peso)/Math.pow(parseFloat(i.talla)/100,2)).toFixed(1)," kg/m²"]})]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"font-semibold text-purple-800 mb-3 border-b border-purple-300",children:"🔍 ANAMNESIS"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 text-sm",children:[r.tiempo_enfermedad&&e.jsxs("div",{children:[e.jsx("strong",{children:"Tiempo de Enfermedad:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:r.tiempo_enfermedad})]}),r.forma_inicio&&e.jsxs("div",{children:[e.jsx("strong",{children:"Forma de Inicio:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:r.forma_inicio})]}),r.curso&&e.jsxs("div",{children:[e.jsx("strong",{children:"Curso:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:r.curso})]})]}),r.descripcion_general&&e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Descripción General:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:r.descripcion_general})]})]}),r.antecedentes&&e.jsxs("div",{className:"mb-6 p-4 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"font-semibold text-orange-800 mb-2 border-b border-orange-300",children:"📚 ANTECEDENTES"}),e.jsx("p",{className:"text-sm leading-relaxed p-2 bg-white rounded border",children:r.antecedentes})]}),r.examen_fisico&&e.jsxs("div",{className:"mb-6 p-4 bg-teal-50 rounded-lg border border-teal-200",children:[e.jsx("h3",{className:"font-semibold text-teal-800 mb-2 border-b border-teal-300",children:"🔬 EXAMEN FÍSICO"}),e.jsx("p",{className:"text-sm leading-relaxed p-2 bg-white rounded border",children:r.examen_fisico})]}),x&&x.length>0?e.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg border border-red-200 seccion-diagnosticos",children:[e.jsx("h3",{className:"font-semibold text-red-800 mb-2 border-b border-red-300",children:"🎯 DIAGNÓSTICOS CIE-10"}),e.jsx("div",{className:"space-y-3",children:x.map((o,E)=>e.jsx("div",{className:"text-sm p-3 bg-white rounded border border-red-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"inline-block w-6 h-6 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center flex-shrink-0",children:E+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[e.jsx("span",{className:"inline-block px-2 py-1 bg-red-100 text-red-800 text-xs font-semibold rounded",children:o.tipo||"Principal"}),e.jsx("span",{className:"inline-block px-2 py-1 bg-gray-100 text-gray-800 text-xs font-mono rounded",children:o.codigo})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900 leading-relaxed",children:o.descripcion})]})]})},E))})]}):e.jsx(y,{titulo:"🎯 DIAGNÓSTICOS CIE-10",mensaje:"No se han registrado diagnósticos para esta consulta"}),r.tratamiento&&e.jsxs("div",{className:"mb-6 p-4 bg-indigo-50 rounded-lg border border-indigo-200",children:[e.jsx("h3",{className:"font-semibold text-indigo-800 mb-2 border-b border-indigo-300",children:"💊 PLAN DE TRATAMIENTO"}),e.jsx("p",{className:"text-sm leading-relaxed p-2 bg-white rounded border",children:r.tratamiento})]}),p&&p.length>0?e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200 seccion-medicamentos",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-2 border-b border-green-300",children:"💉 RECETA MÉDICA"}),e.jsx("div",{className:"space-y-3",children:p.map((o,E)=>e.jsxs("div",{className:"text-sm p-3 bg-white rounded border border-green-100",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Medicamento:"})," ",o.medicamento]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Concentración:"})," ",o.concentracion]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Forma Farmacéutica:"})," ",o.forma_farmaceutica]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Dosis:"})," ",o.dosis]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Frecuencia:"})," ",o.frecuencia]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duración:"})," ",o.duracion]})]})]}),o.indicaciones&&e.jsx("div",{className:"mt-2 pt-2 border-t border-green-100",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Indicaciones:"})," ",o.indicaciones]})})]},E))})]}):e.jsx(y,{titulo:"💉 RECETA MÉDICA",mensaje:"No se han prescrito medicamentos para esta consulta"}),C&&C.length>0?e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200 seccion-laboratorio",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2 border-b border-blue-300",children:"🔬 EXÁMENES DE LABORATORIO SOLICITADOS"}),e.jsx("div",{className:"space-y-3",children:C.map((o,E)=>e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-blue-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded",children:["Orden #",o.id||E+1]}),e.jsx("span",{className:"text-xs text-gray-500",children:g(o.fecha_solicitud)})]}),o.examenes&&o.examenes.length>0?e.jsx("div",{className:"space-y-2",children:o.examenes.map((S,c)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-blue-50 rounded border-l-4 border-blue-300",children:[e.jsx("span",{className:"w-5 h-5 bg-blue-500 text-white text-xs font-bold rounded-full flex items-center justify-center flex-shrink-0",children:c+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900",children:S.nombre}),S.descripcion&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:S.descripcion}),S.condicion_paciente&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:[e.jsx("strong",{children:"Condición:"})," ",S.condicion_paciente]}),S.tiempo_resultado&&e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[e.jsx("strong",{children:"Tiempo estimado:"})," ",S.tiempo_resultado]})]}),e.jsx("div",{className:"text-xs",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${o.estado==="pendiente"?"bg-yellow-100 text-yellow-800":o.estado==="completado"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:o.estado||"Pendiente"})})]},c))}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No hay exámenes específicos registrados"})]},E))})]}):e.jsx(y,{titulo:"🔬 EXÁMENES DE LABORATORIO SOLICITADOS",mensaje:"No se han solicitado exámenes de laboratorio para esta consulta"}),e.jsx("div",{className:"mt-8 pt-4 border-t-2 border-gray-300",children:e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("p",{children:"Documento generado digitalmente"}),e.jsxs("p",{children:["Fecha de impresión: ",g(new Date)," - ",v(new Date)]})]}),e.jsxs("div",{className:"text-center pie-firma",children:[w?.firma&&e.jsx("div",{className:"mb-4 firma-digital",children:e.jsx("img",{src:w.firma,alt:"Firma digital del médico",className:"mx-auto border border-gray-300 rounded bg-white p-1 firma-img-hc"})}),e.jsxs("div",{className:"border-t-2 border-gray-400 pt-2 min-w-[200px]",children:[e.jsxs("p",{className:"font-semibold text-sm",children:["Dr(a). ",w?.nombre," ",w?.apellido]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["CMP: ",w?.cmp||"N/A"]}),w?.rne&&e.jsxs("p",{className:"text-xs text-gray-600",children:["RNE: ",w.rne]}),e.jsx("p",{className:"text-xs text-gray-600",children:w?.especialidad}),!w?.firma&&e.jsx("div",{className:"mt-2 mb-4 h-16 flex items-center justify-center border border-dashed border-gray-300 text-xs text-gray-400",children:"[Espacio para firma manual]"})]})]})]})})]})},Qs=({paciente:s,ordenesLaboratorio:i,medicoInfo:r,configuracionClinica:x})=>{const p=()=>window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?`${window.location.protocol}//${window.location.host}/2demayo.svg`:"/2demayo.svg",C=h=>h?new Date(h).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",w=h=>h?new Date(h).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"";return e.jsxs("div",{className:"bg-white max-w-2xl mx-auto print:shadow-none print:max-w-none",style:{minHeight:"210mm",maxWidth:"148mm",padding:"10mm",fontFamily:"Arial, sans-serif",fontSize:"12px"},children:[e.jsxs("div",{className:"border-2 border-black p-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-black pb-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:p(),alt:"Logo Clínica 2 de Mayo",className:"h-10 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-bold text-black uppercase leading-tight",children:x?.nombre_clinica||"CLÍNICA 2 DE MAYO"}),e.jsx("p",{className:"text-xs text-black",children:x?.direccion||"Dirección de la clínica"}),e.jsxs("p",{className:"text-xs text-black",children:["Tel: ",x?.telefono||"123-456-789"]}),x?.ruc&&e.jsxs("p",{className:"text-xs text-black",children:["RUC: ",x.ruc]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("h2",{className:"text-sm font-bold text-black leading-tight",children:["Dr(a). ",r?.nombre," ",r?.apellido]}),e.jsx("p",{className:"text-xs text-black",children:r?.especialidad}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",r?.cmp||"N/A"]}),r?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",r.rne]})]})]}),e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-black border-b border-black pb-1",children:"📋 ORDEN DE LABORATORIO"}),e.jsxs("div",{className:"flex justify-between text-xs text-black mt-1",children:[e.jsxs("span",{children:["Fecha: ",C(new Date)]}),e.jsxs("span",{children:["Hora: ",w(new Date)]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-3",children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"👤 DATOS DEL PACIENTE"}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 text-xs",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Paciente:"})," ",s?.nombres," ",s?.apellidos]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"DNI:"})," ",s?.dni]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Edad:"})," ",s?.edad," años"]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Sexo:"})," ",s?.sexo]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"🔬 EXÁMENES SOLICITADOS"}),i&&i.length>0?e.jsx("div",{className:"space-y-2",children:i.map((h,N)=>e.jsxs("div",{className:"border border-gray-300 p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"font-bold text-black text-xs bg-blue-200 px-1 rounded",children:["#",N+1]}),e.jsxs("span",{className:"text-xs text-black",children:["Solicitud: ",C(h.fecha_solicitud)]})]}),h.examenes&&h.examenes.length>0?e.jsx("ul",{className:"list-disc pl-5 text-xs text-black",children:h.examenes.map((g,v)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:g.nombre}),g.condicion_paciente&&e.jsxs("span",{className:"ml-2 bg-yellow-100 px-1 rounded border",children:["⚠️ ",g.condicion_paciente]}),g.tiempo_resultado&&e.jsxs("span",{className:"ml-2 bg-blue-100 px-1 rounded border",children:["⏱️ ",g.tiempo_resultado]})]},v))}):e.jsx("p",{className:"text-xs text-black",children:"Sin detalles disponibles"})]},N))}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{className:"text-xs",children:"No hay órdenes de laboratorio"})})]}),e.jsx("div",{className:"space-y-2 mb-4",children:e.jsxs("div",{className:"border border-black p-2",children:[e.jsx("h3",{className:"text-xs font-bold text-black mb-1",children:"📝 INSTRUCCIONES"}),e.jsxs("div",{className:"text-xs text-black space-y-1",children:[e.jsx("p",{children:"• Presentar DNI original"}),e.jsx("p",{children:"• Seguir preparación específica"}),e.jsx("p",{children:"• Resultados según tiempo indicado"})]})]})}),e.jsx("div",{className:"border-t border-black pt-3 mt-4",children:e.jsxs("div",{className:"flex justify-between items-end text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-16 border border-dashed border-gray-400 flex items-center justify-center mb-1",children:e.jsxs("span",{className:"text-xs text-gray-500 text-center leading-tight",children:["SELLO",e.jsx("br",{}),"LAB"]})}),e.jsx("p",{className:"text-xs text-black font-bold",children:"PROCESADO"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xs text-gray-600",children:["Emitido: ",C(new Date)]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Válido 15 días"})]}),e.jsxs("div",{className:"text-center",children:[r?.firma&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:r.firma,alt:"Firma digital del médico",className:"mx-auto border border-gray-300 rounded bg-white p-1 firma-img-lab"})}),e.jsxs("div",{className:"border-t border-black pt-1 min-w-24",children:[e.jsxs("p",{className:"font-bold text-black text-xs",children:["Dr(a). ",r?.nombre," ",r?.apellido]}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",r?.cmp||"N/A"]}),r?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",r.rne]}),e.jsx("p",{className:"text-xs text-black",children:r?.especialidad}),!r?.firma&&e.jsx("div",{className:"mt-1 mb-2 h-8 flex items-center justify-center border border-dashed border-gray-400 text-xs text-gray-500",children:"[Firma Manual]"}),e.jsx("p",{className:"text-xs text-black font-bold",children:"FIRMA MÉDICO"})]})]})]})})]})},Zs=({paciente:s,medicamentos:i,medicoInfo:r,configuracionClinica:x})=>{const p=()=>window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?`${window.location.protocol}//${window.location.host}/2demayo.svg`:"/2demayo.svg",C=h=>h?new Date(h).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",w=h=>h?new Date(h).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"";return e.jsxs("div",{className:"bg-white max-w-2xl mx-auto print:shadow-none print:max-w-none",style:{minHeight:"210mm",maxWidth:"148mm",padding:"10mm",fontFamily:"Arial, sans-serif",fontSize:"12px"},children:[e.jsxs("div",{className:"border-2 border-black p-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-black pb-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:p(),alt:"Logo Clínica 2 de Mayo",className:"h-10 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-bold text-black uppercase leading-tight",children:x?.nombre_clinica||"CLÍNICA 2 DE MAYO"}),e.jsx("p",{className:"text-xs text-black",children:x?.direccion||"Dirección de la clínica"}),e.jsxs("p",{className:"text-xs text-black",children:["Tel: ",x?.telefono||"123-456-789"]}),x?.ruc&&e.jsxs("p",{className:"text-xs text-black",children:["RUC: ",x.ruc]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("h2",{className:"text-sm font-bold text-black leading-tight",children:["Dr(a). ",r?.nombre," ",r?.apellido]}),e.jsx("p",{className:"text-xs text-black",children:r?.especialidad}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",r?.cmp||"N/A"]}),r?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",r.rne]})]})]}),e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-black border-b border-black pb-1",children:"💊 RECETA MÉDICA"}),e.jsxs("div",{className:"flex justify-between text-xs text-black mt-1",children:[e.jsxs("span",{children:["Fecha: ",C(new Date)]}),e.jsxs("span",{children:["Hora: ",w(new Date)]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-3",children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"👤 DATOS DEL PACIENTE"}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 text-xs",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Paciente:"})," ",s?.nombres," ",s?.apellidos]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"DNI:"})," ",s?.dni]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Edad:"})," ",s?.edad," años"]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Sexo:"})," ",s?.sexo]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-3",style:{minHeight:"80px"},children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"💊 MEDICAMENTOS PRESCRITOS"}),i&&i.length>0?e.jsx("ul",{className:"list-disc pl-5 text-xs text-black space-y-1",children:i.map((h,N)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold uppercase",children:h.nombre||"Medicamento no especificado"}),h.dosis&&e.jsxs("span",{className:"ml-2",children:[e.jsx("strong",{children:"Dosis:"})," ",h.dosis]}),h.frecuencia&&e.jsxs("span",{className:"ml-2",children:[e.jsx("strong",{children:"Frecuencia:"})," ",h.frecuencia]}),h.duracion&&e.jsxs("span",{className:"ml-2",children:[e.jsx("strong",{children:"Duración:"})," ",h.duracion]}),h.observaciones&&e.jsxs("span",{className:"ml-2 italic",children:[e.jsx("strong",{children:"Obs:"})," ",h.observaciones]})]},N))}):e.jsx("p",{className:"text-xs text-black italic text-center py-4",children:"No se han prescrito medicamentos."})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"border border-black p-2",children:[e.jsx("h3",{className:"text-xs font-bold text-black mb-1",children:"📋 INSTRUCCIONES"}),e.jsxs("div",{className:"text-xs text-black space-y-1",children:[e.jsx("p",{children:"• Tomar según indicación médica"}),e.jsx("p",{children:"• Completar tratamiento"}),e.jsx("p",{children:"• Contactar médico si efectos adversos"})]})]}),e.jsxs("div",{className:"border border-red-500 bg-red-50 p-2",children:[e.jsx("h3",{className:"text-xs font-bold text-red-800 mb-1",children:"⚠️ ADVERTENCIAS"}),e.jsx("p",{className:"text-xs text-red-800",children:"• Receta personal e intransferible • Fuera del alcance de niños"})]})]}),e.jsx("div",{className:"border-t border-black pt-3 mt-4",children:e.jsxs("div",{className:"flex justify-between items-end text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-16 border border-dashed border-gray-400 flex items-center justify-center mb-1",children:e.jsxs("span",{className:"text-xs text-gray-500 text-center leading-tight",children:["SELLO",e.jsx("br",{}),"FARMACIA"]})}),e.jsx("p",{className:"text-xs text-black font-bold",children:"DESPACHADO"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xs text-gray-600",children:["Emitido: ",C(new Date)]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Válido 30 días"})]}),e.jsxs("div",{className:"text-center",children:[r?.firma&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:r.firma,alt:"Firma digital del médico",className:"mx-auto border border-gray-300 rounded bg-white p-1 firma-img-receta"})}),e.jsxs("div",{className:"border-t border-black pt-1 min-w-24",children:[e.jsxs("p",{className:"font-bold text-black text-xs",children:["Dr(a). ",r?.nombre," ",r?.apellido]}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",r?.cmp||"N/A"]}),r?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",r.rne]}),e.jsx("p",{className:"text-xs text-black",children:r?.especialidad}),!r?.firma&&e.jsx("div",{className:"mt-1 mb-2 h-8 flex items-center justify-center border border-dashed border-gray-400 text-xs text-gray-500",children:"[Firma Manual]"}),e.jsx("p",{className:"text-xs text-black font-bold",children:"FIRMA MÉDICO"})]})]})]})})]})},et=()=>{const s=t.useRef(),i=ke.useReactToPrint({contentRef:s,documentTitle:"Historia Clínica",onBeforeGetContent:t.useCallback(()=>new Promise(r=>{setTimeout(r,100)}),[]),pageStyle:`
      @page {
        size: A4;
        margin: 10mm;
      }
      
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
        }
        
        .print\\:shadow-none {
          box-shadow: none !important;
        }
        
        .print\\:max-w-none {
          max-width: none !important;
        }
        
        .no-print {
          display: none !important;
        }
        
        /* Colores de fondo para impresión */
        .bg-blue-50, .bg-yellow-50, .bg-green-50, 
        .bg-purple-50, .bg-orange-50, .bg-teal-50, 
        .bg-red-50, .bg-indigo-50 {
          background-color: #f8f9fa !important;
          border: 1px solid #dee2e6 !important;
        }
        
        /* Asegurar que los bordes se impriman */
        .border, .border-b, .border-t-2 {
          border-color: #6c757d !important;
        }
        
        /* Mejorar legibilidad de texto */
        .text-gray-600, .text-gray-800 {
          color: #333 !important;
        }
      }
    `});return{componentRef:s,handlePrint:i}},st=()=>{const s=t.useRef(),i=ke.useReactToPrint({contentRef:s,documentTitle:"Orden de Laboratorio",onBeforeGetContent:t.useCallback(()=>new Promise(r=>{setTimeout(r,100)}),[]),pageStyle:`
      @page {
        size: A4;
        margin: 15mm;
      }
      
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
          font-family: 'Times New Roman', serif;
        }
        
        .no-print {
          display: none !important;
        }
        
        .print\\:border-black {
          border-color: black !important;
        }
        
        .print\\:text-black {
          color: black !important;
        }
      }
    `});return{componentRef:s,handlePrint:i}},tt=()=>{const s=t.useRef(),i=ke.useReactToPrint({contentRef:s,documentTitle:"Receta Médica",onBeforeGetContent:t.useCallback(()=>new Promise(r=>{setTimeout(r,100)}),[]),pageStyle:`
      @page {
        size: A4;
        margin: 15mm;
      }
      
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
          font-family: 'Times New Roman', serif;
        }
        
        .no-print {
          display: none !important;
        }
        
        .print\\:border-black {
          border-color: black !important;
        }
        
        .print\\:text-black {
          color: black !important;
        }
      }
    `});return{componentRef:s,handlePrint:i}};function Le(){const{pacienteId:s,consultaId:i}=de(),{componentRef:r,handlePrint:x}=et(),{componentRef:p,handlePrint:C}=st(),{componentRef:w,handlePrint:h}=tt(),[N,g]=t.useState(null),[v,y]=t.useState(null),[o,E]=t.useState(null),[S,c]=t.useState([]),[u,a]=t.useState([]);t.useEffect(()=>{i&&(fetch(`${I}api_resultados_laboratorio.php?consulta_id=${i}`).then(A=>A.json()).then(A=>{A.success&&A.resultados?c(A.resultados):c([])}).catch(()=>c([])),fetch(`${I}api_ordenes_laboratorio.php?consulta_id=${i}`).then(A=>A.json()).then(A=>{A.success&&Array.isArray(A.ordenes)?a(A.ordenes):a([])}).catch(A=>{console.error("Error al cargar órdenes de laboratorio:",A),a([])}))},[i]);const[n,d]=t.useState(null),[l,k]=t.useState(null),[M,m]=t.useState(!0),[b,j]=t.useState(""),[P,D]=t.useState({tiempo_enfermedad:"",forma_inicio:"",curso:"",antecedentes:"",examen_fisico:"",tratamiento:"",receta:[]}),[O,H]=t.useState(!1),[$,B]=t.useState(""),[W,f]=t.useState([]);return t.useEffect(()=>{i&&fetch(`${I}api_historia_clinica.php?consulta_id=${i}`,{credentials:"include"}).then(A=>A.json()).then(A=>{A.success&&A.datos&&(D({...A.datos,receta:Array.isArray(A.datos.receta)?A.datos.receta:[]}),Array.isArray(A.datos.diagnosticos)?f(A.datos.diagnosticos):f([]))})},[i]),t.useEffect(()=>{s&&(m(!0),fetch(`${I}api_pacientes.php?id=${s}`).then(A=>A.json()).then(A=>{A.success&&A.paciente?d(A.paciente):j(A.error||"No se encontró el paciente"),m(!1)}).catch(()=>{j("Error de conexión con el servidor"),m(!1)}))},[s]),t.useEffect(()=>{i&&fetch(`${I}api_triaje.php?consulta_id=${i}`).then(A=>A.json()).then(A=>{A.success&&A.triaje&&A.triaje.datos?k(A.triaje.datos):k(null)}).catch(()=>k(null))},[i]),t.useEffect(()=>{fetch(`${I}api_get_configuracion.php`,{credentials:"include"}).then(A=>A.json()).then(A=>{A.success&&A.data&&y(A.data)}).catch(()=>y(null))},[]),t.useEffect(()=>{const A=JSON.parse(sessionStorage.getItem("medico")||"null");A?(g(A),E(A.firma||null)):(g(null),E(null))},[]),M?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-white/50 flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"🏥 Cargando historia clínica..."})]})}):b?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-red-200 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Error"}),e.jsx("p",{className:"text-red-600",children:b})]})}):n?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 py-4 sm:py-8 px-2 sm:px-4 overflow-x-hidden",children:[e.jsxs("div",{className:"max-w-6xl mx-auto w-full",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-4 sm:p-6 lg:p-8 mb-6 border border-white/50 w-full",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 sm:w-8 sm:h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"text-center sm:text-left flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-blue-800 to-indigo-800 bg-clip-text text-transparent",children:"📋 Historia Clínica"}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:"Sistema Médico Integral - Clínica 2 de Mayo"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-green-100 to-blue-100 rounded-full flex-shrink-0",children:[e.jsx("div",{className:"w-2 h-2 sm:w-3 sm:h-3 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-700",children:"En línea"})]})]})}),N&&e.jsx("div",{className:`mb-6 p-4 rounded-2xl border ${o?"bg-green-50/80 border-green-200 backdrop-blur-sm":"bg-amber-50/80 border-amber-200 backdrop-blur-sm"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${o?"bg-green-500":"bg-amber-500"}`,children:o?e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${o?"text-green-800":"text-amber-800"}`,children:o?e.jsxs(e.Fragment,{children:["✍️ ",e.jsx("strong",{children:"Firma Digital Activa:"})," Los documentos impresos incluirán su firma digital."]}):e.jsxs(e.Fragment,{children:["⚠️ ",e.jsx("strong",{children:"Sin Firma Digital:"})," Los documentos impresos tendrán espacio para firma manual."]})}),e.jsxs("p",{className:`text-xs mt-1 ${o?"text-green-600":"text-amber-600"}`,children:["Dr(a). ",N.nombre," ",N.apellido," - CMP: ",N.cmp||"N/A"]})]})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"👤 Información del Paciente"})]}),e.jsx(Gs,{paciente:n})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"🚨 Triaje y Signos Vitales"})]}),e.jsx(Us,{triaje:l})]}),e.jsxs("form",{onSubmit:async A=>{A.preventDefault(),H(!0),B("");const G={...P,diagnosticos:W,receta:P.receta},L=await(await fetch(`${I}api_historia_clinica.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:i,datos:G}),credentials:"include"})).json();H(!1),B(L.success?"Guardado correctamente":L.error||"Error al guardar")},className:"space-y-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-500 to-violet-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"📝 Anamnesis y Examen Físico"})]}),e.jsx(qs,{hc:P,setHc:D})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"🔬 Laboratorio y Apoyo Diagnóstico"})]}),e.jsx(Ws,{consultaId:i,resultadosLab:S,ordenesLab:u})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"🩺 Diagnósticos CIE10"})]}),e.jsx(Js,{diagnosticos:W,setDiagnosticos:f})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-emerald-500 to-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"💊 Tratamiento y Receta Médica"})]}),e.jsx(Ks,{receta:P.receta||[],setReceta:A=>D(G=>({...G,receta:typeof A=="function"?A(G.receta):A})),tratamiento:P.tratamiento||"",setTratamiento:A=>D(G=>({...G,tratamiento:A}))})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 w-full",children:[e.jsx("button",{type:"submit",className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm whitespace-nowrap",disabled:O,children:O?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Guardando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),e.jsx("span",{children:"💾 Guardar HC"})]})}),e.jsxs("button",{type:"button",onClick:()=>{r.current?x():console.warn("Referencia de impresión no disponible")},className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg text-sm whitespace-nowrap",title:o?"Imprimir HC con firma digital":"Imprimir HC (sin firma digital)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),e.jsx("span",{children:"🖨️ HC"}),o&&e.jsx("span",{className:"text-xs bg-white/20 px-1 rounded",children:"✍️"})]}),e.jsxs("button",{type:"button",onClick:()=>{p.current&&u&&u.length>0?C():console.warn("Referencia de laboratorio no disponible o sin órdenes de laboratorio")},className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg text-sm whitespace-nowrap",disabled:!u||u.length===0,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),e.jsx("span",{children:"🔬 Lab"})]}),e.jsxs("button",{type:"button",onClick:()=>{w.current&&P.receta&&P.receta.length>0?h():console.warn("Referencia de receta no disponible o sin medicamentos")},className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg text-sm whitespace-nowrap",disabled:!P.receta||P.receta.length===0,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),e.jsx("span",{children:"💊 Receta"})]})]}),e.jsxs("div",{className:"text-center w-full mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"✍️ Firma Digital"})]}),o?e.jsxs("div",{className:"flex flex-col items-center gap-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-3 shadow-sm",children:e.jsx("img",{src:o,alt:"Firma del médico",className:"max-h-16 max-w-[200px] object-contain"})}),e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2 w-full",children:[e.jsxs("div",{className:"text-xs text-gray-600 font-medium",children:[N?.nombre," ",N?.apellido]}),N?.especialidad&&e.jsx("div",{className:"text-xs text-gray-500",children:N.especialidad}),e.jsxs("div",{className:"text-xs text-gray-500",children:["C.M.P. ",N?.cmp||"N/A",N?.rne&&` - R.N.E ${N.rne}`]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Sistema Médico Digitalizado"})]})]}):e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"FIRMA Y SELLO MÉDICO"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Sistema Médico Digitalizado"}),e.jsx("div",{className:"text-xs text-orange-500 mt-2 italic",children:"⚠️ No hay firma registrada"})]})]})]}),$&&e.jsx("div",{className:`mt-4 p-4 rounded-xl border text-center font-medium ${$.includes("correctamente")?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[$.includes("correctamente")?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),$]})})]})]})]}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px"},children:e.jsx("div",{ref:r,children:e.jsx(Ys,{paciente:n,triaje:l,hc:P,diagnosticos:W,medicamentos:P.receta,ordenesLaboratorio:u,medicoInfo:N,configuracionClinica:v})})}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px"},children:e.jsx("div",{ref:p,children:e.jsx(Qs,{paciente:n,ordenesLaboratorio:u,medicoInfo:N,configuracionClinica:v})})}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px"},children:e.jsx("div",{ref:w,children:e.jsx(Zs,{paciente:n,medicamentos:P.receta,medicoInfo:N,configuracionClinica:v})})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-gray-200 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Paciente no encontrado"}),e.jsx("p",{className:"text-gray-600",children:"No se encontró información del paciente."})]})})}function at({medicoId:s}){const[i,r]=t.useState([]),[x,p]=t.useState(!0),[C,w]=t.useState(""),[h,N]=t.useState(""),[g,v]=t.useState(3),[y,o]=t.useState(1),E=ie();t.useEffect(()=>{p(!0),fetch(`${I}api_historial_consultas_medico.php?medico_id=${s}`,{credentials:"include"}).then(l=>l.json()).then(l=>{l.success?r(l.historial):w(l.error||"Error al cargar historial"),p(!1)}).catch(()=>{w("Error de conexión"),p(!1)})},[s]);const S=i.filter(l=>l.paciente_nombre.toLowerCase().includes(h.toLowerCase())||l.motivo.toLowerCase().includes(h.toLowerCase())||l.diagnostico.toLowerCase().includes(h.toLowerCase())),c=S.length,u=Math.ceil(c/g),a=(y-1)*g,n=a+g,d=S.slice(a,n);return t.useEffect(()=>{o(1)},[h,g]),e.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Historial de Consultas"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",className:"border rounded p-2 w-full",placeholder:"Buscar por paciente, motivo o diagnóstico",value:h,onChange:l=>N(l.target.value)}),e.jsx("label",{className:"text-xs",children:"Filas por página:"}),e.jsxs("select",{value:g,onChange:l=>v(Number(l.target.value)),className:"border rounded p-1 text-xs",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]}),x?e.jsx("div",{children:"Cargando..."}):C?e.jsx("div",{className:"text-red-600",children:C}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full text-sm border rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1",children:"Fecha"}),e.jsx("th",{className:"px-2 py-1",children:"Paciente"}),e.jsx("th",{className:"px-2 py-1 hidden sm:table-cell",children:"Motivo"}),e.jsx("th",{className:"px-2 py-1 hidden md:table-cell",children:"Diagnóstico"}),e.jsx("th",{className:"px-2 py-1 hidden md:table-cell",children:"Estado"}),e.jsx("th",{className:"px-2 py-1",children:"Detalle"})]})}),e.jsx("tbody",{children:S.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-2",children:"Sin resultados"})}):d.map(l=>e.jsxs("tr",{className:"hover:bg-blue-50",children:[e.jsx("td",{className:"border px-2 py-1",children:l.fecha}),e.jsx("td",{className:"border px-2 py-1",children:l.paciente_nombre}),e.jsx("td",{className:"border px-2 py-1 hidden sm:table-cell",children:l.motivo}),e.jsx("td",{className:"border px-2 py-1 hidden md:table-cell",children:l.diagnostico}),e.jsx("td",{className:"border px-2 py-1 hidden md:table-cell",children:l.estado}),e.jsx("td",{className:"border px-2 py-1 text-center",children:e.jsx("button",{className:"text-blue-600 underline",onClick:()=>E(`/historia-clinica/${l.paciente_id}/${l.consulta_id}`),children:"Ver"})})]},l.id))})]}),c>0&&e.jsxs("div",{className:"flex justify-end items-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>o(y-1),disabled:y===1,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{className:"text-sm",children:["Página ",y," de ",u]}),e.jsx("button",{onClick:()=>o(y+1),disabled:y===u,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Siguiente"})]})]})]})}function rt({consulta:s,initialData:i,onGuardar:r,onCancelar:x}){const[p,C]=t.useState({presion_arterial:"",frecuencia_cardiaca:"",frecuencia_respiratoria:"",temperatura:"",saturacion:"",peso:"",talla:"",motivo:"",sintomas:"",nivel_conciencia:"Alerta",hidratacion:"Normal",coloracion:"Normal",clasificacion:"No urgente"});t.useEffect(()=>{i&&C({presion_arterial:i.presion_arterial||"",frecuencia_cardiaca:i.frecuencia_cardiaca||"",frecuencia_respiratoria:i.frecuencia_respiratoria||"",temperatura:i.temperatura||"",saturacion:i.saturacion||"",peso:i.peso||"",talla:i.talla||"",motivo:i.motivo||"",sintomas:i.sintomas||"",nivel_conciencia:i.nivel_conciencia||"Alerta",hidratacion:i.hidratacion||"Normal",coloracion:i.coloracion||"Normal",clasificacion:i.clasificacion||"No urgente"})},[i]);const[w,h]=t.useState(!1),N=v=>{C({...p,[v.target.name]:v.target.value})},g=v=>{v.preventDefault(),h(!0);const y={...p,clasificacion:p.clasificacion&&p.clasificacion.trim()?p.clasificacion:"No urgente"};r(y),h(!1)};return e.jsxs("form",{onSubmit:g,className:"space-y-3 p-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{name:"presion_arterial",value:p.presion_arterial,onChange:N,placeholder:"Presión arterial (mmHg)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"frecuencia_cardiaca",value:p.frecuencia_cardiaca,onChange:N,placeholder:"Frecuencia cardíaca (lpm)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"frecuencia_respiratoria",value:p.frecuencia_respiratoria,onChange:N,placeholder:"Frecuencia respiratoria (rpm)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"temperatura",value:p.temperatura,onChange:N,placeholder:"Temperatura (°C)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"saturacion",value:p.saturacion,onChange:N,placeholder:"Saturación O₂ (%)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"peso",value:p.peso,onChange:N,placeholder:"Peso (kg)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"talla",value:p.talla,onChange:N,placeholder:"Talla (cm)",className:"border rounded px-2 py-1"})]}),e.jsx("textarea",{name:"motivo",value:p.motivo,onChange:N,placeholder:"Motivo de consulta",className:"border rounded px-2 py-1 w-full"}),e.jsx("textarea",{name:"sintomas",value:p.sintomas,onChange:N,placeholder:"Síntomas principales",className:"border rounded px-2 py-1 w-full"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("select",{name:"nivel_conciencia",value:p.nivel_conciencia,onChange:N,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"Alerta",children:"Alerta"}),e.jsx("option",{value:"Somnoliento",children:"Somnoliento"}),e.jsx("option",{value:"Inconsciente",children:"Inconsciente"})]}),e.jsxs("select",{name:"hidratacion",value:p.hidratacion,onChange:N,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"Normal",children:"Hidratación normal"}),e.jsx("option",{value:"Deshidratado",children:"Deshidratado"})]}),e.jsxs("select",{name:"coloracion",value:p.coloracion,onChange:N,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"Normal",children:"Coloración normal"}),e.jsx("option",{value:"Cianosis",children:"Cianosis"}),e.jsx("option",{value:"Palidez",children:"Palidez"}),e.jsx("option",{value:"Ictericia",children:"Ictericia"})]})]}),e.jsxs("select",{name:"clasificacion",value:p.clasificacion,onChange:N,className:"border rounded px-2 py-1 w-full",children:[e.jsx("option",{value:"No urgente",children:"No urgente"}),e.jsx("option",{value:"Urgente",children:"Urgente"}),e.jsx("option",{value:"Emergencia",children:"Emergencia"})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-2",children:[e.jsx("button",{type:"button",onClick:x,className:"bg-gray-300 px-3 py-1 rounded",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-3 py-1 rounded",disabled:w,children:"Guardar triaje"})]})]})}function it(){const[s,i]=t.useState([]),[r,x]=t.useState({}),[p,C]=t.useState(!0),[w,h]=t.useState(null),[N,g]=t.useState(null),[v,y]=t.useState(null),[o,E]=t.useState(!1),[S,c]=t.useState(!1),[u,a]=t.useState(5),[n,d]=t.useState(1),[l,k]=t.useState(""),[M,m]=t.useState(""),[b,j]=t.useState(""),P=()=>{C(!0),fetch(I+"api_consultas.php",{credentials:"include"}).then(f=>f.json()).then(async f=>{if(f.success){i(f.consultas);const A={};await Promise.all(f.consultas.map(async G=>{try{const L=await(await fetch(I+`api_triaje.php?consulta_id=${G.id}`)).json();A[G.id]=L.success&&L.triaje?"Completado":"Pendiente"}catch{A[G.id]="Pendiente"}})),x(A)}else h(f.error||"Error al cargar consultas");C(!1)}).catch(f=>{h("Error de red"),C(!1)})};if(t.useEffect(()=>{P()},[]),p)return e.jsx(ue,{message:"Cargando pacientes en triaje..."});if(w)return e.jsx("div",{className:"text-red-600",children:w});let D=s.filter(f=>{const A=l.trim().toLowerCase();return A&&!(f.historia_clinica&&f.historia_clinica.toLowerCase().includes(A)||f.paciente_nombre&&f.paciente_nombre.toLowerCase().includes(A)||f.paciente_apellido&&f.paciente_apellido.toLowerCase().includes(A)||f.medico_nombre&&f.medico_nombre.toLowerCase().includes(A))?!1:!M&&!b?!0:!(!f.fecha||M&&f.fecha<M||b&&f.fecha>b)});const O=D.length,H=Math.ceil(O/u),$=(n-1)*u,B=$+u,W=D.slice($,B);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-600 rounded-2xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl",children:e.jsx(U,{iconName:"People",className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:O}),e.jsx("div",{className:"text-sm text-emerald-100",children:"Total Pacientes"})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-yellow-500 to-orange-600 rounded-2xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl",children:e.jsx(U,{iconName:"Clock",className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.values(r).filter(f=>f==="Pendiente").length}),e.jsx("div",{className:"text-sm text-yellow-100",children:"Triajes Pendientes"})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl",children:e.jsx(U,{iconName:"CheckMark",className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.values(r).filter(f=>f==="Completado").length}),e.jsx("div",{className:"text-sm text-blue-100",children:"Triajes Completados"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(U,{iconName:"Filter",className:"text-xl text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Filtros de búsqueda"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(U,{iconName:"Search",className:"text-lg text-gray-400"})}),e.jsx("input",{type:"text",value:l,onChange:f=>{k(f.target.value),d(1)},placeholder:"Buscar paciente, médico...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(U,{iconName:"Calendar",className:"text-lg text-gray-400"})}),e.jsx("input",{type:"date",value:M,onChange:f=>{m(f.target.value),d(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300",placeholder:"Fecha desde"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(U,{iconName:"Calendar",className:"text-lg text-gray-400"})}),e.jsx("input",{type:"date",value:b,onChange:f=>{j(f.target.value),d(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300",placeholder:"Fecha hasta"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(U,{iconName:"NumberedList",className:"text-lg text-gray-400"})}),e.jsxs("select",{value:u,onChange:f=>{a(Number(f.target.value)),d(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300 appearance-none bg-white",children:[e.jsx("option",{value:5,children:"5 por página"}),e.jsx("option",{value:10,children:"10 por página"}),e.jsx("option",{value:25,children:"25 por página"})]})]})]}),(l||M||b)&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:()=>{k(""),m(""),j(""),d(1)},className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors duration-300",children:[e.jsx(U,{iconName:"Clear",className:"text-lg"}),e.jsx("span",{children:"Limpiar filtros"})]})})]}),N?e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(U,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold",children:["Triaje: ",N.paciente_nombre," ",N.paciente_apellido]}),e.jsxs("p",{className:"text-emerald-100",children:["Historia Clínica: ",N.historia_clinica||"N/A"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-white/20 rounded-xl px-3 py-2",children:[e.jsx(U,{iconName:"Calendar",className:"text-lg"}),e.jsxs("span",{children:[N.fecha," - ",N.hora]})]})]})}),e.jsx("div",{className:"p-6",children:S?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-emerald-200 border-t-emerald-500 rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Cargando datos de triaje..."})]})}):e.jsx(rt,{consulta:N,initialData:v,onGuardar:async f=>{E(!0);const A={consulta_id:N.id,datos:{...f,paciente_id:N.paciente_id}};try{const Y=await(await fetch(I+"api_triaje.php",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(A)})).json();Y.success||(console.error("Error al guardar triaje:",Y.error),alert("Error al guardar triaje: "+(Y.error||"Error desconocido")))}catch(G){console.error("Error de red al guardar triaje:",G),alert("Error de red al guardar triaje")}E(!1),g(null),y(null),P()},onCancelar:()=>{g(null),y(null)},guardando:o})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{iconName:"Table",className:"text-xl text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Lista de Pacientes para Triaje"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:D.length>0?`Mostrando ${W.length} de ${D.length} pacientes`:"No hay pacientes"})]})}),e.jsx("div",{className:"overflow-x-auto",children:D.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex items-center justify-center w-20 h-20 bg-gray-100 rounded-full mx-auto mb-4",children:e.jsx(U,{iconName:"Health",className:"text-4xl text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No hay pacientes"}),e.jsx("p",{className:"text-gray-500",children:"No se encontraron pacientes pendientes de triaje"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Historia Clínica"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Paciente"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Médico"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Fecha y Hora"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Estado"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Acción"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:W.map(f=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-200",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{iconName:"NumberField",className:"text-lg text-gray-400"}),e.jsx("span",{className:"font-mono text-sm",children:f.historia_clinica||"-"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-emerald-100 rounded-full",children:e.jsx(U,{iconName:"Contact",className:"text-lg text-emerald-600"})}),e.jsx("div",{children:e.jsxs("div",{className:"font-semibold text-gray-800",children:[f.paciente_nombre," ",f.paciente_apellido]})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{iconName:"Health",className:"text-lg text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:f.medico_nombre||"-"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{iconName:"Calendar",className:"text-lg text-gray-400"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-800",children:f.fecha}),e.jsx("div",{className:"text-gray-500",children:f.hora})]})]})}),e.jsx("td",{className:"px-6 py-4",children:r[f.id]==="Completado"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:[e.jsx(U,{iconName:"CheckMark",className:"text-sm"}),"Completado"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(U,{iconName:"Clock",className:"text-sm"}),"Pendiente"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-emerald-500 to-green-600 text-white font-semibold rounded-xl hover:from-emerald-600 hover:to-green-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",onClick:async()=>{g(f),c(!0),y(null);try{const G=await(await fetch(I+`api_triaje.php?consulta_id=${f.id}`)).json();G.success&&G.triaje&&G.triaje.datos?y(G.triaje.datos):y(null)}catch{y(null)}c(!1)},children:[e.jsx(U,{iconName:"Health",className:"text-lg"}),"Realizar Triaje"]})})]},f.id))})]})}),e.jsx("div",{className:"lg:hidden p-4 space-y-4",children:W.map(f=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 shadow-sm hover:shadow-md transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-emerald-100 rounded-full",children:e.jsx(U,{iconName:"Contact",className:"text-xl text-emerald-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-800 text-lg",children:[f.paciente_nombre," ",f.paciente_apellido]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(U,{iconName:"NumberField",className:"text-sm"}),"HC: ",f.historia_clinica||"N/A"]})]})]}),r[f.id]==="Completado"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(U,{iconName:"CheckMark",className:"text-xs"}),"Completado"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(U,{iconName:"Clock",className:"text-xs"}),"Pendiente"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{iconName:"Health",className:"text-lg text-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Médico"}),e.jsx("div",{className:"text-sm text-gray-800",children:f.medico_nombre||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{iconName:"Calendar",className:"text-lg text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Fecha y Hora"}),e.jsxs("div",{className:"text-sm text-gray-800",children:[f.fecha," - ",f.hora]})]})]})]}),e.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-emerald-500 to-green-600 text-white font-semibold rounded-xl hover:from-emerald-600 hover:to-green-700 transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl",onClick:async()=>{g(f),c(!0),y(null);try{const G=await(await fetch(I+`api_triaje.php?consulta_id=${f.id}`)).json();G.success&&G.triaje&&G.triaje.datos?y(G.triaje.datos):y(null)}catch{y(null)}c(!1)},children:[e.jsx(U,{iconName:"Health",className:"text-xl"}),"Realizar Triaje"]})]},f.id))})]})})]}),D.length>0&&H>1&&e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",$+1," - ",Math.min(B,O)," de ",O," pacientes"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>d(n-1),disabled:n===1,className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 text-gray-700 rounded-xl transition-all duration-300 disabled:cursor-not-allowed",children:[e.jsx(U,{iconName:"ChevronLeft",className:"text-lg"}),e.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"px-3 py-2 text-sm font-medium text-gray-600",children:["Página ",n," de ",H]})}),e.jsxs("button",{onClick:()=>d(n+1),disabled:n===H,className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 text-gray-700 rounded-xl transition-all duration-300 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx(U,{iconName:"ChevronRight",className:"text-lg"})]})]})]})})]})]})}function nt(){const[s,i]=t.useState("triage"),r=[{key:"triage",label:"Triaje",icon:"Health",color:"emerald",description:"Evaluación inicial de pacientes"},{key:"tratamientos",label:"Tratamientos",icon:"Health",color:"blue",description:"Gestión de tratamientos"},{key:"hospitalizacion",label:"Hospitalización",icon:"Hospital",color:"purple",description:"Control de hospitalización"}],x=(p,C)=>({emerald:C?"bg-gradient-to-r from-emerald-500 to-green-600 text-white shadow-lg border-emerald-300":"bg-white text-emerald-700 border-emerald-200 hover:bg-emerald-50 hover:border-emerald-300",blue:C?"bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg border-blue-300":"bg-white text-blue-700 border-blue-200 hover:bg-blue-50 hover:border-blue-300",purple:C?"bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg border-purple-300":"bg-white text-purple-700 border-purple-200 hover:bg-purple-50 hover:border-purple-300"})[p];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 via-cyan-50 to-blue-50 p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-teal-600 via-cyan-600 to-blue-600 rounded-2xl p-6 sm:p-8 text-white shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-12 -translate-x-12"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-white/20 rounded-2xl backdrop-blur-sm",children:e.jsx(U,{iconName:"Health",className:"text-3xl text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold drop-shadow-lg",children:"Panel de Enfermería"}),e.jsx("p",{className:"text-lg text-white/90 mt-1",children:"Gestión integral de cuidados médicos"})]})]})})]})}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto",children:r.map(p=>e.jsxs("button",{className:`group relative p-6 rounded-2xl border-2 font-semibold transition-all duration-300 transform hover:scale-[1.02] ${x(p.color,s===p.key)}`,onClick:()=>i(p.key),children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:`flex items-center justify-center w-12 h-12 rounded-xl ${s===p.key?"bg-white/20":`bg-${p.color}-100`}`,children:e.jsx(U,{iconName:p.icon,className:`text-2xl ${s===p.key?"text-white":`text-${p.color}-600`}`})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:p.label}),e.jsx("div",{className:`text-sm ${s===p.key?"text-white/80":"text-gray-600"}`,children:p.description})]})]}),s===p.key&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-white rounded-full shadow-lg flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"})})]},p.key))})}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[s==="triage"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(U,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Control de Triaje"}),e.jsx("p",{className:"text-emerald-100",children:"Evaluación y clasificación de pacientes"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx(it,{})})]}),s==="tratamientos"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(U,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gestión de Tratamientos"}),e.jsx("p",{className:"text-blue-100",children:"Control y seguimiento de tratamientos"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full mx-auto mb-4",children:e.jsx(U,{iconName:"Health",className:"text-4xl text-blue-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Módulo en Desarrollo"}),e.jsx("p",{className:"text-gray-600",children:"La gestión de tratamientos estará disponible próximamente"})]})})]}),s==="hospitalizacion"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(U,{iconName:"Hospital",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Control de Hospitalización"}),e.jsx("p",{className:"text-purple-100",children:"Gestión de pacientes hospitalizados"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex items-center justify-center w-20 h-20 bg-purple-100 rounded-full mx-auto mb-4",children:e.jsx(U,{iconName:"Hospital",className:"text-4xl text-purple-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Módulo en Desarrollo"}),e.jsx("p",{className:"text-gray-600",children:"El control de hospitalización estará disponible próximamente"})]})})]})]})]})}function ot(){return e.jsx(nt,{})}Ne.createElement;function lt({selected:s,setSelected:i}){const[r,x]=t.useState([]),[p,C]=t.useState(""),[w,h]=t.useState(!1);t.useEffect(()=>{h(!0),fetch(I+"api_examenes_laboratorio.php",{credentials:"include"}).then(v=>v.json()).then(v=>x(v.examenes||[])).finally(()=>h(!1))},[]);const N=r.filter(v=>v.nombre.toLowerCase().includes(p.toLowerCase())||v.metodologia&&v.metodologia.toLowerCase().includes(p.toLowerCase())),g=v=>{i(y=>y.includes(v)?y.filter(o=>o!==v):[...y,v])};return e.jsxs("div",{className:"mb-2",children:[e.jsx("input",{type:"text",value:p,onChange:v=>C(v.target.value),placeholder:"Buscar examen...",className:"border rounded p-2 text-xs w-full mb-2"}),e.jsx("div",{className:"max-h-48 overflow-y-auto border rounded bg-white",children:w?e.jsx("div",{className:"p-2 text-center text-gray-500 text-xs",children:"Cargando..."}):N.length===0?e.jsx("div",{className:"p-2 text-center text-gray-500 text-xs",children:"Sin exámenes"}):N.map(v=>e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 border-b last:border-b-0 cursor-pointer hover:bg-blue-50 text-xs",children:[e.jsx("input",{type:"checkbox",checked:s.includes(v.id),onChange:()=>g(v.id)}),e.jsx("span",{className:"font-medium",children:v.nombre}),e.jsx("span",{className:"text-gray-400",children:v.metodologia})]},v.id))})]})}function ct({consultaId:s,mostrarPrecios:i=!0}){const[r,x]=t.useState([]),[p,C]=t.useState([]),[w,h]=t.useState(!1),[N,g]=t.useState("");t.useEffect(()=>{fetch(I+"api_examenes_laboratorio.php",{credentials:"include"}).then(E=>E.json()).then(E=>C(E.examenes||[]))},[]);const v=p.filter(E=>r.includes(E.id)),y=v.reduce((E,S)=>E+(parseFloat(S.precio_publico)||0),0),o=async E=>{E.preventDefault(),h(!0),g("");try{if((await fetch(I+"api_ordenes_laboratorio.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:s,examenes:r})})).ok)g("Orden enviada correctamente"),x([]),setTimeout(()=>g(""),3e3);else throw new Error("Error al enviar la orden")}catch{g("Error al enviar la orden. Intente nuevamente."),setTimeout(()=>g(""),5e3)}finally{h(!1)}};return t.useEffect(()=>{fetch(I+"api_examenes_laboratorio.php",{credentials:"include"}).then(E=>E.json()).then(E=>C(E.examenes||[]))},[]),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 border border-emerald-200 rounded-xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx("svg",{className:"w-7 h-7 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-emerald-800",children:"🔬 Solicitud de Análisis de Laboratorio"}),e.jsx("p",{className:"text-sm text-emerald-600",children:"Seleccione los exámenes requeridos para el diagnóstico"})]})]}),e.jsxs("form",{onSubmit:o,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-emerald-100 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),e.jsx("label",{className:"font-semibold text-emerald-800",children:"Exámenes Disponibles:"})]}),e.jsx(lt,{selected:r,setSelected:x})]}),r.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"font-semibold text-blue-800",children:["📋 Exámenes Seleccionados (",r.length,")"]})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-3",children:v.map(E=>e.jsx("div",{className:"bg-white rounded-lg p-3 border border-blue-100 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:E.nombre}),i&&e.jsxs("div",{className:"text-sm text-green-700 font-semibold mt-1",children:["Precio público: S/ ",parseFloat(E.precio_publico).toFixed(2)]}),(E.condicion_paciente||E.tiempo_resultado)&&e.jsxs("div",{className:"mt-1 space-y-1",children:[E.condicion_paciente&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3 text-amber-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-xs text-amber-700 font-medium",children:E.condicion_paciente})]}),E.tiempo_resultado&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-xs text-gray-600",children:["⏱️ ",E.tiempo_resultado]})]})]})]})]})},E.id))}),i&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800 font-bold text-lg flex justify-end",children:["Total cotización: S/ ",y.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"submit",className:`
              px-6 py-3 rounded-lg font-semibold text-white shadow-lg transition-all duration-200
              flex items-center gap-2 min-w-[140px] justify-center
              ${r.length===0||w?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-emerald-600 to-teal-700 hover:from-emerald-700 hover:to-teal-800 hover:shadow-xl transform hover:-translate-y-0.5"}
            `,disabled:w||r.length===0,children:w?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Enviando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),e.jsx("span",{children:"Solicitar Exámenes"})]})}),e.jsx("div",{className:"text-sm text-emerald-700 font-medium",children:r.length===0?e.jsx("span",{className:"text-gray-500",children:"Ningún examen seleccionado"}):e.jsxs("span",{children:["✅ ",r.length," examen",r.length!==1?"es":""," seleccionado",r.length!==1?"s":""]})})]}),N&&e.jsxs("div",{className:`
            rounded-lg p-4 border shadow-sm flex items-center gap-3
            ${N.includes("correctamente")?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}
          `,children:[N.includes("correctamente")?e.jsx("svg",{className:"w-6 h-6 text-green-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-6 h-6 text-red-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"font-semibold",children:N})]})]})]})}function dt(){const{consultaId:s}=de();let i=!0;try{const r=sessionStorage.getItem("usuario"),x=sessionStorage.getItem("medico"),p=r?JSON.parse(r):x?JSON.parse(x):null;p&&p.rol==="medico"&&(i=!1)}catch{i=!0}return e.jsxs("div",{className:"max-w-xl mx-auto p-6 bg-white rounded shadow mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Solicitud de Análisis de Laboratorio"}),e.jsxs("div",{className:"mb-4 text-center text-gray-600",children:[e.jsx("b",{children:"Consulta ID:"})," ",s]}),e.jsx(ct,{consultaId:s,mostrarPrecios:i}),e.jsx("div",{className:"text-center",children:e.jsx(te,{to:-1,className:"text-blue-600 hover:underline",children:"← Volver a la historia clínica"})})]})}function xt(){const[s,i]=t.useState(!1),[r,x]=t.useState([]),[p,C]=t.useState(0),w=ie(),{pacienteId:h}=de(),[N,g]=t.useState([]),[v,y]=t.useState([]),[o,E]=t.useState([]),[S,c]=t.useState([]),[u,a]=t.useState(!0),[n,d]=t.useState(""),[l,k]=t.useState(""),[M,m]=t.useState(""),[b,j]=t.useState(0),[P,D]=t.useState(3),[O,H]=t.useState(null),[$,B]=t.useState(null);t.useEffect(()=>{Promise.all([fetch(`${I}api_examenes_laboratorio.php`,{credentials:"include"}).then(R=>R.json()),fetch(`${I}api_tarifas.php`,{credentials:"include"}).then(R=>R.json()),fetch(`${I}api_examenes_laboratorio_ranking.php`,{credentials:"include"}).then(R=>R.json()),h?fetch(`${I}api_pacientes.php?id=${h}`,{credentials:"include"}).then(R=>R.json()):Promise.resolve({success:!1})]).then(([R,X,z,q])=>{g(R.examenes||[]),c(X.tarifas||[]),y(z.ranking||[]),q&&q.success&&q.paciente&&B(q.paciente),a(!1)})},[h]);const W=R=>{E(X=>X.includes(R)?X.filter(z=>z!==R):[...X,R]),k("")},f=()=>o.reduce((R,X)=>{const z=S.find(q=>q.servicio_tipo==="laboratorio"&&q.examen_id===X&&q.activo===1);return R+(z?parseFloat(z.precio_particular):0)},0);if(u)return e.jsx("div",{children:"Cargando exámenes y tarifas..."});const A=Array.from(new Set(N.map(R=>R.categoria).filter(Boolean))),G=v.map(R=>parseInt(R.id)),L=[...N].sort((R,X)=>{const z=G.indexOf(R.id),q=G.indexOf(X.id);return z===-1&&q===-1?R.nombre.localeCompare(X.nombre):z===-1?1:q===-1?-1:z-q}).filter(R=>{const X=n.trim().length===0||R.nombre.toLowerCase().includes(n.toLowerCase()),z=M===""||R.categoria===M;return X&&z}),J=Math.max(1,Math.ceil(L.length/P)),F=L.slice(b*P,b*P+P),_=()=>{E([]),k("")},T=()=>{if(o.length===0){k("Selecciona al menos un examen para cobrar.");return}const R=o.map(X=>{const z=N.find(ae=>ae.id===X),q=S.find(ae=>ae.servicio_tipo==="laboratorio"&&ae.examen_id===X&&ae.activo===1);let K=z&&typeof z.nombre=="string"&&z.nombre.trim()!==""&&z.nombre!=="0"?z.nombre:"Examen sin nombre";return{servicio_tipo:"laboratorio",servicio_id:X,descripcion:K,cantidad:1,precio_unitario:q?parseFloat(q.precio_particular):0,subtotal:q?parseFloat(q.precio_particular):0}});x(R),C(R.reduce((X,z)=>X+z.subtotal,0)),i(!0)};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 md:p-8 bg-white rounded-xl shadow-lg mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"🔬"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Cotización de Laboratorio"})]}),e.jsx("button",{onClick:()=>w("/seleccionar-servicio",{state:{pacienteId:h}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"})]}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("b",{children:"ID Paciente:"})," ",h]}),e.jsx("input",{type:"text",value:n,onChange:R=>d(R.target.value),placeholder:"Buscar examen...",className:"border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-64"})]}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-2 items-center",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Filtrar por categoría:"}),e.jsxs("select",{value:M,onChange:R=>m(R.target.value),className:"border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-64",children:[e.jsx("option",{value:"",children:"Todas"}),A.map(R=>e.jsx("option",{value:R,children:R},R))]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Selecciona los exámenes:"}),e.jsx("div",{className:"mb-2 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:e.jsxs("div",{className:"w-full bg-white shadow-md rounded-xl border border-gray-200 px-4 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"text-sm text-gray-700 flex gap-4 items-center",children:[e.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1",children:["Total exámenes: ",e.jsx("b",{children:L.length})]}),e.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1",children:["Páginas: ",e.jsx("b",{children:J})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("button",{disabled:b===0||J===1,onClick:()=>j(R=>Math.max(0,R-1)),className:"px-2 py-1 rounded-full bg-blue-100 text-blue-700 disabled:opacity-50 hover:bg-blue-200 transition-colors shadow-sm",title:"Página anterior",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("span",{className:"px-3 py-1 text-sm font-medium bg-gray-50 rounded",children:["Página ",b+1," de ",J||1]}),e.jsx("button",{disabled:b>=J-1||J===1,onClick:()=>j(R=>Math.min(J-1,R+1)),className:"px-2 py-1 rounded-full bg-blue-100 text-blue-700 disabled:opacity-50 hover:bg-blue-200 transition-colors shadow-sm",title:"Página siguiente",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsxs("select",{value:P,onChange:R=>{D(Number(R.target.value)),j(0)},className:"border border-gray-300 rounded-lg px-2 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 ml-2",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]})]})}),L.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No hay exámenes para mostrar."}):e.jsx("div",{className:"bg-white rounded-lg shadow border border-gray-200",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:F.map(R=>{const X=S.find(z=>z.servicio_tipo==="laboratorio"&&z.examen_id===R.id&&z.activo===1);return e.jsxs("li",{className:"flex items-center px-4 py-3 hover:bg-blue-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:o.includes(R.id),onChange:()=>W(R.id),className:"mr-3 accent-blue-600 w-5 h-5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:R.nombre}),R.categoria&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded mt-1 inline-block",children:R.categoria})]}),e.jsxs("div",{className:"font-bold text-green-700 text-lg",children:["S/ ",X?X.precio_particular:"-"]})]},R.id)})})})]})}),e.jsxs("div",{className:"w-full md:w-96 md:sticky md:top-8 h-fit",children:[o.length>0&&!s&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotización"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:o.map(R=>{const X=N.find(q=>q.id===R),z=S.find(q=>q.servicio_tipo==="laboratorio"&&q.examen_id===R&&q.activo===1);return e.jsxs("li",{className:"py-2 flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:X?.nombre}),X?.condicion_paciente&&e.jsxs("span",{className:"block text-xs text-gray-400 mt-1",children:["Condición: ",X.condicion_paciente]}),X?.tiempo_resultado&&e.jsxs("span",{className:"block text-xs text-gray-400",children:["Tiempo: ",X.tiempo_resultado]})]}),e.jsxs("div",{className:"font-bold text-green-700 text-right",children:["S/ ",z?z.precio_particular:"-"]})]},R)})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",f().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:_,className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:T,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Cobrar"})]})]}),s&&$&&e.jsx(pe,{paciente:$,servicio:{key:"laboratorio",label:"Laboratorio"},detalles:r,total:p,onCobroCompleto:()=>{i(!1),k("Cotización procesada correctamente.")},onCancelar:()=>i(!1)})]})]}),l&&e.jsx("div",{className:`mt-6 text-center font-semibold ${l.includes("correctamente")?"text-green-600":"text-red-600"}`,children:l}),O&&e.jsxs("div",{className:"mt-8 mx-auto max-w-lg bg-white rounded-xl shadow-lg border border-blue-200 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-700 mb-2",children:"Comprobante de Cotización"}),e.jsxs("div",{className:"mb-2 text-blue-800 font-semibold",children:["Nº comprobante: ",O.numero]}),e.jsxs("div",{className:"mb-2 text-gray-600 text-sm",children:["Fecha: ",O.fecha]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-4",children:O.detalles.map((R,X)=>e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-800",children:R.descripcion}),e.jsxs("span",{className:"text-green-700 font-bold",children:["S/ ",R.precio_unitario.toFixed(2)]})]},X))}),e.jsxs("div",{className:"text-right text-lg font-bold text-blue-700 border-t pt-2",children:["Total: S/ ",O.total.toFixed(2)]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Imprimir"}),e.jsx("button",{onClick:()=>H(null),className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Cerrar"})]})]})]})}function mt(){const[s,i]=t.useState(!1),[r,x]=t.useState([]),[p,C]=t.useState(0),{pacienteId:w}=de(),h=ie(),[N,g]=t.useState(null),[v,y]=t.useState([]),[o,E]=t.useState([]),[S,c]=t.useState({}),[u,a]=t.useState("");t.useEffect(()=>{fetch(`${I}api_pacientes.php?id=${w}`).then(m=>m.json()).then(m=>{m.success&&m.paciente&&g(m.paciente)}),fetch(`${I}api_tarifas.php`,{credentials:"include"}).then(m=>m.json()).then(m=>{const b=(m.tarifas||[]).filter(j=>j.servicio_tipo==="rayosx");y(b)})},[w]);const n=m=>{E(b=>b.includes(m)?b:[...b,m]),c(b=>({...b,[m]:1}))},d=m=>{E(b=>b.filter(j=>j!==m)),c(b=>{const j={...b};return delete j[m],j})},l=(m,b)=>{c(j=>({...j,[m]:b}))},k=()=>o.reduce((m,b)=>{const j=v.find(D=>D.id===b),P=S[b]||1;return j?m+j.precio_particular*P:m},0),M=async()=>{if(o.length===0){a("Selecciona al menos un estudio de Rayos X.");return}const m=o.map(b=>{const j=v.find(D=>D.id===b),P=S[b]||1;return j?{servicio_tipo:"rayosx",servicio_id:b,descripcion:j.descripcion||j.nombre,cantidad:P,precio_unitario:j.precio_particular,subtotal:j.precio_particular*P}:null}).filter(Boolean);x(m),C(k()),i(!0)};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-2xl shadow-2xl mt-8 border border-blue-100",children:[e.jsx("button",{onClick:()=>h("/seleccionar-servicio",{state:{pacienteId:w}}),className:"mb-4 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded text-gray-700 font-semibold",children:"← Volver"}),e.jsxs("h2",{className:"text-2xl font-bold text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"rayosx",children:"🩻"})," Cotizador de Rayos X"]}),N&&e.jsxs("div",{className:"mb-4 p-2 bg-blue-50 rounded text-blue-800 text-sm",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",N.nombres||N.nombre," ",N.apellidos||N.apellido," (DNI: ",N.dni,")"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"mb-4 max-h-[500px] overflow-y-auto",children:[e.jsx("div",{className:"font-bold mb-2",children:"Estudios disponibles:"}),v.length===0?e.jsx("div",{className:"text-gray-500",children:"No hay estudios de Rayos X registrados."}):e.jsx("ul",{className:"divide-y divide-gray-100",children:v.map(m=>e.jsxs("li",{className:"flex items-center gap-4 py-3 px-2 hover:bg-blue-50 rounded-lg transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:m.descripcion||m.nombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Precio: S/ ",m.precio_particular]})]}),o.includes(m.id)?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:1,value:S[m.id]||1,onChange:b=>l(m.id,Math.max(1,Number(b.target.value))),className:"border rounded-lg px-2 w-16 bg-white"}),e.jsx("button",{onClick:()=>d(m.id),className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-xl shadow transition","aria-label":"Quitar",children:"✕"})]}):e.jsx("button",{onClick:()=>n(m.id),className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-100 hover:bg-green-200 text-green-700 text-xl shadow transition","aria-label":"Agregar",children:"+"})]},m.id))})]}),e.jsxs("div",{className:"w-full md:w-96 md:sticky md:top-8 h-fit",children:[o.length>0&&!s&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"font-semibold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"📝"}),"Resumen de Cotización"]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-2 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:o.map(m=>{const b=v.find(P=>P.id===m),j=S[m]||1;return b?e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{children:b.descripcion||b.nombre}),e.jsxs("span",{children:[j," estudio(s)"]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",(b.precio_particular*j).toFixed(2)]})]},m):null})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",k().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>{E([]),a("")},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:M,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Registrar Cotización"})]})]}),s&&e.jsx(pe,{paciente:N,servicio:{key:"rayosx",label:"Rayos X"},detalles:r,total:p,onCobroCompleto:()=>{i(!1),E([]),c({}),a("Cobro procesado correctamente.")},onCancelar:()=>i(!1)})]})]}),u&&e.jsx("div",{className:"mt-4 text-center font-semibold text-green-600",children:u})]})}function ht(){const[s,i]=t.useState(!1),[r,x]=t.useState([]),[p,C]=t.useState(0),{pacienteId:w}=de(),h=ie(),[N,g]=t.useState(null),[v,y]=t.useState([]),[o,E]=t.useState([]),[S,c]=t.useState({}),[u,a]=t.useState("");t.useEffect(()=>{fetch(`${I}api_pacientes.php?id=${w}`).then(m=>m.json()).then(m=>{m.success&&m.paciente&&g(m.paciente)}),fetch(`${I}api_tarifas.php`,{credentials:"include"}).then(m=>m.json()).then(m=>{const b=(m.tarifas||[]).filter(j=>j.servicio_tipo==="ecografia");y(b)})},[w]);const n=m=>{E(b=>b.includes(m)?b:[...b,m]),c(b=>({...b,[m]:1}))},d=m=>{E(b=>b.filter(j=>j!==m)),c(b=>{const j={...b};return delete j[m],j})},l=(m,b)=>{c(j=>({...j,[m]:b}))},k=()=>o.reduce((m,b)=>{const j=v.find(D=>D.id===b),P=S[b]||1;return j?m+j.precio_particular*P:m},0),M=async()=>{if(o.length===0){a("Selecciona al menos una ecografía.");return}const m=o.map(b=>{const j=v.find(H=>H.id===b),P=S[b]||1;let O=j&&j.descripcion&&j.descripcion!=="0"?j.descripcion:j&&j.nombre&&j.nombre!=="0"?j.nombre:"Ecografía sin nombre";return j?{servicio_tipo:"ecografia",servicio_id:b,descripcion:O,cantidad:P,precio_unitario:j.precio_particular,subtotal:j.precio_particular*P}:null}).filter(Boolean);x(m),C(k()),i(!0)};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-2xl shadow-2xl mt-8 border border-blue-100",children:[e.jsx("button",{onClick:()=>h("/seleccionar-servicio",{state:{pacienteId:w}}),className:"mb-4 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded text-gray-700 font-semibold",children:"← Volver"}),e.jsxs("h2",{className:"text-2xl font-bold text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"eco",children:"📡"})," Cotizador de Ecografías"]}),N&&e.jsxs("div",{className:"mb-4 p-2 bg-blue-50 rounded text-blue-800 text-sm",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",N.nombres||N.nombre," ",N.apellidos||N.apellido," (DNI: ",N.dni,")"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"mb-4 max-h-[500px] overflow-y-auto",children:[e.jsx("div",{className:"font-bold mb-2",children:"Ecografías disponibles:"}),v.length===0?e.jsx("div",{className:"text-gray-500",children:"No hay ecografías registradas."}):e.jsx("ul",{className:"divide-y divide-gray-100",children:v.map(m=>e.jsxs("li",{className:"flex items-center gap-4 py-3 px-2 hover:bg-blue-50 rounded-lg transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:m.descripcion||m.nombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Precio: S/ ",m.precio_particular]})]}),o.includes(m.id)?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:1,value:S[m.id]||1,onChange:b=>l(m.id,Math.max(1,Number(b.target.value))),className:"border rounded-lg px-2 w-16 bg-white"}),e.jsx("button",{onClick:()=>d(m.id),className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-xl shadow transition","aria-label":"Quitar",children:"✕"})]}):e.jsx("button",{onClick:()=>n(m.id),className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-100 hover:bg-green-200 text-green-700 text-xl shadow transition","aria-label":"Agregar",children:"+"})]},m.id))})]}),o.length>0&&!s&&e.jsxs("div",{className:"bg-blue-50 rounded-2xl p-6 border border-blue-200 shadow mb-4 max-h-[500px] overflow-y-auto",children:[e.jsxs("h4",{className:"font-semibold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"📝"}),"Resumen de Cotización"]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-2",children:o.map(m=>{const b=v.find(P=>P.id===m),j=S[m]||1;return b?e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{children:b.descripcion||b.nombre}),e.jsxs("span",{children:[j," estudio(s)"]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",(b.precio_particular*j).toFixed(2)]})]},m):null})}),e.jsxs("div",{className:"text-right text-xl font-bold text-blue-800 flex items-center gap-2",children:["Total: ",e.jsx("span",{children:"💲"})," S/ ",k().toFixed(2)]}),e.jsxs("button",{onClick:M,className:"mt-6 bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 flex items-center gap-2 text-lg",children:[e.jsx("span",{children:"🛒"}),"Registrar Cotización"]})]}),s&&N&&e.jsx(pe,{paciente:N,servicio:{key:"ecografia",label:"Ecografía"},detalles:r,total:p,onCobroCompleto:()=>{i(!1),a("Cotización procesada correctamente.")},onCancelar:()=>i(!1)})]}),u&&e.jsx("div",{className:"mt-4 text-center font-semibold text-green-600",children:u})]})}function ut({onSeleccionarOrden:s}){const[i,r]=t.useState("table"),[x,p]=t.useState(10),[C,w]=t.useState(0),[h,N]=t.useState([]),[g,v]=t.useState(!0),[y,o]=t.useState(""),[E,S]=t.useState([]),[c,u]=t.useState(""),[a,n]=t.useState(""),[d,l]=t.useState(""),[k,M]=t.useState("");if(t.useEffect(()=>{v(!0),fetch(I+"api_ordenes_laboratorio.php",{credentials:"include"}).then($=>$.json()).then($=>{$.success?N($.ordenes):o($.error||"Error al cargar órdenes"),v(!1)}).catch($=>{o("Error de conexión con el servidor"),v(!1),console.error("Error al cargar órdenes:",$)}),fetch(I+"api_examenes_laboratorio.php",{credentials:"include"}).then($=>$.json()).then($=>{S($.examenes||[])})},[]),g||E.length===0)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"flex items-center gap-3 text-purple-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),e.jsx("span",{children:"Cargando órdenes de laboratorio..."})]})});if(y)return e.jsx("div",{className:"p-4 text-red-600 bg-red-50 rounded-lg border border-red-200",children:y});const b=($=>$.filter(B=>{if((c||a)&&B.fecha){const W=new Date(B.fecha),f=c?new Date(c):null,A=a?new Date(a):null;if(f&&W<f||A&&W>new Date(A+"T23:59:59"))return!1}if(d.trim()!==""){const W=d.toLowerCase(),f=(B.paciente_nombre+" "+B.paciente_apellido).toLowerCase(),A=(B.medico_nombre||"").toLowerCase();if(!f.includes(W)&&!A.includes(W))return!1}return!(k&&B.estado!==k)}))(h),j={total:h.length,pendientes:h.filter($=>$.estado==="pendiente").length,completadas:h.filter($=>$.estado==="completado").length,hoy:h.filter($=>{if(!$.fecha)return!1;const B=new Date($.fecha).toDateString(),W=new Date().toDateString();return B===W}).length},P=Math.ceil(b.length/x),D=b.slice(C*x,(C+1)*x),O=$=>Array.isArray($)?$.map(B=>{const W=E.find(f=>f.id==B);return W?W.nombre:B}).join(", "):"",H=$=>$?new Date($).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"N/A";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm",children:"Total Órdenes"}),e.jsx("p",{className:"text-2xl font-bold",children:j.total})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"📋"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-100 text-sm",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold",children:j.pendientes})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"⏳"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-emerald-100 text-sm",children:"Completadas"}),e.jsx("p",{className:"text-2xl font-bold",children:j.completadas})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"✅"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm",children:"Hoy"}),e.jsx("p",{className:"text-2xl font-bold",children:j.hoy})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"📅"})]})})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Desde"}),e.jsx("input",{type:"date",value:c,onChange:$=>{u($.target.value),w(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hasta"}),e.jsx("input",{type:"date",value:a,onChange:$=>{n($.target.value),w(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar"}),e.jsx("input",{type:"text",value:d,onChange:$=>{l($.target.value),w(0)},placeholder:"Paciente o médico...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsxs("select",{value:k,onChange:$=>{M($.target.value),w(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"completado",children:"Completado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Por página"}),e.jsxs("select",{value:x,onChange:$=>{p(Number($.target.value)),w(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vista:"}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>r("table"),className:`px-3 py-1 rounded-md text-sm transition-colors ${i==="table"?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"📊 Tabla"}),e.jsx("button",{onClick:()=>r("cards"),className:`px-3 py-1 rounded-md text-sm transition-colors ${i==="cards"?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"🗃️ Tarjetas"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",D.length," de ",b.length," órdenes"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{disabled:C===0,onClick:()=>w($=>Math.max(0,$-1)),className:"px-3 py-1 rounded-lg bg-gray-100 disabled:opacity-50 hover:bg-gray-200 transition-colors",children:"←"}),e.jsxs("span",{className:"px-3 py-1 text-sm",children:[C+1," / ",P||1]}),e.jsx("button",{disabled:C>=P-1,onClick:()=>w($=>Math.min(P-1,$+1)),className:"px-3 py-1 rounded-lg bg-gray-100 disabled:opacity-50 hover:bg-gray-200 transition-colors",children:"→"})]})]})]}),b.length===0?e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No se encontraron órdenes con los filtros aplicados"})]}):e.jsxs(e.Fragment,{children:[i==="table"&&e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Paciente"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Tipo de Cotización"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden md:table-cell",children:"Médico"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden lg:table-cell",children:"Consulta"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden lg:table-cell",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Acciones"})]})}),e.jsx("tbody",{children:D.map($=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-purple-50/50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:["#",$.id]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"font-medium",children:[$.paciente_nombre," ",$.paciente_apellido]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:$.consulta_id?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 border border-blue-200",children:"Médico"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-pink-100 text-pink-800 border border-pink-200",children:"Particular"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden md:table-cell",children:$.medico_nombre}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden lg:table-cell",children:$.consulta_id}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden lg:table-cell",children:H($.fecha)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${$.estado==="completado"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,children:$.estado==="completado"?"✅ Completado":"⏳ Pendiente"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>s($),className:"inline-flex items-center px-3 py-1.5 bg-gradient-to-r from-purple-500 to-indigo-500 text-white text-xs font-medium rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-all transform hover:scale-105 shadow-md",title:$.estado==="completado"?"Editar resultado":"Llenar resultados",children:$.estado==="completado"?"✏️ Editar":"📝 Procesar"})})})]},$.id))})]})})}),i==="cards"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:D.map($=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6 hover:shadow-xl transition-all transform hover:scale-105",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"🧪"}),e.jsxs("span",{className:"font-bold text-gray-900",children:["#",$.id]})]}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${$.estado==="completado"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,children:$.estado==="completado"?"✅":"⏳"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Paciente"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[$.paciente_nombre," ",$.paciente_apellido]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Médico"}),e.jsx("p",{className:"text-sm text-gray-700",children:$.medico_nombre||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Consulta"}),e.jsx("p",{className:"text-sm text-gray-700",children:$.consulta_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Fecha"}),e.jsx("p",{className:"text-sm text-gray-700",children:H($.fecha)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Exámenes"}),e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:O($.examenes)})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>s($),className:"flex-1 bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-2.5 px-4 rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-all font-medium text-sm shadow-md hover:shadow-lg transform hover:scale-105",children:$.estado==="completado"?"✏️ Editar Resultado":"📝 Procesar Orden"})})})]},$.id))})]})]})}function pt({orden:s,onVolver:i,onGuardado:r}){const[x,p]=t.useState([]),[C,w]=t.useState({}),[h,N]=t.useState(!1),[g,v]=t.useState(""),[y,o]=t.useState("success");t.useEffect(()=>{fetch(I+"api_examenes_laboratorio.php",{credentials:"include"}).then(a=>a.json()).then(a=>p(a.examenes||[]))},[]),t.useEffect(()=>{if(!(!x||x.length===0))if(s.resultados&&typeof s.resultados=="object")w({...s.resultados});else{const a={};let n=[];if(typeof s.examenes=="string")try{n=JSON.parse(s.examenes)}catch{n=s.examenes.split(",").map(d=>d.trim()).filter(d=>d)}else Array.isArray(s.examenes)?n=s.examenes:s.examenes&&(n=[s.examenes]);n.forEach(d=>{const l=typeof d=="object"?d.id:d,k=x.find(M=>M.id==l);k&&Array.isArray(k.valores_referenciales)&&k.valores_referenciales.length>0?k.valores_referenciales.forEach(M=>{(M.tipo===void 0||M.tipo==="Parámetro")&&M.nombre&&M.nombre.trim()!==""&&(a[`${l}__${M.nombre}`]="")}):a[`${l}`]=""}),w(a)}},[s,x]);function E(a,n){if(!a)return"";let d=a;Object.keys(n).sort((k,M)=>M.length-k.length).forEach(k=>{const M=n[k]||0,m=new RegExp(k.replace(/[.*+?^${}()|[\]\\]/g,"$&"),"g");d=d.replace(m,M===""?0:M)});try{const k=Ue(d);return typeof k=="number"&&!isNaN(k)?k.toFixed(1):k}catch{return""}}const S=a=>{const n={...C,[a.target.name]:a.target.value};w(n)},c=async a=>{a.preventDefault(),N(!0),v("");try{const n={...C};let d=[];if(typeof s.examenes=="string")try{d=JSON.parse(s.examenes)}catch{d=s.examenes.split(",").map(m=>m.trim()).filter(m=>m)}else Array.isArray(s.examenes)?d=s.examenes:s.examenes&&(d=[s.examenes]);d.forEach(m=>{const b=typeof m=="object"?m.id:m,j=x.find(D=>D.id==b);if(!j||!Array.isArray(j.valores_referenciales))return;const P={};j.valores_referenciales.forEach(D=>{(D.tipo===void 0||D.tipo==="Parámetro")&&D.nombre&&D.nombre.trim()!==""&&(P[D.nombre]=n[`${b}__${D.nombre}`]||"")}),j.valores_referenciales.forEach(D=>{if((D.tipo===void 0||D.tipo==="Parámetro")&&D.nombre&&D.nombre.trim()!==""&&D.formula&&D.formula.trim()!==""){const O=E(D.formula,P);P[D.nombre]=O??"",n[`${b}__${D.nombre}`]=O??""}})});const l=s.consulta_id?s.consulta_id:s.id,M=await(await fetch(I+"api_resultados_laboratorio.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:l,tipo_examen:"varios",resultados:n})})).json();M.success?(v("✅ Resultados guardados correctamente"),o("success"),setTimeout(()=>{r&&r()},1e3)):(v("❌ "+(M.error||"Error al guardar")),o("error"))}catch{v("❌ Error de conexión"),o("error")}finally{N(!1)}},u=(a,n)=>{let d=!1,l=null,k=null;!isNaN(parseFloat(a.min))&&a.min!==null&&a.min!==""?l=parseFloat(a.min):a.referencias&&a.referencias[0]&&!isNaN(parseFloat(a.referencias[0].valor_min))&&(l=parseFloat(a.referencias[0].valor_min)),!isNaN(parseFloat(a.max))&&a.max!==null&&a.max!==""?k=parseFloat(a.max):a.referencias&&a.referencias[0]&&!isNaN(parseFloat(a.referencias[0].valor_max))&&(k=parseFloat(a.referencias[0].valor_max));let M=parseFloat(n);return isNaN(M)||(l!==null&&M<l&&(d=!0),k!==null&&M>k&&(d=!0)),{fueraDeRango:d,min:l,max:k}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-2xl",children:"📊"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Procesar Resultados de Laboratorio"}),e.jsx("p",{className:"text-purple-100",children:"Complete los valores para cada examen solicitado"})]})]})}),e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6",children:e.jsx("div",{className:"max-h-[600px] overflow-y-auto space-y-6",children:(()=>{let a=[];if(typeof s.examenes=="string")try{a=JSON.parse(s.examenes)}catch{a=s.examenes.split(",").map(n=>n.trim()).filter(n=>n)}else Array.isArray(s.examenes)?a=s.examenes:s.examenes&&(a=[s.examenes]);return a.map(n=>{const d=typeof n=="object"?n.id:n,l=x.find(k=>k.id==d);if(l&&Array.isArray(l.valores_referenciales)&&l.valores_referenciales.length>0){const k={};return l.valores_referenciales.forEach(M=>{(M.tipo===void 0||M.tipo==="Parámetro")&&M.nombre&&M.nombre.trim()!==""&&(k[M.nombre]=C[`${d}__${M.nombre}`]||"")}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-4 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"🧪"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:l.nombre}),e.jsx("p",{className:"text-sm text-gray-600",children:"Complete todos los parámetros requeridos"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:l.valores_referenciales.map(M=>{if((M.tipo===void 0||M.tipo==="Parámetro")&&M.nombre&&M.nombre.trim()!==""){const m=M.formula&&M.formula.trim()!=="";let b=C[`${d}__${M.nombre}`]||"";m&&(b=E(M.formula,k)),typeof b=="number"&&isNaN(b)&&(b=""),b==null&&(b="");const{fueraDeRango:j,min:P,max:D}=u(M,b);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{children:M.nombre}),m&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"🧮 Calculado"})]}),m&&e.jsxs("span",{className:"text-xs text-blue-600 font-normal",children:["Fórmula: ",M.formula]}),(P!==null||D!==null)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Rango de referencia: ",P!==null?`${P}`:"∞"," - ",D!==null?`${D}`:"∞"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:`${d}__${M.nombre}`,value:b,onChange:m?void 0:S,readOnly:m,required:!0,className:`w-full px-4 py-3 border-2 rounded-lg transition-all duration-200 ${j?"border-red-400 bg-red-50 text-red-700 font-semibold focus:ring-2 focus:ring-red-500":m?"border-blue-200 bg-blue-50 text-blue-800 cursor-not-allowed":"border-gray-300 bg-white hover:border-purple-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:m?"Valor calculado automáticamente":"Ingrese el valor"}),b&&!m&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:j?e.jsx("span",{className:"text-red-500 font-bold",children:"⚠️"}):e.jsx("span",{className:"text-green-500 font-bold",children:"✓"})})]}),j&&(P!==null||D!==null)&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-600 font-medium bg-red-50 px-2 py-1 rounded-md",children:[e.jsx("span",{children:"⚠️"}),e.jsx("span",{children:"Valor fuera del rango de referencia"})]})]},M.nombre)}return null})})]},d)}else if(l)return e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"🧪"}),e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:l.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Resultado del examen"}),e.jsx("textarea",{name:`${d}`,value:C[`${d}`]||"",onChange:S,rows:4,required:!0,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200",placeholder:"Ingrese el resultado completo del examen..."})]})]},d);return null})})()})}),"        ",e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e.jsx("button",{type:"button",onClick:i,className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium border border-gray-300",children:"← Cancelar"}),e.jsx("button",{type:"submit",disabled:h,className:"px-8 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:h?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Guardando..."]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"💾"}),"Guardar Resultados"]})})]}),g&&e.jsx("div",{className:`p-4 rounded-lg border ${y==="success"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:e.jsx("div",{className:"flex items-center gap-2 font-medium",children:g})})]})]})}function gt(){const[s,i]=t.useState("ordenes"),[r,x]=t.useState(null),[p,C]=t.useState(0),[w,h]=t.useState([]);t.useEffect(()=>{fetch(I+"api_examenes_laboratorio.php",{credentials:"include"}).then(o=>o.json()).then(o=>h(o.examenes||[]))},[]);const N=async o=>{if(o.estado==="completado"){const E=o.consulta_id?o.consulta_id:o.id,c=await(await fetch(I+`api_get_resultados_laboratorio.php?orden_id=${E}`)).json();if(c.success&&c.resultado){x({...o,resultados:c.resultado.resultados}),i("procesar");return}}x(o),i("procesar")},g=()=>{x(null),C(o=>o+1),i("ordenes")},v=o=>{if(!o)return"";let E;if(typeof o=="string")try{E=JSON.parse(o)}catch{E=o.split(",").map(S=>S.trim()).filter(S=>S)}else if(Array.isArray(o))E=o;else return o.toString();return Array.isArray(E)?E.map(S=>{if(typeof S=="object"&&S.nombre)return S.nombre;const c=w.find(u=>u.id==S);return c?c.nombre:S}).join(", "):""},y=[{id:"ordenes",label:"Órdenes de Laboratorio",icon:"🧪",color:"from-purple-600 to-indigo-600"},{id:"procesar",label:"Procesar Resultados",icon:"📊",color:"from-blue-600 to-cyan-600",disabled:!r}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-indigo-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 text-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-2xl",children:"🔬"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Panel de Laboratorio"}),e.jsx("p",{className:"text-purple-100",children:"Gestión de órdenes y resultados de laboratorio"})]})]}),e.jsx("div",{className:"flex gap-1 bg-white/10 backdrop-blur-sm rounded-lg p-1",children:y.map(o=>e.jsxs("button",{onClick:()=>!o.disabled&&i(o.id),disabled:o.disabled,className:`flex items-center gap-2 px-4 py-2 rounded-md transition-all duration-200 text-sm font-medium ${s===o.id?"bg-white text-purple-600 shadow-lg":o.disabled?"text-purple-200 cursor-not-allowed opacity-50":"text-white hover:bg-white/20"}`,children:[e.jsx("span",{className:"text-lg",children:o.icon}),e.jsx("span",{className:"hidden sm:inline",children:o.label})]},o.id))})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[s==="ordenes"&&e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl shadow-xl border border-white/20",children:e.jsx(ut,{onSeleccionarOrden:N},p)}),s==="procesar"&&r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:g,className:"flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-sm rounded-lg shadow-md hover:bg-white transition-colors border border-white/20 text-gray-700 hover:text-gray-900",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Volver a órdenes"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Orden"}),e.jsxs("div",{className:"text-xl font-bold",children:["#",r.id]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Paciente"}),e.jsxs("div",{className:"text-xl font-bold",children:[r.paciente_nombre," ",r.paciente_apellido]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Consulta ID"}),e.jsx("div",{className:"text-xl font-bold",children:r.consulta_id})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Estado"}),e.jsx("div",{className:`text-xl font-bold ${r.estado==="completado"?"text-green-300":"text-yellow-300"}`,children:r.estado==="completado"?"Completado":"Pendiente"})]})]}),e.jsxs("div",{className:"mt-4 bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm mb-2",children:"Exámenes solicitados"}),e.jsx("div",{className:"text-lg",children:v(r.examenes)})]})]}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl shadow-xl border border-white/20 p-6",children:e.jsx(pt,{orden:r,onVolver:g,onGuardado:g})})]})]})]})}function bt(){const{consultaId:s}=de(),[i,r]=t.useState([]),[x,p]=t.useState([]),[C,w]=t.useState(!0),[h,N]=t.useState("");t.useEffect(()=>{w(!0),Promise.all([fetch(`${I}api_resultados_laboratorio.php?consulta_id=${s}`).then(c=>c.json()),fetch(`${I}api_examenes_laboratorio.php`,{credentials:"include"}).then(c=>c.json())]).then(([c,u])=>{c.success?r(c.resultados||[]):N(c.error||"No hay resultados"),p(u.examenes||[]),w(!1)}).catch(()=>{N("Error al cargar resultados"),w(!1)})},[s]);const g={},v={},y={};for(const c of x)g[c.id]=c.nombre,v[c.id]=c.unidad||"",y[c.id]=Array.isArray(c.valores_referenciales)?c.valores_referenciales:[];function o(c,u=null){if(!Array.isArray(c)||c.length===0)return null;if(u){const a=c.find(n=>n.nombre===u);if(a)return a}return c.find(a=>!a.desc||a.desc.toLowerCase()==="general")||c[0]}function E(c){let u=null,a=null;if(!c)return{min:u,max:a};if(Array.isArray(c.referencias)&&c.referencias.length>0){const n=c.referencias[0];isNaN(parseFloat(n.valor_min))||(u=parseFloat(n.valor_min)),isNaN(parseFloat(n.valor_max))||(a=parseFloat(n.valor_max))}return u===null&&!isNaN(parseFloat(c.valor_min))&&c.valor_min!==null&&c.valor_min!==""?u=parseFloat(c.valor_min):u===null&&c.min!==void 0&&!isNaN(parseFloat(c.min))&&(u=parseFloat(c.min)),a===null&&!isNaN(parseFloat(c.valor_max))&&c.valor_max!==null&&c.valor_max!==""?a=parseFloat(c.valor_max):a===null&&c.max!==void 0&&!isNaN(parseFloat(c.max))&&(a=parseFloat(c.max)),{min:u,max:a}}function S(c,u){if(!u||c==null||c==="")return!1;const{min:a,max:n}=E(u),d=parseFloat(c);return isNaN(d)?!1:a!==null&&d<a||n!==null&&d>n}return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-white rounded-xl shadow-xl mt-6",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("h2",{className:"text-3xl font-bold text-green-800",children:"📋 Resultados de Laboratorio"})]}),e.jsx("p",{className:"text-green-600",children:"Reporte completo de los análisis médicos"})]}),e.jsxs(te,{to:-1,className:"mb-6 inline-flex items-center gap-2 px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg font-medium transition-colors duration-200 hover:scale-105",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"⬅️ Volver"]}),C?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando resultados..."})]}):h?e.jsx("div",{className:"p-6 text-red-600 bg-red-50 border border-red-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),h]})}):i.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("p",{className:"text-gray-500 text-lg",children:"No hay resultados registrados para esta consulta."})]}):e.jsx("div",{className:"space-y-6",children:i.map((c,u)=>e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-green-200",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-4 8v4m-4-4h8m-8-4h8a2 2 0 002-2V7a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})}),e.jsxs("span",{className:"text-sm font-bold text-green-800",children:["📅 Fecha del Análisis: ",new Date(c.fecha).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),c.resultados&&typeof c.resultados=="object"?e.jsx("div",{children:(()=>{const a={};return Object.entries(c.resultados).forEach(([n,d])=>{let l=n,k=null;n.includes("__")&&([l,k]=n.split("__")),a[l]||(a[l]=[]),a[l].push({nombreParam:k,val:d,ex:n})}),Object.entries(a).map(([n,d])=>{const l=g[n]||n;return e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-semibold text-base mb-1",children:l}),e.jsx("ul",{className:"list-disc ml-5",children:d.map(({nombreParam:k,val:M,ex:m})=>{const b=y[n]||[],j=o(b,k),P=v[n]?` ${v[n]}`:"",{min:D,max:O}=E(j),H=j&&S(M,j);return e.jsxs("li",{children:[e.jsxs("b",{children:[k||l,":"]})," ",e.jsxs("span",{className:H?"text-red-600 font-bold":"",children:[M,P]}),(D!==null||O!==null)&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["[",D!==null?`min: ${D}`:"",D!==null&&O!==null?", ":"",O!==null?`max: ${O}`:"","]"]}),H&&(D!==null||O!==null)&&e.jsx("span",{className:"text-xs text-red-600 ml-1 font-semibold",children:"Fuera de rango"})]},m)})})]},n)})})()}):e.jsx("div",{children:JSON.stringify(c.resultados)})]},u))})]})}function ft(){return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-center text-gray-800",children:"Módulo de Contabilidad"}),e.jsx("p",{className:"text-center text-gray-600",children:"Gestión de ingresos y egresos por área"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6",children:[e.jsxs(te,{to:"/contabilidad/ingresos",className:"bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-8 text-center font-semibold shadow-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105",children:[e.jsx(me,{className:"text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Ingresos"}),e.jsx("p",{className:"text-green-100",children:"Registro de ingresos por área y servicio"})]}),e.jsxs(te,{to:"/contabilidad/egresos",className:"bg-gradient-to-br from-red-500 to-red-600 text-white rounded-xl p-8 text-center font-semibold shadow-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105",children:[e.jsx(Ge,{className:"text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Egresos"}),e.jsx("p",{className:"text-red-100",children:"Registro de gastos y egresos operativos"})]}),e.jsxs(te,{to:"/contabilidad/reportes",className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-8 text-center font-semibold shadow-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105",children:[e.jsx(ve,{className:"text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Reportes Financieros"}),e.jsx("p",{className:"text-blue-100",children:"Análisis y reportes contables"})]}),e.jsxs(te,{to:"/contabilidad/balance",className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl p-8 text-center font-semibold shadow-lg hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-105",children:[e.jsx(Ae,{className:"text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Balance General"}),e.jsx("p",{className:"text-purple-100",children:"Estado financiero consolidado"})]})]}),e.jsxs("div",{className:"mt-8 bg-gray-50 rounded-lg p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-3",children:"¿Qué puedes hacer aquí?"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-green-700 mb-2",children:"📈 Ingresos:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Registro de consultas médicas"}),e.jsx("li",{children:"• Ingresos por laboratorio"}),e.jsx("li",{children:"• Ventas de farmacia"}),e.jsx("li",{children:"• Procedimientos médicos"})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-red-700 mb-2",children:"📉 Egresos:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Gastos operativos"}),e.jsx("li",{children:"• Compra de medicamentos"}),e.jsx("li",{children:"• Gastos administrativos"}),e.jsx("li",{children:"• Servicios y suministros"})]})]})]})]})]})}function jt({cajaActual:s,resumenHoy:i,onActualizar:r}){const x=ie(),[p,C]=t.useState([]),[w,h]=t.useState([]),[N,g]=t.useState(!1),[v,y]=t.useState(!1);t.useEffect(()=>{o()},[s]);const o=async()=>{try{g(!0);const n=await(await fetch(`${I}api_detalle_ingresos_hoy.php`,{credentials:"include"})).json();n.success&&(C(n.ultimas_transacciones||[]),h(n.ingresos_por_area||[]))}catch(a){console.error("Error cargando detalles:",a)}finally{g(!1)}},E=a=>a||"--:--",S=a=>`S/ ${parseFloat(a||0).toFixed(2)}`,c=a=>({consulta:"bg-blue-100 text-blue-800",laboratorio:"bg-yellow-100 text-yellow-800",farmacia:"bg-purple-100 text-purple-800",ecografia:"bg-green-100 text-green-800",rayosx:"bg-red-100 text-red-800",procedimiento:"bg-gray-100 text-gray-800",otros:"bg-indigo-100 text-indigo-800"})[a]||"bg-gray-100 text-gray-800",u=a=>({efectivo:"💵",tarjeta_debito:"💳",tarjeta_credito:"💳",transferencia:"🏦",yape:"📱",plin:"📱",otros:"💰"})[a]||"💰";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-green-600 rounded-full flex items-center justify-center",children:e.jsx(me,{className:"text-lg md:text-2xl text-white"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 md:w-6 md:h-6 bg-green-400 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 md:w-3 md:h-3 bg-white rounded-full animate-pulse"})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-green-700",children:"Caja Abierta"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 md:gap-6 text-green-600 mt-1 text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{}),e.jsxs("span",{children:["Abierta desde: ",s.hora_apertura]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{}),e.jsxs("span",{children:["Inicial: ",S(s.monto_apertura)]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{}),e.jsx("span",{children:new Date().toLocaleDateString("es-PE")})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsxs("button",{onClick:()=>{r(),o()},className:"bg-green-100 text-green-700 px-3 py-2 md:px-4 md:py-2 rounded-lg font-semibold hover:bg-green-200 transition-all flex items-center gap-1 md:gap-2 text-xs md:text-sm",disabled:N,children:[e.jsx(Xe,{className:`${N?"animate-spin":""} text-sm`}),e.jsx("span",{className:"hidden sm:inline",children:"Actualizar"})]}),e.jsxs("button",{onClick:()=>x("/contabilidad/cierre-caja"),className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-3 py-2 md:px-6 md:py-2 rounded-lg font-semibold hover:from-red-600 hover:to-red-700 transition-all flex items-center gap-1 md:gap-2 text-xs md:text-sm",children:[e.jsx(Oe,{className:"text-sm"}),e.jsx("span",{className:"hidden sm:inline",children:"Cerrar Caja"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500 transform hover:scale-105 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium uppercase tracking-wide",children:"Efectivo"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:S(i?.total_efectivo)}),e.jsx("p",{className:"text-green-500 text-sm mt-1",children:"💵 En caja física"})]}),e.jsx("div",{className:"text-5xl text-green-500 opacity-20",children:"💵"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500 transform hover:scale-105 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium uppercase tracking-wide",children:"Tarjetas"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:S(i?.total_tarjetas)}),e.jsx("p",{className:"text-blue-500 text-sm mt-1",children:"💳 Débito/Crédito"})]}),e.jsx("div",{className:"text-5xl text-blue-500 opacity-20",children:"💳"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500 transform hover:scale-105 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium uppercase tracking-wide",children:"Digital"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600 mt-2",children:S(i?.total_transferencias)}),e.jsx("p",{className:"text-purple-500 text-sm mt-1",children:"📱 Yape/Plin/Transfer"})]}),e.jsx("div",{className:"text-5xl text-purple-500 opacity-20",children:"📱"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500 transform hover:scale-105 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium uppercase tracking-wide",children:"Total del Día"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600 mt-2",children:S(i?.total_dia)}),e.jsx("p",{className:"text-yellow-500 text-sm mt-1",children:"📊 Todos los ingresos"})]}),e.jsx("div",{className:"text-5xl text-yellow-500 opacity-20",children:"📊"})]})})]}),w.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 h-96 dashboard-scroll-section",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ve,{className:"text-blue-600"}),"Ingresos por Área del Día"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[w.length," áreas activas"]})]}),e.jsx("div",{className:"overflow-y-auto h-72 pr-2",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map((a,n)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${c(a.tipo_ingreso)}`,children:a.tipo_ingreso.toUpperCase()}),e.jsx("span",{className:"text-lg font-bold text-gray-800",children:S(a.total_monto)})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:a.area}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ke,{}),a.cantidad_transacciones," trans."]})})]},n))})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 h-96 dashboard-scroll-section",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(he,{className:"text-purple-600"}),"Últimas Transacciones"]}),e.jsx("button",{onClick:()=>x("/contabilidad/ingresos-detalle"),className:"text-purple-600 hover:text-purple-800 font-semibold text-sm",children:"Ver todas →"})]}),p.length>0?e.jsx("div",{className:"overflow-y-auto h-72 pr-2",children:e.jsx("div",{className:"space-y-3",children:p.map((a,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:u(a.metodo_pago)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${c(a.tipo_ingreso)}`,children:a.tipo_ingreso}),e.jsx("span",{className:"text-sm text-gray-600",children:a.area})]}),e.jsx("p",{className:"text-sm text-gray-800 mt-1",children:a.descripcion}),a.paciente_nombre&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Paciente: ",a.paciente_nombre]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-green-600",children:S(a.monto)}),e.jsx("p",{className:"text-xs text-gray-500",children:E(a.hora)})]})]},n))})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(he,{className:"text-4xl mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No hay transacciones registradas hoy"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("button",{onClick:()=>x("/contabilidad/nuevo-ingreso"),className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-6 text-center font-semibold shadow-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105",children:[e.jsx(_e,{className:"text-3xl mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Registrar Ingreso"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Agregar nuevo ingreso manual"})]}),e.jsxs("button",{onClick:()=>x("/contabilidad/ingresos-detalle"),className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl p-6 text-center font-semibold shadow-lg hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-105",children:[e.jsx(he,{className:"text-3xl mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Ver Detalle Completo"}),e.jsx("p",{className:"text-purple-100 text-sm",children:"Historial completo del día"})]}),e.jsxs("button",{onClick:()=>x("/contabilidad/reportes-ingresos"),className:"bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-6 text-center font-semibold shadow-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105",children:[e.jsx(ve,{className:"text-3xl mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Reportes y Análisis"}),e.jsx("p",{className:"text-green-100 text-sm",children:"Análisis detallado de ingresos"})]})]})]})}function Nt(){const[s,i]=t.useState(!0),[r,x]=t.useState(null),[p,C]=t.useState(null),[w,h]=t.useState(null),N=ie(),[g,v]=t.useState(!1),[y,o]=t.useState(""),[E,S]=t.useState(""),[c,u]=t.useState(!1);t.useEffect(()=>{a()},[]);const a=async()=>{try{i(!0);const l=await(await fetch(`${I}api_auth_status.php`,{credentials:"include"})).json();if(!l.success||!l.authenticated){V.fire({icon:"warning",title:"Sesión expirada",text:"Debe iniciar sesión para acceder al módulo de ingresos",confirmButtonText:"Ir al Login"}).then(()=>{N("/")});return}C(l);const M=await(await fetch(`${I}api_caja_estado.php`,{credentials:"include"})).json();if(M.success){if(x(M.caja),M.caja){const b=await(await fetch(`${I}api_resumen_ingresos.php`,{credentials:"include"})).json();b.success&&h(b.resumen)}}else console.log("Estado de caja:",M.error)}catch(d){console.error("Error cargando datos:",d),V.fire({icon:"error",title:"Error de conexión",text:"No se pudo conectar con el servidor. Verifique su conexión.",confirmButtonText:"Reintentar"}).then(()=>{a()})}finally{i(!1)}},n=async()=>{if(!y||parseFloat(y)<0){V.fire("Error","Debe ingresar un monto válido","error");return}try{u(!0);const l=await(await fetch(`${I}api_caja_abrir.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({monto_apertura:parseFloat(y),observaciones:E})})).json();l.success?(V.fire("¡Éxito!","Caja abierta correctamente","success"),v(!1),o(""),S(""),a()):V.fire("Error",l.error||"Error al abrir caja","error")}catch(d){console.error("Error:",d),V.fire("Error","Error de conexión","error")}finally{u(!1)}};return s?e.jsx(ue,{}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"text-4xl text-green-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Módulo de Ingresos"}),e.jsx("p",{className:"text-gray-600",children:"Gestión de caja e ingresos diarios"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Be,{}),e.jsx("span",{children:new Date().toLocaleDateString("es-PE",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mt-1",children:[e.jsx(Re,{}),e.jsx("span",{children:p?.nombre})]})]})]})}),r?e.jsx(jt,{cajaActual:r,resumenHoy:w,onActualizar:a}):e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-orange-50 border-2 border-red-200 rounded-xl p-8 text-center",children:[e.jsx(je,{className:"text-6xl text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-red-700 mb-2",children:"Caja Cerrada"}),e.jsx("p",{className:"text-red-600 mb-6",children:"Debe abrir la caja para comenzar a registrar ingresos del día"}),e.jsxs("button",{onClick:()=>v(!0),className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 flex items-center gap-2 mx-auto",children:[e.jsx(ye,{}),"Abrir Caja"]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(ye,{className:"text-5xl text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Apertura de Caja"}),e.jsx("p",{className:"text-gray-600",children:"Ingrese los datos para abrir la caja del día"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Monto Inicial (Efectivo) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",step:"0.01",value:y,onChange:d=>o(d.target.value),className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"0.00",disabled:c})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Observaciones (Opcional)"}),e.jsx("textarea",{value:E,onChange:d=>S(d.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-none",rows:"3",placeholder:"Notas adicionales sobre la apertura...",disabled:c})]})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsx("button",{onClick:()=>v(!1),className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-all",disabled:c,children:"Cancelar"}),e.jsx("button",{onClick:n,className:"flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all disabled:opacity-50 flex items-center justify-center gap-2",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Abriendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{}),"Abrir Caja"]})})]})]})})]})}function vt(){const s=ie(),[i,r]=t.useState(!0),[x,p]=t.useState(!1),[C,w]=t.useState([]),[h,N]=t.useState([]),[g,v]=t.useState({tipo_ingreso:"",categoria_id:"",area_personalizada:"",descripcion:"",monto:"",metodo_pago:"",referencia:"",paciente_nombre:"",observaciones:""});t.useEffect(()=>{y()},[]);const y=async()=>{try{r(!0);const a=await(await fetch(`${I}api_categorias_ingresos.php`,{credentials:"include"})).json();a.success&&w(a.categorias);const d=await(await fetch(`${I}api_metodos_pago.php`,{credentials:"include"})).json();console.log("Métodos de pago cargados:",d),d.success?N(d.metodos):console.error("Error cargando métodos de pago:",d.error)}catch(u){console.error("Error cargando datos:",u),V.fire("Error","Error al cargar los datos iniciales","error")}finally{r(!1)}},o=u=>{const{name:a,value:n}=u.target;v(d=>({...d,[a]:n})),a==="tipo_ingreso"&&v(d=>({...d,categoria_id:"",area_personalizada:""}))},E=C.filter(u=>u.tipo_ingreso===g.tipo_ingreso),S=C.find(u=>u.id===parseInt(g.categoria_id)),c=async()=>{if(!g.tipo_ingreso){V.fire("Error","Debe seleccionar un tipo de ingreso","error");return}if(!g.descripcion.trim()){V.fire("Error","Debe ingresar una descripción","error");return}if(!g.monto||parseFloat(g.monto)<=0){V.fire("Error","Debe ingresar un monto válido","error");return}if(!g.metodo_pago){V.fire("Error","Debe seleccionar un método de pago","error");return}let u="";g.categoria_id&&S?u=S.nombre:g.area_personalizada.trim()?u=g.area_personalizada.trim():u="Otros servicios";try{p(!0);const n=await(await fetch(`${I}api_registrar_ingreso.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({tipo_ingreso:g.tipo_ingreso,area:u,descripcion:g.descripcion.trim(),monto:parseFloat(g.monto),metodo_pago:g.metodo_pago,referencia:g.referencia.trim(),paciente_nombre:g.paciente_nombre.trim(),observaciones:g.observaciones.trim()})})).json();n.success?V.fire({icon:"success",title:"¡Ingreso Registrado!",text:`Ingreso de S/ ${parseFloat(g.monto).toFixed(2)} registrado correctamente`,confirmButtonText:"Continuar"}).then(()=>{s("/contabilidad/ingresos")}):V.fire("Error",n.error||"Error al registrar ingreso","error")}catch(a){console.error("Error:",a),V.fire("Error","Error de conexión","error")}finally{p(!1)}};return i?e.jsx(ue,{}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>s("/contabilidad/ingresos"),className:"mb-4 bg-gradient-to-r from-gray-200 to-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:from-gray-300 hover:to-gray-400 flex items-center gap-2 font-semibold transition-all",children:[e.jsx(Se,{}),"Volver a Ingresos"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_e,{className:"text-4xl text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Registrar Nuevo Ingreso"}),e.jsx("p",{className:"text-gray-600",children:"Agregar ingreso manual al sistema de caja"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Tipo de Ingreso *"}),e.jsxs("select",{name:"tipo_ingreso",value:g.tipo_ingreso,onChange:o,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar tipo..."}),e.jsx("option",{value:"consulta",children:"Consulta Médica"}),e.jsx("option",{value:"laboratorio",children:"Laboratorio"}),e.jsx("option",{value:"farmacia",children:"Farmacia"}),e.jsx("option",{value:"ecografia",children:"Ecografía"}),e.jsx("option",{value:"rayosx",children:"Rayos X"}),e.jsx("option",{value:"procedimiento",children:"Procedimiento"}),e.jsx("option",{value:"otros",children:"Otros"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Categoría/Área"}),E.length>0?e.jsxs("select",{name:"categoria_id",value:g.categoria_id,onChange:o,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Seleccionar categoría..."}),E.map(u=>e.jsx("option",{value:u.id,children:u.nombre},u.id))]}):e.jsx("input",{type:"text",name:"area_personalizada",value:g.area_personalizada,onChange:o,placeholder:"Especificar área o servicio",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Descripción del Servicio *"}),e.jsx("input",{type:"text",name:"descripcion",value:g.descripcion,onChange:o,placeholder:"Ej: Consulta medicina general, Hemograma completo...",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Monto (S/) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",name:"monto",value:g.monto,onChange:o,step:"0.01",min:"0",placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Método de Pago *"}),e.jsxs("select",{name:"metodo_pago",value:g.metodo_pago,onChange:o,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar método..."}),h.length>0?h.map(u=>e.jsx("option",{value:u.codigo,children:u.nombre},u.codigo)):e.jsx("option",{value:"efectivo",children:"Efectivo (por defecto)"})]}),h.length===0&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:"No se pudieron cargar los métodos de pago. Revise la consola para más detalles."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Número de Referencia",g.metodo_pago!=="efectivo"&&g.metodo_pago!=="otros"&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"text",name:"referencia",value:g.referencia,onChange:o,placeholder:"Nº operación, voucher, etc.",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Nombre del Paciente"}),e.jsx("input",{type:"text",name:"paciente_nombre",value:g.paciente_nombre,onChange:o,placeholder:"Nombre completo del paciente",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Observaciones"}),e.jsx("textarea",{name:"observaciones",value:g.observaciones,onChange:o,rows:"3",placeholder:"Notas adicionales sobre este ingreso...",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"})]})]}),e.jsxs("div",{className:"flex gap-4 mt-8",children:[e.jsx("button",{onClick:()=>s("/contabilidad/ingresos"),className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-all",disabled:x,children:"Cancelar"}),e.jsx("button",{onClick:c,className:"flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition-all disabled:opacity-50 flex items-center justify-center gap-2",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{}),"Registrar Ingreso"]})})]})]})]})}function yt(){const s=ie(),[i,r]=Qe(),[x,p]=t.useState(!0),[C,w]=t.useState([]),[h,N]=t.useState(null),[g,v]=t.useState([]),[y,o]=t.useState([]),[E,S]=t.useState({total:0,pagina_actual:1,total_paginas:1}),[c,u]=t.useState({fecha:i.get("fecha")||new Date().toISOString().split("T")[0],tipo:i.get("tipo")||"",metodo:i.get("metodo")||""}),[a,n]=t.useState(1),d=20;t.useEffect(()=>{l()},[c,a]);const l=async()=>{try{p(!0);const P=new URLSearchParams({fecha:c.fecha,limite:d.toString(),offset:((a-1)*d).toString()});c.tipo&&P.append("tipo",c.tipo),c.metodo&&P.append("metodo",c.metodo);const O=await(await fetch(`${I}api_historial_ingresos.php?${P}`,{credentials:"include"})).json();O.success&&(w(O.ingresos),N(O.estadisticas),v(O.resumen_tipos),o(O.resumen_metodos),S(O.paginacion))}catch(P){console.error("Error cargando historial:",P)}finally{p(!1)}},k=(P,D)=>{const O={...c,[P]:D};u(O),n(1);const H=new URLSearchParams;O.fecha!==new Date().toISOString().split("T")[0]&&H.set("fecha",O.fecha),O.tipo&&H.set("tipo",O.tipo),O.metodo&&H.set("metodo",O.metodo),r(H)},M=P=>`S/ ${parseFloat(P||0).toFixed(2)}`,m=P=>P?new Date(P).toLocaleTimeString("es-PE",{hour:"2-digit",minute:"2-digit"}):"--:--",b=P=>({consulta:"bg-blue-100 text-blue-800",laboratorio:"bg-yellow-100 text-yellow-800",farmacia:"bg-purple-100 text-purple-800",ecografia:"bg-green-100 text-green-800",rayosx:"bg-red-100 text-red-800",procedimiento:"bg-gray-100 text-gray-800",otros:"bg-indigo-100 text-indigo-800"})[P]||"bg-gray-100 text-gray-800",j=P=>({efectivo:"💵",tarjeta_debito:"💳",tarjeta_credito:"💳",transferencia:"🏦",yape:"📱",plin:"📱",otros:"💰"})[P]||"💰";return x?e.jsx(ue,{}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>s("/contabilidad/ingresos"),className:"mb-4 bg-gradient-to-r from-gray-200 to-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:from-gray-300 hover:to-gray-400 flex items-center gap-2 font-semibold transition-all",children:[e.jsx(Se,{}),"Volver a Ingresos"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"text-4xl text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Historial de Ingresos"}),e.jsx("p",{className:"text-gray-600",children:"Registro detallado de todas las transacciones"})]})]})]}),h&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Transacciones"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:h.total_transacciones})]}),e.jsx(me,{className:"text-3xl text-blue-500 opacity-50"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Total Ingresos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:M(h.total_ingresos)})]}),e.jsx(ve,{className:"text-3xl text-green-500 opacity-50"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Tipos de Servicio"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:h.tipos_diferentes})]}),e.jsx(Ee,{className:"text-3xl text-purple-500 opacity-50"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Métodos de Pago"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:h.metodos_diferentes})]}),e.jsx(Be,{className:"text-3xl text-orange-500 opacity-50"})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ee,{className:"text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha"}),e.jsx("input",{type:"date",value:c.fecha,onChange:P=>k("fecha",P.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Servicio"}),e.jsxs("select",{value:c.tipo,onChange:P=>k("tipo",P.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:"consulta",children:"Consulta Médica"}),e.jsx("option",{value:"laboratorio",children:"Laboratorio"}),e.jsx("option",{value:"farmacia",children:"Farmacia"}),e.jsx("option",{value:"ecografia",children:"Ecografía"}),e.jsx("option",{value:"rayosx",children:"Rayos X"}),e.jsx("option",{value:"procedimiento",children:"Procedimiento"}),e.jsx("option",{value:"otros",children:"Otros"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Método de Pago"}),e.jsxs("select",{value:c.metodo,onChange:P=>k("metodo",P.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Todos los métodos"}),e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta_debito",children:"Tarjeta de Débito"}),e.jsx("option",{value:"tarjeta_credito",children:"Tarjeta de Crédito"}),e.jsx("option",{value:"transferencia",children:"Transferencia"}),e.jsx("option",{value:"yape",children:"Yape"}),e.jsx("option",{value:"plin",children:"Plin"}),e.jsx("option",{value:"otros",children:"Otros"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Transacciones (",E.total," registros)"]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2",children:[e.jsx(Ze,{}),"Exportar"]})]})}),C.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(he,{className:"text-4xl mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No se encontraron ingresos para los filtros seleccionados"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hora"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paciente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Método Pago"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuario"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:C.map(P=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:m(P.fecha_registro)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${b(P.tipo_ingreso)}`,children:P.tipo_ingreso})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:P.descripcion}),P.area&&e.jsx("div",{className:"text-xs text-gray-500",children:P.area})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:P.paciente_nombre||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:j(P.metodo_pago)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:P.metodo_pago.replace("_"," ")}),P.referencia_pago&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Ref: ",P.referencia_pago]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-lg font-bold text-green-600",children:M(P.monto)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:P.usuario_nombre})]})})]},P.id))})]})}),E.total_paginas>1&&e.jsx("div",{className:"px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",(a-1)*d+1," - ",Math.min(a*d,E.total)," de ",E.total," registros"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(Math.max(1,a-1)),disabled:a===1,className:"px-3 py-1 border rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(es,{})}),e.jsxs("span",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:[a," / ",E.total_paginas]}),e.jsx("button",{onClick:()=>n(Math.min(E.total_paginas,a+1)),disabled:a===E.total_paginas,className:"px-3 py-1 border rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(ss,{})})]})]})})]})]})}function wt(){const s=ie(),[i,r]=t.useState(!0),[x,p]=t.useState(!1),[C,w]=t.useState(null),[h,N]=t.useState(null),[g,v]=t.useState([]),[y,o]=t.useState({efectivo_contado:"",tarjetas_contado:"",transferencias_contado:"",otros_contado:""}),[E,S]=t.useState("");t.useEffect(()=>{c()},[]);const c=async()=>{try{r(!0);const k=await(await fetch(`${I}api_caja_actual.php`,{credentials:"include"})).json();if(!k.success||!k.caja){V.fire({icon:"warning",title:"No hay caja abierta",text:"No se puede realizar el cierre porque no hay una caja abierta",confirmButtonText:"Volver a Ingresos"}).then(()=>{s("/contabilidad/ingresos")});return}w(k.caja);const m=await(await fetch(`${I}api_resumen_ingresos.php?caja_id=${k.caja.id}`,{credentials:"include"})).json();m.success&&N(m.resumen);const j=await(await fetch(`${I}api_ingresos_detalle.php?caja_id=${k.caja.id}`,{credentials:"include"})).json();j.success&&v(j.ingresos||[])}catch(l){console.error("Error cargando datos:",l),V.fire("Error","Error al cargar los datos del cierre","error")}finally{r(!1)}},u=l=>{const{name:k,value:M}=l.target;o(m=>({...m,[k]:M}))},a=()=>{if(!h)return{};const l={},k=parseFloat(h.total_efectivo||0),M=parseFloat(h.total_tarjetas||0),m=parseFloat(h.total_transferencias||0),b=parseFloat(h.total_otros||0);return l.efectivo=parseFloat(y.efectivo_contado||0)-k,l.tarjetas=parseFloat(y.tarjetas_contado||0)-M,l.transferencias=parseFloat(y.transferencias_contado||0)-m,l.otros=parseFloat(y.otros_contado||0)-b,l.total=l.efectivo+l.tarjetas+l.transferencias+l.otros,l},n=async()=>{if(!y.efectivo_contado){V.fire("Error","Debe ingresar el monto de efectivo contado","error");return}const l=a();if((await V.fire({title:"Confirmar Cierre de Caja",html:`
        <div class="text-left">
          <p><strong>Fecha:</strong> ${C?.fecha}</p>
          <p><strong>Usuario:</strong> ${C?.usuario_nombre}</p>
          <br>
          <p><strong>Resumen de diferencias:</strong></p>
          <ul>
            <li>Efectivo: S/ ${l.efectivo.toFixed(2)}</li>
            <li>Tarjetas: S/ ${l.tarjetas.toFixed(2)}</li>
            <li>Transferencias: S/ ${l.transferencias.toFixed(2)}</li>
            <li>Otros: S/ ${l.otros.toFixed(2)}</li>
          </ul>
          <p><strong>Diferencia Total: S/ ${l.total.toFixed(2)}</strong></p>
        </div>
      `,icon:Math.abs(l.total)>10?"warning":"question",showCancelButton:!0,confirmButtonText:"Confirmar Cierre",cancelButtonText:"Cancelar",confirmButtonColor:l.total<0?"#d33":"#3085d6"})).isConfirmed)try{p(!0);const m=await(await fetch(`${I}api_cerrar_caja.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({caja_id:C.id,efectivo_contado:parseFloat(y.efectivo_contado),tarjetas_contado:parseFloat(y.tarjetas_contado||0),transferencias_contado:parseFloat(y.transferencias_contado||0),otros_contado:parseFloat(y.otros_contado||0),observaciones:E.trim(),diferencias:l})})).json();m.success?V.fire({icon:"success",title:"¡Caja Cerrada Exitosamente!",html:`
            <div class="text-left">
              <p>La caja ha sido cerrada correctamente.</p>
              <p><strong>Diferencia final:</strong> S/ ${l.total.toFixed(2)}</p>
              <br>
              <p>Se ha generado el reporte de cierre.</p>
            </div>
          `,confirmButtonText:"Continuar"}).then(()=>{s("/contabilidad/ingresos")}):V.fire("Error",m.error||"Error al cerrar la caja","error")}catch(M){console.error("Error:",M),V.fire("Error","Error de conexión","error")}finally{p(!1)}};if(i)return e.jsx(ue,{});if(!C)return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"No hay caja abierta"}),e.jsx("button",{onClick:()=>s("/contabilidad/ingresos"),className:"bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600",children:"Volver a Ingresos"})]});const d=a();return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>s("/contabilidad/ingresos"),className:"mb-4 bg-gradient-to-r from-gray-200 to-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:from-gray-300 hover:to-gray-400 flex items-center gap-2 font-semibold transition-all",children:[e.jsx(Se,{}),"Volver a Ingresos"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(je,{className:"text-4xl text-red-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Cierre de Caja"}),e.jsx("p",{className:"text-gray-600",children:"Finalizar jornada y generar reporte de cierre"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-blue-800",children:"Fecha:"}),e.jsx("p",{className:"text-blue-700",children:C.fecha})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-blue-800",children:"Hora apertura:"}),e.jsx("p",{className:"text-blue-700",children:C.hora_apertura})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-blue-800",children:"Monto apertura:"}),e.jsxs("p",{className:"text-blue-700",children:["S/ ",parseFloat(C.monto_apertura||0).toFixed(2)]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-6 flex items-center gap-2",children:[e.jsx(Ae,{}),"Resumen del Sistema"]}),h&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"text-green-600"}),e.jsx("span",{className:"font-semibold",children:"Efectivo"})]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",parseFloat(h.total_efectivo||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"text-blue-600"}),e.jsx("span",{className:"font-semibold",children:"Tarjetas"})]}),e.jsxs("span",{className:"font-bold text-blue-700",children:["S/ ",parseFloat(h.total_tarjetas||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"text-purple-600"}),e.jsx("span",{className:"font-semibold",children:"Transferencias"})]}),e.jsxs("span",{className:"font-bold text-purple-700",children:["S/ ",parseFloat(h.total_transferencias||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"text-gray-600"}),e.jsx("span",{className:"font-semibold",children:"Otros"})]}),e.jsxs("span",{className:"font-bold text-gray-700",children:["S/ ",parseFloat(h.total_otros||0).toFixed(2)]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold",children:[e.jsx("span",{children:"Total del Sistema:"}),e.jsxs("span",{className:"text-blue-600",children:["S/ ",parseFloat(h.total_dia||0).toFixed(2)]})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-6",children:"Conteo Real"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Efectivo Contado *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",name:"efectivo_contado",value:y.efectivo_contado,onChange:u,step:"0.01",min:"0",placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),h&&y.efectivo_contado&&e.jsxs("div",{className:`text-sm mt-1 ${d.efectivo===0?"text-green-600":"text-red-600"}`,children:["Diferencia: S/ ",d.efectivo.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Tarjetas Reportadas"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",name:"tarjetas_contado",value:y.tarjetas_contado,onChange:u,step:"0.01",min:"0",placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),h&&y.tarjetas_contado&&e.jsxs("div",{className:`text-sm mt-1 ${d.tarjetas===0?"text-green-600":"text-red-600"}`,children:["Diferencia: S/ ",d.tarjetas.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Transferencias Confirmadas"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",name:"transferencias_contado",value:y.transferencias_contado,onChange:u,step:"0.01",min:"0",placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),h&&y.transferencias_contado&&e.jsxs("div",{className:`text-sm mt-1 ${d.transferencias===0?"text-green-600":"text-red-600"}`,children:["Diferencia: S/ ",d.transferencias.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Otros Métodos"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"S/"}),e.jsx("input",{type:"number",name:"otros_contado",value:y.otros_contado,onChange:u,step:"0.01",min:"0",placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),h&&y.otros_contado&&e.jsxs("div",{className:`text-sm mt-1 ${d.otros===0?"text-green-600":"text-red-600"}`,children:["Diferencia: S/ ",d.otros.toFixed(2)]})]}),h&&Object.values(y).some(l=>l)&&e.jsx("div",{className:`p-4 rounded-lg ${Math.abs(d.total)<=1?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"font-semibold",children:"Diferencia Total:"}),e.jsxs("div",{className:`text-2xl font-bold ${d.total>=0?"text-green-600":"text-red-600"}`,children:["S/ ",d.total.toFixed(2)]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Observaciones del Cierre"}),e.jsx("textarea",{value:E,onChange:l=>S(l.target.value),rows:"3",placeholder:"Notas sobre diferencias, incidencias, etc.",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"})]}),e.jsx("button",{onClick:n,disabled:!y.efectivo_contado||x,className:"w-full px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg font-semibold hover:from-red-600 hover:to-red-700 transition-all disabled:opacity-50 flex items-center justify-center gap-2 text-lg",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}),"Procesando Cierre..."]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{}),"Cerrar Caja"]})})]})]})]}),g.length>0&&e.jsxs("div",{className:"mt-8 bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Detalle de Ingresos del Día"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50",children:[e.jsx("th",{className:"text-left p-3",children:"Hora"}),e.jsx("th",{className:"text-left p-3",children:"Tipo"}),e.jsx("th",{className:"text-left p-3",children:"Área"}),e.jsx("th",{className:"text-left p-3",children:"Descripción"}),e.jsx("th",{className:"text-left p-3",children:"Método"}),e.jsx("th",{className:"text-right p-3",children:"Monto"})]})}),e.jsx("tbody",{children:g.map((l,k)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:new Date(l.fecha_hora).toLocaleTimeString("es-PE",{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"p-3 capitalize",children:l.tipo_ingreso}),e.jsx("td",{className:"p-3",children:l.area}),e.jsx("td",{className:"p-3",children:l.descripcion}),e.jsx("td",{className:"p-3 capitalize",children:l.metodo_pago}),e.jsxs("td",{className:"p-3 text-right font-semibold",children:["S/ ",parseFloat(l.monto).toFixed(2)]})]},k))})]})})]})]})}const Ct=()=>{const[s,i]=t.useState([]),[r,x]=t.useState([]),[p,C]=t.useState(!0),[w,h]=t.useState(!1),[N,g]=t.useState(!1),[v,y]=t.useState(null),[o,E]=t.useState("");t.useEffect(()=>{S()},[]);const S=async()=>{try{C(!0);const a=await fetch(I+"api_cajas_cerradas.php",{credentials:"include"});if(a.ok){const n=await a.json();n.success&&(i(n.cajas_cerradas),x(n.historial_reaperturas))}}catch(a){console.error("Error al cargar datos:",a)}finally{C(!1)}},c=a=>{y(a),E(""),g(!0)},u=async()=>{if(!o.trim()){alert("Por favor ingresa el motivo de la reapertura");return}try{h(!0);const n=await(await fetch(I+"api_reabrir_caja.php",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({caja_id:v.id,motivo:o.trim()})})).json();n.success?(alert(`✅ Caja ID ${v.id} reabierta exitosamente`),g(!1),y(null),E(""),S()):alert(`❌ Error: ${n.error}`)}catch(a){console.error("Error al reabrir caja:",a),alert("❌ Error de conexión")}finally{h(!1)}};return p?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando cajas cerradas..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("svg",{className:"w-8 h-8 mr-3 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})}),"Reabrir Cajas Cerradas"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Función exclusiva para administradores"})]}),e.jsx("div",{className:"bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium",children:"🔐 Solo Administradores"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Cajas Cerradas Recientes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Últimas 20 cajas cerradas"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"H. Cierre"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Monto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Diferencia"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"No hay cajas cerradas"})}):s.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:a.id}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:a.fecha}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:a.hora_cierre?a.hora_cierre.substr(0,8):"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:["S/ ",parseFloat(a.monto_cierre||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:`inline-flex px-2 py-1 text-xs rounded-full ${parseFloat(a.diferencia||0)===0?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:["S/ ",parseFloat(a.diferencia||0).toFixed(2)]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>c(a),className:"bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs font-medium transition-colors",children:"🔓 Reabrir"})})]},a.id))})]})})]})}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Historial de Reaperturas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Últimas 10 reaperturas"})]}),e.jsx("div",{className:"p-4 space-y-3",children:r.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No hay reaperturas registradas"}):r.map((a,n)=>e.jsx("div",{className:"border-l-4 border-yellow-400 pl-3 py-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Caja ID ",a.caja_id]}),e.jsx("p",{className:"text-xs text-gray-600",children:a.usuario_nombre}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a.motivo})]}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(a.fecha_reapertura).toLocaleString()})]})},n))})]})})]})]}),N&&v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("svg",{className:"w-8 h-8 text-yellow-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirmar Reapertura"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Caja ID:"})," ",v.id]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Fecha:"})," ",v.fecha]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Cerrada:"})," ",v.hora_cierre]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Monto:"})," S/ ",parseFloat(v.monto_cierre||0).toFixed(2)]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo de la reapertura *"}),e.jsx("textarea",{value:o,onChange:a=>E(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Describe el motivo de esta reapertura..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>g(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition-colors",disabled:w,children:"Cancelar"}),e.jsx("button",{onClick:u,disabled:w||!o.trim(),className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:opacity-50 transition-colors",children:w?"Reabriendo...":"🔓 Reabrir Caja"})]})]})})})]})};function kt(){const[s,i]=t.useState({nombre_clinica:"",direccion:"",telefono:"",email:"",horario_atencion:"",logo_url:"",website:"",ruc:"",especialidades:"",mision:"",vision:"",valores:"",director_general:"",jefe_enfermeria:"",contacto_emergencias:""}),[r,x]=t.useState(!1),[p,C]=t.useState(!0),[w,h]=t.useState(!1),[N,g]=t.useState("");t.useEffect(()=>{v()},[]);const v=async()=>{try{C(!0);const u=await fetch(I+"api_get_configuracion.php",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(u.ok){const a=await u.json();if(a.success)i(a.data),a.data&&a.data.logo_url&&g(a.data.logo_url);else throw new Error(a.error||"Error al cargar la configuración")}else if(u.status===401){const a=await u.json();throw new Error("🔒 Acceso denegado: "+(a.error||"No está autenticado como administrador"))}else{const a=await u.text();throw console.error("❌ Error del servidor:",a),new Error(`Error del servidor: ${u.status} - ${a}`)}}catch(u){console.error("🚨 Error al cargar configuración:",u),u.message.includes("🔒 Acceso denegado")?V.fire({title:"🔒 Acceso Denegado",text:"Necesita estar autenticado como administrador para ver la configuración.",icon:"warning",confirmButtonText:"Ir a Login",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(a=>{a.isConfirmed&&(window.location.href="/")}):V.fire({title:"Error",text:"No se pudo cargar la configuración: "+u.message,icon:"error",confirmButtonText:"OK"})}finally{C(!1)}},y=(u,a)=>{i(n=>({...n,[u]:a}))},o=async()=>{if(!s.nombre_clinica||!s.direccion||!s.telefono||!s.email){V.fire({title:"Error",text:"Por favor, complete todos los campos obligatorios.",icon:"error",confirmButtonText:"OK"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)){V.fire({title:"Error",text:"Por favor, ingrese un email válido.",icon:"error",confirmButtonText:"OK"});return}x(!0);try{const a=await fetch(I+"api_configuracion.php",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(a.ok){const n=await a.json();if(n.success)V.fire({title:"¡Configuración guardada!",text:n.message||"Los cambios se han aplicado exitosamente.",icon:"success",confirmButtonText:"OK"}),s.logo_url&&g(s.logo_url);else throw new Error(n.error||"Error al guardar la configuración")}else if(a.status===401){await a.json(),V.fire({title:"🔒 Acceso Denegado",text:"Necesita estar autenticado como administrador para modificar la configuración.",icon:"warning",confirmButtonText:"Ir a Login",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed&&(window.location.href="/")});return}else{const n=await a.text();throw console.error("❌ Error del servidor:",n),new Error(`Error del servidor: ${a.status} - ${n}`)}}catch(a){console.error("🚨 Error al guardar configuración:",a),V.fire({title:"Error",text:"No se pudo guardar la configuración: "+a.message,icon:"error",confirmButtonText:"OK"})}finally{x(!1)}},E=u=>{const a=u.target.files&&u.target.files[0];if(!a)return;const n=URL.createObjectURL(a);g(n),i(d=>({...d,_logo_file:a}))},S=async()=>{const u=s._logo_file;if(!u){V.fire({title:"Info",text:"Seleccione un archivo primero.",icon:"info"});return}h(!0);try{const a=new FormData;a.append("logo",u);const n=await fetch(I+"api_upload_logo.php",{method:"POST",credentials:"include",body:a}),d=await n.json();if(n.ok&&d.success)i(l=>({...l,logo_url:d.path,_logo_file:null})),g(d.path),V.fire({title:"Listo",text:"Logo subido correctamente.",icon:"success"});else throw new Error(d.error||"Error subiendo archivo")}catch(a){console.error("Error upload logo",a),V.fire({title:"Error",text:"No se pudo subir el logo: "+a.message,icon:"error"})}finally{h(!1)}},c=()=>{i(u=>({...u,logo_url:""})),g("")};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-blue-800",children:"⚙️ Configuración del Sistema"}),p?e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando configuración..."})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-800",children:"Información de la Clínica"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la Clínica *"}),e.jsx("input",{type:"text",value:s.nombre_clinica,onChange:u=>y("nombre_clinica",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Teléfono *"}),e.jsx("input",{type:"tel",value:s.telefono,onChange:u=>y("telefono",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",value:s.email,onChange:u=>y("email",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"RUC (opcional)"}),e.jsx("input",{type:"text",value:s.ruc||"",onChange:u=>y("ruc",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dirección *"}),e.jsx("input",{type:"text",value:s.direccion,onChange:u=>y("direccion",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Director General"}),e.jsx("input",{type:"text",value:s.director_general||"",onChange:u=>y("director_general",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Dr. Juan Pérez"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Jefe de Enfermería"}),e.jsx("input",{type:"text",value:s.jefe_enfermeria||"",onChange:u=>y("jefe_enfermeria",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enf. María González"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL del Logo (opcional) / Subir logo"}),e.jsx("input",{type:"url",value:s.logo_url||"",onChange:u=>y("logo_url",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2",placeholder:"https://ejemplo.com/logo.png"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:E,className:"text-sm"}),e.jsx("button",{type:"button",onClick:S,disabled:w,className:"bg-green-600 text-white px-3 py-1 rounded-md hover:bg-green-700 disabled:bg-gray-300 text-sm",children:w?"Subiendo...":"Subir Logo"}),e.jsx("button",{type:"button",onClick:c,className:"bg-red-100 text-red-700 px-3 py-1 rounded-md hover:bg-red-200 text-sm",children:"Eliminar"})]}),N?e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Vista previa:"}),e.jsx("img",{src:N.startsWith("http")?N:"/"+N.replace(/^\/+/,""),alt:"Logo preview",style:{maxHeight:96}})]}):null]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sitio Web (opcional)"}),e.jsx("input",{type:"url",value:s.website||"",onChange:u=>y("website",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://www.ejemplo.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contacto de Emergencias"}),e.jsx("input",{type:"tel",value:s.contacto_emergencias||"",onChange:u=>y("contacto_emergencias",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Emergencias 24h: +51 987-654-321"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Especialidades"}),e.jsx("textarea",{value:s.especialidades||"",onChange:u=>y("especialidades",u.target.value),rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Medicina General, Pediatría, Ginecología, Traumatología..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Horario de Atención"}),e.jsx("textarea",{value:s.horario_atencion||"",onChange:u=>y("horario_atencion",u.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Lunes a Viernes: 7:00 AM - 8:00 PM..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Misión Institucional"}),e.jsx("textarea",{value:s.mision||"",onChange:u=>y("mision",u.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brindar servicios de salud de calidad..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Visión Institucional"}),e.jsx("textarea",{value:s.vision||"",onChange:u=>y("vision",u.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ser el centro de salud de referencia..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valores Institucionales"}),e.jsx("textarea",{value:s.valores||"",onChange:u=>y("valores",u.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Compromiso, Excelencia, Humanización, Integridad..."})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"* Campos obligatorios"}),e.jsx("button",{onClick:o,disabled:r,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 font-medium transition-colors",children:r?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Guardando..."]}):"💾 Guardar Configuración"})]})})]}),e.jsxs("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"ℹ️ Información del Sistema"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Versión:"})," 1.0.0"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Base de datos:"})," MySQL"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Servidor web:"})," Apache (Laragon)"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Framework:"})," React + Vite"]})]})]})]})}function _t(){const[s,i]=t.useState([]),[r,x]=t.useState([]),[p,C]=t.useState(!0),[w,h]=t.useState(!1),[N,g]=t.useState(null),[v,y]=t.useState("todos"),[o,E]=t.useState(1),[S,c]=t.useState(5),u=[{value:"consulta",label:"Consultas Médicas"},{value:"rayosx",label:"Rayos X"},{value:"ecografia",label:"Ecografía"},{value:"ocupacional",label:"Medicina Ocupacional"},{value:"procedimientos",label:"Procedimientos Médicos"},{value:"cirugias",label:"Cirugías Menores"},{value:"tratamientos",label:"Tratamientos Especializados"},{value:"emergencias",label:"Emergencias"}],a=[...u],[n,d]=t.useState({servicio_tipo:"consulta",medico_id:"",descripcion_base:"",descripcion:"",precio_particular:"",precio_seguro:"",precio_convenio:"",activo:1});t.useEffect(()=>{M(),l()},[]);const l=async()=>{try{const J=await(await fetch(`${I}api_medicos.php`)).json();if(J.success){const F=(J.medicos||[]).map(_=>({..._,id:parseInt(_.id)}));x(F)}}catch(L){console.error("Error al cargar médicos:",L)}},k=t.useCallback((L,J)=>{if(!L||L==="general"||L==="")return J||"Consulta General";const F=r.find(_=>_.id===parseInt(L));if(F){const _=F.nombre,T=F.especialidad?` - ${F.especialidad}`:"";return`${_}${T} - ${J||"Consulta"}`}return J||"Consulta"},[r]),M=async()=>{try{C(!0);const J=await(await fetch(`${I}api_tarifas.php`,{credentials:"include"})).json();J.success?i(J.tarifas||[]):console.error("Error al cargar tarifas:",J.error)}catch(L){console.error("Error:",L),V.fire("Error","Error de conexión al cargar tarifas","error")}finally{C(!1)}},m=(L=null)=>{if(L&&(L.fuente==="medicamentos"||L.fuente==="examenes_laboratorio")){V.fire({title:"No Editable",text:L.fuente==="medicamentos"?"Los precios de medicamentos se gestionan desde el módulo de farmacia.":"Los precios de exámenes se gestionan desde el módulo de laboratorio.",icon:"info",confirmButtonText:"Entendido"});return}if(L){g(L);const J=L.descripcion;let F="general",_=J;const T=r.find(R=>J.includes(R.nombre));if(T){F=T.id.toString();const R=new RegExp(`^${T.nombre}(\\s*-\\s*${T.especialidad})?\\s*-\\s*`,"i");_=J.replace(R,"").trim()}d({servicio_tipo:L.servicio_tipo,medico_id:F,descripcion_base:_,descripcion:J,precio_particular:L.precio_particular,precio_seguro:L.precio_seguro||"",precio_convenio:L.precio_convenio||"",activo:L.activo})}else g(null),d({servicio_tipo:"consulta",medico_id:"general",descripcion_base:"",descripcion:"",precio_particular:"",precio_seguro:"",precio_convenio:"",activo:1});h(!0)},b=()=>{h(!1),g(null),d({servicio_tipo:"consulta",medico_id:"general",descripcion_base:"",descripcion:"",precio_particular:"",precio_seguro:"",precio_convenio:"",activo:1})},j=async()=>{if(!n.descripcion.trim()){V.fire("Error","La descripción es obligatoria","error");return}if(!n.precio_particular||parseFloat(n.precio_particular)<=0){V.fire("Error","El precio particular debe ser mayor a 0","error");return}try{const L=N?`${I}api_tarifas.php`:`${I}api_tarifas.php`,J=N?"PUT":"POST",F=N?{...n,id:N.id}:n,T=await(await fetch(L,{method:J,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(F)})).json();T.success?(V.fire({title:"¡Éxito!",text:N?"Tarifa actualizada correctamente":"Tarifa creada correctamente",icon:"success",confirmButtonText:"OK"}),b(),M()):V.fire("Error",T.error||"Error al guardar la tarifa","error")}catch(L){console.error("Error:",L),V.fire("Error","Error de conexión","error")}},P=async(L,J)=>{if(typeof L=="string"&&(L.startsWith("med_")||L.startsWith("lab_"))){V.fire({title:"No Eliminable",text:L.startsWith("med_")?"Los medicamentos se eliminan desde el módulo de farmacia.":"Los exámenes se eliminan desde el módulo de laboratorio.",icon:"info",confirmButtonText:"Entendido"});return}if((await V.fire({title:"¿Estás seguro?",text:`¿Deseas eliminar la tarifa "${J}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33"})).isConfirmed)try{const T=await(await fetch(`${I}api_tarifas.php`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:L})})).json();T.success?(V.fire("¡Eliminado!","La tarifa ha sido eliminada","success"),M()):V.fire("Error",T.error||"Error al eliminar la tarifa","error")}catch(_){console.error("Error:",_),V.fire("Error","Error de conexión","error")}},D=async(L,J)=>{try{const _=await(await fetch(`${I}api_tarifas.php`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:L,activo:J})})).json();_.success?M():V.fire("Error",_.error||"Error al cambiar estado","error")}catch(F){console.error("Error:",F),V.fire("Error","Error de conexión","error")}},O=v==="todos"?s.filter(L=>!["laboratorio","farmacia"].includes(L.servicio_tipo)):s.filter(L=>L.servicio_tipo===v&&!["laboratorio","farmacia"].includes(L.servicio_tipo)),H=O.length,$=Math.ceil(H/S),B=(o-1)*S,W=B+S,f=O.slice(B,W),A=L=>{E(L)},G=L=>{c(L),E(1)};t.useEffect(()=>{E(1)},[v]),t.useEffect(()=>{if(r.length>0&&n.medico_id&&n.descripcion_base){const L=k(n.medico_id,n.descripcion_base);d(J=>({...J,descripcion:L}))}},[r,n.medico_id,n.descripcion_base,k]);const Y=L=>{const J=a.find(F=>F.value===L);return J?J.label:L};return p?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"text-xl",children:"Cargando tarifas..."})}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-blue-800",children:"💰 Gestión de Tarifas"}),e.jsx("button",{onClick:()=>m(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-medium",children:"➕ Nueva Tarifa"})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Filtrar por servicio:"}),e.jsxs("select",{value:v,onChange:L=>y(L.target.value),className:"border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"todos",children:"Todos los servicios"}),a.map(L=>e.jsx("option",{value:L.value,children:L.label},L.value))]}),e.jsxs("span",{className:"text-gray-600",children:["(",H," tarifa",H!==1?"s":""," - Página ",o," de ",$,")"]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"font-medium text-gray-700 text-sm sm:text-base",children:"Elementos por página:"}),e.jsxs("select",{value:S,onChange:L=>G(parseInt(L.target.value)),className:"border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]}),$>1&&e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>A(1),disabled:o===1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 whitespace-nowrap",children:[e.jsx("span",{className:"hidden sm:inline",children:"Primera"}),e.jsx("span",{className:"sm:hidden",children:"❮❮"})]}),e.jsxs("button",{onClick:()=>A(o-1),disabled:o===1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:[e.jsx("span",{className:"hidden sm:inline",children:"Anterior"}),e.jsx("span",{className:"sm:hidden",children:"❮"})]}),e.jsx("div",{className:"hidden sm:flex items-center gap-2",children:Array.from({length:Math.min(5,$)},(L,J)=>{let F;return $<=5?F=J+1:F=Math.max(1,Math.min(o-2,$-4))+J,e.jsx("button",{onClick:()=>A(F),className:`px-3 py-1 text-sm border rounded ${o===F?"bg-blue-500 text-white":"hover:bg-gray-100"}`,children:F},F)})}),e.jsx("div",{className:"flex sm:hidden items-center gap-1",children:Array.from({length:Math.min(3,$)},(L,J)=>{let F;return $<=3?F=J+1:F=Math.max(1,Math.min(o-1,$-2))+J,e.jsx("button",{onClick:()=>A(F),className:`px-2 py-1 text-xs border rounded ${o===F?"bg-blue-500 text-white":"hover:bg-gray-100"}`,children:F},`mobile-${F}`)})}),e.jsxs("button",{onClick:()=>A(o+1),disabled:o===$,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx("span",{className:"sm:hidden",children:"❯"})]}),e.jsxs("button",{onClick:()=>A($),disabled:o===$,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 whitespace-nowrap",children:[e.jsx("span",{className:"hidden sm:inline",children:"Última"}),e.jsx("span",{className:"sm:hidden",children:"❯❯"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Servicio"}),e.jsx("th",{className:"hidden sm:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Particular"}),e.jsx("th",{className:"hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Seguro"}),e.jsx("th",{className:"hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Convenio"}),e.jsx("th",{className:"hidden md:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(L=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex items-center mb-1 sm:mb-0",children:[e.jsx("span",{className:"text-lg mr-2",children:L.fuente==="medicamentos"?"💊":L.fuente==="examenes_laboratorio"?"🔬":"🏥"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:Y(L.servicio_tipo)})]}),L.fuente&&L.fuente!=="tarifas"&&e.jsx("span",{className:"ml-0 sm:ml-2 px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full",children:L.fuente==="medicamentos"?"Desde Farmacia":"Desde Laboratorio"}),e.jsx("div",{className:"sm:hidden mt-2 text-sm font-medium text-gray-900",children:L.descripcion})]})}),e.jsx("td",{className:"hidden sm:table-cell px-6 py-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:L.descripcion})}),e.jsxs("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.jsxs("div",{className:"font-medium",children:["S/ ",parseFloat(L.precio_particular).toFixed(2)]}),e.jsxs("div",{className:"block lg:hidden text-xs text-gray-500 mt-1",children:[L.precio_seguro&&e.jsxs("div",{children:["Seguro: S/ ",parseFloat(L.precio_seguro).toFixed(2)]}),L.precio_convenio&&e.jsxs("div",{children:["Convenio: S/ ",parseFloat(L.precio_convenio).toFixed(2)]})]})]}),e.jsx("td",{className:"hidden lg:table-cell px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:L.precio_seguro?`S/ ${parseFloat(L.precio_seguro).toFixed(2)}`:"-"}),e.jsx("td",{className:"hidden lg:table-cell px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:L.precio_convenio?`S/ ${parseFloat(L.precio_convenio).toFixed(2)}`:"-"}),e.jsx("td",{className:"hidden md:table-cell px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>D(L.id,L.activo===1?0:1),className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${L.activo===1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:L.activo===1?"✓ Activo":"✗ Inactivo"})}),e.jsx("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-2 space-y-1 sm:space-y-0",children:[e.jsx("div",{className:"block md:hidden mb-2",children:e.jsx("button",{onClick:()=>D(L.id,L.activo===1?0:1),className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${L.activo===1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:L.activo===1?"✓ Activo":"✗ Inactivo"})}),L.fuente==="medicamentos"?e.jsxs("button",{onClick:()=>window.open("/farmacia-medicamentos","_blank"),className:"text-blue-600 hover:text-blue-900 px-2 sm:px-3 py-1 bg-blue-100 rounded text-xs sm:text-sm",children:["🏥 ",e.jsx("span",{className:"hidden sm:inline",children:"Gestionar en"})," Farmacia"]}):L.fuente==="examenes_laboratorio"?e.jsxs("button",{onClick:()=>window.open("/laboratorio-examenes","_blank"),className:"text-green-600 hover:text-green-900 px-2 sm:px-3 py-1 bg-green-100 rounded text-xs sm:text-sm",children:["🧪 ",e.jsx("span",{className:"hidden sm:inline",children:"Gestionar en"})," Lab"]}):e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-1 sm:space-y-0 sm:space-x-2",children:[e.jsx("button",{onClick:()=>m(L),className:"text-blue-600 hover:text-blue-900 px-2 py-1 bg-blue-100 rounded text-xs sm:text-sm",children:"✏️ Editar"}),e.jsx("button",{onClick:()=>P(L.id,L.descripcion),className:"text-red-600 hover:text-red-900 px-2 py-1 bg-red-100 rounded text-xs sm:text-sm",children:"🗑️ Eliminar"})]})]})})]},L.id))})]})}),O.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay tarifas registradas para este filtro"})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:N?"Editar Tarifa":"Nueva Tarifa"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Servicio *"}),e.jsx("select",{value:n.servicio_tipo,onChange:L=>d({...n,servicio_tipo:L.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:u.map(L=>e.jsx("option",{value:L.value,children:L.label},L.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Médico * ",r.length===0&&e.jsx("span",{className:"text-gray-400",children:"(Cargando...)"})]}),e.jsxs("select",{value:n.medico_id,onChange:L=>{const J=L.target.value,F=k(J,n.descripcion_base);d({...n,medico_id:J,descripcion:F})},className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:r.length===0,children:[e.jsx("option",{value:"general",children:"Tarifa General (Todos los médicos)"}),r.map(L=>e.jsxs("option",{value:L.id,children:["Dr(a). ",L.nombre," ",L.apellido||""," - ",L.especialidad||"General"]},L.id))]}),r.length===0&&e.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"⚠️ No se pudieron cargar los médicos. Verifique la conexión."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción Base *"}),e.jsx("input",{type:"text",value:n.descripcion_base,onChange:L=>{const J=L.target.value,F=k(n.medico_id,J);d({...n,descripcion_base:J,descripcion:F})},className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ej: Consulta Especializada, Procedimiento, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción Final (Se genera automáticamente)"}),e.jsx("input",{type:"text",value:n.descripcion,readOnly:!0,className:"w-full border rounded px-3 py-2 bg-gray-100 text-gray-600",placeholder:"Se generará automáticamente al seleccionar médico y descripción base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Particular * (S/)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:n.precio_particular,onChange:L=>d({...n,precio_particular:L.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Seguro (S/) - Opcional"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:n.precio_seguro,onChange:L=>d({...n,precio_seguro:L.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Convenio (S/) - Opcional"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:n.precio_convenio,onChange:L=>d({...n,precio_convenio:L.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.activo===1,onChange:L=>d({...n,activo:L.target.checked?1:0}),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Activo"})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-6",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:N?"Actualizar":"Crear"})]})]})})]})}const St={administrador:"/usuarios",recepcionista:"/pacientes",enfermero:"/panel-enfermero",medico:"/mis-consultas",laboratorista:"/panel-laboratorio"};function ee({usuario:s,rolesPermitidos:i,children:r}){if(!s)return e.jsx(ge,{to:"/",replace:!0});if(i&&!i.includes(s.rol)){const x=St[s.rol]||"/";return e.jsx(ge,{to:x,replace:!0})}return r}function Et({medicamento:s,usuario:i,onClose:r}){const[x,p]=t.useState([]),[C,w]=t.useState(!0),[h,N]=t.useState(null),[g,v]=t.useState({tipo:"entrada",cantidad:1,observaciones:"",usuario_id:""}),[y,o]=t.useState(!1),[E,S]=t.useState([]);t.useEffect(()=>{fe.get(I+"api_medicos.php").then(d=>S(d.data.medicos||[])).catch(()=>S([]))},[]);const c=`${I}api_movimientos_medicamento.php`,u=()=>{w(!0),N(null);let d=c+`?medicamento_id=${s.id}`;fetch(d,{credentials:"include"}).then(async l=>{const k=await l.json();if(!l.ok||k.error)throw new Error(k.error||`Error HTTP: ${l.status}`);return k}).then(p).catch(l=>N(l.message)).finally(()=>w(!1))};t.useEffect(()=>{u()},[s.id]);const a=d=>{const{name:l,value:k}=d.target;v(M=>({...M,[l]:l==="cantidad"?Number(k):k}))},n=d=>{d.preventDefault(),o(!0),fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({medicamento_id:s.id,tipo:g.tipo,cantidad:g.cantidad,usuario_id:i?.id?Number(i.id):1,medico_id:g.usuario_id?Number(g.usuario_id):null,observaciones:g.observaciones})}).then(l=>l.json()).then(()=>{v({tipo:"entrada",cantidad:1,observaciones:"",usuario_id:""}),u()}).finally(()=>o(!1))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-2xl w-full p-6 relative",children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 text-gray-500 hover:text-black",children:"✕"}),e.jsx("h2",{className:"text-xl font-bold mb-2 text-center",children:"Historial de Movimientos"}),e.jsxs("div",{className:"mb-4 text-center text-lg font-semibold text-purple-700",children:[s.nombre," (",s.codigo,")"]}),e.jsxs("form",{onSubmit:n,className:"flex flex-wrap gap-2 items-end mb-6",children:[e.jsxs("select",{name:"tipo",value:g.tipo,onChange:a,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"entrada",children:"Entrada"}),e.jsx("option",{value:"salida",children:"Salida"})]}),e.jsx("input",{name:"cantidad",type:"number",min:1,value:g.cantidad,onChange:a,className:"border rounded px-2 py-1 w-24",required:!0}),e.jsxs("select",{name:"usuario_id",value:g.usuario_id,onChange:a,className:"border rounded px-2 py-1 w-56",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona médico responsable"}),E.map(d=>e.jsxs("option",{value:d.id,children:[d.nombre," ",d.apellido," (",d.email,")"]},d.id))]}),e.jsx("input",{name:"observaciones",value:g.observaciones,onChange:a,className:"border rounded px-2 py-1 flex-1",placeholder:"Observaciones"}),e.jsx("button",{type:"submit",disabled:y,className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Registrar"})]}),C?e.jsx("div",{className:"text-center text-gray-500",children:"Cargando movimientos..."}):h?e.jsx("div",{className:"text-center text-red-500",children:h}):e.jsx("div",{className:"overflow-x-auto max-h-72",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200 rounded-lg text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-purple-100",children:[e.jsx("th",{className:"py-1 px-2 border-b",children:"Fecha"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Tipo"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Cantidad"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Usuario"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Médico responsable"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Observaciones"})]})}),e.jsx("tbody",{children:Array.isArray(x)&&x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-3 text-gray-400",children:"Sin movimientos registrados"})}):Array.isArray(x)?x.map(d=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-1 px-2 border-b",children:new Date(d.fecha_hora).toLocaleString()}),e.jsx("td",{className:"py-1 px-2 border-b",children:d.tipo_movimiento}),e.jsx("td",{className:"py-1 px-2 border-b text-right",children:d.cantidad}),e.jsx("td",{className:"py-1 px-2 border-b",children:d.usuario_nombre||d.usuario_id||"-"}),e.jsx("td",{className:"py-1 px-2 border-b",children:d.medico_nombre||"-"}),e.jsx("td",{className:"py-1 px-2 border-b",children:d.observaciones})]},d.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-3 text-red-500",children:"Error al cargar movimientos o sesión/rol incorrecto"})})})]})})]})})}function Mt({initialData:s,onSave:i,onCancel:r}){const[x,p]=t.useState({codigo:s?.codigo||"",nombre:s?.nombre||"",presentacion:s?.presentacion||"",concentracion:s?.concentracion||"",laboratorio:s?.laboratorio||"",stock:s?.stock??0,unidades_por_caja:s?.unidades_por_caja??30,fecha_vencimiento:s?.fecha_vencimiento||"",estado:s?.estado||"activo",precio_compra:s?.precio_compra!==void 0&&s?.precio_compra!==null?String(s.precio_compra):"",margen_ganancia:s?.margen_ganancia!==void 0&&s?.margen_ganancia!==null?String(s.margen_ganancia):"30",id:s?.id||void 0}),[C,w]=t.useState(""),h=g=>{const{name:v,value:y}=g.target;p(o=>v==="stock"||v==="unidades_por_caja"?{...o,[v]:Number(y)}:{...o,[v]:y})},N=async g=>{if(g.preventDefault(),!x.codigo.trim()||!x.nombre.trim()){w("El código y el nombre son obligatorios");return}if(!x.fecha_vencimiento){w("La fecha de vencimiento es obligatoria");return}if(!x.unidades_por_caja||x.unidades_por_caja<1){w("Las unidades por caja deben ser mayor a 0");return}w("");const v={...x,precio_compra:parseFloat(x.precio_compra)||0,margen_ganancia:parseFloat(x.margen_ganancia)||0,unidades_por_caja:parseInt(x.unidades_por_caja)||1};if(i){const y=await i(v);y&&y.error&&y.error.toLowerCase().includes("código ya existe")&&V.fire({icon:"error",title:"Código duplicado",text:y.error,confirmButtonColor:"#e53e3e"})}};return e.jsxs("form",{onSubmit:N,className:"bg-white rounded shadow max-w-lg mx-auto flex flex-col max-h-full",children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:[e.jsx("h2",{className:"text-lg font-bold text-center",children:s?"Editar Medicamento":"Nuevo Medicamento"}),C&&e.jsx("div",{className:"text-red-500 text-center mt-2",children:C})]}),e.jsx("div",{className:"p-4 overflow-y-auto flex-1",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Código *"}),e.jsx("input",{name:"codigo",value:x.codigo,onChange:h,className:"w-full border rounded px-2 py-1",maxLength:30,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Nombre *"}),e.jsx("input",{name:"nombre",value:x.nombre,onChange:h,className:"w-full border rounded px-2 py-1",maxLength:100,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Presentación"}),e.jsx("input",{name:"presentacion",value:x.presentacion,onChange:h,className:"w-full border rounded px-2 py-1",maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Concentración"}),e.jsx("input",{name:"concentracion",value:x.concentracion,onChange:h,className:"w-full border rounded px-2 py-1",maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Laboratorio"}),e.jsx("input",{name:"laboratorio",value:x.laboratorio,onChange:h,className:"w-full border rounded px-2 py-1",maxLength:100})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Stock (unidades)"}),e.jsx("input",{name:"stock",type:"number",min:0,value:x.stock,onChange:h,className:"w-full border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Unidades por caja *"}),e.jsx("input",{name:"unidades_por_caja",type:"number",min:1,value:x.unidades_por_caja,onChange:h,className:"w-full border rounded px-2 py-1",required:!0}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ejemplo: 30 pastillas por caja, 100 jeringas por caja"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Fecha de vencimiento *"}),e.jsx("input",{name:"fecha_vencimiento",type:"date",value:x.fecha_vencimiento,onChange:h,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Estado"}),e.jsxs("select",{name:"estado",value:x.estado,onChange:h,className:"w-full border rounded px-2 py-1",children:[e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"inactivo",children:"Inactivo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Precio de compra (S/)"}),e.jsx("input",{name:"precio_compra",type:"number",min:0,step:"0.01",value:x.precio_compra!==void 0&&x.precio_compra!==null?String(x.precio_compra):"",onChange:h,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Margen de ganancia (%)"}),e.jsx("input",{name:"margen_ganancia",type:"number",min:0,max:100,step:"0.1",value:x.margen_ganancia!==void 0&&x.margen_ganancia!==null?String(x.margen_ganancia):"",onChange:h,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Precio de venta sugerido (S/)"}),e.jsx("input",{value:Number(x.precio_compra)+Number(x.precio_compra)*Number(x.margen_ganancia)/100,readOnly:!0,className:"w-full border rounded px-2 py-1 bg-gray-100 text-gray-700"})]})]})}),e.jsx("div",{className:"p-4 border-t bg-gray-50 rounded-b-lg",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:r,className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors",children:"Guardar"})]})})]})}function Fe(){const[s,i]=t.useState(null),[r,x]=t.useState(""),[p,C]=t.useState(""),[w,h]=t.useState(null),[N,g]=t.useState([]),[v,y]=t.useState(!0),[o,E]=t.useState(null),[S,c]=t.useState(!1),[u,a]=t.useState(null),[n,d]=t.useState(""),[l,k]=t.useState(1),[M,m]=t.useState(3),[b,j]=t.useState(!1),[P,D]=t.useState(null),[O,H]=t.useState(""),[$,B]=t.useState(!1),W=()=>{y(!0),E(null);const T=`${I}api_medicamentos.php`;fetch(T,{credentials:"include"}).then(R=>{if(!R.ok)throw new Error("Error al cargar medicamentos");return R.json()}).then(g).catch(E).finally(()=>y(!1))};t.useEffect(()=>{W()},[]);const f=()=>{a(null),c(!0)},A=T=>{a(T),c(!0)},G=T=>{const R=`${I}api_medicamentos.php`;return fetch(R,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)}).then(X=>X.json()).then(X=>X.success?(c(!1),W(),{success:!0}):{error:X.error||"Error al guardar"}).catch(()=>({error:"Error de red o servidor"}))};let Y=N.filter(T=>T.nombre.toLowerCase().includes(n.toLowerCase())||T.codigo.toLowerCase().includes(n.toLowerCase()));Y.sort((T,R)=>T.id&&R.id?R.id-T.id:0),$&&(Y=Y.filter(T=>T.estado==="cuarentena")),r&&(Y=Y.filter(T=>T.fecha_vencimiento&&T.fecha_vencimiento>=r)),p&&(Y=Y.filter(T=>T.fecha_vencimiento&&T.fecha_vencimiento<=p));const L=Math.ceil(Y.length/M),J=Y.slice((l-1)*M,l*M),F=T=>{m(Number(T.target.value)),k(1)},_=T=>{T>=1&&T<=L&&k(T)};return e.jsxs("div",{className:"max-w-7xl mx-auto p-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-blue-600 mb-2",children:"💊 Gestión de Medicamentos"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Sistema integral de inventario farmacéutico"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-4 gap-2",children:[e.jsx("input",{type:"text",placeholder:"Buscar por código o nombre...",value:n,onChange:T=>d(T.target.value),className:"border rounded px-3 py-2 w-full sm:w-72"}),e.jsxs("select",{value:M,onChange:F,className:"border rounded px-2 py-2 ml-2",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]}),e.jsx("span",{className:"ml-2 text-sm",children:"por página"}),e.jsxs("button",{onClick:f,className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-lg shadow-lg hover:from-purple-700 hover:to-blue-700 transform hover:scale-105 transition-all duration-200 font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"+"}),"Nuevo Medicamento"]})]}),e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-2 sm:p-4 mb-6 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-base font-semibold text-yellow-900 flex-wrap",children:[e.jsx("span",{className:"inline-block text-yellow-600 mr-1",children:"🗓️"}),e.jsx("label",{className:"text-xs sm:text-base",children:"Filtrar por vencimiento:"}),e.jsx("span",{className:"ml-1 text-xs font-normal text-gray-700",children:"Desde"}),e.jsx("input",{type:"date",value:r,onChange:T=>x(T.target.value),className:"border border-yellow-400 rounded px-1 py-1 focus:ring-2 focus:ring-yellow-300 w-16 sm:w-24 md:w-28"}),e.jsx("span",{className:"ml-1 text-xs font-normal text-gray-700",children:"Hasta"}),e.jsx("input",{type:"date",value:p,onChange:T=>C(T.target.value),className:"border border-yellow-400 rounded px-1 py-1 focus:ring-2 focus:ring-yellow-300 w-16 sm:w-24 md:w-28"}),e.jsx("button",{type:"button",onClick:()=>{x(""),C("")},className:"ml-1 px-2 py-1 rounded bg-yellow-300 text-yellow-900 font-semibold border border-yellow-400 hover:bg-yellow-400 transition text-xs sm:text-sm",title:"Limpiar filtros de vencimiento",children:"Limpiar"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 sm:mt-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:T=>B(T.target.checked)}),"Solo cuarentena"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Medicamentos en cuarentena deben ser llevados a puntos de acopio autorizados (DIGEMID)."})]})]}),v&&e.jsx("div",{className:"text-center text-gray-500",children:"Cargando..."}),o&&e.jsx("div",{className:"text-center text-red-500",children:o.message||"Error"}),!v&&!o&&e.jsxs("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 rounded-lg",children:[e.jsxs("table",{className:"w-full bg-white border border-gray-200 rounded-lg text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white",children:[e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider",children:"Código"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider sm:hidden",children:"Acciones"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider hidden md:table-cell",children:"Presentación"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider hidden lg:table-cell",children:"Concentración"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden md:table-cell",children:"Stock"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden lg:table-cell",children:"Vencimiento"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden xl:table-cell",children:"Precio Compra"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden xl:table-cell",children:"Margen %"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden xl:table-cell",children:"Precio Venta"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden lg:table-cell",children:"Estado"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Acciones"})]})}),e.jsx("tbody",{children:J.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:12,className:"text-center py-4 text-gray-400",children:"No hay medicamentos registrados"})}):J.map((T,R)=>{let X=R%2===0?"bg-white":"bg-gray-50",z="";if(T.fecha_vencimiento){const q=new Date,ae=(new Date(T.fecha_vencimiento)-q)/(1e3*60*60*24);ae<0?(z="bg-red-100 border-l-4 border-red-500",X=""):ae<90&&(z="bg-orange-100 border-l-4 border-orange-500",X="")}return e.jsxs("tr",{className:`transition-colors duration-200 hover:bg-purple-100 hover:shadow-sm ${X} ${z}`,children:[e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 font-medium text-gray-900",children:T.codigo}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 font-semibold text-gray-800",children:T.nombre}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-center sm:hidden",children:e.jsxs("div",{className:"flex flex-row gap-1 justify-center",children:[e.jsx("button",{onClick:()=>i(T),className:"p-1 text-blue-600 hover:text-white hover:bg-blue-600 rounded-md transition-all duration-200",title:"Ver detalles",children:e.jsx(is,{size:12})}),e.jsx("button",{onClick:()=>A(T),className:"p-1 text-indigo-600 hover:text-white hover:bg-indigo-600 rounded-md transition-all duration-200",title:"Editar",children:e.jsx(Me,{size:12})}),e.jsx("button",{onClick:()=>h(T),className:"p-1 text-purple-600 hover:text-white hover:bg-purple-600 rounded-md transition-all duration-200",title:"Historial",children:e.jsx(he,{size:12})}),T.estado!=="cuarentena"&&e.jsx("button",{onClick:()=>{D(T),j(!0),H("")},className:"p-1 text-yellow-600 hover:text-white hover:bg-yellow-600 rounded-md transition-all duration-200",title:"Cuarentena",children:e.jsx(je,{size:12})})]})}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 hidden md:table-cell",children:T.presentacion}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 hidden lg:table-cell",children:T.concentracion}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-right font-medium text-gray-700 hidden md:table-cell",children:T.stock}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-center hidden lg:table-cell",children:T.fecha_vencimiento?new Date(T.fecha_vencimiento).toLocaleDateString():"-"}),e.jsxs("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-right font-mono text-xs hidden xl:table-cell",children:["S/ ",T.precio_compra!==void 0?Number(T.precio_compra).toFixed(2):"-"]}),e.jsxs("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-right hidden xl:table-cell",children:[T.margen_ganancia!==void 0?Number(T.margen_ganancia).toFixed(1):"-","%"]}),e.jsxs("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-right font-semibold text-green-700 font-mono text-xs hidden xl:table-cell",children:["S/ ",T.precio_compra!==void 0&&T.margen_ganancia!==void 0?(Number(T.precio_compra)+Number(T.precio_compra)*Number(T.margen_ganancia)/100).toFixed(2):"-"]}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 hidden lg:table-cell font-medium text-center text-xs "+(T.estado==="cuarentena"?"bg-yellow-200 text-yellow-900 font-bold":""),children:T.estado==="cuarentena"?"CUARENTENA":T.estado}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-center hidden sm:table-cell",children:e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx("button",{onClick:()=>A(T),className:"p-1 text-indigo-600 hover:text-white hover:bg-indigo-600 rounded-md transition-all duration-200",title:"Editar",children:e.jsx(Me,{size:14})}),e.jsx("button",{onClick:()=>h(T),className:"p-1 text-purple-600 hover:text-white hover:bg-purple-600 rounded-md transition-all duration-200",title:"Historial",children:e.jsx(he,{size:14})}),T.estado!=="cuarentena"&&e.jsx("button",{onClick:()=>{D(T),j(!0),H("")},className:"p-1 text-yellow-600 hover:text-white hover:bg-yellow-600 rounded-md transition-all duration-200",title:"Cuarentena",children:e.jsx(je,{size:14})})]})})]},T.id)})})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-xs w-full relative",children:[e.jsx("button",{onClick:()=>i(null),className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-xl",children:"×"}),e.jsx("h2",{className:"text-lg font-bold mb-2 text-blue-800",children:"Detalles del Medicamento"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Código:"})," ",s.codigo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",s.nombre]}),e.jsxs("div",{children:[e.jsx("b",{children:"Presentación:"})," ",s.presentacion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Concentración:"})," ",s.concentracion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Laboratorio:"})," ",s.laboratorio]}),e.jsxs("div",{children:[e.jsx("b",{children:"Stock:"})," ",s.stock]}),e.jsxs("div",{children:[e.jsx("b",{children:"Vencimiento:"})," ",s.fecha_vencimiento?new Date(s.fecha_vencimiento).toLocaleDateString():"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Precio compra:"})," S/"," ",s.precio_compra!==void 0?Number(s.precio_compra).toFixed(2):"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Margen ganancia:"})," ",s.margen_ganancia!==void 0?Number(s.margen_ganancia).toFixed(1):"-","%"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Precio venta:"})," S/"," ",s.precio_compra!==void 0&&s.margen_ganancia!==void 0?(Number(s.precio_compra)+Number(s.precio_compra)*Number(s.margen_ganancia)/100).toFixed(2):"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Estado:"})," ",s.estado]})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full relative",children:[e.jsx("h2",{className:"text-lg font-bold mb-2 text-yellow-800",children:"Enviar a cuarentena"}),e.jsxs("p",{className:"mb-2 text-sm",children:["Medicamento: ",e.jsx("b",{children:P?.nombre})," (",P?.codigo,")"]}),e.jsxs("label",{className:"block mb-2 text-sm",children:["Motivo de cuarentena ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{className:"w-full border rounded px-2 py-1 mb-4",rows:3,value:O,onChange:T=>H(T.target.value),required:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>j(!1),className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Cancelar"}),e.jsx("button",{className:"bg-yellow-600 text-white px-4 py-2 rounded",disabled:!O.trim(),onClick:async()=>{if(!P)return;const T=`${I}api_medicamentos.php`,R=new Date().toISOString().slice(0,10),X={...P,estado:"cuarentena",fecha_cuarentena:R,motivo_cuarentena:O};await fetch(T,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(X)}),j(!1),D(null),H(""),W()},children:"Confirmar"})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Página ",l," de ",L," (",Y.length," ","resultados)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_(1),disabled:l===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"«"}),e.jsx("button",{onClick:()=>_(l-1),disabled:l===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"‹"}),e.jsx("span",{className:"px-2 py-1",children:l}),e.jsx("button",{onClick:()=>_(l+1),disabled:l===L||L===0,className:"px-2 py-1 border rounded disabled:opacity-50",children:"›"}),e.jsx("button",{onClick:()=>_(L),disabled:l===L||L===0,className:"px-2 py-1 border rounded disabled:opacity-50",children:"»"})]})]})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-0 max-w-lg w-full relative max-h-[90vh] overflow-y-auto",children:e.jsx(Mt,{initialData:u,onSave:G,onCancel:()=>c(!1)})})}),w&&e.jsx(Et,{medicamento:w,usuario:null,onClose:()=>{h(null),W()}})]})}function we(){const s=()=>{if(a.length===0){G("Selecciona al menos un medicamento.");return}const z=a.map(q=>{const K=E.find(re=>re.id===q),ae=k[q]||"unidad",ne=d[q]||1,oe=m[q]||30,le=L(K);let xe=0,se=K&&K.nombre&&K.nombre!=="0"?K.nombre:"Medicamento sin nombre";return ae==="caja"?(xe=le*oe*ne,se+=" (Caja)"):(xe=le*ne,se+=" (Unidad)"),{servicio_tipo:"farmacia",servicio_id:q,descripcion:se,cantidad:ne,precio_unitario:le,subtotal:xe}});p(z),w(X()),r(!0)},[i,r]=t.useState(!1),[x,p]=t.useState([]),[C,w]=t.useState(0),h=ie(),N=de(),[g,v]=t.useState(!1),[y,o]=t.useState(!1),[E,S]=t.useState([]),[c,u]=t.useState(""),[a,n]=t.useState([]),[d,l]=t.useState({}),[k,M]=t.useState({}),[m,b]=t.useState({}),j=N.pacienteId||null,[P,D]=t.useState(null),[O,H]=t.useState(""),[$,B]=t.useState(""),[W,f]=t.useState(""),[A,G]=t.useState(""),Y=()=>{fetch(`${I}api_medicamentos.php`,{credentials:"include"}).then(z=>z.json()).then(z=>{S(z.medicamentos||z||[]);const q={};(z.medicamentos||z||[]).forEach(K=>{q[K.id]=K.unidades_por_caja||1}),b(q)})};t.useEffect(()=>{Y()},[]),t.useEffect(()=>{j&&fetch(`${I}api_pacientes.php?id=${j}`).then(z=>z.json()).then(z=>{z.success&&z.paciente&&D({id:z.paciente.id,dni:z.paciente.dni,nombre:(z.paciente.nombres||z.paciente.nombre||"")+" "+(z.paciente.apellidos||z.paciente.apellido||""),historia_clinica:z.paciente.historia_clinica||""})})},[j]);const L=z=>{if(!z)return 0;const q=Number(z.precio_compra||0),K=Number(z.margen_ganancia||0);return q+q*K/100},J=E.filter(z=>z.nombre.toLowerCase().includes(c.toLowerCase())||z.codigo&&z.codigo.toLowerCase().includes(c.toLowerCase())),F=z=>{n(q=>q.includes(z)?q:[...q,z]),l(q=>({...q,[z]:1})),M(q=>({...q,[z]:"unidad"}))},_=z=>{n(q=>q.filter(K=>K!==z)),l(q=>{const K={...q};return delete K[z],K}),M(q=>{const K={...q};return delete K[z],K})},T=(z,q)=>{l(K=>({...K,[z]:q}))},R=(z,q)=>{M(K=>({...K,[z]:q})),q==="caja"&&l(K=>({...K,[z]:1}))},X=()=>a.reduce((z,q)=>{const K=E.find(oe=>oe.id===q),ae=d[q]||1,ne=k[q]||"unidad";return K?ne==="caja"?z+L(K)*m[q]*ae:z+L(K)*ae:z},0);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 bg-white rounded-2xl shadow-2xl mt-8 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-blue-900 flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"medicamentos",children:"💊"}),"Cotizador de Medicamentos"]}),e.jsx("button",{className:"bg-blue-100 text-blue-800 px-4 py-2 rounded font-semibold border border-blue-300 hover:bg-blue-200 transition",onClick:()=>{j?h("/seleccionar-servicio",{state:{pacienteId:j}}):h("/seleccionar-servicio")},children:"← Volver a Servicios"})]}),e.jsxs("div",{className:"mb-4",children:[!N.pacienteId&&e.jsx(Ie,{onPacienteEncontrado:z=>{D({id:z.id,dni:z.dni||"",nombre:((z.nombre||"")+" "+(z.apellido||"")).trim(),historia_clinica:z.historia_clinica||""}),H(""),B(""),f(""),o(!0),G("")},onNoEncontrado:()=>{D(null),v(!0),o(!0),G("Paciente no encontrado. Verifica el DNI, nombre o historia clínica.")},onNuevaBusqueda:()=>{D(null),v(!1),o(!1)}}),!N.pacienteId&&!j&&!O&&!g&&y&&!P&&e.jsx("button",{className:"mt-2 px-3 py-1 bg-yellow-100 text-yellow-800 rounded border border-yellow-300 text-sm",onClick:()=>v(!0),children:"Paciente no encontrado"}),!N.pacienteId&&g&&!j&&e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx("input",{type:"text",value:O,onChange:z=>H(z.target.value),placeholder:"DNI",className:"border px-2 py-1 rounded w-32"}),e.jsx("input",{type:"text",value:$,onChange:z=>B(z.target.value),placeholder:"Nombres",className:"border px-2 py-1 rounded w-40",required:!0}),e.jsx("input",{type:"text",value:W,onChange:z=>f(z.target.value),placeholder:"Apellidos",className:"border px-2 py-1 rounded w-40",required:!0})]}),(j||O)&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded text-blue-800 text-sm",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",P?`${P.nombre} (DNI: ${P.dni})`:`${$} ${W} (DNI: ${O})`]})]}),e.jsxs("div",{className:"mb-4 flex gap-2 items-center",children:[e.jsx("span",{className:"text-blue-700 text-xl",children:"🔍"}),e.jsx("input",{type:"text",value:c,onChange:z=>u(z.target.value),placeholder:"Buscar medicamento...",className:"border px-3 py-2 rounded-lg w-full max-w-md focus:ring-2 focus:ring-blue-300"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:E.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No hay medicamentos registrados en el sistema."}):J.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-8",children:['Sin coincidencias para "',c,'".']}):e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:J.map(z=>{const q=m[z.id]||30,K=z.stock,ae=Math.floor(K/q);return e.jsxs("li",{className:"flex items-center gap-4 py-3 px-2 hover:bg-blue-50 rounded-lg transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"🧪"}),z.nombre]}),e.jsxs("div",{className:"text-xs text-gray-500 flex gap-2 items-center",children:[e.jsxs("span",{children:["📦 ",ae," cajas"]}),e.jsxs("span",{children:["💊 ",K," unidades"]}),e.jsxs("span",{children:["💲 S/ ",L(z).toFixed(2)," / unidad"]})]})]}),a.includes(z.id)?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:k[z.id]||"unidad",onChange:ne=>R(z.id,ne.target.value),className:"border rounded-lg px-2 py-1 mr-2 bg-white",children:[e.jsx("option",{value:"unidad",children:"Unidad"}),e.jsx("option",{value:"caja",children:"Caja"})]}),k[z.id]==="caja"?e.jsx("input",{type:"number",min:1,max:ae,value:d[z.id]||1,onChange:ne=>T(z.id,Math.max(1,Math.min(ae,Number(ne.target.value)))),className:"border rounded-lg px-2 w-16 bg-white"}):e.jsx("input",{type:"number",min:1,max:K,value:d[z.id]||1,onChange:ne=>T(z.id,Math.max(1,Math.min(K,Number(ne.target.value)))),className:"border rounded-lg px-2 w-16 bg-white"}),e.jsx("button",{onClick:()=>_(z.id),className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-xl shadow transition","aria-label":"Quitar",children:e.jsx(Oe,{})})]}):e.jsx("button",{onClick:()=>F(z.id),className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-100 hover:bg-green-200 text-green-700 text-xl shadow transition","aria-label":"Agregar",children:e.jsx(_e,{})})]},z.id)})})})}),e.jsxs("div",{className:"col-span-1 md:sticky md:top-24 md:ml-8 w-full md:w-96",children:[a.length>0&&!i&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotización"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:a.map(z=>{const q=E.find(Q=>Q.id===z),K=k[z]||"unidad",ae=d[z]||1,ne=m[z]||30,oe=L(q);let le=0,xe=q?.nombre||"";return K==="caja"?(le=oe*ne*ae,xe+=" (Caja)"):(le=oe*ae,xe+=" (Unidad)"),e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"💊"}),xe]}),e.jsxs("span",{children:[ae," ",K==="caja"?"caja(s)":"unidad(es)"]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",le.toFixed(2)]})]},z)})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",X().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>{n([]),G("")},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:s,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Registrar Venta"})]})]}),i&&(P&&P.nombre&&P.dni||O&&$&&W?e.jsx(pe,{paciente:P||{id:null,dni:O,nombre:`${$} ${W}`,historia_clinica:`MANUAL-${O}`},servicio:{key:"farmacia",label:"Farmacia"},detalles:x,total:C,onCobroCompleto:()=>{r(!1),n([]),l({}),M({}),G("Venta procesada correctamente. Stock actualizado."),Y()},onCancelar:()=>r(!1)}):e.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-lg font-semibold text-center",children:"Faltan datos completos del paciente. Por favor, busca un paciente registrado o completa los campos de DNI, nombres y apellidos para continuar con el cobro."}))]})]})}),A&&e.jsx("div",{className:`mt-4 text-center font-semibold ${A.includes("registrada")?"text-green-600":"text-red-600"}`,children:A})]})}function Pt(){const{pacienteId:s}=de(),i=ie(),[r,x]=t.useState([]),[p,C]=t.useState([]),[w,h]=t.useState({}),[N,g]=t.useState(!1),[v,y]=t.useState([]),[o,E]=t.useState(0),[S,c]=t.useState(""),[u,a]=t.useState(null);t.useEffect(()=>{fetch(`${I}api_tarifas.php`,{credentials:"include"}).then(m=>m.json()).then(m=>{const b=(m.tarifas||[]).filter(j=>(j.servicio_tipo==="procedimiento"||j.servicio_tipo==="procedimientos")&&j.activo===1);x(b)}),fetch(`${I}api_pacientes.php?id=${s}`).then(m=>m.json()).then(m=>{m.success&&m.paciente&&a(m.paciente)}),C([]),h({}),g(!1),c("")},[s]);const n=m=>{C(b=>b.includes(m)?b:[...b,m]),h(b=>({...b,[m]:1}))},d=m=>{C(b=>b.filter(j=>j!==m)),h(b=>{const j={...b};return delete j[m],j})},l=(m,b)=>{h(j=>({...j,[m]:b}))},k=()=>p.reduce((m,b)=>{const j=r.find(D=>D.id===b),P=w[b]||1;return j?m+j.precio_particular*P:m},0),M=()=>{if(p.length===0){c("Selecciona al menos un procedimiento.");return}const m=p.map(b=>{const j=r.find(O=>O.id===b),P=w[b]||1;let D=j&&j.descripcion?j.descripcion:j&&j.nombre?j.nombre:"";return(D===0||D==="0"||D===null||D===void 0)&&(D=j&&j.nombre?j.nombre:""),j?{servicio_tipo:"procedimiento",servicio_id:b,descripcion:D,cantidad:P,precio_unitario:j.precio_particular,subtotal:j.precio_particular*P}:null}).filter(Boolean);y(m),E(k()),g(!0)};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 md:p-8 bg-white rounded-xl shadow-lg mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"🛠️"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Cotización de Procedimientos"})]}),e.jsx("button",{onClick:()=>i("/seleccionar-servicio",{state:{pacienteId:s}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"})]}),e.jsx("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:e.jsxs("div",{className:"text-gray-600",children:[e.jsx("b",{children:"ID Paciente:"})," ",s]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Selecciona los procedimientos:"}),r.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No hay procedimientos para mostrar."}):e.jsx("div",{className:"bg-white rounded-lg shadow border border-gray-200",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:r.map(m=>e.jsxs("li",{className:"flex items-center px-4 py-3 hover:bg-blue-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:p.includes(m.id),onChange:()=>p.includes(m.id)?d(m.id):n(m.id),className:"mr-3 accent-orange-600 w-5 h-5"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"font-semibold text-gray-800",children:m.descripcion||m.nombre})}),e.jsxs("div",{className:"font-bold text-green-700 text-lg",children:["S/ ",m.precio_particular]}),p.includes(m.id)&&e.jsx("input",{type:"number",min:1,value:w[m.id]||1,onChange:b=>l(m.id,Math.max(1,Number(b.target.value))),className:"border rounded-lg px-2 w-16 bg-white ml-2"})]},m.id))})})]})}),e.jsxs("div",{className:"w-full md:w-96 md:sticky md:top-8 h-fit",children:[p.length>0&&!N&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotización"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:p.map(m=>{const b=r.find(P=>P.id===m),j=w[m]||1;return b?e.jsxs("li",{className:"py-2 flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx("div",{children:e.jsx("span",{className:"font-medium text-gray-900",children:b.descripcion||b.nombre})}),e.jsxs("div",{className:"font-bold text-green-700 text-right",children:["S/ ",(b.precio_particular*j).toFixed(2)]})]},m):null})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",k().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>{C([]),c("")},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:M,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Cotizar"})]})]}),N&&e.jsx(pe,{paciente:u,servicio:{key:"procedimiento",label:"Procedimiento"},detalles:v,total:o,onCobroCompleto:()=>{g(!1),C([]),h({}),c("Cotización procesada correctamente.")},onCancelar:()=>g(!1)})]})]}),S&&e.jsx("div",{className:`mt-6 text-center font-semibold ${S.includes("correctamente")?"text-green-600":"text-red-600"}`,children:S})]})}function Lt(){const[s,i]=t.useState(!1),[r,x]=t.useState(null),[p,C]=t.useState([]),[w,h]=t.useState(""),[N,g]=t.useState(""),{pacienteId:v}=de(),y=ie(),[o,E]=t.useState(null),[S,c]=t.useState(!0),[u,a]=t.useState(""),[n,d]=t.useState(1),[l,k]=t.useState(3);if(t.useEffect(()=>{d(1)},[l,w,N]),t.useEffect(()=>{fetch(`${I}api_consumos_paciente.php?paciente_id=${v}`,{credentials:"include"}).then(B=>B.json()).then(B=>{B.success?E(B):a(B.error||"Error al cargar consumo"),c(!1)}).catch(()=>{a("Error de conexión con el servidor"),c(!1)})},[v]),S)return e.jsx(ue,{});if(u)return e.jsx("div",{className:"text-red-600 font-bold p-6",children:u});let M=o.historial;function m(B){return B.split(" ")[0]}w&&(M=M.filter(B=>m(B.fecha)>=w)),N&&(M=M.filter(B=>m(B.fecha)<=N));const b=M.length,j=Math.max(1,Math.ceil(b/l)),P=(n-1)*l,D=P+l,O=M.slice(P,D),H=()=>{const W=[],f=[];for(let A=Math.max(2,n-2);A<=Math.min(j-1,n+2);A++)W.push(A);return n-2>2?f.push(1,"..."):f.push(1),f.push(...W),n+2<j-1?f.push("...",j):j>1&&f.push(j),f.filter((A,G,Y)=>Y.indexOf(A)===G)};function $(){if(!r||!p)return;const B=new Date(r.fecha).toLocaleString("es-PE"),W=o.apellido?`${o.nombre} ${o.apellido}`:o.nombre,f=r.tipo_pago?r.tipo_pago.toUpperCase():r.detalles&&r.detalles[0]?.tipo_pago?r.detalles[0].tipo_pago.toUpperCase():"EFECTIVO",A=r.cobertura?r.cobertura.toUpperCase():r.detalles&&r.detalles[0]?.cobertura?r.detalles[0].cobertura.toUpperCase():"PARTICULAR",G=`
      <div style="font-family: monospace; width: 320px; margin: 0 auto;">
        <h3 style="text-align: center; margin-bottom: 10px;">🏥 CLÍNICA 2 DE MAYO</h3>
        <hr>
        <p><strong>COMPROBANTE DE PAGO #${r.cobro_id||""}</strong></p>
        <p>Fecha: ${B}</p>
        <p>Paciente: ${W}</p>
        <p>DNI: ${o.dni}</p>
        <p>H.C.: ${o.historia_clinica}</p>
        <hr>
        <p><strong>DETALLE:</strong></p>
        ${p.map(Y=>`<p>${Y.descripcion} x${Y.cantidad||1} .... S/ ${(Y.subtotal||Y.monto).toFixed(2)}</p>`).join("")}
        <hr>
        <p style="font-weight:bold; font-size:17px; color:#008000;">TOTAL: S/ ${p.reduce((Y,L)=>Y+Number(L.subtotal||L.monto),0).toFixed(2)}</p>
        <p>Tipo de pago: ${f}</p>
        <p>Cobertura: ${A}</p>
        <hr>
        <div style="text-align: center; font-size: 12px;">Gracias por su preferencia<br>Conserve este comprobante</div>
      </div>
    `;V.fire({title:"Ticket de Cobro",html:G,icon:"info",confirmButtonText:"Imprimir",showCancelButton:!0,cancelButtonText:"Cerrar"}).then(Y=>{if(Y.isConfirmed){const L=window.open("","_blank","width=400,height=600");L.document.write(`<html><head><title>Ticket</title></head><body>${G}</body></html>`),L.document.close(),L.print()}})}return e.jsxs("div",{className:"max-w-3xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8 font-sans",children:[s&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-red-600 text-xl font-bold",onClick:()=>i(!1),children:"×"}),e.jsx("h3",{className:"text-lg font-bold mb-2 text-blue-800",children:"Detalle del Cobro"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Fecha:"})," ",r.fecha,e.jsx("br",{})]}),e.jsxs("table",{className:"min-w-full border rounded mb-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1 border text-left",children:"Servicio"}),e.jsx("th",{className:"px-2 py-1 border text-left",children:"Descripción"}),e.jsx("th",{className:"px-2 py-1 border text-right",children:"Monto (S/)"})]})}),e.jsx("tbody",{children:p.map((B,W)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:B.servicio_tipo||r.servicio}),e.jsx("td",{className:"border px-2 py-1",children:B.descripcion&&B.descripcion!=="0"?B.descripcion:e.jsx("span",{className:"italic text-gray-500",children:"Sin detalle"})}),e.jsx("td",{className:"border px-2 py-1 text-right",children:Number(B.subtotal||B.monto).toFixed(2)})]},W))})]}),e.jsxs("div",{className:"font-bold text-right text-green-700 text-lg mb-4",children:["Total: S/ ",p.reduce((B,W)=>B+Number(W.subtotal||W.monto),0).toFixed(2)]}),e.jsx("button",{className:"w-full py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded shadow",onClick:$,children:"Imprimir ticket"})]})}),e.jsx("button",{onClick:()=>y(-1),className:"mb-4 bg-gradient-to-r from-blue-200 to-purple-200 px-4 py-2 rounded hover:bg-blue-300 flex items-center gap-2 text-blue-900 font-semibold",children:"← Volver"}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ns,{className:"text-3xl text-blue-700"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Consumo del Paciente"})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-2 gap-4 bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"ID:"})," ",o.paciente_id," ",e.jsx("br",{}),e.jsx("span",{className:"font-semibold text-gray-700",children:"Nombre:"})," ",o.nombre," ",o.apellido," ",e.jsx("br",{}),e.jsx("span",{className:"font-semibold text-gray-700",children:"DNI:"})," ",o.dni]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Historia Clínica:"})," ",o.historia_clinica," ",e.jsx("br",{}),e.jsxs("span",{className:"inline-flex items-center gap-2 font-bold text-green-700 text-lg mt-2",children:[e.jsx(me,{className:"text-2xl"}),"Consumo Total: S/ ",o.consumo_total.toFixed(2)]}),o.deuda_total>0&&e.jsxs("span",{className:"inline-flex items-center gap-2 font-bold text-red-600 text-lg mt-2 ml-4",children:[e.jsx(me,{className:"text-2xl"}),"Deuda: S/ ",o.deuda_total.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-8 mb-2",children:[e.jsx(os,{className:"text-xl text-purple-700"}),e.jsx("h4",{className:"font-semibold text-lg text-purple-800",children:"Historial de Servicios"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"fechaInicio",className:"font-semibold text-gray-700",children:"Desde:"}),e.jsx("input",{type:"date",id:"fechaInicio",value:w,onChange:B=>h(B.target.value),className:"border rounded px-2 py-1 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"fechaFin",className:"font-semibold text-gray-700",children:"Hasta:"}),e.jsx("input",{type:"date",id:"fechaFin",value:N,onChange:B=>g(B.target.value),className:"border rounded px-2 py-1 text-sm"})]}),e.jsx("button",{onClick:()=>{h(""),g("")},className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 font-semibold",children:"Limpiar Filtros"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border rounded-lg shadow-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-purple-100",children:[e.jsx("th",{className:"px-3 py-2 border text-left",children:"Fecha"}),e.jsx("th",{className:"px-3 py-2 border text-left",children:"Servicio"}),e.jsx("th",{className:"px-3 py-2 border text-left",children:"Descripción"}),e.jsx("th",{className:"px-3 py-2 border text-right",children:"Monto (S/)"})]})}),e.jsx("tbody",{children:M.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-6 text-gray-500",children:o.historial.length===0?"No hay servicios registrados.":"No se encontraron servicios en el rango de fechas seleccionado."})}):O.map((B,W)=>e.jsxs("tr",{className:W%2===0?"bg-white":"bg-blue-50",children:[e.jsx("td",{className:"border px-3 py-2",children:B.fecha}),e.jsx("td",{className:"border px-3 py-2",children:e.jsxs("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold ${B.servicio==="consulta"?"bg-green-100 text-green-700":B.servicio==="laboratorio"?"bg-yellow-100 text-yellow-700":B.servicio==="farmacia"?"bg-purple-100 text-purple-700":B.servicio==="procedimiento"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:[B.servicio,B.servicio==="laboratorio"&&B.resultados_laboratorio&&e.jsx("button",{className:"ml-2 text-purple-700 hover:text-purple-900",title:"Descargar resultados",onClick:()=>window.open(B.resultados_laboratorio,"_blank"),children:e.jsx("span",{role:"img","aria-label":"descargar",children:"📥"})})]})}),e.jsx("td",{className:"border px-3 py-2",children:e.jsx("button",{className:"px-3 py-1 bg-blue-100 hover:bg-blue-200 rounded text-blue-900 font-semibold text-xs shadow",onClick:()=>{x(B),C(B.detalles),i(!0)},children:"Ver detalle"})}),e.jsx("td",{className:"border px-3 py-2 text-right font-semibold text-green-700",children:Number(B.monto).toFixed(2)})]},W))})]})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:["Mostrando ",b===0?0:P+1," - ",Math.min(D,b)," de ",b," servicios"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-semibold",children:"Filas:"}),e.jsxs("select",{id:"itemsPerPage",value:l,onChange:B=>k(Number(B.target.value)),className:"border rounded px-2 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]})]}),b>0&&e.jsxs("span",{className:"text-blue-600 font-medium",children:["Total de servicios: S/ ",M.reduce((B,W)=>B+Number(W.monto),0).toFixed(2)]})]}),j>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>d(1),disabled:n===1,title:"Primera página",children:"«"}),e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>d(n-1),disabled:n===1,children:"‹ Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:H().map((B,W)=>e.jsx(Ne.Fragment,{children:B==="..."?e.jsx("span",{className:"px-3 py-2 text-gray-500",children:"..."}):e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===B?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>d(B),children:B})},W))}),e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===j?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>d(n+1),disabled:n===j,children:"Siguiente ›"}),e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n===j?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>d(j),disabled:n===j,title:"Última página",children:"»"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Ir a página:"}),e.jsx("input",{type:"number",min:"1",max:j,value:n,onChange:B=>{const W=parseInt(B.target.value);W>=1&&W<=j&&d(W)},className:"w-16 px-2 py-1 border rounded text-center focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsxs("span",{className:"text-gray-600",children:["de ",j]})]})]})]})]})}function Ft(){const[s,i]=t.useState([]),[r,x]=t.useState(!0),[p,C]=t.useState(null),[w,h]=t.useState([]),[N,g]=t.useState(!1),[v,y]=t.useState(""),[o,E]=t.useState(""),[S,c]=t.useState(1),[u,a]=t.useState(3),[n,d]=t.useState(0),l=()=>{x(!0);let b=`${I}api_cobros.php`;const j=[`page=${S}`,`limit=${u}`,"servicio=farmacia"];let P=v,D=o;(P&&!D||!P&&D)&&(P=P||D,D=D||P),P&&D&&(j.push(`fecha_inicio=${P}`),j.push(`fecha_fin=${D}`)),b+="?"+j.join("&"),fetch(b,{credentials:"include"}).then(O=>{if(!O.ok)throw new Error(`Error HTTP: ${O.status}`);return O.json()}).then(O=>{i(O.cobros||[]),d(O.total||0),x(!1)}).catch(O=>{x(!1),console.error("Error al cargar ventas:",O),alert("Error al cargar ventas: "+O.message)})};t.useEffect(()=>{l()},[v,o,S,u]);const k=b=>{C(b),g(!0),fetch(`${I}api_cobros.php?cobro_id=${b.id}`,{credentials:"include"}).then(j=>j.json()).then(j=>{if(j.success&&j.cobro){const P=j.cobro.detalles||[];let D=[];P.forEach(O=>{if(O.servicio_tipo==="farmacia")try{D=JSON.parse(O.descripcion)}catch{D.push({descripcion:O.descripcion,cantidad:O.cantidad,precio_unitario:O.precio_unitario,subtotal:O.subtotal})}}),h(D)}})},M=()=>{const b=new De;b.text("Ventas de Farmacia",14,14),$e(b,{head:[["Fecha","Paciente","DNI","Usuario","Total","Estado"]],body:s.map(j=>[new Date(j.fecha_cobro).toLocaleDateString(),j.nombre?`${j.nombre} ${j.apellido||""}`.trim():"-",j.dni||"-",j.usuario_nombre||j.usuario_id,`S/ ${parseFloat(j.total).toFixed(2)}`,j.estado])}),b.save("ventas_farmacia.pdf")},m=()=>{const b=be.json_to_sheet(s.map(P=>({Fecha:new Date(P.fecha_cobro).toLocaleDateString(),Paciente:P.nombre?`${P.nombre} ${P.apellido||""}`.trim():"-",DNI:P.dni||"-",Usuario:P.usuario_nombre||P.usuario_id,Total:parseFloat(P.total).toFixed(2),Estado:P.estado}))),j=be.book_new();be.book_append_sheet(j,b,"Ventas"),ls(j,"ventas_farmacia.xlsx")};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-800 mb-4",children:"Ventas de Farmacia"}),e.jsxs("div",{className:"flex gap-4 mb-4 items-center",children:[e.jsxs("label",{className:"text-sm",children:["Mostrar:",e.jsxs("select",{value:u,onChange:b=>{a(Number(b.target.value)),c(1)},className:"ml-2 border rounded px-2 py-1",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]}),e.jsx("button",{className:"px-3 py-1 bg-green-600 text-white rounded",onClick:M,children:"Exportar PDF"}),e.jsx("button",{className:"px-3 py-1 bg-amber-500 text-white rounded",onClick:m,children:"Exportar Excel"}),e.jsxs("label",{className:"text-sm",children:["Desde:",e.jsx("input",{type:"date",value:v,onChange:b=>y(b.target.value),className:"ml-2 border rounded px-2 py-1"})]}),e.jsxs("label",{className:"text-sm",children:["Hasta:",e.jsx("input",{type:"date",value:o,onChange:b=>E(b.target.value),className:"ml-2 border rounded px-2 py-1"})]}),e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded",onClick:l,children:"Filtrar"}),(v||o)&&e.jsx("button",{className:"px-2 py-1 bg-gray-200 text-gray-700 rounded",onClick:()=>{y(""),E("")},children:"Limpiar"})]}),r?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Cargando ventas..."}):s.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No hay ventas registradas."}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-50",children:[e.jsx("th",{className:"p-2",children:"Fecha"}),e.jsx("th",{className:"p-2",children:"Paciente"}),e.jsx("th",{className:"p-2",children:"DNI"}),e.jsx("th",{className:"p-2",children:"Usuario"}),e.jsx("th",{className:"p-2",children:"Total"}),e.jsx("th",{className:"p-2",children:"Estado"}),e.jsx("th",{className:"p-2",children:"Detalle"})]})}),e.jsx("tbody",{children:s.map(b=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:new Date(b.fecha_cobro).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:b.nombre?`${b.nombre} ${b.apellido||""}`.trim():"-"}),e.jsx("td",{className:"p-2",children:b.dni||"-"}),e.jsx("td",{className:"p-2",children:b.usuario_nombre||b.usuario_id}),e.jsxs("td",{className:"p-2 font-bold text-blue-700",children:["S/ ",parseFloat(b.total).toFixed(2)]}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${b.estado==="pagado"?"bg-green-100 text-green-800":b.estado==="anulado"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:b.estado})}),e.jsx("td",{className:"p-2",children:e.jsx("button",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200",onClick:()=>k(b),children:"Ver"})})]},b.id))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("span",{className:"text-sm",children:["Página ",S," de ",Math.max(1,Math.ceil(n/u))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded",disabled:S===1,onClick:()=>c(S-1),children:"Anterior"}),e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded",disabled:S>=Math.ceil(n/u),onClick:()=>c(S+1),children:"Siguiente"})]})]})]}),N&&p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 text-xl",onClick:()=>g(!1),children:"✕"}),e.jsx("h3",{className:"text-xl font-bold mb-2 text-blue-700",children:"Detalle de Venta"}),e.jsxs("div",{className:"mb-2 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Paciente:"})," ",p.nombre?`${p.nombre} ${p.apellido||""}`.trim():"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",p.dni||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Usuario:"})," ",p.usuario_nombre||p.usuario_id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Fecha:"})," ",new Date(p.fecha_cobro).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("b",{children:"Total:"})," S/ ",parseFloat(p.total).toFixed(2)]}),e.jsxs("div",{children:[e.jsx("b",{children:"Tipo de Pago:"})," ",p.tipo_pago]})]}),e.jsxs("table",{className:"w-full text-sm border mb-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-50",children:[e.jsx("th",{className:"p-2",children:"Medicamento"}),e.jsx("th",{className:"p-2",children:"Cantidad"}),e.jsx("th",{className:"p-2",children:"Precio Unitario"}),e.jsx("th",{className:"p-2",children:"Subtotal"})]})}),e.jsx("tbody",{children:w.map(b=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:b.descripcion}),e.jsx("td",{className:"p-2",children:b.cantidad}),e.jsxs("td",{className:"p-2",children:["S/ ",b.precio_unitario]}),e.jsxs("td",{className:"p-2",children:["S/ ",b.subtotal]})]},b.id))})]})]})})]})}function Tt(){const s=Ce(),i=ie(),[r,x]=t.useState(null),p=s.state?.pacienteId,[C,w]=t.useState([]);return t.useEffect(()=>{fetch(I+"api_tarifas.php",{credentials:"include"}).then(h=>h.json()).then(h=>{if(h.success&&Array.isArray(h.tarifas)){const N=["consulta","laboratorio","farmacia","ecografia","rayosx","ocupacional"],g=h.tarifas.filter(v=>v.activo===1&&!N.includes(v.servicio_tipo)).map(v=>({key:v.servicio_tipo+"_"+v.id,label:v.descripcion,tarifaId:v.id}));w(g)}})},[]),t.useEffect(()=>{p&&fetch(`${I}api_pacientes.php?id=${p}`).then(h=>h.json()).then(h=>{h.success&&h.paciente?x(h.paciente):x(null)})},[p]),e.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-blue-400 rounded-t-xl p-4 mb-0",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"🗂️"})," Atención en Recepción"]}),e.jsx("p",{className:"text-white text-sm",children:"Gestión de pacientes y servicios"})]}),e.jsxs("div",{className:"bg-white rounded-b-xl shadow p-4",children:[e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded font-bold hover:bg-blue-600 mb-4",onClick:()=>i("/"),children:"Volver al Dashboard"}),r?e.jsxs("div",{className:"bg-blue-50 rounded p-4 mb-4",children:[e.jsx("div",{className:"font-bold text-blue-800 mb-2",children:"Paciente encontrado:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",r.nombre]}),e.jsxs("div",{children:[e.jsx("b",{children:"Apellido:"})," ",r.apellido]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",r.dni]}),e.jsxs("div",{children:[e.jsx("b",{children:"Fecha de nacimiento:"})," ",r.fecha_nacimiento]}),e.jsxs("div",{children:[e.jsx("b",{children:"Sexo:"})," ",r.sexo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Dirección:"})," ",r.direccion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Teléfono:"})," ",r.telefono]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",r.email]}),e.jsxs("div",{children:[e.jsx("b",{children:"Tipo de seguro:"})," ",r.tipo_seguro]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Historia Clínica:"})," ",r.historia_clinica]}),e.jsxs("div",{children:[e.jsx("b",{children:"Edad:"})," ",r.edad?r.edad+" años":r.fecha_nacimiento?(()=>{const h=new Date(r.fecha_nacimiento);return isNaN(h)?"Edad no disponible":Math.floor((new Date-h)/(365.25*24*60*60*1e3))+" años"})():"Edad no disponible"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Procedencia:"})," ",r.procedencia]})]})]})]}):e.jsx("div",{className:"text-center text-gray-500 mb-4",children:"Busca un paciente por DNI para mostrar los servicios."}),r&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-2",children:[e.jsxs("div",{className:"font-semibold text-blue-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"🔽"})," Seleccionar Servicio para: ",e.jsxs("span",{className:"text-black",children:[r.nombre," ",r.apellido]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-100 font-bold",onClick:()=>i("/agendar-consulta",{state:{pacienteId:r.id}}),children:"👨‍⚕️ Consulta Médica"}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-green-100 font-bold",onClick:()=>i(`/cotizar-laboratorio/${r.id}`),children:["🧪 Laboratorio ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-purple-100 font-bold",onClick:()=>i(`/cotizar-farmacia/${r.id}`),children:["💊 Farmacia ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-50 font-bold",onClick:()=>i(`/cotizar-rayosx/${r.id}`),children:["🩻 Rayos X ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-50 font-bold",onClick:()=>i(`/cotizar-ecografia/${r.id}`),children:["🩺 Ecografías ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-orange-100 font-bold",onClick:()=>i(`/cotizar-procedimientos/${r.id}`),children:["🛠️ Procedimientos ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-50 font-bold",onClick:()=>{V.fire({title:"Página en construcción",text:"La funcionalidad de Medicina Ocupacional estará disponible próximamente.",icon:"info",confirmButtonText:"OK"})},children:["👨‍⚕️ Medicina Ocupacional ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 flex gap-4 items-center",children:[e.jsx("span",{children:"💰 = Requiere pago previo"}),e.jsx("span",{children:"📅 = Agendar primero, cobrar después"})]})]})]})]})})}function Dt(){const[s,i]=t.useState([]),[r,x]=t.useState([]),[p,C]=t.useState([]),[w,h]=t.useState(!0),[N,g]=t.useState(!1),[v,y]=t.useState(null),[o,E]=t.useState("todos"),[S,c]=t.useState("todos"),[u,a]=t.useState(1),[n]=t.useState(10),d=[{value:"consulta",label:"Consultas Médicas"},{value:"procedimiento",label:"Procedimientos Médicos"},{value:"cirugia",label:"Cirugías"},{value:"interconsulta",label:"Interconsultas"},{value:"otros",label:"Otros Servicios"}],[l,k]=t.useState({medico_id:"",tarifa_id:"",especialidad:"",tipo_servicio:"consulta",porcentaje_clinica:"",porcentaje_medico:"",monto_fijo_clinica:"",monto_fijo_medico:"",vigencia_desde:new Date().toISOString().split("T")[0],vigencia_hasta:"",observaciones:"",activo:1});t.useEffect(()=>{M()},[]);const M=async()=>{try{h(!0),await Promise.all([m(),b(),j()])}catch(_){console.error("Error al cargar datos:",_)}finally{h(!1)}},m=async()=>{try{const T=await(await fetch(`${I}api_honorarios_medicos_v2.php`,{credentials:"include"})).json();T.success&&i(T.configuraciones||[])}catch(_){console.error("Error al cargar configuraciones:",_)}},b=async()=>{try{const T=await(await fetch(`${I}api_medicos.php`,{credentials:"include"})).json();T.success&&x(T.medicos||[])}catch(_){console.error("Error al cargar médicos:",_)}},j=async()=>{try{const T=await(await fetch(`${I}api_honorarios_medicos_v2.php?tarifas_con_honorarios=1`,{credentials:"include"})).json();T.success&&C(T.tarifas||[])}catch(_){console.error("Error al cargar tarifas:",_)}},P=(_=null)=>{_?(y(_),k({medico_id:_.medico_id,tarifa_id:_.tarifa_id||"",especialidad:_.especialidad,tipo_servicio:_.tipo_servicio,porcentaje_clinica:_.porcentaje_clinica,porcentaje_medico:_.porcentaje_medico,monto_fijo_clinica:_.monto_fijo_clinica||"",monto_fijo_medico:_.monto_fijo_medico||"",vigencia_desde:_.vigencia_desde,vigencia_hasta:_.vigencia_hasta||"",observaciones:_.observaciones||"",activo:_.activo})):(y(null),k({medico_id:"",tarifa_id:"",especialidad:"",tipo_servicio:"consulta",porcentaje_clinica:"",porcentaje_medico:"",monto_fijo_clinica:"",monto_fijo_medico:"",vigencia_desde:new Date().toISOString().split("T")[0],vigencia_hasta:"",observaciones:"",activo:1})),g(!0)},D=()=>{g(!1),y(null)},O=()=>{if(!l.medico_id)return V.fire("Error","Debe seleccionar un médico","error"),!1;const _=l.monto_fijo_clinica&&l.monto_fijo_medico,T=l.porcentaje_clinica&&l.porcentaje_medico;if(!_&&!T)return V.fire("Error","Debe configurar porcentajes O montos fijos","error"),!1;if(T){const R=parseFloat(l.porcentaje_clinica)+parseFloat(l.porcentaje_medico);if(Math.abs(R-100)>.01)return V.fire("Error","Los porcentajes deben sumar exactamente 100%","error"),!1}return!0},H=async()=>{if(O())try{const _=`${I}api_honorarios_medicos_v2.php`,T=v?"PUT":"POST",R=v?{...l,id:v.id}:l;R.tarifa_id===""&&(R.tarifa_id=null),R.vigencia_hasta===""&&(R.vigencia_hasta=null),R.monto_fijo_clinica===""&&(R.monto_fijo_clinica=null),R.monto_fijo_medico===""&&(R.monto_fijo_medico=null);const q=await(await fetch(_,{method:T,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(R)})).json();q.success?(V.fire({title:"¡Éxito!",text:v?"Configuración actualizada correctamente":"Configuración creada correctamente",icon:"success",confirmButtonText:"OK"}),D(),m()):V.fire("Error",q.error||"Error al guardar la configuración","error")}catch(_){console.error("Error:",_),V.fire("Error","Error de conexión","error")}},$=async(_,T)=>{if((await V.fire({title:"¿Estás seguro?",text:`¿Deseas eliminar la configuración de ${T}?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33"})).isConfirmed)try{const z=await(await fetch(`${I}api_honorarios_medicos_v2.php`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:_})})).json();z.success?(V.fire("¡Eliminado!","La configuración ha sido eliminada","success"),m()):V.fire("Error",z.error||"Error al eliminar la configuración","error")}catch(X){console.error("Error:",X),V.fire("Error","Error de conexión","error")}},B=_=>{const T=r.find(R=>R.id==_);T&&k(R=>({...R,medico_id:_,especialidad:T.especialidad||""}))},W=(_,T)=>{if(_==="porcentaje_clinica"){const R=100-parseFloat(T||0);k(X=>({...X,porcentaje_clinica:T,porcentaje_medico:R>=0?R.toString():""}))}else if(_==="porcentaje_medico"){const R=100-parseFloat(T||0);k(X=>({...X,porcentaje_medico:T,porcentaje_clinica:R>=0?R.toString():""}))}},f=s.filter(_=>{const T=o==="todos"||_.medico_id==o,R=S==="todos"||_.tipo_servicio===S;return T&&R}),A=f.length,G=Math.ceil(A/n),Y=(u-1)*n,L=Y+n,J=f.slice(Y,L),F=_=>{a(_)};return t.useEffect(()=>{a(1)},[o,S]),w?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"text-xl",children:"Cargando configuraciones de honorarios..."})}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-green-800",children:"💰 Gestión de Honorarios Médicos"}),e.jsx("button",{onClick:()=>P(),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 font-medium",children:"➕ Nueva Configuración"})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700 mb-2",children:"Filtrar por médico:"}),e.jsxs("select",{value:o,onChange:_=>E(_.target.value),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"todos",children:"Todos los médicos"}),r.map(_=>e.jsxs("option",{value:_.id,children:["Dr(a). ",_.nombre," ",_.apellido," - ",_.especialidad]},_.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700 mb-2",children:"Filtrar por tipo de servicio:"}),e.jsxs("select",{value:S,onChange:_=>c(_.target.value),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"todos",children:"Todos los servicios"}),d.map(_=>e.jsx("option",{value:_.value,children:_.label},_.value))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("span",{className:"text-gray-600",children:[A," configuración",A!==1?"es":""," - Página ",u," de ",G]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Médico"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Servicio"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Configuración"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vigencia"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:J.map(_=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["Dr(a). ",_.nombre," ",_.apellido]}),e.jsx("div",{className:"text-sm text-gray-500",children:_.especialidad})]})})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:d.find(T=>T.value===_.tipo_servicio)?.label||_.tipo_servicio}),_.tarifa_descripcion&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Tarifa específica: ",_.tarifa_descripcion]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:_.monto_fijo_clinica?e.jsxs("div",{children:[e.jsxs("div",{children:["Clínica: S/ ",parseFloat(_.monto_fijo_clinica).toFixed(2)]}),e.jsxs("div",{children:["Médico: S/ ",parseFloat(_.monto_fijo_medico).toFixed(2)]})]}):e.jsxs("div",{children:[e.jsxs("div",{children:["Clínica: ",_.porcentaje_clinica,"%"]}),e.jsxs("div",{children:["Médico: ",_.porcentaje_medico,"%"]})]})})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.jsxs("div",{children:["Desde: ",_.vigencia_desde]}),_.vigencia_hasta&&e.jsxs("div",{children:["Hasta: ",_.vigencia_hasta]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${_.activo===1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:_.activo===1?"✓ Activo":"✗ Inactivo"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>P(_),className:"text-blue-600 hover:text-blue-900 px-3 py-1 bg-blue-100 rounded text-sm",children:"✏️ Editar"}),e.jsx("button",{onClick:()=>$(_.id,`${_.nombre} ${_.apellido}`),className:"text-red-600 hover:text-red-900 px-3 py-1 bg-red-100 rounded text-sm",children:"🗑️ Eliminar"})]})})]},_.id))})]})}),f.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay configuraciones registradas para este filtro"})]}),G>1&&e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mt-6",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("button",{onClick:()=>F(1),disabled:u===1,className:"px-3 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:"Primera"}),e.jsx("button",{onClick:()=>F(u-1),disabled:u===1,className:"px-3 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:"Anterior"}),Array.from({length:Math.min(5,G)},(_,T)=>{let R;return G<=5?R=T+1:R=Math.max(1,Math.min(u-2,G-4))+T,e.jsx("button",{onClick:()=>F(R),className:`px-3 py-1 text-sm border rounded ${u===R?"bg-green-500 text-white":"hover:bg-gray-100"}`,children:R},R)}),e.jsx("button",{onClick:()=>F(u+1),disabled:u===G,className:"px-3 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:"Siguiente"}),e.jsx("button",{onClick:()=>F(G),disabled:u===G,className:"px-3 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:"Última"})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:v?"Editar Configuración de Honorarios":"Nueva Configuración de Honorarios"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Médico *"}),e.jsxs("select",{value:l.medico_id,onChange:_=>B(_.target.value),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",disabled:v,children:[e.jsx("option",{value:"",children:"Seleccionar médico..."}),r.map(_=>e.jsxs("option",{value:_.id,children:["Dr(a). ",_.nombre," ",_.apellido," - ",_.especialidad]},_.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Especialidad"}),e.jsx("input",{type:"text",value:l.especialidad,onChange:_=>k({...l,especialidad:_.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Especialidad médica"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Servicio *"}),e.jsx("select",{value:l.tipo_servicio,onChange:_=>k({...l,tipo_servicio:_.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",children:d.map(_=>e.jsx("option",{value:_.value,children:_.label},_.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tarifa Específica (Opcional)"}),e.jsxs("select",{value:l.tarifa_id,onChange:_=>k({...l,tarifa_id:_.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"",children:"Configuración general para el tipo de servicio"}),p.filter(_=>_.servicio_tipo===l.tipo_servicio).map(_=>e.jsxs("option",{value:_.id,children:[_.descripcion," - S/ ",_.precio_particular]},_.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Si selecciona una tarifa específica, esta configuración solo se aplicará a esa tarifa. Si no selecciona ninguna, se aplicará a todas las tarifas del tipo de servicio."})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-3",children:"Configuración de Honorarios"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:"Por Porcentajes"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Porcentaje Clínica (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:l.porcentaje_clinica,onChange:_=>W("porcentaje_clinica",_.target.value),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Porcentaje Médico (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:l.porcentaje_medico,onChange:_=>W("porcentaje_medico",_.target.value),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"0.00"})]}),l.porcentaje_clinica&&l.porcentaje_medico&&e.jsxs("div",{className:`text-xs p-2 rounded ${Math.abs(parseFloat(l.porcentaje_clinica)+parseFloat(l.porcentaje_medico)-100)<=.01?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:["Total: ",(parseFloat(l.porcentaje_clinica)+parseFloat(l.porcentaje_medico)).toFixed(2),"%"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:"Por Montos Fijos"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Monto Fijo Clínica (S/)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:l.monto_fijo_clinica,onChange:_=>k({...l,monto_fijo_clinica:_.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Monto Fijo Médico (S/)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:l.monto_fijo_medico,onChange:_=>k({...l,monto_fijo_medico:_.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"0.00"})]})]})]})]}),e.jsxs("div",{className:"mt-3 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-700",children:[e.jsx("strong",{children:"Nota:"})," Puede usar porcentajes O montos fijos, no ambos. Los porcentajes se calculan sobre el precio de la tarifa correspondiente."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vigencia Desde *"}),e.jsx("input",{type:"date",value:l.vigencia_desde,onChange:_=>k({...l,vigencia_desde:_.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vigencia Hasta (Opcional)"}),e.jsx("input",{type:"date",value:l.vigencia_hasta,onChange:_=>k({...l,vigencia_hasta:_.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaciones"}),e.jsx("textarea",{value:l.observaciones,onChange:_=>k({...l,observaciones:_.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",rows:"3",placeholder:"Observaciones adicionales sobre esta configuración..."})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.activo===1,onChange:_=>k({...l,activo:_.target.checked?1:0}),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Configuración activa"})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-6",children:[e.jsx("button",{onClick:D,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:H,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:v?"Actualizar":"Crear"})]})]})})]})}function $t(){const[s,i]=t.useState([]),[r,x]=t.useState([]),[p,C]=t.useState(!0),[w,h]=t.useState("todos"),[N,g]=t.useState("todos"),[v,y]=t.useState(()=>{const F=new Date;return F.setDate(1),F.toISOString().split("T")[0]}),[o,E]=t.useState(()=>new Date().toISOString().split("T")[0]),[S,c]=t.useState(1),[u]=t.useState(15),[a,n]=t.useState(!1),[d,l]=t.useState(null),[k,M]=t.useState({estado_pago_medico:"pagado",metodo_pago_medico:"efectivo",observaciones:""}),m=[{value:"pendiente",label:"Pendiente",color:"bg-yellow-100 text-yellow-800"},{value:"pagado",label:"Pagado",color:"bg-green-100 text-green-800"},{value:"cancelado",label:"Cancelado",color:"bg-red-100 text-red-800"}],b=[{value:"efectivo",label:"Efectivo"},{value:"transferencia",label:"Transferencia Bancaria"},{value:"cheque",label:"Cheque"},{value:"deposito",label:"Depósito Bancario"}];t.useEffect(()=>{j()},[]),t.useEffect(()=>{D()},[w,N,v,o]);const j=async()=>{try{C(!0),await Promise.all([P(),D()])}catch(F){console.error("Error al cargar datos:",F)}finally{C(!1)}},P=async()=>{try{const _=await(await fetch(`${I}api_medicos.php`,{credentials:"include"})).json();_.success&&x(_.medicos||[])}catch(F){console.error("Error al cargar médicos:",F)}},D=async()=>{try{let F=`${I}api_movimientos_honorarios.php?fecha_desde=${v}&fecha_hasta=${o}`;w!=="todos"&&(F+=`&medico_id=${w}`),N!=="todos"&&(F+=`&estado_pago=${N}`);const T=await(await fetch(F,{credentials:"include"})).json();T.success&&i(T.movimientos||[])}catch(F){console.error("Error al cargar movimientos:",F)}},O=F=>{l(F),M({estado_pago_medico:F.estado_pago_medico,metodo_pago_medico:F.metodo_pago_medico||"efectivo",observaciones:""}),n(!0)},H=()=>{n(!1),l(null)},$=async()=>{if(d)try{const _=await(await fetch(`${I}api_movimientos_honorarios.php`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:d.id,...k})})).json();_.success?(V.fire({title:"¡Éxito!",text:"Estado de pago actualizado correctamente",icon:"success",confirmButtonText:"OK"}),H(),D()):V.fire("Error",_.error||"Error al actualizar el pago","error")}catch(F){console.error("Error:",F),V.fire("Error","Error de conexión","error")}},B=async F=>{if((await V.fire({title:"¿Marcar como pagado?",text:`¿Confirma que se pagó S/ ${F.monto_medico} a ${F.medico_nombre} ${F.medico_apellido}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Sí, marcar como pagado",cancelButtonText:"Cancelar",confirmButtonColor:"#10b981"})).isConfirmed)try{const R=await(await fetch(`${I}api_movimientos_honorarios.php`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:F.id,estado_pago_medico:"pagado",metodo_pago_medico:"efectivo"})})).json();R.success?(V.fire("¡Pagado!","El honorario ha sido marcado como pagado","success"),D()):V.fire("Error",R.error||"Error al marcar como pagado","error")}catch(T){console.error("Error:",T),V.fire("Error","Error de conexión","error")}},W=s.length,f=Math.ceil(W/u),A=(S-1)*u,G=A+u,Y=s.slice(A,G),L=s.reduce((F,_)=>(F.total+=parseFloat(_.monto_medico),_.estado_pago_medico==="pagado"?F.pagado+=parseFloat(_.monto_medico):_.estado_pago_medico==="pendiente"&&(F.pendiente+=parseFloat(_.monto_medico)),F),{total:0,pagado:0,pendiente:0}),J=F=>{c(F)};return t.useEffect(()=>{c(1)},[w,N,v,o]),p?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"text-xl",children:"Cargando movimientos de honorarios..."})}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h1",{className:"text-3xl font-bold text-blue-800",children:"💳 Pagos de Honorarios Médicos"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-blue-800 text-sm font-medium",children:"Total Honorarios"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:["S/ ",L.total.toFixed(2)]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-green-800 text-sm font-medium",children:"Pagado"}),e.jsxs("div",{className:"text-2xl font-bold text-green-900",children:["S/ ",L.pagado.toFixed(2)]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-yellow-800 text-sm font-medium",children:"Pendiente"}),e.jsxs("div",{className:"text-2xl font-bold text-yellow-900",children:["S/ ",L.pendiente.toFixed(2)]})]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700 mb-2",children:"Desde:"}),e.jsx("input",{type:"date",value:v,onChange:F=>y(F.target.value),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700 mb-2",children:"Hasta:"}),e.jsx("input",{type:"date",value:o,onChange:F=>E(F.target.value),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700 mb-2",children:"Médico:"}),e.jsxs("select",{value:w,onChange:F=>h(F.target.value),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"todos",children:"Todos los médicos"}),r.map(F=>e.jsxs("option",{value:F.id,children:["Dr(a). ",F.nombre," ",F.apellido]},F.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700 mb-2",children:"Estado:"}),e.jsxs("select",{value:N,onChange:F=>g(F.target.value),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"todos",children:"Todos los estados"}),m.map(F=>e.jsx("option",{value:F.value,children:F.label},F.value))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("span",{className:"text-gray-600 text-sm",children:[W," movimiento",W!==1?"s":""," - Página ",S," de ",f]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha/Hora"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Médico"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paciente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Servicio"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Honorario"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Y.map(F=>{const _=m.find(T=>T.value===F.estado_pago_medico);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:F.fecha}),e.jsx("div",{className:"text-sm text-gray-500",children:F.hora})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["Dr(a). ",F.medico_nombre," ",F.medico_apellido]}),e.jsx("div",{className:"text-sm text-gray-500",children:F.especialidad})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:F.paciente_nombre?e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[F.paciente_nombre," ",F.paciente_apellido]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["DNI: ",F.dni]})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"Sin paciente"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:F.tipo_servicio}),F.tarifa_descripcion&&e.jsx("div",{className:"text-xs text-gray-500",children:F.tarifa_descripcion})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["S/ ",parseFloat(F.monto_medico).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Total: S/ ",parseFloat(F.tarifa_total).toFixed(2)]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${_?.color}`,children:_?.label}),F.fecha_pago_medico&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Pagado: ",F.fecha_pago_medico]}),F.metodo_pago_medico&&F.estado_pago_medico==="pagado"&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Método: ",b.find(T=>T.value===F.metodo_pago_medico)?.label]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[F.estado_pago_medico==="pendiente"&&e.jsx("button",{onClick:()=>B(F),className:"text-green-600 hover:text-green-900 px-3 py-1 bg-green-100 rounded text-sm",children:"💰 Marcar Pagado"}),e.jsx("button",{onClick:()=>O(F),className:"text-blue-600 hover:text-blue-900 px-3 py-1 bg-blue-100 rounded text-sm",children:"✏️ Editar"})]})})]},F.id)})})]})}),s.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay movimientos de honorarios para este filtro"})]}),f>1&&e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mt-6",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("button",{onClick:()=>J(1),disabled:S===1,className:"px-3 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:"Primera"}),e.jsx("button",{onClick:()=>J(S-1),disabled:S===1,className:"px-3 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:"Anterior"}),Array.from({length:Math.min(5,f)},(F,_)=>{let T;return f<=5?T=_+1:T=Math.max(1,Math.min(S-2,f-4))+_,e.jsx("button",{onClick:()=>J(T),className:`px-3 py-1 text-sm border rounded ${S===T?"bg-blue-500 text-white":"hover:bg-gray-100"}`,children:T},T)}),e.jsx("button",{onClick:()=>J(S+1),disabled:S===f,className:"px-3 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:"Siguiente"}),e.jsx("button",{onClick:()=>J(f),disabled:S===f,className:"px-3 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:"Última"})]})}),a&&d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Editar Estado de Pago"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Médico:"})," Dr(a). ",d.medico_nombre," ",d.medico_apellido]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Monto:"})," S/ ",parseFloat(d.monto_medico).toFixed(2)]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:[e.jsx("strong",{children:"Fecha:"})," ",d.fecha]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado de Pago *"}),e.jsx("select",{value:k.estado_pago_medico,onChange:F=>M({...k,estado_pago_medico:F.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:m.map(F=>e.jsx("option",{value:F.value,children:F.label},F.value))})]}),k.estado_pago_medico==="pagado"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Método de Pago *"}),e.jsx("select",{value:k.metodo_pago_medico,onChange:F=>M({...k,metodo_pago_medico:F.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:b.map(F=>e.jsx("option",{value:F.value,children:F.label},F.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaciones"}),e.jsx("textarea",{value:k.observaciones,onChange:F=>M({...k,observaciones:F.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Observaciones sobre el pago..."})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-6",children:[e.jsx("button",{onClick:H,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:$,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Actualizar"})]})]})})]})}function At(){const[s,i]=t.useState(()=>{const x=sessionStorage.getItem("usuario"),p=sessionStorage.getItem("medico");return x?JSON.parse(x):p?JSON.parse(p):null}),r=async()=>{try{await fetch("/policlinico-2demayo/api_logout.php",{method:"POST",credentials:"include"})}catch(x){console.error("Error al cerrar sesión en el backend:",x)}i(null),sessionStorage.removeItem("usuario"),sessionStorage.removeItem("medico"),window.location.href="/"};return t.useEffect(()=>{s&&(s.rol==="medico"?(sessionStorage.setItem("medico",JSON.stringify(s)),sessionStorage.removeItem("usuario")):(sessionStorage.setItem("usuario",JSON.stringify(s)),sessionStorage.removeItem("medico")))},[s]),e.jsx(cs,{children:s?e.jsx(Ns,{usuario:s,onLogout:r,children:e.jsxs(ds,{children:[e.jsx(Z,{path:"/",element:s?.rol==="medico"?e.jsx(ge,{to:"/mis-consultas",replace:!0}):s?.rol==="laboratorista"?e.jsx(ge,{to:"/panel-laboratorio",replace:!0}):s?.rol==="enfermero"?e.jsx(ge,{to:"/panel-enfermero",replace:!0}):s?.rol==="químico"||s?.rol==="quimico"?e.jsx(ge,{to:"/medicamentos",replace:!0}):e.jsx(_s,{usuario:s})}),e.jsx(Z,{path:"/pacientes",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Ss,{})})}),e.jsx(Z,{path:"/usuarios",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(Es,{})})}),e.jsx(Z,{path:"/agendar-consulta",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Ls,{})})}),s?.rol==="medico"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{path:"/mis-consultas",element:e.jsx(ee,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Ts,{usuario:s})})}),e.jsx(Z,{path:"/panel-medico",element:e.jsx(ee,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Vs,{})})}),e.jsx(Z,{path:"/historia-clinica/:pacienteId",element:e.jsx(ee,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Le,{})})}),e.jsx(Z,{path:"/historia-clinica/:pacienteId/:consultaId",element:e.jsx(ee,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Le,{})})}),e.jsx(Z,{path:"/historial-consultas",element:e.jsx(ee,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(at,{medicoId:s.id})})}),e.jsx(Z,{path:"/solicitud-laboratorio/:consultaId",element:e.jsx(ee,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(dt,{})})}),e.jsx(Z,{path:"/resultados-laboratorio/:consultaId",element:e.jsx(ee,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(bt,{})})})]}),(s?.rol==="químico"||s?.rol==="quimico")&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{path:"/medicamentos",element:e.jsx(ee,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(Fe,{})})}),e.jsx(Z,{path:"/farmacia/cotizador",element:e.jsx(ee,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(we,{})})}),e.jsx(Z,{path:"/farmacia/ventas",element:e.jsx(ee,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(Ft,{})})})]}),s?.rol==="enfermero"&&e.jsx(Z,{path:"/panel-enfermero",element:e.jsx(ee,{usuario:s,rolesPermitidos:["enfermero"],children:e.jsx(ot,{})})}),(s?.rol==="administrador"||s?.rol==="recepcionista")&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{path:"/medicos",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(Rs,{})})}),e.jsx(Z,{path:"/reportes",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(ft,{})})}),e.jsx(Z,{path:"/contabilidad/ingresos",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Nt,{})})}),e.jsx(Z,{path:"/contabilidad/nuevo-ingreso",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(vt,{})})}),e.jsx(Z,{path:"/contabilidad/ingresos-detalle",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(yt,{})})}),e.jsx(Z,{path:"/contabilidad/cierre-caja",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(wt,{})})}),e.jsx(Z,{path:"/contabilidad/egresos",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Módulo de Egresos"}),e.jsx("p",{className:"text-gray-600",children:"En construcción..."})]})})}),e.jsx(Z,{path:"/contabilidad/reportes",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Reportes Financieros"}),e.jsx("p",{className:"text-gray-600",children:"En construcción..."})]})})}),e.jsx(Z,{path:"/contabilidad/balance",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Balance General"}),e.jsx("p",{className:"text-gray-600",children:"En construcción..."})]})})}),e.jsx(Z,{path:"/configuracion",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(kt,{})})}),e.jsx(Z,{path:"/reabrir-caja",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(Ct,{})})}),e.jsx(Z,{path:"/gestion-tarifas",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(_t,{})})}),e.jsx(Z,{path:"/gestion-honorarios",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(Dt,{})})}),e.jsx(Z,{path:"/pagos-honorarios",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx($t,{})})}),e.jsx(Z,{path:"/cotizar-laboratorio/:pacienteId",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(xt,{})})}),e.jsx(Z,{path:"/cotizar-rayosx/:pacienteId",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(mt,{})})}),e.jsx(Z,{path:"/cotizar-ecografia/:pacienteId",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(ht,{})})}),e.jsx(Z,{path:"/cotizar-farmacia/:pacienteId",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(we,{})})}),e.jsx(Z,{path:"/cotizar-procedimientos/:pacienteId",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Pt,{})})}),e.jsx(Z,{path:"/seleccionar-servicio",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Tt,{})})}),e.jsx(Z,{path:"/consumo-paciente/:pacienteId",element:e.jsx(ee,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Lt,{})})})]}),s?.rol==="laboratorista"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{path:"/panel-laboratorio",element:e.jsx(ee,{usuario:s,rolesPermitidos:["laboratorista"],children:e.jsx(gt,{})})}),e.jsx(Z,{path:"/examenes-laboratorio",element:e.jsx(ee,{usuario:s,rolesPermitidos:["laboratorista"],children:e.jsx(ms,{})})})]}),(s?.rol==="químico"||s?.rol==="quimico")&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{path:"/medicamentos",element:e.jsx(ee,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(Fe,{})})}),e.jsx(Z,{path:"/farmacia/cotizador",element:e.jsx(ee,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(we,{})})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-800 via-blue-500 to-green-400",children:e.jsx(gs,{onLogin:i})})})}class zt extends Ne.Component{constructor(i){super(i),this.state={hasError:!1}}static getDerivedStateFromError(i){return{hasError:!0}}componentDidCatch(i,r){console.error("Error capturado por ErrorBoundary:",i,r)}render(){return this.state.hasError?e.jsxs("div",{className:"max-w-md mx-auto mt-6 p-4 bg-red-100 text-red-700 rounded shadow text-center",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"¡Ups! Algo salió mal."}),e.jsx("p",{children:"Por favor, recarga la página o intenta más tarde."})]}):this.props.children}}xs.createRoot(document.getElementById("root")).render(e.jsx(Ne.StrictMode,{children:e.jsx(zt,{children:e.jsx(At,{})})}));
