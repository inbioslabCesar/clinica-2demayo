import{r as t,c as ne,j as e,I as W,i as Te,L as te,S as q,d as fe,C as Me,e as De,f as ue,u as ce,w as Pe,b as Ae,E as je,a as Ne,R as pe,l as ve,g as de,h as $e,N as he,k as ze,m as we,n as Ce,o as ke,p as Be,q as Oe,s as Re,t as _e,v as He,x as Ie,B as Ve,y as We,z as Y,A as qe}from"./vendor-7BPgS6x8.js";import{B as O,E as Ge}from"./examenes-laboratorio-crud-CCkz_McC.js";import{P as Ue,a as Je,S as ye}from"./paciente-list-DQxYsTws.js";import{U as Xe}from"./usuario-list-1LegjKv4.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))d(x);new MutationObserver(x=>{for(const w of x)if(w.type==="childList")for(const y of w.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&d(y)}).observe(document,{childList:!0,subtree:!0});function a(x){const w={};return x.integrity&&(w.integrity=x.integrity),x.referrerPolicy&&(w.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?w.credentials="include":x.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function d(x){if(x.ep)return;x.ep=!0;const w=a(x);fetch(x.href,w)}})();function Ke({onLogin:s}){const[r,a]=t.useState(""),[d,x]=t.useState(""),[w,y]=t.useState(""),[h,j]=t.useState(!1),[N,v]=t.useState(!1),C=ne(),l=()=>window.location.protocol!=="https:"&&window.location.hostname!=="localhost"?{isValid:!1,message:"⚠️ Conexión insegura detectada. Se requiere HTTPS para proteger tus credenciales."}:d.length<4?{isValid:!1,message:"La contraseña es demasiado corta"}:{isValid:!0},_=async E=>{E.preventDefault(),y(""),j(!0);const o=l();if(!o.isValid){y(o.message),j(!1);return}const g=r.includes("@")&&r.includes(".");try{if(g){let n,c;try{n=await fetch(O+"api_login_medico.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:r,password:d}),credentials:"include"}),c=await n.json()}catch{n={ok:!1},c={}}if(n.ok&&c.success){const S={...c.medico,rol:"medico"};sessionStorage.setItem("medico",JSON.stringify(S)),s&&s(S),C("/");return}let m,f;try{m=await fetch(O+"api_login.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({usuario:r,password:d}),credentials:"include"}),f=await m.json()}catch{m={ok:!1},f={}}if(m.ok&&f.success){sessionStorage.setItem("usuario",JSON.stringify(f.usuario)),s&&s(f.usuario),C("/");return}}else{let n,c;try{n=await fetch(O+"api_login.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({usuario:r,password:d}),credentials:"include"}),c=await n.json()}catch{n={ok:!1},c={}}if(n.ok&&c.success){sessionStorage.setItem("usuario",JSON.stringify(c.usuario)),s&&s(c.usuario),C("/");return}let m,f;try{m=await fetch(O+"api_login_medico.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:r,password:d}),credentials:"include"}),f=await m.json()}catch{m={ok:!1},f={}}if(m.ok&&f.success){const S={...f.medico,rol:"medico"};sessionStorage.setItem("medico",JSON.stringify(S)),s&&s(S),C("/");return}}y("Usuario o contraseña incorrectos")}catch{y("Error de conexión con el servidor")}finally{j(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-900 via-purple-800 to-indigo-900 flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-blue-400/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-80 h-80 bg-purple-400/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-3/4 left-1/2 w-64 h-64 bg-indigo-400/20 rounded-full blur-3xl"})]}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl border border-white/20 shadow-2xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"relative mx-auto w-20 h-20 mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full blur-lg opacity-60"}),e.jsx("img",{src:"/2demayo.svg",alt:"Logo clínica",className:"relative w-20 h-20 object-contain bg-white/90 rounded-full p-3 shadow-lg ring-4 ring-white/30"})]}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2 drop-shadow-lg",children:"Clínica 2 de Mayo"}),e.jsx("p",{className:"text-lg text-white/80",children:"Acceso al Sistema Médico"})]}),e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(W,{iconName:"Contact",className:"text-xl text-white/60"})}),e.jsx("input",{type:"text",placeholder:"Usuario o email del médico",value:r,onChange:E=>a(E.target.value),className:"w-full bg-white/10 border border-white/20 rounded-2xl pl-12 pr-4 py-4 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:border-transparent backdrop-blur-sm transition-all duration-300",required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(W,{iconName:"Lock",className:"text-xl text-white/60"})}),e.jsx("input",{type:N?"text":"password",placeholder:"Contraseña",value:d,onChange:E=>x(E.target.value),className:"w-full bg-white/10 border border-white/20 rounded-2xl pl-12 pr-12 py-4 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:border-transparent backdrop-blur-sm transition-all duration-300",required:!0}),e.jsx("button",{type:"button",onClick:()=>v(!N),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-white/60 hover:text-white transition-colors",children:e.jsx(W,{iconName:N?"Hide":"RedEye",className:"text-xl"})})]}),e.jsxs("button",{type:"submit",disabled:h,className:"w-full bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 hover:from-blue-700 hover:via-purple-700 hover:to-indigo-800 text-white font-bold rounded-2xl py-4 px-6 shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-3 relative overflow-hidden",children:[h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Verificando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{iconName:"SignIn",className:"text-xl"}),e.jsx("span",{children:"Ingresar al Sistema"})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"})]}),w&&e.jsx("div",{className:"bg-red-500/20 backdrop-blur-sm border border-red-400/30 rounded-2xl p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-200",children:[e.jsx(W,{iconName:"ErrorBadge",className:"text-xl"}),e.jsx("span",{className:"font-medium",children:w})]})})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-white/60 text-sm",children:[e.jsx(W,{iconName:"Shield",className:"text-lg"}),e.jsx("span",{children:"Sistema Seguro y Confiable"})]})})]})})]})}function Ye(){return e.jsx("footer",{className:"w-full bg-purple-800 py-4 border-t border-blue-500 shadow-inner",children:e.jsx("div",{className:"container mx-auto text-center",children:e.jsxs("span",{className:"text-white text-sm font-medium drop-shadow",children:["© ",new Date().getFullYear()," Clínica 2 de Mayo. Todos los derechos reservados."]})})})}Te();function Qe({open:s,onClose:r,onLogout:a,usuario:d}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed inset-0 z-40 bg-black bg-opacity-40 transition-opacity duration-200 md:hidden ${s?"block":"hidden"}`,onClick:r,"aria-hidden":"true"}),e.jsx("aside",{className:`fixed z-50 top-0 left-0 h-full w-64 bg-white border-r border-blue-500 shadow-lg transform transition-transform duration-200 ease-in-out
        ${s?"translate-x-0":"-translate-x-full"}
        md:translate-x-0 md:static md:flex md:flex-col md:z-10 md:h-auto md:shadow-none md:bg-white md:w-64`,children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsxs("div",{className:"flex flex-col items-center py-6 bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 text-white rounded-b-2xl mx-2 mb-4 shadow-lg",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-full blur-md"}),e.jsx("img",{src:"/2demayo.svg",alt:"Logo",className:"relative h-16 w-16 object-contain bg-white rounded-full p-2 shadow-lg ring-4 ring-white/30",onError:x=>{x.target.onerror=null,x.target.src="/logo.svg"}})]}),e.jsx("h5",{className:"text-lg font-bold text-white mt-3 text-center drop-shadow-lg",children:"Clínica 2 de Mayo"}),e.jsx("div",{className:"w-12 h-0.5 bg-white/30 rounded-full mt-2"})]}),e.jsx("nav",{className:"flex flex-col gap-3 px-4 flex-1 overflow-y-auto",children:d?.rol==="medico"?e.jsxs(e.Fragment,{children:[e.jsxs(te,{to:"/mis-consultas",className:"py-2 px-3 rounded-lg text-indigo-700 hover:bg-indigo-100 font-medium flex items-center gap-2",onClick:r,children:[e.jsx(W,{iconName:"Contact",className:"text-xl"}),"Mis Consultas"]}),e.jsxs(te,{to:"/panel-medico",className:"py-2 px-3 rounded-lg text-blue-700 hover:bg-blue-100 font-medium flex items-center gap-2",onClick:r,children:[e.jsx(W,{iconName:"Calendar",className:"text-xl"}),"Disponibilidad"]}),e.jsxs(te,{to:"/historial-consultas",className:"py-2 px-3 rounded-lg text-blue-700 hover:bg-blue-100 font-medium flex items-center gap-2",onClick:r,children:[e.jsx(W,{iconName:"History",className:"text-xl"}),"Historial de consultas"]})]}):d?.rol==="enfermero"?e.jsx(e.Fragment,{children:e.jsx(te,{to:"/panel-enfermero",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:r,children:"Panel Enfermería"})}):d?.rol==="laboratorista"?e.jsxs(e.Fragment,{children:[e.jsx(te,{to:"/panel-laboratorio",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:r,children:"Panel Laboratorio"}),e.jsx(te,{to:"/examenes-laboratorio",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:r,children:"Gestión de Exámenes"})]}):d?.rol==="químico"||d?.rol==="quimico"?e.jsxs(e.Fragment,{children:[e.jsx(te,{to:"/medicamentos",className:"py-2 px-3 rounded-lg text-pink-700 hover:bg-pink-100 font-medium",onClick:r,children:"Medicamentos"}),e.jsx(te,{to:"/farmacia/cotizador",className:"py-2 px-3 rounded-lg text-blue-700 hover:bg-blue-100 font-medium",onClick:r,children:"Cotizador Farmacia"}),e.jsx(te,{to:"/farmacia/ventas",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:r,children:"Ventas de Farmacia"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(te,{to:"/",className:"group relative py-3 px-4 rounded-xl bg-gradient-to-r from-purple-600 via-purple-700 to-indigo-800 text-white font-semibold shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 flex items-center gap-3 overflow-hidden",onClick:r,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"relative z-10 flex items-center justify-center w-8 h-8 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(W,{iconName:"ViewDashboard",className:"text-xl text-white"})}),e.jsx("span",{className:"relative z-10 text-lg",children:"Dashboard"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"})]}),e.jsxs(te,{to:"/pacientes",className:"py-3 px-4 rounded-lg text-cyan-700 hover:bg-gradient-to-r hover:from-cyan-50 hover:to-blue-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:r,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-cyan-100 rounded-lg",children:e.jsx(W,{iconName:"People",className:"text-xl text-cyan-600"})}),e.jsx("span",{children:"Pacientes"})]}),d?.rol==="administrador"&&e.jsxs(e.Fragment,{children:[e.jsxs(te,{to:"/usuarios",className:"py-3 px-4 rounded-lg text-blue-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:r,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 rounded-lg",children:e.jsx(W,{iconName:"People",className:"text-xl text-blue-600"})}),e.jsx("span",{children:"Usuarios"})]}),e.jsxs(te,{to:"/medicos",className:"py-3 px-4 rounded-lg text-emerald-700 hover:bg-gradient-to-r hover:from-emerald-50 hover:to-green-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:r,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-emerald-100 rounded-lg",children:e.jsx(W,{iconName:"Health",className:"text-xl text-emerald-600"})}),e.jsx("span",{children:"Médicos"})]}),e.jsxs(te,{to:"/gestion-tarifas",className:"py-3 px-4 rounded-lg text-amber-700 hover:bg-gradient-to-r hover:from-amber-50 hover:to-yellow-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:r,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-amber-100 rounded-lg",children:e.jsx(W,{iconName:"Money",className:"text-xl text-amber-600"})}),e.jsx("span",{children:"💰 Gestión de Tarifas"})]})]}),e.jsxs(te,{to:"/reportes",className:"py-3 px-4 rounded-lg text-violet-700 hover:bg-gradient-to-r hover:from-violet-50 hover:to-purple-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:r,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-violet-100 rounded-lg",children:e.jsx(W,{iconName:"BarChart4",className:"text-xl text-violet-600"})}),e.jsx("span",{children:"Reportes"})]}),e.jsxs(te,{to:"/configuracion",className:"py-3 px-4 rounded-lg text-gray-700 hover:bg-gradient-to-r hover:from-gray-50 hover:to-slate-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:r,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-gray-100 rounded-lg",children:e.jsx(W,{iconName:"Settings",className:"text-xl text-gray-600"})}),e.jsx("span",{children:"Configuración"})]})]})}),e.jsx("div",{className:"mt-auto p-4",children:e.jsxs("button",{onClick:a,className:"group w-full bg-gradient-to-r from-red-600 via-red-700 to-rose-800 text-white font-bold rounded-xl py-3 px-4 shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 flex items-center justify-center gap-3 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-700 via-rose-600 to-pink-700 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"relative z-10 flex items-center justify-center w-6 h-6 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(W,{iconName:"SignOut",className:"text-lg text-white"})}),e.jsx("span",{className:"relative z-10",children:"Cerrar sesión"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"})]})})]})})]})}function Ze({usuario:s,onMenu:r}){return e.jsxs("header",{className:"flex items-center justify-between px-6 py-3 bg-purple-800 shadow text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"/2demayo.svg",alt:"Logo",className:"h-10 w-10 object-contain bg-white rounded-full p-1 shadow"}),e.jsx("span",{className:"text-xl font-bold drop-shadow",children:"Clínica 2 de Mayo"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-white/90",children:[s?.nombre," ",s?.apellido||""]}),e.jsx("button",{className:"md:hidden ml-2",onClick:r,"aria-label":"Abrir menú",children:e.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]})]})}function es({usuario:s,onLogout:r,children:a}){const[d,x]=t.useState(!1);return t.useEffect(()=>{const w=()=>{window.innerWidth>=768&&x(!1)};return window.addEventListener("resize",w),w(),()=>window.removeEventListener("resize",w)},[]),e.jsxs("div",{className:"min-h-screen flex flex-col bg-blue-50 overflow-x-hidden",children:[e.jsx(Ze,{usuario:s,onMenu:()=>x(!0)}),e.jsxs("div",{className:"flex flex-1 max-w-full",children:[e.jsx(Qe,{open:d,onClose:()=>x(!1),onLogout:r,usuario:s}),e.jsx("main",{className:"flex-1 px-2 sm:px-4 md:px-8 min-w-0 max-w-full overflow-x-auto",children:a})]}),e.jsx(Ye,{})]})}function Fe({onPacienteEncontrado:s,onNoEncontrado:r,onNuevaBusqueda:a}){const[d,x]=t.useState(""),[w,y]=t.useState("dni"),[h,j]=t.useState([]),[N,v]=t.useState(!1),[C,l]=t.useState(!1),_=async g=>{if(g.preventDefault(),!!d.trim()){v(!0),j([]);try{const c=await(await fetch(O+"api_pacientes_buscar.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tipo:w,valor:d})})).json();c.success&&Array.isArray(c.pacientes)&&c.pacientes.length>0?(j(c.pacientes),l(!1),c.pacientes.length===1&&s&&(l(!1),s(c.pacientes[0]))):(j([]),l(!0),r())}catch{j([]),r()}v(!1)}},E=g=>{x(g.target.value),l(!1),a&&a()},o=g=>{y(g.target.value),l(!1),a&&a()};return e.jsxs("div",{className:"mb-4",children:[e.jsxs("form",{onSubmit:_,className:"flex flex-col md:flex-row gap-2 mb-4",children:[e.jsxs("select",{value:w,onChange:o,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"dni",children:"DNI"}),e.jsx("option",{value:"nombre",children:"Nombre y Apellido"}),e.jsx("option",{value:"historia",children:"Historia Clínica"})]}),e.jsx("input",{type:"text",value:d,onChange:E,placeholder:`Buscar por ${w}`,className:"border rounded px-2 py-1 flex-1"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white rounded px-4 py-1 font-bold",disabled:N,children:"Buscar"})]}),N&&e.jsx("div",{className:"text-blue-600",children:"Buscando..."}),h.length>0&&e.jsxs("div",{className:"mt-2 bg-blue-50 rounded-lg p-2",children:[e.jsx("div",{className:"font-bold mb-2",children:"Selecciona un paciente:"}),e.jsx("ul",{className:"divide-y divide-blue-100",children:h.length===1?e.jsx("li",{className:"py-2 flex flex-col md:flex-row md:items-center gap-2",children:e.jsxs("span",{className:"w-full px-3 py-2 rounded bg-blue-100 font-semibold text-blue-900",children:[h[0].nombre," ",h[0].apellido," | DNI: ",h[0].dni," | HC: ",h[0].historia_clinica]})},h[0].id):h.map(g=>e.jsx("li",{className:"py-2 flex flex-col md:flex-row md:items-center gap-2",children:e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 rounded bg-blue-100 hover:bg-blue-200 font-semibold text-blue-900",onClick:()=>{l(!1),s(g)},children:[g.nombre," ",g.apellido," | DNI: ",g.dni," | HC: ",g.historia_clinica]})},g.id))})]}),C&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded border border-yellow-300 text-sm",disabled:!0,children:"Paciente no encontrado"})})]})}function ss({paciente:s}){return e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4",children:[e.jsx("div",{className:"font-bold text-blue-800 mb-2",children:"Paciente encontrado:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Nombre:"})," ",s.nombre]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Apellido:"})," ",s.apellido]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"DNI:"})," ",s.dni]}),s.fecha_nacimiento&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Fecha de nacimiento:"})," ",s.fecha_nacimiento]}),s.sexo&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Sexo:"})," ",s.sexo]}),s.direccion&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Dirección:"})," ",s.direccion]}),s.telefono&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Teléfono:"})," ",s.telefono]}),s.email&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",s.email]}),s.tipo_seguro&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Tipo de seguro:"})," ",s.tipo_seguro]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Historia Clínica:"})," ",s.historia_clinica]}),s.edad&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Edad:"})," ",s.edad," ",s.edad_unidad||""]}),s.procedencia&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Procedencia:"})," ",s.procedencia]})]})]})]})}function me({paciente:s,servicio:r,onCobroCompleto:a,onCancelar:d,detalles:x,total:w}){const[y,h]=t.useState([]),[j,N]=t.useState("particular"),[v,C]=t.useState("efectivo"),[l,_]=t.useState(""),[E,o]=t.useState(!1);t.useEffect(()=>{x||g()},[x]);const g=async()=>{try{const i=await(await fetch(`${O}api_tarifas.php`,{credentials:"include"})).json();i.success&&h(i.tarifas||[])}catch(L){console.error("Error al cargar tarifas:",L)}},n=t.useMemo(()=>Array.isArray(x)&&x.length>0?x:[],[x]),c=()=>typeof w=="number"&&w>0?w:n.reduce((L,i)=>L+i.subtotal,0),m=async()=>{if(n.length===0){q.fire("Error","No hay servicios para cobrar","error");return}if(!s||!s.nombre||!s.dni||!s.historia_clinica){q.fire("Error","Faltan datos completos del paciente (nombre, DNI o historia clínica)","error");return}o(!0);try{const L=JSON.parse(sessionStorage.getItem("usuario")||"{}"),i={paciente_id:s.id,usuario_id:L.id,total:c(),tipo_pago:v,observaciones:l,detalles:n,servicio_info:r},b=await(await fetch(`${O}api_cobros.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)})).json();if(b.success){if(r?.key==="laboratorio"&&!r?.consulta_id){const M=n.map($=>$.servicio_id),z=await(await fetch(`${O}api_ordenes_laboratorio.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({consulta_id:null,examenes:M,paciente_id:s?.id||null,cobro_id:b.cobro_id})})).json()}await f(b.cobro_id,i),a&&a(b.cobro_id,r)}else q.fire("Error",b.error||"Error al procesar el cobro","error")}catch(L){console.error("Error:",L),q.fire("Error","Error de conexión con el servidor","error")}finally{o(!1)}},f=async(L,i)=>{const u=new Date().toLocaleString("es-PE"),b=s.apellido?`${s.nombre} ${s.apellido}`:s.nombre,M=`
      <div style="text-align: left; font-family: monospace;">
        <h3 style="text-align: center; margin-bottom: 20px;">🏥 CLÍNICA 2 DE MAYO</h3>
        <hr>
        <p><strong>COMPROBANTE DE PAGO #${L}</strong></p>
        <p>Fecha: ${u}</p>
        <p>Paciente: ${b}</p>
        <p>DNI: ${s.dni}</p>
        <p>H.C.: ${s.historia_clinica}</p>
        <hr>
        <p><strong>DETALLE:</strong></p>
        ${i.detalles.map(D=>`<p>${D.descripcion} x${D.cantidad} .... S/ ${D.subtotal.toFixed(2)}</p>`).join("")}
        <hr>
        <p><strong>TOTAL: S/ ${i.total.toFixed(2)}</strong></p>
  <p>Tipo de pago: ${v==="yape"?"Yape":v.toUpperCase()}</p>
        <p>Cobertura: ${j.toUpperCase()}</p>
        <hr>
        <p style="text-align: center; font-size: 12px;">
          Gracias por su preferencia<br>
          Conserve este comprobante
        </p>
      </div>
    `;await q.fire({title:"Cobro Procesado ✅",html:M,icon:"success",confirmButtonText:"Imprimir Comprobante",showCancelButton:!0,cancelButtonText:"Solo Continuar"}).then(D=>{if(D.isConfirmed){const z=window.open("","_blank");z.document.write(M),z.document.close(),z.print()}})};if(!r)return e.jsx("div",{children:"Seleccione un servicio primero"});const S=c();return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-blue-200",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-blue-800",children:"💰 Módulo de Cobros"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Paciente:"}),e.jsx("p",{children:s.nombre}),e.jsxs("p",{children:["DNI: ",s.dni," | H.C.: ",s.historia_clinica]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Tipo de Cobertura:"}),e.jsxs("select",{value:j,onChange:L=>N(L.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"particular",children:"Particular"}),e.jsx("option",{value:"seguro",children:"Seguro"}),e.jsx("option",{value:"convenio",children:"Convenio"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Detalle del Servicio:"}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded",children:[n.map((L,i)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:L.descripcion}),e.jsxs("span",{className:"font-bold",children:["S/ ",L.subtotal.toFixed(2)]})]},i)),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between items-center font-bold text-lg",children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{className:"text-green-600",children:["S/ ",S.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Método de Pago:"}),e.jsxs("select",{value:v,onChange:L=>C(L.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"}),e.jsx("option",{value:"transferencia",children:"Transferencia"}),e.jsx("option",{value:"yape",children:"Yape"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Observaciones:"}),e.jsx("textarea",{value:l,onChange:L=>_(L.target.value),className:"w-full border rounded px-3 py-2 h-20",placeholder:"Observaciones adicionales (opcional)"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:m,disabled:E||S<=0,className:"flex-1 bg-green-600 text-white py-3 px-6 rounded font-bold text-lg hover:bg-green-700 disabled:bg-gray-400",children:E?"Procesando...":`💳 Cobrar S/ ${S.toFixed(2)}`}),e.jsx("button",{onClick:d,className:"bg-gray-500 text-white py-3 px-6 rounded font-bold hover:bg-gray-600",children:"Cancelar"})]})]})}const ts=[{key:"consulta",label:"Consulta Médica",icon:"👨‍⚕️",requiresPayment:!1},{key:"laboratorio",label:"Laboratorio",icon:"🔬",requiresPayment:!0},{key:"farmacia",label:"Farmacia",icon:"💊",requiresPayment:!0},{key:"rayosx",label:"Rayos X",icon:"🩻",requiresPayment:!0},{key:"ecografia",label:"Ecografía",icon:"🩺",requiresPayment:!0},{key:"ocupacional",label:"Medicina Ocupacional",icon:"👷‍⚕️",requiresPayment:!0}],as=["consulta","laboratorio","farmacia","ecografia","rayosx","ocupacional"];function rs({paciente:s}){const r=ne(),[a,d]=t.useState(null),[x,w]=t.useState(!1),[y,h]=t.useState([]);t.useEffect(()=>{fetch(O+"api_tarifas.php",{credentials:"include"}).then(l=>l.json()).then(l=>{if(l.success&&Array.isArray(l.tarifas)){const _=l.tarifas.filter(E=>E.activo===1&&!as.includes(E.servicio_tipo)).map(E=>({key:E.servicio_tipo+"_"+E.id,label:E.descripcion,icon:"🛠️",requiresPayment:!0,tarifaId:E.id}));h(_)}})},[]);const j=l=>{l.key==="consulta"?r("/agendar-consulta",{state:{pacienteId:s.id}}):l.key==="laboratorio"?r(`/cotizar-laboratorio/${s.id}`):l.key==="farmacia"?r(`/cotizar-farmacia/${s.id}`):l.key==="rayosx"?r(`/cotizar-rayosx/${s.id}`):l.key==="ecografia"?r(`/cotizar-ecografia/${s.id}`):l.key==="ocupacional"?q.fire({title:"Página en construcción",text:"La funcionalidad de Medicina Ocupacional estará disponible próximamente.",icon:"info",confirmButtonText:"OK"}):l.key==="procedimiento"?r(`/cotizar-procedimientos/${s.id}`):l.requiresPayment?(d(l),w(!0)):C(l)},N=async(l,_)=>{w(!1),q.fire({title:"💰 Pago Procesado",text:`Servicio de ${_.label} pagado exitosamente.`,icon:"success",confirmButtonText:"OK"})},v=()=>{w(!1),d(null)},C=async l=>{const _=JSON.parse(sessionStorage.getItem("usuario")||"{}");if(!_.id){q.fire("Error","No se pudo identificar al usuario","error");return}try{const o=await(await fetch(O+"api_atenciones.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paciente_id:s.id,usuario_id:_.id,servicio:l.key,observaciones:""})})).json();o.success?q.fire({title:"Atención registrada",text:`Atención registrada para ${l.label}.`,icon:"success",confirmButtonText:"OK"}):q.fire({title:"Error",text:o.error||"No se pudo registrar la atención",icon:"error",confirmButtonText:"OK"})}catch(E){console.error("Error:",E),q.fire("Error","Error de conexión","error")}};return x&&a&&a.key!=="laboratorio"?e.jsx(me,{paciente:s,servicio:a,onCobroCompleto:N,onCancelar:v}):e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 text-blue-800",children:["🏥 Seleccionar Servicio para: ",s.nombre," ",s.apellido]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[ts.map(l=>l.key==="ocupacional"?e.jsxs("button",{onClick:()=>{q.fire({title:"Página en construcción",text:"La funcionalidad de Medicina Ocupacional estará disponible próximamente.",icon:"info",confirmButtonText:"OK"})},className:"flex items-center justify-center gap-2 p-4 bg-white border border-blue-300 rounded-lg hover:bg-blue-100 hover:border-blue-400 transition-colors font-medium text-blue-700 hover:text-blue-800",children:[e.jsx("span",{className:"text-2xl",children:l.icon}),e.jsx("span",{children:l.label}),l.requiresPayment&&e.jsx("span",{className:"text-green-600 text-sm",children:"💰"})]},l.key):e.jsxs("button",{onClick:()=>j(l),className:"flex items-center justify-center gap-2 p-4 bg-white border border-blue-300 rounded-lg hover:bg-blue-100 hover:border-blue-400 transition-colors font-medium text-blue-700 hover:text-blue-800",children:[e.jsx("span",{className:"text-2xl",children:l.icon}),e.jsx("span",{children:l.label}),l.requiresPayment&&e.jsx("span",{className:"text-green-600 text-sm",children:"💰"})]},l.key)),e.jsxs("button",{onClick:()=>j({key:"procedimiento",label:"Procedimientos",icon:"🛠️",requiresPayment:!0}),className:"flex items-center justify-center gap-2 p-4 bg-white border border-orange-300 rounded-lg hover:bg-orange-100 hover:border-orange-400 transition-colors font-medium text-orange-700 hover:text-orange-800",children:[e.jsx("span",{className:"text-2xl",children:"🛠️"}),e.jsx("span",{children:"Procedimientos"}),e.jsx("span",{className:"text-green-600 text-sm",children:"💰"})]},"procedimientos")]}),e.jsx("div",{className:"mt-3 text-sm text-gray-600 text-center",children:"💰 = Requiere pago previo | 🏥 = Agendar primero, cobrar después"})]})}function ns({onPacienteRegistrado:s}){const[r,a]=t.useState(null),[d,x]=t.useState(!1),w=()=>{a(null),x(!1)},y=h=>{a(h),s&&s()};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Fe,{onPacienteEncontrado:a,onNoEncontrado:()=>x(!0),onNuevaBusqueda:w}),r&&e.jsxs(e.Fragment,{children:[e.jsx(ss,{paciente:r}),e.jsx(rs,{paciente:r})]}),d&&!r&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"mb-2 text-blue-700",children:"Paciente no encontrado. ¿Desea registrarlo?"}),e.jsx(Ue,{initialData:{},onRegistroExitoso:y})]})]})}function is({usuario:s}){const[r,a]=t.useState(null),[d,x]=t.useState({pacientesHoy:0,consultasHoy:0,totalPacientes:0}),w=fe(),y=t.useCallback(async()=>{try{const v=await(await fetch(O+"api_estadisticas_dashboard.php")).json();v.success?x({pacientesHoy:v.estadisticas.pacientes_hoy,consultasHoy:v.estadisticas.consultas_hoy,totalPacientes:v.estadisticas.total_pacientes}):(console.error("Error al obtener estadísticas:",v.error),x({pacientesHoy:0,consultasHoy:0,totalPacientes:0}))}catch(N){console.error("Error de conexión al obtener estadísticas:",N),x({pacientesHoy:0,consultasHoy:0,totalPacientes:0})}},[]),h=t.useCallback(()=>{fetch(O+"api_ultima_hc.php").then(N=>N.json()).then(N=>{N.success&&a(N.ultima_hc)}),y()},[y]);t.useEffect(()=>{h(),y()},[s,w.pathname,h,y]);const j=()=>new Intl.DateTimeFormat("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(new Date);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 rounded-2xl p-6 sm:p-8 text-white shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white/10 rounded-full -translate-y-20 translate-x-20"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-white/5 rounded-full translate-y-16 -translate-x-16"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-white/20 rounded-2xl backdrop-blur-sm",children:e.jsx(W,{iconName:"Hospital",className:"text-3xl text-white"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold drop-shadow-lg",children:["¡Bienvenido, ",s?.nombre," ",s?.apellido||"","!"]}),e.jsx("p",{className:"text-lg text-white/90 mt-1",children:j()})]})]}),e.jsx("p",{className:"text-xl text-white/95 font-medium",children:"Panel de Control - Clínica 2 de Mayo"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"group bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border border-cyan-100 hover:border-cyan-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-xl",children:e.jsx(W,{iconName:"People",className:"text-2xl text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:d.pacientesHoy}),e.jsx("p",{className:"text-sm text-gray-500",children:"Hoy"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Pacientes Atendidos"}),e.jsx("p",{className:"text-sm text-gray-600",children:"En el día de hoy"})]}),e.jsxs("div",{className:"group bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border border-emerald-100 hover:border-emerald-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-emerald-400 to-green-500 rounded-xl",children:e.jsx(W,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:d.consultasHoy}),e.jsx("p",{className:"text-sm text-gray-500",children:"Hoy"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Consultas Médicas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"En el día de hoy"})]}),e.jsxs("div",{className:"group bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border border-purple-100 hover:border-purple-200 sm:col-span-2 lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-xl",children:e.jsx(W,{iconName:"Contact",className:"text-2xl text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:d.totalPacientes}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Pacientes Registrados"}),e.jsx("p",{className:"text-sm text-gray-600",children:"En la base de datos"})]})]}),r&&e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-amber-100",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl",children:e.jsx(W,{iconName:"DocumentSearch",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Última Historia Clínica"}),e.jsx("p",{className:"text-gray-600",children:"Registro más reciente en el sistema"})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-amber-100 rounded-lg",children:e.jsx(W,{iconName:"NumberField",className:"text-lg text-amber-700"})}),e.jsx("span",{className:"text-lg font-mono font-bold text-amber-800",children:r}),e.jsxs("span",{className:"text-sm text-amber-600 bg-amber-100 px-2 py-1 rounded-full",children:["HC #",r]})]})})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(W,{iconName:"ContactCard",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Atención en Recepción"}),e.jsx("p",{className:"text-indigo-100",children:"Gestión de pacientes y servicios"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx(ns,{onPacienteRegistrado:h})})]})]})}function ls(){const[s,r]=t.useState([]);return e.jsx("div",{children:e.jsx(Je,{pacientes:s})})}function os(){return e.jsxs("div",{className:"container py-4",children:[e.jsx("h2",{className:"mb-4 text-2xl font-bold text-purple-800",children:"Gestión de Usuarios"}),e.jsx(Xe,{})]})}function cs(){const[s,r]=t.useState([]),[a,d]=t.useState([]),[x,w]=t.useState([]),[y,h]=t.useState(!1),[j,N]=t.useState(""),[v,C]=t.useState(1),[l,_]=t.useState(new Date),E=["#22c55e","#3b82f6","#f59e42","#e11d48","#a21caf","#facc15","#0ea5e9","#14b8a6","#6366f1","#f472b6"],o=Array.isArray(s)?s:[],g=o.reduce((i,u,b)=>(i[u.id]=E[b%E.length],i),{});t.useEffect(()=>{h(!0),Promise.all([fetch(O+"api_medicos.php").then(i=>i.json()),fetch(O+"api_disponibilidad_medicos.php").then(i=>i.json()),fetch(O+"api_consultas.php").then(i=>i.json())]).then(([i,u,b])=>{r(i.medicos||[]),d(u.disponibilidad||[]),w(b.consultas||[]),h(!1)})},[]);const n={};a.forEach(i=>{i.fecha&&(n[i.fecha]||(n[i.fecha]=[]),n[i.fecha].push(i))});function c(i){const u=i.toISOString().slice(0,10),b=a.filter(z=>z.fecha===u);if(b.length>0)return b;const D=["domingo","lunes","martes","miércoles","jueves","viernes","sábado"][i.getDay()];return a.filter(z=>z.dia_semana===D&&!z.fecha)}const m=c(l);o.filter(i=>m.some(u=>u.medico_id==i.id));const f=j.trim().toLowerCase();let S=[];f?S=a.filter(i=>{const u=o.find(b=>b.id==i.medico_id);return u?u.nombre&&u.nombre.toLowerCase().includes(f)||u.especialidad&&u.especialidad.toLowerCase().includes(f):!1}):S=m;const L=S;return e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-2 text-center",children:"Disponibilidad de Médicos"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4 items-start",children:[e.jsx(Me,{onChange:_,value:l,className:"border rounded shadow !text-base w-full max-w-xs md:!text-base md:w-[350px] md:h-[350px] !h-[320px] md:!h-[350px]",tileContent:({date:i,view:u})=>{if(u!=="month")return null;const b=c(i);if(!b.length)return null;const M=[...new Set(b.map(D=>D.medico_id))];return e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:2},children:M.map((D,z)=>e.jsx("span",{style:{display:"inline-block",width:8,height:8,borderRadius:"50%",background:g[D]||"#888",marginLeft:z>0?2:0}},D))})}}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("input",{type:"text",placeholder:"Buscar por nombre o especialidad...",value:j,onChange:i=>{N(i.target.value),C(1)},className:"border rounded px-3 py-1"})}),y?e.jsx("div",{children:"Cargando..."}):e.jsx("div",{className:"overflow-x-auto",style:{maxHeight:260,minHeight:80},children:e.jsxs("table",{className:"min-w-full text-[11px] md:text-sm border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Médico"}),e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Especialidad"}),e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Horario"}),e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Cupos libres"})]})}),e.jsx("tbody",{children:L.map((i,u)=>{const b=o.find(T=>T.id==i.medico_id);if(!b)return null;let M=i.fecha;!M&&i.dia_semana&&(M=i.dia_semana);const D=i.hora_inicio.split(":").map(Number),z=i.hora_fin.split(":").map(Number);let $=0,P=D[0],A=D[1];for(;P<z[0]||P===z[0]&&A<z[1];)$++,A+=30,A>=60&&(P++,A=0);const I=x.filter(T=>T.medico_id==b.id&&(i.fecha?T.fecha===i.fecha:!0)&&T.hora>=i.hora_inicio&&T.hora<i.hora_fin&&T.estado==="pendiente"),p=$-I.length;return e.jsxs("tr",{className:p>0?"bg-green-50":"bg-yellow-100",children:[e.jsxs("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1 font-bold",style:{color:g[b.id]||void 0},children:["Dr(a). ",b.nombre," ",b.apellido||""]}),e.jsx("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1",children:b.especialidad}),e.jsxs("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1",children:[i.hora_inicio," - ",i.hora_fin," ",M?e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",M,")"]}):null]}),e.jsx("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1 font-bold",children:p>0?p:"Sin cupos"})]},i.medico_id+"-"+u)})})]})})]})]})]})}function ds({pacienteId:s}){const[r,a]=t.useState([]),[d,x]=t.useState(0),[w,y]=t.useState([]),[h,j]=t.useState(""),[N,v]=t.useState([]),[C,l]=t.useState(""),[_,E]=t.useState(""),[o,g]=t.useState(""),[n,c]=t.useState(null),[m,f]=t.useState(!1),[S,L]=t.useState(null),[i,u]=t.useState(!1),b=De(q);t.useEffect(()=>{m&&n?fetch(O+"api_tarifas.php",{credentials:"include"}).then($=>$.json()).then($=>{if($.success&&Array.isArray($.tarifas)){let P=$.tarifas.find(A=>A.servicio_tipo==="consulta"&&A.activo===1&&Number(A.medico_id)===Number(n.medico_id));if(P||(P=$.tarifas.find(A=>A.servicio_tipo==="consulta"&&A.activo===1&&(!A.medico_id||A.medico_id===null))),P){const A={servicio_tipo:"consulta",servicio_id:n.id,descripcion:P.descripcion||`Consulta - ${n.medico_nombre}`,cantidad:1,precio_unitario:parseFloat(P.precio_particular)||0,subtotal:parseFloat(P.precio_particular)||0};a([A]),x(A.subtotal)}else a([]),x(0)}}):(a([]),x(0))},[m,n]),t.useEffect(()=>{fetch(O+"api_medicos.php").then($=>$.json()).then($=>y($.medicos||[]))},[]),t.useEffect(()=>{h&&C?(u(!0),fetch(`${O}api_horarios_disponibles.php?medico_id=${h}&fecha=${C}`).then($=>$.json()).then($=>{$.success?v($.horarios_disponibles||[]):(v([]),console.error("Error:",$.error))}).catch($=>{console.error("Error:",$),v([])}).finally(()=>u(!1))):v([])},[h,C]),t.useEffect(()=>{s&&fetch(`${O}api_pacientes.php?id=${s}`).then($=>$.json()).then($=>{$.success&&$.paciente&&L($.paciente)}).catch(console.error)},[s]);const M=async $=>{if($.preventDefault(),g(""),!s||!h||!C||!_){g("Completa todos los campos");return}try{const A=await(await fetch(O+"api_consultas.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paciente_id:s,medico_id:h,fecha:C,hora:_,estado:"programada"})})).json();if(A.success){const I=w.find(T=>String(T.id)===String(h)),p=`${I?.nombre} ${I?.apellido||""}`.trim();c({id:A.consulta_id||A.id,medico_id:h,medico_nombre:p,medico_especialidad:I?.especialidad,fecha:C,hora:_,paciente_id:s}),f(!0),g("")}else g(A.error||"Error al agendar")}catch(P){console.error("Error:",P),g("Error de conexión")}},D=async($,P)=>{f(!1),b.fire({icon:"success",title:"¡Consulta Agendada y Pagada!",html:`
        <div class="text-left">
          <p><strong>Consulta:</strong> ${n.medico_nombre}</p>
          <p><strong>Especialidad:</strong> ${n.medico_especialidad}</p>
          <p><strong>Fecha:</strong> ${n.fecha}</p>
          <p><strong>Hora:</strong> ${n.hora}</p>
          <p><strong>Cobro ID:</strong> ${$}</p>
        </div>
      `,confirmButtonColor:"#22c55e",confirmButtonText:"Aceptar"}),l(""),E(""),j(""),c(null)},z=()=>{f(!1),b.fire({title:"Cobro Cancelado",text:"La consulta fue agendada pero no se realizó el cobro. Puede cobrarse posteriormente.",icon:"info",confirmButtonText:"Entendido"})};return m&&n&&S?e.jsxs("div",{className:"max-w-2xl mx-auto p-2 md:p-8 w-full",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-4 border border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"✅ Consulta Agendada Exitosamente"}),e.jsxs("div",{className:"text-sm text-blue-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Médico:"})," ",n.medico_nombre," (",n.medico_especialidad,")"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",n.fecha," - ",e.jsx("strong",{children:"Hora:"})," ",n.hora]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Paciente:"})," ",S.nombre," ",S.apellido]})]})]}),e.jsx(me,{paciente:S,servicio:{key:"consulta",label:`Consulta - ${n.medico_nombre}`,medico_id:n.medico_id,consulta_id:n.id},detalles:r,total:d,onCobroCompleto:D,onCancelar:z})]}):e.jsxs("div",{className:"max-w-2xl mx-auto p-2 md:p-8 w-full overflow-x-auto",children:[e.jsx(cs,{}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-4 text-center",children:"Agendar Consulta Médica"}),e.jsxs("form",{onSubmit:M,className:"flex flex-col gap-2 md:gap-4 mb-4 bg-white rounded-lg shadow border border-blue-200 p-2 md:p-8 w-full max-w-full text-xs md:text-base",children:[e.jsx("label",{className:"font-semibold mb-1",htmlFor:"medico-select",children:"Médico"}),e.jsxs("select",{id:"medico-select",value:h,onChange:$=>{j($.target.value),E("")},className:"border rounded px-3 py-2 md:px-4 md:py-3 text-base md:text-lg",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un médico"}),w.map($=>e.jsxs("option",{value:$.id,children:["Dr(a). ",$.nombre," ",$.apellido||""," - ",$.especialidad]},$.id))]}),e.jsx("label",{className:"font-semibold mb-1",htmlFor:"fecha-consulta",children:"Fecha de la consulta"}),e.jsx("input",{id:"fecha-consulta",type:"date",value:C,onChange:$=>{l($.target.value),E("")},className:"border rounded px-3 py-2 md:px-4 md:py-3 text-base md:text-lg",required:!0}),e.jsx("label",{className:"font-semibold mb-1",htmlFor:"hora-select",children:"Horario disponible"}),e.jsxs("select",{id:"hora-select",value:_,onChange:$=>E($.target.value),className:"border rounded px-3 py-2 md:px-4 md:py-3 text-base md:text-lg",required:!0,disabled:!h||!C||i,children:[e.jsx("option",{value:"",children:i?"Cargando horarios...":!h||!C?"Selecciona médico y fecha primero":N.length===0?"No hay horarios disponibles":"Selecciona un horario"}),N.map($=>e.jsxs("option",{value:$.hora,children:[$.hora," - ",$.medico_nombre]},`${$.medico_id}-${$.hora}`))]}),e.jsx("button",{type:"submit",className:"bg-green-600 text-white rounded px-4 py-2 md:px-6 md:py-3 font-bold text-base md:text-lg",children:"Agendar Consulta"})]}),o&&e.jsx("div",{className:"mt-2 text-base md:text-lg text-center text-green-700",children:o})]})}function xs(){const s=fe(),r=ne(),a=s.state?.pacienteId;return a?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-800",children:"Agendar Consulta Médica"}),e.jsx("button",{onClick:()=>r("/seleccionar-servicio",{state:{pacienteId:a}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"})]}),e.jsx(ds,{pacienteId:a})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow text-center",children:[e.jsx("p",{className:"text-lg font-bold text-red-600 mb-2",children:"No se ha seleccionado un paciente."}),e.jsx("button",{onClick:()=>r(-1),className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Volver"})]})})}function ms({medicoId:s,onIniciarConsulta:r,onVerDetalle:a}){const d=ne(),[x,w]=t.useState([]),[y,h]=t.useState(1),[j,N]=t.useState(5),[v,C]=t.useState(!1),[l,_]=t.useState(""),[E,o]=t.useState(""),[g,n]=t.useState(""),[c,m]=t.useState("");t.useEffect(()=>{s&&(C(!0),fetch(`${O}api_consultas.php?medico_id=${s}`,{credentials:"include"}).then(p=>p.json()).then(p=>{w(p.consultas||[]),C(!1)}).catch(p=>{console.error("Error cargando consultas:",p),C(!1)}))},[s]);const f=async(p,T)=>{_(""),C(!0);try{await fetch(O+"api_consultas.php",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:p,estado:T})});const K=await(await fetch(`${O}api_consultas.php?medico_id=${s}`,{credentials:"include"})).json();w(K.consultas||[]),_(`Consulta ${T} correctamente`)}catch(U){console.error("Error actualizando estado:",U),_("Error al actualizar el estado")}finally{C(!1)}},S=x.filter(p=>{const T=E.trim().toLowerCase();return T&&!(p.paciente_nombre&&p.paciente_nombre.toLowerCase().includes(T)||p.paciente_apellido&&p.paciente_apellido.toLowerCase().includes(T)||p.historia_clinica&&p.historia_clinica.toLowerCase().includes(T)||p.dni&&p.dni.toLowerCase().includes(T))?!1:!g&&!c?!0:!(!p.fecha||g&&p.fecha<g||c&&p.fecha>c)}),L=S.length,i=Math.max(1,Math.ceil(L/j)),u=S.slice((y-1)*j,y*j),b=p=>{N(Number(p.target.value)),h(1)},M=()=>h(p=>Math.max(1,p-1)),D=()=>h(p=>Math.min(i,p+1)),z=p=>{if(!p)return"N/A";try{return new Date(p).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return p}},$=p=>{switch(p?.toLowerCase()){case"pendiente":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"completada":case"completado":return"bg-green-100 text-green-800 border-green-200";case"cancelada":case"cancelado":return"bg-red-100 text-red-800 border-red-200";case"en_proceso":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},P=p=>{switch(p?.toLowerCase()){case"pendiente":return"⏳ ";case"completada":case"completado":return"✅ ";case"cancelada":case"cancelado":return"❌ ";case"en_proceso":return"🔄 ";default:return"📋 "}},A=p=>{switch(p?.toLowerCase()){case"emergencia":return"bg-red-100 text-red-800 border-red-200 animate-pulse";case"urgente":case"urgencia":return"bg-orange-100 text-orange-800 border-orange-200";case"no urgente":case"normal":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},I=p=>{switch(p?.toLowerCase()){case"emergencia":return"🚨 ";case"urgente":case"urgencia":return"⚠️ ";case"no urgente":case"normal":return"🟢 ";default:return"⚪ "}};return e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:max-w-7xl lg:mx-auto",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-3 sm:p-6 mb-4 sm:mb-8 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 sm:w-5 sm:h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-800",children:"🔍 Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"col-span-full lg:col-span-2",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"Búsqueda general"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-2 sm:pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("input",{type:"text",value:E,onChange:p=>{o(p.target.value),h(1)},placeholder:"Buscar por nombre, HC o DNI...",className:"pl-8 sm:pl-10 w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white/80"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"📅 Desde"}),e.jsx("input",{type:"date",value:g,onChange:p=>{n(p.target.value),h(1)},className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white/80"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"📅 Hasta"}),e.jsx("input",{type:"date",value:c,onChange:p=>{m(p.target.value),h(1)},className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white/80"})]})]}),(E||g||c)&&e.jsx("div",{className:"mt-3 sm:mt-4 flex justify-center sm:justify-end",children:e.jsxs("button",{onClick:()=>{o(""),n(""),m(""),h(1)},className:"inline-flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Limpiar Filtros"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-6 mb-4 sm:mb-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-xs sm:text-sm font-medium",children:"Total Consultas"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:S.length})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-xs sm:text-sm font-medium",children:"Pendientes"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:S.filter(p=>p.estado==="pendiente").length})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-100 text-xs sm:text-sm font-medium",children:"Emergencias"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:S.filter(p=>p.clasificacion==="Emergencia").length})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})})]})})]}),v?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-8 sm:p-12 border border-white/50 flex justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600 font-medium text-sm sm:text-base",children:"🏥 Cargando consultas médicas..."})]})}):u.length===0?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-8 sm:p-12 border border-white/50 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-r from-gray-300 to-gray-400 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 sm:w-10 sm:h-10 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-700 mb-2",children:"📅 No hay consultas"}),e.jsx("p",{className:"text-gray-500 text-sm sm:text-base",children:"No se encontraron consultas con los filtros aplicados"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/50 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-600 to-indigo-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"👤 Paciente"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"🏥 HC / DNI"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"📅 Fecha"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"⏰ Hora"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"📊 Estado"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"🚨 Clasificación"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"🩺 Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:u.map((p,T)=>{const U=T%2===0;return e.jsxs("tr",{className:`${U?"bg-white/60":"bg-blue-50/40"} hover:bg-blue-100/60 transition-all duration-200 hover:shadow-lg transform hover:-translate-y-0.5`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:((p.paciente_nombre||"")+(p.paciente_apellido||"")).charAt(0)||"P"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:p.paciente_nombre?`${p.paciente_nombre} ${p.paciente_apellido||""}`.trim():`Paciente #${p.paciente_id}`}),e.jsx("div",{className:"text-sm text-gray-500",children:"Consulta médica"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:["HC: ",p.historia_clinica||"N/A"]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:["DNI: ",p.dni||"N/A"]})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"font-medium text-gray-900",children:z(p.fecha)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium text-gray-900",children:p.hora||"N/A"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${$(p.estado)}`,children:[P(p.estado),p.estado||"Sin estado"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${A(p.clasificacion)}`,children:[I(p.clasificacion),p.clasificacion||"Sin clasificar"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[p.estado==="pendiente"&&!p.clasificacion&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f(p.id,"completada"),className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",title:"Completar consulta",children:e.jsx("span",{className:"text-sm",children:"✔️"})}),e.jsx("button",{onClick:()=>f(p.id,"cancelada"),className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",title:"Cancelar consulta",children:e.jsx("span",{className:"text-sm",children:"✖️"})})]}),e.jsx("button",{onClick:()=>d(`/historia-clinica/${p.paciente_id}/${p.id}`),className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",title:"Ver Historia Clínica",children:e.jsx("span",{className:"text-sm",children:"📖"})}),r&&e.jsxs("button",{onClick:()=>r(p),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Iniciar"]}),a&&e.jsxs("button",{onClick:()=>a(p),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Ver"]})]})})]},p.id)})})]})})}),e.jsx("div",{className:"lg:hidden space-y-3 sm:space-y-4",children:u.map(p=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/50 p-4 hover:shadow-xl transition-all duration-200 hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-semibold text-lg",children:((p.paciente_nombre||"")+(p.paciente_apellido||"")).charAt(0)||"P"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:p.paciente_nombre?`${p.paciente_nombre} ${p.paciente_apellido||""}`.trim():`Paciente #${p.paciente_id}`}),e.jsx("p",{className:"text-sm text-gray-500",children:"Consulta médica"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"📅 Fecha"}),e.jsx("p",{className:"text-gray-900",children:z(p.fecha)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"⏰ Hora"}),e.jsx("p",{className:"text-gray-900",children:p.hora||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"🏥 HC"}),e.jsx("p",{className:"text-gray-900",children:p.historia_clinica||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"👤 DNI"}),e.jsx("p",{className:"text-gray-900",children:p.dni||"N/A"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${$(p.estado)}`,children:[P(p.estado),p.estado||"Sin estado"]}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${A(p.clasificacion)}`,children:[I(p.clasificacion),p.clasificacion||"Sin clasificar"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[p.estado==="pendiente"&&!p.clasificacion&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>f(p.id,"completada"),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("span",{children:"✔️"}),e.jsx("span",{className:"hidden sm:inline",children:"Completar"})]}),e.jsxs("button",{onClick:()=>f(p.id,"cancelada"),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("span",{children:"✖️"}),e.jsx("span",{className:"hidden sm:inline",children:"Cancelar"})]})]}),e.jsxs("button",{onClick:()=>d(`/historia-clinica/${p.paciente_id}/${p.id}`),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("span",{children:"📖"}),e.jsx("span",{className:"hidden sm:inline",children:"Historia"})]}),r&&e.jsxs("button",{onClick:()=>r(p),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Iniciar"})]}),a&&e.jsxs("button",{onClick:()=>a(p),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),e.jsx("span",{className:"hidden sm:inline",children:"Ver"})]})]})]},p.id))})]}),l&&e.jsx("div",{className:"mt-3 sm:mt-4 p-3 sm:p-4 bg-blue-100 border border-blue-300 rounded-lg sm:rounded-xl text-blue-800 text-center text-sm sm:text-base",children:l}),S.length>0&&e.jsx("div",{className:"mt-4 sm:mt-8 bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-4 sm:p-6 border border-white/50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:M,disabled:y===1,className:"inline-flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),e.jsx("div",{className:"flex items-center gap-1 sm:gap-2",children:e.jsxs("span",{className:"text-gray-600 font-medium text-sm sm:text-base",children:[y,"/",i]})}),e.jsxs("button",{onClick:D,disabled:y===i,className:"inline-flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 sm:gap-3",children:[e.jsxs("label",{className:"text-xs sm:text-sm font-medium text-gray-700",children:["📄 ",e.jsx("span",{className:"hidden sm:inline",children:"Filas por página:"}),e.jsx("span",{className:"sm:hidden",children:"Por página:"})]}),e.jsxs("select",{value:j,onChange:b,className:"px-2 sm:px-3 py-1.5 sm:py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/80",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 text-center sm:text-left",children:[e.jsxs("span",{className:"block sm:inline",children:[u.length," de ",L]}),e.jsx("span",{className:"hidden sm:inline",children:" consultas"})]})]})]})})]})}function hs({usuario:s}){const r=s?.id;return r?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 shadow-2xl",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 bg-white/10 rounded-full px-6 py-3 backdrop-blur-sm border border-white/20 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 9l6-6m-6 0l6 6"})})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Panel Médico"}),e.jsxs("p",{className:"text-blue-100 text-sm",children:["Dr(a). ",s?.nombre," ",s?.apellido||""]})]})]}),e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"📋 Mis Consultas Programadas"}),e.jsx("p",{className:"text-blue-100 max-w-2xl mx-auto",children:"Gestiona tus citas médicas, revisa el historial de pacientes y mantén un seguimiento completo de tus consultas"})]})})}),e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx(ms,{medicoId:r})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-red-100 flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md mx-4 border border-red-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-red-800 mb-2",children:"Error de Acceso"}),e.jsx("p",{className:"text-red-600 font-medium",children:"No se encontró el médico logueado."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Por favor, inicia sesión nuevamente."})]})})})}const us=()=>{const[s,r]=t.useState([]),[a,d]=t.useState(!0),[x,w]=t.useState(null),[y,h]=t.useState(!1),[j,N]=t.useState({nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),[v,C]=t.useState(""),[l,_]=t.useState(!1),[E,o]=t.useState(!1),[g,n]=t.useState({id:null,nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),[c,m]=t.useState(""),[f,S]=t.useState(!1),[L,i]=t.useState(""),[u,b]=t.useState("id"),[M,D]=t.useState("asc"),[z,$]=t.useState(5),[P,A]=t.useState(1);t.useEffect(()=>{I()},[]);const I=async()=>{d(!0);try{const X=await ue.get(O+"api_medicos.php");r(X.data.medicos||[]),w(null)}catch(X){w("Error al cargar médicos"),console.error("Error fetching medicos:",X)}finally{d(!1)}},p=async X=>{_(!0),C("");try{const se=await ue.post(O+"api_medicos.php",X);se.data.success?(await I(),k(),q.fire({title:"¡Éxito!",text:"Médico registrado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})):C(se.data.message||"Error al registrar médico")}catch(se){C("Error de conexión al registrar médico"),console.error("Error creating medico:",se)}finally{_(!1)}},T=async X=>{S(!0),m("");try{const se=await ue.put(O+"api_medicos.php",X);se.data.success?(await I(),B(),q.fire({title:"¡Éxito!",text:"Médico actualizado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})):m(se.data.message||"Error al actualizar médico")}catch(se){m("Error de conexión al actualizar médico"),console.error("Error updating medico:",se)}finally{S(!1)}},U=async X=>{if((await q.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const re=await ue.delete(O+"api_medicos.php",{data:{id:X}});re.data.success?(await I(),q.fire({title:"¡Eliminado!",text:"Médico eliminado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})):q.fire({title:"Error",text:re.data.message||"Error al eliminar médico",icon:"error"})}catch(re){q.fire({title:"Error",text:"Error de conexión al eliminar médico",icon:"error"}),console.error("Error deleting medico:",re)}},K=()=>{h(!0),N({nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),C("")},k=()=>{h(!1),N({nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),C("")},G=X=>{const{name:se,value:re}=X.target;N(oe=>({...oe,[se]:re}))},J=async X=>{X.preventDefault(),await p(j)},Z=X=>{o(!0),n({id:X.id,nombre:X.nombre,apellido:X.apellido||"",especialidad:X.especialidad,email:X.email,password:"",cmp:X.cmp||"",rne:X.rne||"",firma:X.firma||null}),m("")},B=()=>{o(!1),n({id:null,nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),m("")},R=X=>{const{name:se,value:re}=X.target;n(oe=>({...oe,[se]:re}))},F=async X=>{X.preventDefault(),await T(g)},H=X=>{u===X?D(M==="asc"?"desc":"asc"):(b(X),D("asc")),A(1)},ae=[...s.filter(X=>{if(!L)return!0;const se=L.toLowerCase();return X.nombre.toLowerCase().includes(se)||X.apellido&&X.apellido.toLowerCase().includes(se)||X.especialidad.toLowerCase().includes(se)||X.email.toLowerCase().includes(se)})].sort((X,se)=>{let re=X[u],oe=se[u];return typeof re=="string"&&(re=re.toLowerCase(),oe=oe.toLowerCase()),M==="asc"?re<oe?-1:re>oe?1:0:re>oe?-1:re<oe?1:0}),ee=ae.length,xe=Math.ceil(ee/z),ie=(P-1)*z,le=ie+z;return{medicos:ae.slice(ie,le),allMedicos:ae,loading:a,error:x,showModal:y,form:j,formError:v,saving:l,editModal:E,editForm:g,editError:c,editSaving:f,busqueda:L,setBusqueda:i,sortBy:u,sortDir:M,rowsPerPage:z,setRowsPerPage:$,page:P,setPage:A,totalRows:ee,totalPages:xe,startIdx:ie,endIdx:le,handleOpenModal:K,handleCloseModal:k,handleInputChange:G,handleSubmit:J,handleEdit:Z,handleEditClose:B,handleEditChange:R,handleEditSubmit:F,handleSort:H,deleteMedico:U,fetchMedicos:I}},ps=s=>{try{const r=s.map(({id:j,nombre:N,especialidad:v,email:C})=>({ID:j,Nombre:N,Especialidad:v,Email:C})),a=ce.json_to_sheet(r),d=ce.book_new();ce.book_append_sheet(d,a,"Médicos");const x=[{wch:8},{wch:25},{wch:20},{wch:30}];a["!cols"]=x;const w=Pe(d,{bookType:"xlsx",type:"array"}),y=new Blob([w],{type:"application/octet-stream"}),h=`medicos_${new Date().toISOString().slice(0,10)}.xlsx`;return Ae.saveAs(y,h),{success:!0,fileName:h}}catch(r){return console.error("Error exportando a Excel:",r),{success:!1,error:r.message}}},bs=s=>{try{const r=new je;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Lista de Médicos",14,15),r.setFontSize(10),r.setFont(void 0,"normal"),r.text(`Fecha de generación: ${new Date().toLocaleDateString()}`,14,25),r.text(`Total de médicos: ${s.length}`,14,30);const a=[{header:"ID",dataKey:"id"},{header:"Nombre",dataKey:"nombre"},{header:"Especialidad",dataKey:"especialidad"},{header:"Email",dataKey:"email"}],d=s.map(w=>({id:w.id,nombre:`${w.nombre} ${w.apellido||""}`.trim(),especialidad:w.especialidad,email:w.email}));Ne(r,{columns:a,body:d,startY:35,styles:{fontSize:9,cellPadding:3},headStyles:{fillColor:[59,130,246],textColor:[255,255,255],fontStyle:"bold"},alternateRowStyles:{fillColor:[245,247,250]},tableLineColor:[209,213,219],tableLineWidth:.1,margin:{top:35,bottom:20,left:14,right:14}});const x=`medicos_${new Date().toISOString().slice(0,10)}.pdf`;return r.save(x),{success:!0,fileName:x}}catch(r){return console.error("Error exportando a PDF:",r),{success:!1,error:r.message}}},gs=({busqueda:s,setBusqueda:r,onAddNew:a,medicos:d,totalCount:x})=>{const w=()=>{const h=ps(d);h.success||console.error("Error al exportar:",h.error)},y=()=>{const h=bs(d);h.success||console.error("Error al exportar:",h.error)};return e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-6 mb-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6",children:[e.jsxs("div",{className:"mb-4 lg:mb-0",children:[e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Gestión de Médicos"}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),x," médicos registrados"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:a,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 font-medium flex items-center justify-center gap-2 shadow-lg hover:shadow-xl",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Médico"}),e.jsx("span",{className:"sm:hidden",children:"Nuevo"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:w,className:"px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 font-medium flex items-center gap-2 shadow-lg hover:shadow-xl",title:"Exportar a Excel",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden lg:inline",children:"Excel"})]}),e.jsxs("button",{onClick:y,className:"px-4 py-3 bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-xl hover:from-red-600 hover:to-pink-700 transition-all duration-200 font-medium flex items-center gap-2 shadow-lg hover:shadow-xl",title:"Exportar a PDF",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),e.jsx("span",{className:"hidden lg:inline",children:"PDF"})]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Buscar médicos por nombre, especialidad o email...",value:s,onChange:h=>r(h.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-white/80 backdrop-blur-sm"}),s&&e.jsx("button",{onClick:()=>r(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("svg",{className:"h-4 w-4 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filtrando por: ",e.jsxs("span",{className:"font-medium text-blue-600",children:['"',s,'"']}),e.jsx("button",{onClick:()=>r(""),className:"text-blue-600 hover:text-blue-700 underline",children:"Limpiar"})]})]})},fs=({medicos:s,loading:r,error:a,sortBy:d,sortDir:x,onSort:w,onEdit:y,onDelete:h,page:j,setPage:N,rowsPerPage:v,setRowsPerPage:C,totalPages:l,totalRows:_,startIdx:E,endIdx:o})=>{if(r)return e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-8 shadow-lg",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-gray-600",children:"Cargando médicos..."})]})})});if(a)return e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-8 shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-red-500 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error al cargar"}),e.jsx("p",{className:"text-gray-600",children:a})]})});if(s.length===0)return e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-8 shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay médicos"}),e.jsx("p",{className:"text-gray-600",children:"No se encontraron médicos que coincidan con los criterios de búsqueda."})]})});const g=n=>d!==n?e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):x==="asc"?e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"})}):e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:[e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>w("id"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["ID",g("id")]})}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>w("nombre"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Nombre",g("nombre")]})}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>w("especialidad"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"Especialidad",g("especialidad")]})}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>w("email"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),"Email",g("email")]})}),e.jsx("th",{className:"px-6 py-4 text-center font-semibold",children:"Acciones"})]})}),e.jsx("tbody",{children:s.map((n,c)=>e.jsxs("tr",{className:`border-b border-gray-200 hover:bg-blue-50/50 transition-colors ${c%2===0?"bg-white/50":"bg-gray-50/50"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold text-sm",children:n.id})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold",children:n.nombre.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["Dr(a). ",n.nombre," ",n.apellido||""]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",n.id]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:n.especialidad})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-gray-900",children:n.email})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>y(n),className:"p-2 text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-lg transition-colors",title:"Editar médico",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>h(n.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar médico",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},n.id))})]})})}),e.jsx("div",{className:"lg:hidden space-y-4",children:s.map(n=>e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg",children:n.nombre.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900",children:["Dr(a). ",n.nombre," ",n.apellido||""]}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["ID: #",n.id]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(n),className:"p-2 text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-lg transition-colors",title:"Editar médico",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>h(n.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar médico",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-purple-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),e.jsx("span",{className:"text-gray-600 text-sm",children:"Especialidad:"}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:n.especialidad})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),e.jsx("span",{className:"text-gray-600 text-sm",children:"Email:"}),e.jsx("span",{className:"text-gray-900 text-sm",children:n.email})]})]})]},n.id))}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-4 mt-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"Mostrar:"}),e.jsx("select",{value:v,onChange:n=>C(Number(n.target.value)),className:"border border-gray-300 rounded-lg px-3 py-1.5 text-sm bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent",children:[5,10,20,50].map(n=>e.jsx("option",{value:n,children:n},n))})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("button",{onClick:()=>N(n=>Math.max(1,n-1)),disabled:j===1,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 font-medium",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),e.jsx("div",{className:"flex items-center gap-2 px-4 py-2 bg-white/80 rounded-lg border border-white/20",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Página ",j," de ",l||1]})}),e.jsxs("button",{onClick:()=>N(n=>n<l?n+1:n),disabled:j>=l,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 font-medium",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["Mostrando ",_===0?0:E+1," - ",Math.min(o,_)," de ",_," médicos"]})})]})]})},Se=({isOpen:s,onClose:r,mode:a="create",formData:d,onChange:x,onSubmit:w,error:y,isSaving:h})=>{const[j,N]=t.useState(d.firma||null),[v,C]=t.useState(""),l=t.useRef(null);if(!s)return null;const _=S=>{const L=S.target.files[0];if(!L)return;if(!L.type.match(/^image\/(png|jpeg|jpg)$/)){C("Solo se permiten archivos PNG, JPG o JPEG");return}if(L.size>2*1024*1024){C("El archivo es demasiado grande. Máximo 2MB.");return}const i=new FileReader;i.onload=u=>{const b=u.target.result;N(b),C(""),x({target:{name:"firma",value:b}})},i.readAsDataURL(L)},E=()=>{N(null),C(""),l.current&&(l.current.value=""),x({target:{name:"firma",value:null}})},o=a==="edit",g=o?"Editar Médico":"Registrar Nuevo Médico",n=o?"Actualizar información del médico":"Agregar médico al sistema",c=o?"Actualizar Médico":"Registrar Médico",m=o?"bg-gradient-to-r from-amber-500 to-orange-600":"bg-gradient-to-r from-blue-500 to-purple-600",f=o?"bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700";return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-md lg:max-w-2xl xl:max-w-3xl rounded-2xl shadow-2xl max-h-[95vh] sm:max-h-[88vh] lg:max-h-[85vh] flex flex-col",children:[e.jsx("div",{className:`${m} text-white p-4 sm:p-6 rounded-t-2xl flex-shrink-0`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:g}),e.jsx("p",{className:"text-white/80 text-sm",children:n})]})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-2 sm:py-4",children:e.jsx("form",{id:`medico-form-${a}`,onSubmit:w,className:"h-full flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4 sm:space-y-6 pb-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Información Personal"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Nombre *"]})}),e.jsx("input",{type:"text",name:"nombre",value:d.nombre,onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Juan",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Apellido *"]})}),e.jsx("input",{type:"text",name:"apellido",value:d.apellido||"",onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Pérez García",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"Especialidad *"]})}),e.jsx("input",{type:"text",name:"especialidad",value:d.especialidad,onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Cardiología",required:!0})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a1 1 0 011-1h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Códigos Profesionales"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a1 1 0 011-1h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"C.M.P. (Colegio Médico del Perú) *"]})}),e.jsx("input",{type:"text",name:"cmp",value:d.cmp||"",onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"64201",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Obligatorio para todos los médicos"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"R.N.E. (Registro Nacional de Especialidad)"]})}),e.jsx("input",{type:"text",name:"rne",value:d.rne||"",onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"36922"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Solo para médicos especialistas"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Información de Contacto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),"Email *"]})}),e.jsx("input",{type:"email",name:"email",value:d.email,onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"doctor@clinica2demayo.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),o?"Nueva Contraseña":"Contraseña de Acceso *"]})}),e.jsx("input",{type:"password",name:"password",value:d.password,onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"••••••••",required:!o,autoComplete:"new-password"}),o&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Dejar vacío para mantener la contraseña actual"}),!o&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Mínimo 8 caracteres recomendados"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"✍️ Firma Digital"})]}),j?e.jsxs("div",{className:"bg-white border-2 border-dashed border-indigo-300 rounded-lg p-4 text-center",children:[e.jsx("img",{src:j,alt:"Firma digital",className:"max-h-32 mx-auto object-contain",style:{maxWidth:"300px"}}),e.jsx("div",{className:"mt-3 flex justify-center gap-2",children:e.jsx("button",{type:"button",onClick:E,className:"px-3 py-1 text-sm bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",children:"🗑️ Eliminar"})})]}):e.jsxs("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("p",{className:"text-gray-500",children:"No hay firma registrada"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Subir Firma Digital"]})}),e.jsx("input",{ref:l,type:"file",accept:"image/png,image/jpeg,image/jpg",onChange:_,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white"}),v&&e.jsxs("div",{className:"text-red-600 text-sm flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),v]}),e.jsx("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-3",children:e.jsxs("div",{className:"text-sm text-indigo-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"📋 Requisitos de la firma:"}),e.jsxs("ul",{className:"space-y-1 text-indigo-700 text-xs",children:[e.jsx("li",{children:"• Formato: PNG, JPG o JPEG"}),e.jsx("li",{children:"• Tamaño máximo: 2MB"}),e.jsx("li",{children:"• Recomendado: Fondo transparente"}),e.jsx("li",{children:"• Dimensiones sugeridas: 300x100 píxeles"})]})]})})]}),(d.nombre||d.apellido||d.cmp||j)&&e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Vista Previa - Así aparecerá en los documentos"]}),e.jsxs("div",{className:"bg-white border-2 border-blue-200 rounded-lg p-3 text-center",children:[j&&e.jsx("img",{src:j,alt:"Firma",className:"max-h-12 mx-auto object-contain mb-2"}),e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-800",children:[d.nombre," ",d.apellido]}),d.especialidad&&e.jsx("div",{className:"text-xs text-gray-600",children:d.especialidad}),e.jsxs("div",{className:"text-xs text-gray-600",children:[d.cmp&&`C.M.P. ${d.cmp}`,d.rne&&` - R.N.E ${d.rne}`]})]})]})]})]})]})})}),y&&e.jsx("div",{className:"mx-4 sm:mx-6 mb-4",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-5 w-5 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-red-700 font-medium",children:y})]})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 p-4 sm:p-6 border-t border-gray-200 bg-gray-50/50 rounded-b-2xl flex-shrink-0",children:[e.jsxs("button",{type:"button",onClick:r,className:"flex-1 px-6 py-3 rounded-xl bg-gray-100 text-gray-700 hover:bg-gray-200 transition-all duration-200 font-medium flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Cancelar"]}),e.jsx("button",{type:"submit",form:`medico-form-${a}`,disabled:h,className:`flex-1 px-6 py-3 rounded-xl ${f} text-white disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all duration-200 font-medium flex items-center justify-center gap-2`,children:h?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),c]})})]})]})})};function js(){const{medicos:s,allMedicos:r,loading:a,error:d,showModal:x,form:w,formError:y,saving:h,editModal:j,editForm:N,editError:v,editSaving:C,busqueda:l,setBusqueda:_,sortBy:E,sortDir:o,rowsPerPage:g,setRowsPerPage:n,page:c,setPage:m,totalRows:f,totalPages:S,startIdx:L,endIdx:i,handleOpenModal:u,handleCloseModal:b,handleInputChange:M,handleSubmit:D,handleEdit:z,handleEditClose:$,handleEditChange:P,handleEditSubmit:A,handleSort:I,deleteMedico:p}=us();return e.jsx("div",{className:"bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(gs,{busqueda:l,setBusqueda:_,onAddNew:u,medicos:r,totalCount:f}),e.jsx(fs,{medicos:s,loading:a,error:d,sortBy:E,sortDir:o,onSort:I,onEdit:z,onDelete:p,page:c,setPage:m,rowsPerPage:g,setRowsPerPage:n,totalPages:S,totalRows:f,startIdx:L,endIdx:i}),e.jsx(Se,{isOpen:x,onClose:b,mode:"create",formData:w,onChange:M,onSubmit:D,error:y,isSaving:h}),e.jsx(Se,{isOpen:j,onClose:$,mode:"edit",formData:N,onChange:P,onSubmit:A,error:v,isSaving:C})]})})})}function Ns(){return e.jsx("div",{className:"container mx-auto py-8",children:e.jsx(js,{})})}function vs({onSave:s,bloquesGuardados:r=[]}){const[a,d]=t.useState([]),[x,w]=t.useState({}),[y,h]=t.useState(null),j=new Set(r.map(n=>n.fecha)),N=n=>new Date(n.getTime()-n.getTimezoneOffset()*6e4).toISOString().slice(0,10),v=n=>{const c=new Date,m=new Date(n);return c.setHours(0,0,0,0),m.setHours(0,0,0,0),m<c},C=n=>{let c=Array.isArray(n)?n:[n];c=c.map(m=>N(m)),c=c.filter(m=>!v(m)),d(c),w(m=>{const f={...m};return c.forEach(S=>{f[S]||(f[S]=[{hora_inicio:"08:00:00",hora_fin:"10:00:00"}])}),Object.keys(f).forEach(S=>{c.includes(S)||delete f[S]}),f})},l=n=>{const c=N(n);v(c)&&!j.has(c)||(h(c),!a.includes(c)&&!v(c)&&(d(m=>[...m,c]),w(m=>({...m,[c]:[{hora_inicio:"08:00:00",hora_fin:"10:00:00"}]}))))},_=(n,c,m,f)=>{w(S=>{const L={...S};return L[n][c][m]=f,{...L}})},E=n=>{w(c=>{const m={...c};return m[n]=[...m[n],{hora_inicio:"08:00:00",hora_fin:"10:00:00"}],m})},o=(n,c)=>{w(m=>{const f={...m};return f[n]=f[n].filter((S,L)=>L!==c),f})},g=()=>{const n=[];Object.entries(x).forEach(([c,m])=>{m.forEach(f=>n.push({fecha:c,...f}))}),s&&s(n)};return e.jsxs("div",{className:"max-w-xl mx-auto p-4 border rounded shadow bg-white",children:[e.jsx("h2",{className:"font-bold text-lg mb-2 text-center",children:"Definir Disponibilidad"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Selecciona fechas:"}),e.jsx(Me,{onChange:C,value:a.length===1?new Date(a[0]):a.map(n=>new Date(n)),selectRange:!1,minDetail:"month",maxDetail:"month",allowPartialRange:!1,showNeighboringMonth:!1,locale:"es-ES",selectMultiple:!0,tileClassName:({date:n})=>{const c=N(n);let m=[];return a.includes(c)&&m.push("selected-multiple"),x[c]&&x[c].length>0&&m.push("has-bloques"),j.has(c)&&(v(c)?m.push("fecha-pasada"):m.push("fecha-registrada")),m.join(" ")},onClickDay:l}),e.jsxs("div",{className:"mt-3 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"font-semibold mb-1 text-gray-700",children:"Leyenda:"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-100 border-2 border-green-500 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-green-500 text-xs font-bold",children:"✓"})}),e.jsx("span",{children:"Ya registrado"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-100 border-2 border-gray-400 rounded flex items-center justify-center opacity-70",children:e.jsx("span",{className:"text-gray-500 text-xs font-bold",children:"⏰"})}),e.jsx("span",{children:"Consulta pasada"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-sky-400 rounded"}),e.jsx("span",{children:"Seleccionado"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-100 border border-blue-300 rounded"}),e.jsx("span",{children:"Hoy"})]})]})]})]}),a.length===0&&e.jsx("div",{className:"text-gray-500 text-sm mb-2",children:"Selecciona al menos una fecha en el calendario."}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 min-w-[320px] max-w-md relative",children:[e.jsx("button",{onClick:()=>h(null),className:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold","aria-label":"Cerrar",children:"×"}),e.jsxs("div",{className:"font-semibold mb-2 text-blue-700",children:["Bloques para ",y]}),x[y]&&x[y].map((n,c)=>e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("input",{type:"time",value:n.hora_inicio,onChange:m=>_(y,c,"hora_inicio",m.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("span",{children:"a"}),e.jsx("input",{type:"time",value:n.hora_fin,onChange:m=>_(y,c,"hora_fin",m.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("button",{type:"button",onClick:()=>o(y,c),className:"text-red-600 hover:underline",children:"Eliminar"})]},c)),e.jsx("button",{type:"button",onClick:()=>E(y),className:"text-blue-600 hover:underline text-sm mt-1",children:"+ Agregar otro horario"}),e.jsx("button",{onClick:()=>h(null),className:"bg-blue-600 text-white px-4 py-2 rounded font-bold w-full mt-4",children:"Cerrar"})]})}),a.length>0&&!y&&a.map(n=>e.jsxs("div",{className:"mb-4 border rounded p-2 bg-gray-50",children:[e.jsx("div",{className:"font-semibold mb-1",children:n}),x[n].map((c,m)=>e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("input",{type:"time",value:c.hora_inicio,onChange:f=>_(n,m,"hora_inicio",f.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("span",{children:"a"}),e.jsx("input",{type:"time",value:c.hora_fin,onChange:f=>_(n,m,"hora_fin",f.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("button",{type:"button",onClick:()=>o(n,m),className:"text-red-600 hover:underline",children:"Eliminar"})]},m)),e.jsx("button",{type:"button",onClick:()=>E(n),className:"text-blue-600 hover:underline text-sm mt-1",children:"+ Agregar otro horario"})]},n)),e.jsx("button",{onClick:g,className:"bg-blue-600 text-white px-4 py-2 rounded font-bold w-full mt-2",children:"Guardar Disponibilidad"})]})}function ys(){const r=JSON.parse(sessionStorage.getItem("medico")||"null")?.id,[a,d]=t.useState(null),[x,w]=t.useState({hora_inicio:"",hora_fin:""}),y=m=>{d(m.id),w({hora_inicio:m.hora_inicio,hora_fin:m.hora_fin})},h=async m=>{try{(await(await fetch(`${O}api_disponibilidad_medicos.php`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m.id,fecha:m.fecha||"",hora_inicio:x.hora_inicio,hora_fin:x.hora_fin})})).json()).success?(d(null),E(),q.fire({icon:"success",title:"Bloque actualizado",showConfirmButton:!1,timer:1400})):q.fire({icon:"error",title:"No se pudo editar el bloque"})}catch{q.fire({icon:"error",title:"Error de red o servidor al editar"})}},j=()=>{d(null)},N=async m=>{if((await q.fire({title:"¿Seguro que deseas eliminar este bloque?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{(await(await fetch(`${O}api_disponibilidad_medicos.php`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m})})).json()).success?(E(),q.fire({icon:"success",title:"Bloque eliminado",showConfirmButton:!1,timer:1400})):q.fire({icon:"error",title:"No se pudo eliminar el bloque"})}catch{q.fire({icon:"error",title:"Error de red o servidor al eliminar"})}},[v,C]=t.useState([]),[l,_]=t.useState(!1),E=t.useCallback(async()=>{_(!0);try{const f=await(await fetch(`${O}api_disponibilidad_medicos.php?medico_id=${r}`)).json();C(f.disponibilidad||[])}catch{C([])}_(!1)},[r]);t.useEffect(()=>{E()},[E]);const o=async m=>{try{(await(await fetch(`${O}api_disponibilidad_medicos.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({medico_id:r,bloques:m})})).json()).success?(q.fire({icon:"success",title:"Disponibilidad guardada correctamente",showConfirmButton:!1,timer:1400}),E()):q.fire({icon:"error",title:"Error al guardar disponibilidad"})}catch{q.fire({icon:"error",title:"Error de red o servidor"})}},g=v.reduce((m,f)=>(m[f.fecha]||(m[f.fecha]=[]),m[f.fecha].push(f),m),{}),n=m=>m?.slice(0,5),c=m=>{const f=new Date,S=new Date(m);return f.setHours(0,0,0,0),S.setHours(0,0,0,0),S<f};return e.jsxs("div",{className:"max-w-6xl mx-auto mt-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8 text-center col-span-2",children:"Panel del Médico"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"md:w-1/2 w-full",children:e.jsx(vs,{onSave:o,bloquesGuardados:v})}),e.jsxs("div",{className:"md:w-1/2 w-full max-h-[70vh] overflow-y-auto bg-white rounded-lg shadow-inner",children:[e.jsxs("h2",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Disponibilidad registrada"]}),l?e.jsx("div",{className:"text-center py-4",children:e.jsx(ye,{message:"Cargando disponibilidad registrada..."})}):Object.keys(g).length===0?e.jsx("div",{className:"text-gray-500 text-center py-6",children:"No hay bloques registrados aún."}):e.jsx("div",{className:"space-y-6",children:Object.keys(g).sort().map(m=>{const f=c(m);return e.jsxs("div",{className:`rounded-lg shadow p-4 ${f?"bg-gray-50 border-l-4 border-gray-400":"bg-blue-50"}`,children:[e.jsxs("div",{className:`font-semibold mb-2 flex items-center gap-2 ${f?"text-gray-600":"text-blue-700"}`,children:[f?e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(()=>{const[S,L,i]=m.split("-");return new Date(Number(S),Number(L)-1,Number(i)).toLocaleDateString()})(),f&&e.jsx("span",{className:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded-full ml-2",children:"Consulta pasada"})]}),e.jsxs("table",{className:`min-w-full text-sm border rounded overflow-hidden ${f?"opacity-70":""}`,children:[e.jsx("thead",{className:`${f?"bg-gray-200":"bg-blue-100"}`,children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1",children:"Hora inicio"}),e.jsx("th",{className:"px-2 py-1",children:"Hora fin"}),e.jsx("th",{className:"px-2 py-1 text-center",children:f?"Historial":"Acciones"})]})}),e.jsx("tbody",{children:g[m].map(S=>e.jsx("tr",{className:`${f?"hover:bg-gray-100":"hover:bg-blue-200"} transition group`,children:a===S.id&&!f?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-1 text-center",children:e.jsx("input",{type:"time",className:"border rounded px-1 py-0.5 text-green-700 font-mono",value:x.hora_inicio,onChange:L=>w(i=>({...i,hora_inicio:L.target.value}))})}),e.jsx("td",{className:"px-2 py-1 text-center",children:e.jsx("input",{type:"time",className:"border rounded px-1 py-0.5 text-red-700 font-mono",value:x.hora_fin,onChange:L=>w(i=>({...i,hora_fin:L.target.value}))})}),e.jsxs("td",{className:"px-2 py-1 text-center flex gap-1 justify-center",children:[e.jsx("button",{title:"Guardar",onClick:()=>h(S),className:"text-green-600 hover:text-green-800",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("button",{title:"Cancelar",onClick:j,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-1 text-center font-mono text-green-700",children:n(S.hora_inicio)}),e.jsx("td",{className:"px-2 py-1 text-center font-mono text-red-700",children:n(S.hora_fin)}),e.jsx("td",{className:"px-2 py-1 text-center flex gap-1 justify-center",children:f?e.jsx("span",{className:"text-xs text-gray-500 px-2 py-1 bg-gray-100 rounded",children:"Finalizado"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{title:"Editar",onClick:()=>y(S),className:"text-blue-500 hover:text-blue-700 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m2-2l-6 6"})})}),e.jsx("button",{title:"Eliminar",onClick:()=>N(S.id),className:"text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})})]})},S.id))})]})]},m)})})]})]})]})}function ws(){return e.jsx(ys,{})}function Cs({consultaId:s,resultadosLab:r,ordenesLab:a=[]}){const[d,x]=t.useState("laboratorio"),[w,y]=t.useState([]),h=ne();t.useEffect(()=>{fetch(`${O}/api_examenes_laboratorio.php`,{credentials:"include"}).then(N=>N.json()).then(N=>y(N.examenes||[])).catch(N=>console.error("Error al obtener exámenes:",N))},[]);const j=pe.useMemo(()=>{const N={};for(const v of w)N[v.id]=v.nombre;return N},[w]);return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 mb-2",children:[e.jsxs("button",{onClick:()=>x("laboratorio"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${d==="laboratorio"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["🧪 ",e.jsx("span",{className:"hidden sm:inline",children:"Laboratorio"}),e.jsx("span",{className:"sm:hidden",children:"Lab"})]}),e.jsxs("button",{onClick:()=>x("rx"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${d==="rx"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["📸 ",e.jsx("span",{className:"hidden sm:inline",children:"RX"})]}),e.jsxs("button",{onClick:()=>x("ecografia"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${d==="ecografia"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["🫀 ",e.jsx("span",{className:"hidden sm:inline",children:"Ecografía"}),e.jsx("span",{className:"sm:hidden",children:"Eco"})]}),e.jsxs("button",{onClick:()=>x("tomografia"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${d==="tomografia"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["🔬 ",e.jsx("span",{className:"hidden sm:inline",children:"Tomografía"}),e.jsx("span",{className:"sm:hidden",children:"TAC"})]})]}),e.jsxs("div",{className:"border rounded-b bg-white p-3 overflow-hidden",children:[d==="laboratorio"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mb-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",onClick:()=>h(`/solicitud-laboratorio/${s}`),children:"Solicitar análisis de laboratorio"}),(!a||a.length===0)&&e.jsx("div",{className:"mb-3 p-2 bg-gray-50 border border-gray-200 rounded text-gray-600",children:"No hay exámenes solicitados para esta consulta."}),a&&a.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-yellow-50 border border-yellow-300 rounded",children:[e.jsx("div",{className:"font-semibold text-yellow-800 mb-1",children:"Exámenes solicitados:"}),a.map((N,v)=>e.jsxs("ul",{className:"list-disc ml-5 text-sm",children:[Array.isArray(N.examenes)&&N.examenes.length>0?N.examenes.map((C,l)=>typeof C=="string"||typeof C=="number"?e.jsx("li",{children:j[C]||C},l):e.jsx("li",{children:C.nombre||j[C.id]||JSON.stringify(C)},l)):e.jsx("li",{className:"text-gray-500",children:"Sin detalles de exámenes"}),e.jsxs("li",{className:"text-xs text-gray-500",children:["Estado: ",N.estado||"pendiente"]})]},N.id||v)),(!r||r.length===0||r.every(N=>!N.resultados||typeof N.resultados=="object"&&Object.keys(N.resultados).length===0||typeof N.resultados=="string"&&N.resultados.trim()===""))&&e.jsx("div",{className:"mt-2 text-sm text-gray-500",children:"Aún no hay resultados disponibles."})]}),r&&r.length>0&&r.some(N=>N.resultados&&(typeof N.resultados=="object"&&Object.keys(N.resultados).length>0||typeof N.resultados=="string"&&N.resultados.trim()!==""))&&e.jsxs("div",{className:"mb-6 p-3 sm:p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-green-800",children:"Resultados Disponibles"}),e.jsx("p",{className:"text-xs sm:text-sm text-green-600",children:"Los resultados de laboratorio ya están listos"})]})]}),e.jsxs("button",{className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg hover:shadow-xl text-sm sm:text-base",onClick:()=>h(`/resultados-laboratorio/${s}`),children:[e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden sm:inline",children:"📋 Ver Resultados de Laboratorio"}),e.jsx("span",{className:"sm:hidden",children:"📋 Ver Resultados"}),e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),d==="rx"&&e.jsx("div",{className:"text-gray-500",children:"(Próximamente: solicitud y resultados de Rayos X)"}),d==="ecografia"&&e.jsx("div",{className:"text-gray-500",children:"(Próximamente: solicitud y resultados de Ecografía)"}),d==="tomografia"&&e.jsx("div",{className:"text-gray-500",children:"(Próximamente: solicitud y resultados de Tomografía)"})]})]})}function ks({hc:s,setHc:r}){return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Anamnesis"}),e.jsxs("div",{className:"mb-2 flex flex-col md:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Tiempo de Enfermedad:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.tiempo_enfermedad,onChange:a=>r(d=>({...d,tiempo_enfermedad:a.target.value}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Forma de inicio:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.forma_inicio,onChange:a=>r(d=>({...d,forma_inicio:a.target.value}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Curso:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.curso,onChange:a=>r(d=>({...d,curso:a.target.value}))})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Descripción general del cuadro actual:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.descripcion_general||"",onChange:a=>r(d=>({...d,descripcion_general:a.target.value}))})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Antecedentes"}),e.jsx("div",{className:"mb-2",children:e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.antecedentes,onChange:a=>r(d=>({...d,antecedentes:a.target.value}))})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Examen Físico"}),e.jsx("div",{className:"mb-2",children:e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.examen_fisico,onChange:a=>r(d=>({...d,examen_fisico:a.target.value}))})})]})}function _s({triaje:s}){return s?e.jsxs("div",{className:"space-y-4",children:[s.motivo&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"📋 Motivo de Consulta"}),e.jsx("p",{className:"text-blue-800 leading-relaxed",children:s.motivo})]})]})}),s.sintomas&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-orange-900 mb-2",children:"🩺 Síntomas Principales"}),e.jsx("p",{className:"text-orange-800 leading-relaxed",children:s.sintomas})]})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),"❤️ Signos Vitales"]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:[s.presion_arterial&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Presión Arterial"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:s.presion_arterial}),e.jsx("div",{className:"text-xs text-gray-400",children:"mmHg"})]}),s.frecuencia_cardiaca&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Freq. Cardíaca"}),e.jsx("div",{className:"text-lg font-bold text-pink-600",children:s.frecuencia_cardiaca}),e.jsx("div",{className:"text-xs text-gray-400",children:"lpm"})]}),s.frecuencia_respiratoria&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Freq. Respiratoria"}),e.jsx("div",{className:"text-lg font-bold text-blue-600",children:s.frecuencia_respiratoria}),e.jsx("div",{className:"text-xs text-gray-400",children:"rpm"})]}),s.temperatura&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Temperatura"}),e.jsx("div",{className:"text-lg font-bold text-orange-600",children:s.temperatura}),e.jsx("div",{className:"text-xs text-gray-400",children:"°C"})]}),s.saturacion&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Sat. O₂"}),e.jsx("div",{className:"text-lg font-bold text-cyan-600",children:s.saturacion}),e.jsx("div",{className:"text-xs text-gray-400",children:"%"})]}),s.peso&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Peso"}),e.jsx("div",{className:"text-lg font-bold text-purple-600",children:s.peso}),e.jsx("div",{className:"text-xs text-gray-400",children:"kg"})]}),s.talla&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Talla"}),e.jsx("div",{className:"text-lg font-bold text-indigo-600",children:s.talla}),e.jsx("div",{className:"text-xs text-gray-400",children:"cm"})]}),s.peso&&s.talla&&e.jsxs("div",{className:"bg-gradient-to-r from-emerald-50 to-teal-50 rounded-lg p-3 shadow-sm border border-emerald-200",children:[e.jsx("div",{className:"text-xs text-emerald-700 font-medium uppercase",children:"IMC"}),e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:(parseFloat(s.peso)/Math.pow(parseFloat(s.talla)/100,2)).toFixed(1)}),e.jsx("div",{className:"text-xs text-emerald-500",children:"kg/m²"})]})]})]}),(s.nivel_conciencia||s.hidratacion||s.coloracion)&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-purple-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"👤 Estado General"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[s.nivel_conciencia&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Conciencia:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.nivel_conciencia==="Alerta"?"bg-green-100 text-green-800":s.nivel_conciencia==="Somnoliento"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.nivel_conciencia})]}),s.hidratacion&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Hidratación:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.hidratacion==="Normal"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:s.hidratacion})]}),s.coloracion&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Coloración:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.coloracion==="Normal"?"bg-green-100 text-green-800":s.coloracion==="Cianosis"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s.coloracion})]})]})]})]}):e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-yellow-700",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"font-medium",children:"No hay datos de triaje registrados"})]}),e.jsx("p",{className:"text-sm text-yellow-600 mt-2",children:"El triaje debe ser realizado por el personal de enfermería"})]})}function Ss({paciente:s}){return s?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",s.nombre," ",s.apellido]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",s.dni]}),e.jsxs("div",{children:[e.jsx("b",{children:"Historia Clínica:"})," ",s.historia_clinica]}),e.jsxs("div",{children:[e.jsx("b",{children:"Edad:"})," ",s.edad," ",s.edad_unidad]}),e.jsxs("div",{children:[e.jsx("b",{children:"Sexo:"})," ",s.sexo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Dirección:"})," ",s.direccion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Teléfono:"})," ",s.telefono]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",s.email]})]}):null}function Es({diagnosticos:s,setDiagnosticos:r}){const[a,d]=t.useState(""),[x,w]=t.useState([]),[y,h]=t.useState(null),[j,N]=t.useState({tipo:"principal",observaciones:""}),[v,C]=t.useState(!1);t.useEffect(()=>{if(a.length<2){w([]);return}C(!0);const g=setTimeout(async()=>{try{const c=await(await fetch(`http://localhost/clinica-2demayo/api_cie10.php?buscar=${encodeURIComponent(a)}&limite=15`)).json();c.success?w(c.data):(console.error("Error en la búsqueda:",c.message),w([]))}catch(n){console.error("Error al buscar códigos CIE10:",n),w([])}finally{C(!1)}},300);return()=>clearTimeout(g)},[a]);const l=()=>{y&&(r(o=>[...o,{...y,...j,fecha:new Date().toISOString().slice(0,10)}]),h(null),N({tipo:"secundario",observaciones:""}),d(""),w([]))},_=o=>{r(g=>g.filter(n=>n.codigo!==o))},E=(o,g)=>{r(n=>n.map(c=>c.codigo===o?{...c,tipo:g}:c))};return e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Diagnóstico (CIE10)"}),e.jsx("div",{className:"mb-2 flex flex-col sm:flex-row gap-2 items-stretch",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",className:"border rounded p-2 w-full pr-10",placeholder:"Buscar diagnóstico por nombre o código CIE10...",value:a,onChange:o=>{d(o.target.value),h(null)}}),v&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]})}),a.length>=2&&!v&&x.length===0&&e.jsxs("div",{className:"border rounded bg-yellow-50 p-3 mb-2 text-center",children:[e.jsxs("div",{className:"text-yellow-700",children:['No se encontraron códigos CIE10 para "',a,'"']}),e.jsx("div",{className:"text-xs text-yellow-600 mt-1",children:"Intenta con otros términos o códigos"})]}),x.length>0&&!y&&e.jsx("div",{className:"border rounded bg-white shadow-lg max-h-60 overflow-y-auto mb-2 z-10",children:x.map(o=>e.jsx("div",{className:"px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>h(o),children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm text-gray-900",children:o.nombre}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded mr-2",children:o.codigo}),o.categoria&&e.jsx("span",{className:"text-blue-600",children:o.categoria}),o.subcategoria&&e.jsxs("span",{className:"text-gray-500",children:[" • ",o.subcategoria]})]}),o.descripcion&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:o.descripcion})]})})},o.id))}),y&&e.jsxs("div",{className:"border rounded p-3 bg-blue-50 mb-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"font-semibold text-lg",children:y.nombre}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-mono bg-blue-100 px-2 py-1 rounded mr-2",children:y.codigo}),y.categoria&&e.jsx("span",{className:"text-blue-600",children:y.categoria}),y.subcategoria&&e.jsxs("span",{className:"text-gray-500",children:[" • ",y.subcategoria]})]}),y.descripcion&&e.jsx("div",{className:"text-sm text-gray-700 mt-2 p-2 bg-white rounded border-l-4 border-blue-400",children:y.descripcion})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-1",children:[e.jsxs("select",{className:"border rounded p-1",value:j.tipo,onChange:o=>N(g=>({...g,tipo:o.target.value})),children:[e.jsx("option",{value:"principal",children:"Principal"}),e.jsx("option",{value:"secundario",children:"Secundario"})]}),e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Observaciones",value:j.observaciones,onChange:o=>N(g=>({...g,observaciones:o.target.value}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:l,children:"Agregar diagnóstico"}),e.jsx("button",{type:"button",className:"bg-gray-400 text-white px-3 py-1 rounded",onClick:()=>h(null),children:"Cancelar"})]})]}),s.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Diagnósticos agregados:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border rounded min-w-max",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Código"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Nombre"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Tipo"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Observaciones"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Fecha"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap w-16",children:"Quitar"})]})}),e.jsx("tbody",{children:s.map((o,g)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1 font-mono text-xs whitespace-nowrap",children:o.codigo}),e.jsx("td",{className:"border px-2 py-1 max-w-xs truncate",title:o.nombre,children:o.nombre}),e.jsx("td",{className:"border px-2 py-1",children:e.jsxs("select",{className:"border rounded p-1 text-xs w-full min-w-0",value:o.tipo,onChange:n=>E(o.codigo,n.target.value),children:[e.jsx("option",{value:"principal",children:"Principal"}),e.jsx("option",{value:"secundario",children:"Secundario"})]})}),e.jsx("td",{className:"border px-2 py-1 max-w-xs truncate",title:o.observaciones,children:o.observaciones}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:o.fecha}),e.jsx("td",{className:"border px-2 py-1 text-center",children:e.jsx("button",{type:"button",className:"text-red-600 hover:text-red-800 bg-red-100 hover:bg-red-200 rounded px-2 py-1 text-xs font-medium transition-colors",onClick:()=>_(o.codigo),title:"Eliminar diagnóstico",children:"✕"})})]},o.codigo+g))})]})})]})]})}function Ls({receta:s,setReceta:r}){const a=Array.isArray(s)?s:[],[d,x]=t.useState(""),[w,y]=t.useState([]),[h,j]=t.useState(!1),[N,v]=t.useState(null),[C,l]=t.useState({dosis:"",frecuencia:"",duracion:"",observaciones:""});t.useEffect(()=>{if(d.length<2){y([]);return}j(!0),fetch(`${O}api_medicamentos.php?busqueda=${encodeURIComponent(d)}`,{credentials:"include"}).then(o=>o.json()).then(o=>y(o)).finally(()=>j(!1))},[d]);const _=()=>{if(!N)return;const o={codigo:N.codigo,nombre:N.nombre,dosis:C.dosis,frecuencia:C.frecuencia,duracion:C.duracion,observaciones:C.observaciones};r(g=>[o,...g]),v(null),l({dosis:"",frecuencia:"",duracion:"",observaciones:""}),x(""),y([])},E=o=>{r(g=>g.filter(n=>n.codigo!==o))};return e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Receta médica"}),e.jsxs("div",{className:"mb-2 flex flex-col sm:flex-row gap-2 items-stretch",children:[e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Buscar medicamento por nombre o código",value:d,onChange:o=>{x(o.target.value),v(null)}}),h&&e.jsx("span",{className:"text-xs text-gray-500",children:"Buscando..."})]}),w.length>0&&!N&&e.jsx("div",{className:"border rounded bg-white shadow max-h-40 overflow-y-auto mb-2",children:w.map(o=>e.jsxs("div",{className:"px-2 py-1 hover:bg-blue-100 cursor-pointer text-sm",onClick:()=>v(o),children:[o.nombre," ",e.jsxs("span",{className:"text-gray-500",children:["(",o.codigo,")"]})]},o.codigo))}),N&&e.jsxs("div",{className:"border rounded p-2 bg-blue-50 mb-2",children:[e.jsxs("div",{className:"font-semibold mb-1",children:[N.nombre," ",e.jsxs("span",{className:"text-gray-500",children:["(",N.codigo,")"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-1",children:[e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Dosis (ej: 500mg)",value:C.dosis,onChange:o=>l(g=>({...g,dosis:o.target.value}))}),e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Frecuencia (ej: cada 8h)",value:C.frecuencia,onChange:o=>l(g=>({...g,frecuencia:o.target.value}))}),e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Duración (ej: 5 días)",value:C.duracion,onChange:o=>l(g=>({...g,duracion:o.target.value}))})]}),e.jsx("textarea",{className:"border rounded p-1 w-full mb-2",placeholder:"Observaciones",value:C.observaciones,onChange:o=>l(g=>({...g,observaciones:o.target.value})),rows:2}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:_,children:"Agregar a receta"}),e.jsx("button",{type:"button",className:"bg-gray-400 text-white px-3 py-1 rounded",onClick:()=>v(null),children:"Cancelar"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Medicamentos seleccionados:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border rounded min-w-max",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Medicamento"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Dosis"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Frecuencia"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Duración"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Observaciones"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap w-16",children:"Quitar"})]})}),e.jsx("tbody",{children:a.length>0?a.map((o,g)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1 max-w-xs",children:e.jsxs("div",{className:"truncate",title:`${o.nombre} (${o.codigo})`,children:[o.nombre," ",e.jsxs("span",{className:"text-gray-500",children:["(",o.codigo,")"]})]})}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:o.dosis}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:o.frecuencia}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:o.duracion}),e.jsx("td",{className:"border px-2 py-1 max-w-xs truncate",title:o.observaciones,children:o.observaciones}),e.jsx("td",{className:"border px-2 py-1 text-center",children:e.jsx("button",{type:"button",className:"text-red-600 hover:text-red-800 bg-red-100 hover:bg-red-200 rounded px-2 py-1 text-xs font-medium transition-colors",onClick:()=>E(o.codigo),title:"Eliminar medicamento",children:"✕"})})]},o.codigo+g)):e.jsx("tr",{children:e.jsx("td",{className:"border px-2 py-1 text-center text-gray-500 italic",colSpan:6,children:"No hay medicamentos seleccionados"})})})]})})]})]})}function Ms({receta:s,setReceta:r,tratamiento:a,setTratamiento:d}){return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Tratamiento"}),e.jsx("div",{className:"mb-2",children:e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,placeholder:"Indicación general, reposo, dieta, fisioterapia, etc.",value:a||"",onChange:x=>d(x.target.value)})}),e.jsx(Ls,{receta:s,setReceta:r})]})}const Ps=({paciente:s,triaje:r,hc:a,diagnosticos:d,medicamentos:x,ordenesLaboratorio:w,medicoInfo:y,configuracionClinica:h})=>{const j=()=>window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?`${window.location.protocol}//${window.location.host}/2demayo.svg`:"/2demayo.svg",N=l=>l?new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",v=l=>l?new Date(l).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"",C=({titulo:l,mensaje:_="No hay información registrada"})=>e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"font-semibold text-gray-600 mb-2 border-b border-gray-300",children:l}),e.jsx("p",{className:"text-sm text-gray-500 italic text-center p-4",children:_})]});return e.jsxs("div",{className:"bg-white p-8 max-w-4xl mx-auto shadow-lg print:shadow-none print:max-w-none",children:[e.jsx("style",{jsx:!0,children:`
        @media print {
          .firma-medico {
            break-inside: avoid;
            page-break-inside: avoid;
          }
          .firma-imagen {
            print-color-adjust: exact;
            -webkit-print-color-adjust: exact;
          }
        }
      `}),e.jsx("div",{className:"text-center border-b-2 border-blue-600 pb-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-2",children:[e.jsx("img",{src:j(),alt:"Logo Clínica 2 de Mayo",className:"h-16 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-800",children:h?.nombre_clinica||"CLÍNICA 2 DE MAYO"}),e.jsx("p",{className:"text-sm text-gray-600",children:h?.direccion||"Dirección de la clínica"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Tel: ",h?.telefono||"123-456-789"," | Email: ",h?.email||"contacto@clinica2demayo.com"]})]})]})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 border-b border-gray-300 pb-2",children:"📋 HISTORIA CLÍNICA"}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mt-2",children:[e.jsxs("span",{children:["Fecha: ",N(new Date)]}),e.jsxs("span",{children:["Hora: ",v(new Date)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6 p-4 bg-blue-50 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2 border-b border-blue-200",children:"👤 DATOS DEL PACIENTE"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Nombre:"})," ",s?.nombres," ",s?.apellidos]}),e.jsxs("p",{children:[e.jsx("strong",{children:"DNI:"})," ",s?.dni]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Edad:"})," ",s?.edad," años"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Sexo:"})," ",s?.sexo]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Teléfono:"})," ",s?.telefono]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2 border-b border-blue-200",children:"🩺 INFORMACIÓN MÉDICA"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Médico:"})," Dr(a). ",y?.nombre," ",y?.apellido]}),e.jsxs("p",{children:[e.jsx("strong",{children:"CMP:"})," ",y?.cmp||"N/A"]}),y?.rne&&e.jsxs("p",{children:[e.jsx("strong",{children:"RNE:"})," ",y.rne]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Especialidad:"})," ",y?.especialidad]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha Consulta:"})," ",N(s?.fecha_consulta)]})]})]})]}),r?.motivo&&e.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-2 border-b border-yellow-300",children:"📝 MOTIVO DE CONSULTA"}),e.jsx("p",{className:"text-sm leading-relaxed",children:r.motivo})]}),r&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-2 border-b border-green-300",children:"❤️ SIGNOS VITALES"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[r.presion_arterial&&e.jsxs("div",{children:[e.jsx("strong",{children:"P/A:"})," ",r.presion_arterial," mmHg"]}),r.frecuencia_cardiaca&&e.jsxs("div",{children:[e.jsx("strong",{children:"FC:"})," ",r.frecuencia_cardiaca," lpm"]}),r.frecuencia_respiratoria&&e.jsxs("div",{children:[e.jsx("strong",{children:"FR:"})," ",r.frecuencia_respiratoria," rpm"]}),r.temperatura&&e.jsxs("div",{children:[e.jsx("strong",{children:"T°:"})," ",r.temperatura,"°C"]}),r.saturacion&&e.jsxs("div",{children:[e.jsx("strong",{children:"SpO₂:"})," ",r.saturacion,"%"]}),r.peso&&e.jsxs("div",{children:[e.jsx("strong",{children:"Peso:"})," ",r.peso," kg"]}),r.talla&&e.jsxs("div",{children:[e.jsx("strong",{children:"Talla:"})," ",r.talla," cm"]}),r.peso&&r.talla&&e.jsxs("div",{children:[e.jsx("strong",{children:"IMC:"})," ",(parseFloat(r.peso)/Math.pow(parseFloat(r.talla)/100,2)).toFixed(1)," kg/m²"]})]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"font-semibold text-purple-800 mb-3 border-b border-purple-300",children:"🔍 ANAMNESIS"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 text-sm",children:[a.tiempo_enfermedad&&e.jsxs("div",{children:[e.jsx("strong",{children:"Tiempo de Enfermedad:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:a.tiempo_enfermedad})]}),a.forma_inicio&&e.jsxs("div",{children:[e.jsx("strong",{children:"Forma de Inicio:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:a.forma_inicio})]}),a.curso&&e.jsxs("div",{children:[e.jsx("strong",{children:"Curso:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:a.curso})]})]}),a.descripcion_general&&e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Descripción General:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:a.descripcion_general})]})]}),a.antecedentes&&e.jsxs("div",{className:"mb-6 p-4 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"font-semibold text-orange-800 mb-2 border-b border-orange-300",children:"📚 ANTECEDENTES"}),e.jsx("p",{className:"text-sm leading-relaxed p-2 bg-white rounded border",children:a.antecedentes})]}),a.examen_fisico&&e.jsxs("div",{className:"mb-6 p-4 bg-teal-50 rounded-lg border border-teal-200",children:[e.jsx("h3",{className:"font-semibold text-teal-800 mb-2 border-b border-teal-300",children:"🔬 EXAMEN FÍSICO"}),e.jsx("p",{className:"text-sm leading-relaxed p-2 bg-white rounded border",children:a.examen_fisico})]}),d&&d.length>0?e.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg border border-red-200 seccion-diagnosticos",children:[e.jsx("h3",{className:"font-semibold text-red-800 mb-2 border-b border-red-300",children:"🎯 DIAGNÓSTICOS CIE-10"}),e.jsx("div",{className:"space-y-3",children:d.map((l,_)=>e.jsx("div",{className:"text-sm p-3 bg-white rounded border border-red-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"inline-block w-6 h-6 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center flex-shrink-0",children:_+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[e.jsx("span",{className:"inline-block px-2 py-1 bg-red-100 text-red-800 text-xs font-semibold rounded",children:l.tipo||"Principal"}),e.jsx("span",{className:"inline-block px-2 py-1 bg-gray-100 text-gray-800 text-xs font-mono rounded",children:l.codigo})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900 leading-relaxed",children:l.descripcion})]})]})},_))})]}):e.jsx(C,{titulo:"🎯 DIAGNÓSTICOS CIE-10",mensaje:"No se han registrado diagnósticos para esta consulta"}),a.tratamiento&&e.jsxs("div",{className:"mb-6 p-4 bg-indigo-50 rounded-lg border border-indigo-200",children:[e.jsx("h3",{className:"font-semibold text-indigo-800 mb-2 border-b border-indigo-300",children:"💊 PLAN DE TRATAMIENTO"}),e.jsx("p",{className:"text-sm leading-relaxed p-2 bg-white rounded border",children:a.tratamiento})]}),x&&x.length>0?e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200 seccion-medicamentos",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-2 border-b border-green-300",children:"💉 RECETA MÉDICA"}),e.jsx("div",{className:"space-y-3",children:x.map((l,_)=>e.jsxs("div",{className:"text-sm p-3 bg-white rounded border border-green-100",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Medicamento:"})," ",l.medicamento]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Concentración:"})," ",l.concentracion]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Forma Farmacéutica:"})," ",l.forma_farmaceutica]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Dosis:"})," ",l.dosis]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Frecuencia:"})," ",l.frecuencia]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duración:"})," ",l.duracion]})]})]}),l.indicaciones&&e.jsx("div",{className:"mt-2 pt-2 border-t border-green-100",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Indicaciones:"})," ",l.indicaciones]})})]},_))})]}):e.jsx(C,{titulo:"💉 RECETA MÉDICA",mensaje:"No se han prescrito medicamentos para esta consulta"}),w&&w.length>0?e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200 seccion-laboratorio",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2 border-b border-blue-300",children:"🔬 EXÁMENES DE LABORATORIO SOLICITADOS"}),e.jsx("div",{className:"space-y-3",children:w.map((l,_)=>e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-blue-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded",children:["Orden #",l.id||_+1]}),e.jsx("span",{className:"text-xs text-gray-500",children:N(l.fecha_solicitud)})]}),l.examenes&&l.examenes.length>0?e.jsx("div",{className:"space-y-2",children:l.examenes.map((E,o)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-blue-50 rounded border-l-4 border-blue-300",children:[e.jsx("span",{className:"w-5 h-5 bg-blue-500 text-white text-xs font-bold rounded-full flex items-center justify-center flex-shrink-0",children:o+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900",children:E.nombre}),E.descripcion&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:E.descripcion}),E.condicion_paciente&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:[e.jsx("strong",{children:"Condición:"})," ",E.condicion_paciente]}),E.tiempo_resultado&&e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[e.jsx("strong",{children:"Tiempo estimado:"})," ",E.tiempo_resultado]})]}),e.jsx("div",{className:"text-xs",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${l.estado==="pendiente"?"bg-yellow-100 text-yellow-800":l.estado==="completado"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:l.estado||"Pendiente"})})]},o))}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No hay exámenes específicos registrados"})]},_))})]}):e.jsx(C,{titulo:"🔬 EXÁMENES DE LABORATORIO SOLICITADOS",mensaje:"No se han solicitado exámenes de laboratorio para esta consulta"}),e.jsx("div",{className:"mt-8 pt-4 border-t-2 border-gray-300",children:e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("p",{children:"Documento generado digitalmente"}),e.jsxs("p",{children:["Fecha de impresión: ",N(new Date)," - ",v(new Date)]})]}),e.jsxs("div",{className:"text-center pie-firma",children:[y?.firma&&e.jsx("div",{className:"mb-4 firma-digital",children:e.jsx("img",{src:y.firma,alt:"Firma digital del médico",className:"mx-auto border border-gray-300 rounded bg-white p-1 firma-img-hc"})}),e.jsxs("div",{className:"border-t-2 border-gray-400 pt-2 min-w-[200px]",children:[e.jsxs("p",{className:"font-semibold text-sm",children:["Dr(a). ",y?.nombre," ",y?.apellido]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["CMP: ",y?.cmp||"N/A"]}),y?.rne&&e.jsxs("p",{className:"text-xs text-gray-600",children:["RNE: ",y.rne]}),e.jsx("p",{className:"text-xs text-gray-600",children:y?.especialidad}),!y?.firma&&e.jsx("div",{className:"mt-2 mb-4 h-16 flex items-center justify-center border border-dashed border-gray-300 text-xs text-gray-400",children:"[Espacio para firma manual]"})]})]})]})})]})},Fs=({paciente:s,ordenesLaboratorio:r,medicoInfo:a,configuracionClinica:d})=>{const x=()=>window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?`${window.location.protocol}//${window.location.host}/2demayo.svg`:"/2demayo.svg",w=h=>h?new Date(h).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",y=h=>h?new Date(h).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"";return e.jsxs("div",{className:"bg-white max-w-2xl mx-auto print:shadow-none print:max-w-none",style:{minHeight:"210mm",maxWidth:"148mm",padding:"10mm",fontFamily:"Arial, sans-serif",fontSize:"12px"},children:[e.jsxs("div",{className:"border-2 border-black p-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-black pb-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:x(),alt:"Logo Clínica 2 de Mayo",className:"h-10 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-bold text-black uppercase leading-tight",children:d?.nombre_clinica||"CLÍNICA 2 DE MAYO"}),e.jsx("p",{className:"text-xs text-black",children:d?.direccion||"Dirección de la clínica"}),e.jsxs("p",{className:"text-xs text-black",children:["Tel: ",d?.telefono||"123-456-789"]}),d?.ruc&&e.jsxs("p",{className:"text-xs text-black",children:["RUC: ",d.ruc]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("h2",{className:"text-sm font-bold text-black leading-tight",children:["Dr(a). ",a?.nombre," ",a?.apellido]}),e.jsx("p",{className:"text-xs text-black",children:a?.especialidad}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",a?.cmp||"N/A"]}),a?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",a.rne]})]})]}),e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-black border-b border-black pb-1",children:"📋 ORDEN DE LABORATORIO"}),e.jsxs("div",{className:"flex justify-between text-xs text-black mt-1",children:[e.jsxs("span",{children:["Fecha: ",w(new Date)]}),e.jsxs("span",{children:["Hora: ",y(new Date)]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-3",children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"👤 DATOS DEL PACIENTE"}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 text-xs",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Paciente:"})," ",s?.nombres," ",s?.apellidos]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"DNI:"})," ",s?.dni]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Edad:"})," ",s?.edad," años"]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Sexo:"})," ",s?.sexo]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"🔬 EXÁMENES SOLICITADOS"}),r&&r.length>0?e.jsx("div",{className:"space-y-2",children:r.map((h,j)=>e.jsxs("div",{className:"border border-gray-300 p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"font-bold text-black text-xs bg-blue-200 px-1 rounded",children:["#",j+1]}),e.jsxs("span",{className:"text-xs text-black",children:["Solicitud: ",w(h.fecha_solicitud)]})]}),h.examenes&&h.examenes.length>0?e.jsx("ul",{className:"list-disc pl-5 text-xs text-black",children:h.examenes.map((N,v)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:N.nombre}),N.condicion_paciente&&e.jsxs("span",{className:"ml-2 bg-yellow-100 px-1 rounded border",children:["⚠️ ",N.condicion_paciente]}),N.tiempo_resultado&&e.jsxs("span",{className:"ml-2 bg-blue-100 px-1 rounded border",children:["⏱️ ",N.tiempo_resultado]})]},v))}):e.jsx("p",{className:"text-xs text-black",children:"Sin detalles disponibles"})]},j))}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{className:"text-xs",children:"No hay órdenes de laboratorio"})})]}),e.jsx("div",{className:"space-y-2 mb-4",children:e.jsxs("div",{className:"border border-black p-2",children:[e.jsx("h3",{className:"text-xs font-bold text-black mb-1",children:"📝 INSTRUCCIONES"}),e.jsxs("div",{className:"text-xs text-black space-y-1",children:[e.jsx("p",{children:"• Presentar DNI original"}),e.jsx("p",{children:"• Seguir preparación específica"}),e.jsx("p",{children:"• Resultados según tiempo indicado"})]})]})}),e.jsx("div",{className:"border-t border-black pt-3 mt-4",children:e.jsxs("div",{className:"flex justify-between items-end text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-16 border border-dashed border-gray-400 flex items-center justify-center mb-1",children:e.jsxs("span",{className:"text-xs text-gray-500 text-center leading-tight",children:["SELLO",e.jsx("br",{}),"LAB"]})}),e.jsx("p",{className:"text-xs text-black font-bold",children:"PROCESADO"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xs text-gray-600",children:["Emitido: ",w(new Date)]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Válido 15 días"})]}),e.jsxs("div",{className:"text-center",children:[a?.firma&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:a.firma,alt:"Firma digital del médico",className:"mx-auto border border-gray-300 rounded bg-white p-1 firma-img-lab"})}),e.jsxs("div",{className:"border-t border-black pt-1 min-w-24",children:[e.jsxs("p",{className:"font-bold text-black text-xs",children:["Dr(a). ",a?.nombre," ",a?.apellido]}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",a?.cmp||"N/A"]}),a?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",a.rne]}),e.jsx("p",{className:"text-xs text-black",children:a?.especialidad}),!a?.firma&&e.jsx("div",{className:"mt-1 mb-2 h-8 flex items-center justify-center border border-dashed border-gray-400 text-xs text-gray-500",children:"[Firma Manual]"}),e.jsx("p",{className:"text-xs text-black font-bold",children:"FIRMA MÉDICO"})]})]})]})})]})},Ts=({paciente:s,medicamentos:r,medicoInfo:a,configuracionClinica:d})=>{const x=()=>window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?`${window.location.protocol}//${window.location.host}/2demayo.svg`:"/2demayo.svg",w=h=>h?new Date(h).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",y=h=>h?new Date(h).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"";return e.jsxs("div",{className:"bg-white max-w-2xl mx-auto print:shadow-none print:max-w-none",style:{minHeight:"210mm",maxWidth:"148mm",padding:"10mm",fontFamily:"Arial, sans-serif",fontSize:"12px"},children:[e.jsxs("div",{className:"border-2 border-black p-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-black pb-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:x(),alt:"Logo Clínica 2 de Mayo",className:"h-10 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-bold text-black uppercase leading-tight",children:d?.nombre_clinica||"CLÍNICA 2 DE MAYO"}),e.jsx("p",{className:"text-xs text-black",children:d?.direccion||"Dirección de la clínica"}),e.jsxs("p",{className:"text-xs text-black",children:["Tel: ",d?.telefono||"123-456-789"]}),d?.ruc&&e.jsxs("p",{className:"text-xs text-black",children:["RUC: ",d.ruc]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("h2",{className:"text-sm font-bold text-black leading-tight",children:["Dr(a). ",a?.nombre," ",a?.apellido]}),e.jsx("p",{className:"text-xs text-black",children:a?.especialidad}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",a?.cmp||"N/A"]}),a?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",a.rne]})]})]}),e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-black border-b border-black pb-1",children:"💊 RECETA MÉDICA"}),e.jsxs("div",{className:"flex justify-between text-xs text-black mt-1",children:[e.jsxs("span",{children:["Fecha: ",w(new Date)]}),e.jsxs("span",{children:["Hora: ",y(new Date)]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-3",children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"👤 DATOS DEL PACIENTE"}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 text-xs",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Paciente:"})," ",s?.nombres," ",s?.apellidos]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"DNI:"})," ",s?.dni]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Edad:"})," ",s?.edad," años"]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Sexo:"})," ",s?.sexo]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-3",style:{minHeight:"80px"},children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"💊 MEDICAMENTOS PRESCRITOS"}),r&&r.length>0?e.jsx("ul",{className:"list-disc pl-5 text-xs text-black space-y-1",children:r.map((h,j)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold uppercase",children:h.nombre||"Medicamento no especificado"}),h.dosis&&e.jsxs("span",{className:"ml-2",children:[e.jsx("strong",{children:"Dosis:"})," ",h.dosis]}),h.frecuencia&&e.jsxs("span",{className:"ml-2",children:[e.jsx("strong",{children:"Frecuencia:"})," ",h.frecuencia]}),h.duracion&&e.jsxs("span",{className:"ml-2",children:[e.jsx("strong",{children:"Duración:"})," ",h.duracion]}),h.observaciones&&e.jsxs("span",{className:"ml-2 italic",children:[e.jsx("strong",{children:"Obs:"})," ",h.observaciones]})]},j))}):e.jsx("p",{className:"text-xs text-black italic text-center py-4",children:"No se han prescrito medicamentos."})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"border border-black p-2",children:[e.jsx("h3",{className:"text-xs font-bold text-black mb-1",children:"📋 INSTRUCCIONES"}),e.jsxs("div",{className:"text-xs text-black space-y-1",children:[e.jsx("p",{children:"• Tomar según indicación médica"}),e.jsx("p",{children:"• Completar tratamiento"}),e.jsx("p",{children:"• Contactar médico si efectos adversos"})]})]}),e.jsxs("div",{className:"border border-red-500 bg-red-50 p-2",children:[e.jsx("h3",{className:"text-xs font-bold text-red-800 mb-1",children:"⚠️ ADVERTENCIAS"}),e.jsx("p",{className:"text-xs text-red-800",children:"• Receta personal e intransferible • Fuera del alcance de niños"})]})]}),e.jsx("div",{className:"border-t border-black pt-3 mt-4",children:e.jsxs("div",{className:"flex justify-between items-end text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-16 border border-dashed border-gray-400 flex items-center justify-center mb-1",children:e.jsxs("span",{className:"text-xs text-gray-500 text-center leading-tight",children:["SELLO",e.jsx("br",{}),"FARMACIA"]})}),e.jsx("p",{className:"text-xs text-black font-bold",children:"DESPACHADO"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xs text-gray-600",children:["Emitido: ",w(new Date)]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Válido 30 días"})]}),e.jsxs("div",{className:"text-center",children:[a?.firma&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:a.firma,alt:"Firma digital del médico",className:"mx-auto border border-gray-300 rounded bg-white p-1 firma-img-receta"})}),e.jsxs("div",{className:"border-t border-black pt-1 min-w-24",children:[e.jsxs("p",{className:"font-bold text-black text-xs",children:["Dr(a). ",a?.nombre," ",a?.apellido]}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",a?.cmp||"N/A"]}),a?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",a.rne]}),e.jsx("p",{className:"text-xs text-black",children:a?.especialidad}),!a?.firma&&e.jsx("div",{className:"mt-1 mb-2 h-8 flex items-center justify-center border border-dashed border-gray-400 text-xs text-gray-500",children:"[Firma Manual]"}),e.jsx("p",{className:"text-xs text-black font-bold",children:"FIRMA MÉDICO"})]})]})]})})]})},Ds=()=>{const s=t.useRef(),r=ve.useReactToPrint({contentRef:s,documentTitle:"Historia Clínica",onBeforeGetContent:t.useCallback(()=>new Promise(a=>{setTimeout(a,100)}),[]),pageStyle:`
      @page {
        size: A4;
        margin: 10mm;
      }
      
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
        }
        
        .print\\:shadow-none {
          box-shadow: none !important;
        }
        
        .print\\:max-w-none {
          max-width: none !important;
        }
        
        .no-print {
          display: none !important;
        }
        
        /* Colores de fondo para impresión */
        .bg-blue-50, .bg-yellow-50, .bg-green-50, 
        .bg-purple-50, .bg-orange-50, .bg-teal-50, 
        .bg-red-50, .bg-indigo-50 {
          background-color: #f8f9fa !important;
          border: 1px solid #dee2e6 !important;
        }
        
        /* Asegurar que los bordes se impriman */
        .border, .border-b, .border-t-2 {
          border-color: #6c757d !important;
        }
        
        /* Mejorar legibilidad de texto */
        .text-gray-600, .text-gray-800 {
          color: #333 !important;
        }
      }
    `});return{componentRef:s,handlePrint:r}},As=()=>{const s=t.useRef(),r=ve.useReactToPrint({contentRef:s,documentTitle:"Orden de Laboratorio",onBeforeGetContent:t.useCallback(()=>new Promise(a=>{setTimeout(a,100)}),[]),pageStyle:`
      @page {
        size: A4;
        margin: 15mm;
      }
      
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
          font-family: 'Times New Roman', serif;
        }
        
        .no-print {
          display: none !important;
        }
        
        .print\\:border-black {
          border-color: black !important;
        }
        
        .print\\:text-black {
          color: black !important;
        }
      }
    `});return{componentRef:s,handlePrint:r}},$s=()=>{const s=t.useRef(),r=ve.useReactToPrint({contentRef:s,documentTitle:"Receta Médica",onBeforeGetContent:t.useCallback(()=>new Promise(a=>{setTimeout(a,100)}),[]),pageStyle:`
      @page {
        size: A4;
        margin: 15mm;
      }
      
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
          font-family: 'Times New Roman', serif;
        }
        
        .no-print {
          display: none !important;
        }
        
        .print\\:border-black {
          border-color: black !important;
        }
        
        .print\\:text-black {
          color: black !important;
        }
      }
    `});return{componentRef:s,handlePrint:r}};function Ee(){const{pacienteId:s,consultaId:r}=de(),{componentRef:a,handlePrint:d}=Ds(),{componentRef:x,handlePrint:w}=As(),{componentRef:y,handlePrint:h}=$s(),[j,N]=t.useState(null),[v,C]=t.useState(null),[l,_]=t.useState(null),[E,o]=t.useState([]),[g,n]=t.useState([]);t.useEffect(()=>{r&&(fetch(`${O}api_resultados_laboratorio.php?consulta_id=${r}`).then(T=>T.json()).then(T=>{T.success&&T.resultados?o(T.resultados):o([])}).catch(()=>o([])),fetch(`${O}api_ordenes_laboratorio.php?consulta_id=${r}`).then(T=>T.json()).then(T=>{T.success&&Array.isArray(T.ordenes)?n(T.ordenes):n([])}).catch(T=>{console.error("Error al cargar órdenes de laboratorio:",T),n([])}))},[r]);const[c,m]=t.useState(null),[f,S]=t.useState(null),[L,i]=t.useState(!0),[u,b]=t.useState(""),[M,D]=t.useState({tiempo_enfermedad:"",forma_inicio:"",curso:"",antecedentes:"",examen_fisico:"",tratamiento:"",receta:[]}),[z,$]=t.useState(!1),[P,A]=t.useState(""),[I,p]=t.useState([]);return t.useEffect(()=>{r&&fetch(`${O}api_historia_clinica.php?consulta_id=${r}`,{credentials:"include"}).then(T=>T.json()).then(T=>{T.success&&T.datos&&(D({...T.datos,receta:Array.isArray(T.datos.receta)?T.datos.receta:[]}),Array.isArray(T.datos.diagnosticos)?p(T.datos.diagnosticos):p([]))})},[r]),t.useEffect(()=>{s&&(i(!0),fetch(`${O}api_pacientes.php?id=${s}`).then(T=>T.json()).then(T=>{T.success&&T.paciente?m(T.paciente):b(T.error||"No se encontró el paciente"),i(!1)}).catch(()=>{b("Error de conexión con el servidor"),i(!1)}))},[s]),t.useEffect(()=>{r&&fetch(`${O}api_triaje.php?consulta_id=${r}`).then(T=>T.json()).then(T=>{T.success&&T.triaje&&T.triaje.datos?S(T.triaje.datos):S(null)}).catch(()=>S(null))},[r]),t.useEffect(()=>{fetch(`${O}api_get_configuracion.php`,{credentials:"include"}).then(T=>T.json()).then(T=>{T.success&&T.data&&C(T.data)}).catch(()=>C(null))},[]),t.useEffect(()=>{const T=JSON.parse(sessionStorage.getItem("medico")||"null");T?(N(T),_(T.firma||null)):(N(null),_(null))},[]),L?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-white/50 flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"🏥 Cargando historia clínica..."})]})}):u?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-red-200 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Error"}),e.jsx("p",{className:"text-red-600",children:u})]})}):c?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 py-4 sm:py-8 px-2 sm:px-4 overflow-x-hidden",children:[e.jsxs("div",{className:"max-w-6xl mx-auto w-full",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-4 sm:p-6 lg:p-8 mb-6 border border-white/50 w-full",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 sm:w-8 sm:h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"text-center sm:text-left flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-blue-800 to-indigo-800 bg-clip-text text-transparent",children:"📋 Historia Clínica"}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:"Sistema Médico Integral - Clínica 2 de Mayo"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-green-100 to-blue-100 rounded-full flex-shrink-0",children:[e.jsx("div",{className:"w-2 h-2 sm:w-3 sm:h-3 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-700",children:"En línea"})]})]})}),j&&e.jsx("div",{className:`mb-6 p-4 rounded-2xl border ${l?"bg-green-50/80 border-green-200 backdrop-blur-sm":"bg-amber-50/80 border-amber-200 backdrop-blur-sm"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${l?"bg-green-500":"bg-amber-500"}`,children:l?e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${l?"text-green-800":"text-amber-800"}`,children:l?e.jsxs(e.Fragment,{children:["✍️ ",e.jsx("strong",{children:"Firma Digital Activa:"})," Los documentos impresos incluirán su firma digital."]}):e.jsxs(e.Fragment,{children:["⚠️ ",e.jsx("strong",{children:"Sin Firma Digital:"})," Los documentos impresos tendrán espacio para firma manual."]})}),e.jsxs("p",{className:`text-xs mt-1 ${l?"text-green-600":"text-amber-600"}`,children:["Dr(a). ",j.nombre," ",j.apellido," - CMP: ",j.cmp||"N/A"]})]})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"👤 Información del Paciente"})]}),e.jsx(Ss,{paciente:c})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"🚨 Triaje y Signos Vitales"})]}),e.jsx(_s,{triaje:f})]}),e.jsxs("form",{onSubmit:async T=>{T.preventDefault(),$(!0),A("");const U={...M,diagnosticos:I,receta:M.receta},k=await(await fetch(`${O}api_historia_clinica.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:r,datos:U}),credentials:"include"})).json();$(!1),A(k.success?"Guardado correctamente":k.error||"Error al guardar")},className:"space-y-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-500 to-violet-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"📝 Anamnesis y Examen Físico"})]}),e.jsx(ks,{hc:M,setHc:D})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"🔬 Laboratorio y Apoyo Diagnóstico"})]}),e.jsx(Cs,{consultaId:r,resultadosLab:E,ordenesLab:g})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"🩺 Diagnósticos CIE10"})]}),e.jsx(Es,{diagnosticos:I,setDiagnosticos:p})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-emerald-500 to-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"💊 Tratamiento y Receta Médica"})]}),e.jsx(Ms,{receta:M.receta||[],setReceta:T=>D(U=>({...U,receta:typeof T=="function"?T(U.receta):T})),tratamiento:M.tratamiento||"",setTratamiento:T=>D(U=>({...U,tratamiento:T}))})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 w-full",children:[e.jsx("button",{type:"submit",className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm whitespace-nowrap",disabled:z,children:z?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Guardando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),e.jsx("span",{children:"💾 Guardar HC"})]})}),e.jsxs("button",{type:"button",onClick:()=>{a.current?d():console.warn("Referencia de impresión no disponible")},className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg text-sm whitespace-nowrap",title:l?"Imprimir HC con firma digital":"Imprimir HC (sin firma digital)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),e.jsx("span",{children:"🖨️ HC"}),l&&e.jsx("span",{className:"text-xs bg-white/20 px-1 rounded",children:"✍️"})]}),e.jsxs("button",{type:"button",onClick:()=>{x.current&&g&&g.length>0?w():console.warn("Referencia de laboratorio no disponible o sin órdenes de laboratorio")},className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg text-sm whitespace-nowrap",disabled:!g||g.length===0,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),e.jsx("span",{children:"🔬 Lab"})]}),e.jsxs("button",{type:"button",onClick:()=>{y.current&&M.receta&&M.receta.length>0?h():console.warn("Referencia de receta no disponible o sin medicamentos")},className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg text-sm whitespace-nowrap",disabled:!M.receta||M.receta.length===0,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),e.jsx("span",{children:"💊 Receta"})]})]}),e.jsxs("div",{className:"text-center w-full mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"✍️ Firma Digital"})]}),l?e.jsxs("div",{className:"flex flex-col items-center gap-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-3 shadow-sm",children:e.jsx("img",{src:l,alt:"Firma del médico",className:"max-h-16 max-w-[200px] object-contain"})}),e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2 w-full",children:[e.jsxs("div",{className:"text-xs text-gray-600 font-medium",children:[j?.nombre," ",j?.apellido]}),j?.especialidad&&e.jsx("div",{className:"text-xs text-gray-500",children:j.especialidad}),e.jsxs("div",{className:"text-xs text-gray-500",children:["C.M.P. ",j?.cmp||"N/A",j?.rne&&` - R.N.E ${j.rne}`]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Sistema Médico Digitalizado"})]})]}):e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"FIRMA Y SELLO MÉDICO"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Sistema Médico Digitalizado"}),e.jsx("div",{className:"text-xs text-orange-500 mt-2 italic",children:"⚠️ No hay firma registrada"})]})]})]}),P&&e.jsx("div",{className:`mt-4 p-4 rounded-xl border text-center font-medium ${P.includes("correctamente")?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[P.includes("correctamente")?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),P]})})]})]})]}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px"},children:e.jsx("div",{ref:a,children:e.jsx(Ps,{paciente:c,triaje:f,hc:M,diagnosticos:I,medicamentos:M.receta,ordenesLaboratorio:g,medicoInfo:j,configuracionClinica:v})})}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px"},children:e.jsx("div",{ref:x,children:e.jsx(Fs,{paciente:c,ordenesLaboratorio:g,medicoInfo:j,configuracionClinica:v})})}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px"},children:e.jsx("div",{ref:y,children:e.jsx(Ts,{paciente:c,medicamentos:M.receta,medicoInfo:j,configuracionClinica:v})})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-gray-200 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Paciente no encontrado"}),e.jsx("p",{className:"text-gray-600",children:"No se encontró información del paciente."})]})})}function zs({medicoId:s}){const[r,a]=t.useState([]),[d,x]=t.useState(!0),[w,y]=t.useState(""),[h,j]=t.useState(""),[N,v]=t.useState(3),[C,l]=t.useState(1),_=ne();t.useEffect(()=>{x(!0),fetch(`${O}api_historial_consultas_medico.php?medico_id=${s}`,{credentials:"include"}).then(f=>f.json()).then(f=>{f.success?a(f.historial):y(f.error||"Error al cargar historial"),x(!1)}).catch(()=>{y("Error de conexión"),x(!1)})},[s]);const E=r.filter(f=>f.paciente_nombre.toLowerCase().includes(h.toLowerCase())||f.motivo.toLowerCase().includes(h.toLowerCase())||f.diagnostico.toLowerCase().includes(h.toLowerCase())),o=E.length,g=Math.ceil(o/N),n=(C-1)*N,c=n+N,m=E.slice(n,c);return t.useEffect(()=>{l(1)},[h,N]),e.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Historial de Consultas"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",className:"border rounded p-2 w-full",placeholder:"Buscar por paciente, motivo o diagnóstico",value:h,onChange:f=>j(f.target.value)}),e.jsx("label",{className:"text-xs",children:"Filas por página:"}),e.jsxs("select",{value:N,onChange:f=>v(Number(f.target.value)),className:"border rounded p-1 text-xs",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]}),d?e.jsx("div",{children:"Cargando..."}):w?e.jsx("div",{className:"text-red-600",children:w}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full text-sm border rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1",children:"Fecha"}),e.jsx("th",{className:"px-2 py-1",children:"Paciente"}),e.jsx("th",{className:"px-2 py-1 hidden sm:table-cell",children:"Motivo"}),e.jsx("th",{className:"px-2 py-1 hidden md:table-cell",children:"Diagnóstico"}),e.jsx("th",{className:"px-2 py-1 hidden md:table-cell",children:"Estado"}),e.jsx("th",{className:"px-2 py-1",children:"Detalle"})]})}),e.jsx("tbody",{children:E.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-2",children:"Sin resultados"})}):m.map(f=>e.jsxs("tr",{className:"hover:bg-blue-50",children:[e.jsx("td",{className:"border px-2 py-1",children:f.fecha}),e.jsx("td",{className:"border px-2 py-1",children:f.paciente_nombre}),e.jsx("td",{className:"border px-2 py-1 hidden sm:table-cell",children:f.motivo}),e.jsx("td",{className:"border px-2 py-1 hidden md:table-cell",children:f.diagnostico}),e.jsx("td",{className:"border px-2 py-1 hidden md:table-cell",children:f.estado}),e.jsx("td",{className:"border px-2 py-1 text-center",children:e.jsx("button",{className:"text-blue-600 underline",onClick:()=>_(`/historia-clinica/${f.paciente_id}/${f.consulta_id}`),children:"Ver"})})]},f.id))})]}),o>0&&e.jsxs("div",{className:"flex justify-end items-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>l(C-1),disabled:C===1,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{className:"text-sm",children:["Página ",C," de ",g]}),e.jsx("button",{onClick:()=>l(C+1),disabled:C===g,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Siguiente"})]})]})]})}function Bs({consulta:s,initialData:r,onGuardar:a,onCancelar:d}){const[x,w]=t.useState({presion_arterial:"",frecuencia_cardiaca:"",frecuencia_respiratoria:"",temperatura:"",saturacion:"",peso:"",talla:"",motivo:"",sintomas:"",nivel_conciencia:"Alerta",hidratacion:"Normal",coloracion:"Normal",clasificacion:"No urgente"});t.useEffect(()=>{r&&w({presion_arterial:r.presion_arterial||"",frecuencia_cardiaca:r.frecuencia_cardiaca||"",frecuencia_respiratoria:r.frecuencia_respiratoria||"",temperatura:r.temperatura||"",saturacion:r.saturacion||"",peso:r.peso||"",talla:r.talla||"",motivo:r.motivo||"",sintomas:r.sintomas||"",nivel_conciencia:r.nivel_conciencia||"Alerta",hidratacion:r.hidratacion||"Normal",coloracion:r.coloracion||"Normal",clasificacion:r.clasificacion||"No urgente"})},[r]);const[y,h]=t.useState(!1),j=v=>{w({...x,[v.target.name]:v.target.value})},N=v=>{v.preventDefault(),h(!0);const C={...x,clasificacion:x.clasificacion&&x.clasificacion.trim()?x.clasificacion:"No urgente"};a(C),h(!1)};return e.jsxs("form",{onSubmit:N,className:"space-y-3 p-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{name:"presion_arterial",value:x.presion_arterial,onChange:j,placeholder:"Presión arterial (mmHg)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"frecuencia_cardiaca",value:x.frecuencia_cardiaca,onChange:j,placeholder:"Frecuencia cardíaca (lpm)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"frecuencia_respiratoria",value:x.frecuencia_respiratoria,onChange:j,placeholder:"Frecuencia respiratoria (rpm)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"temperatura",value:x.temperatura,onChange:j,placeholder:"Temperatura (°C)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"saturacion",value:x.saturacion,onChange:j,placeholder:"Saturación O₂ (%)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"peso",value:x.peso,onChange:j,placeholder:"Peso (kg)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"talla",value:x.talla,onChange:j,placeholder:"Talla (cm)",className:"border rounded px-2 py-1"})]}),e.jsx("textarea",{name:"motivo",value:x.motivo,onChange:j,placeholder:"Motivo de consulta",className:"border rounded px-2 py-1 w-full"}),e.jsx("textarea",{name:"sintomas",value:x.sintomas,onChange:j,placeholder:"Síntomas principales",className:"border rounded px-2 py-1 w-full"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("select",{name:"nivel_conciencia",value:x.nivel_conciencia,onChange:j,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"Alerta",children:"Alerta"}),e.jsx("option",{value:"Somnoliento",children:"Somnoliento"}),e.jsx("option",{value:"Inconsciente",children:"Inconsciente"})]}),e.jsxs("select",{name:"hidratacion",value:x.hidratacion,onChange:j,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"Normal",children:"Hidratación normal"}),e.jsx("option",{value:"Deshidratado",children:"Deshidratado"})]}),e.jsxs("select",{name:"coloracion",value:x.coloracion,onChange:j,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"Normal",children:"Coloración normal"}),e.jsx("option",{value:"Cianosis",children:"Cianosis"}),e.jsx("option",{value:"Palidez",children:"Palidez"}),e.jsx("option",{value:"Ictericia",children:"Ictericia"})]})]}),e.jsxs("select",{name:"clasificacion",value:x.clasificacion,onChange:j,className:"border rounded px-2 py-1 w-full",children:[e.jsx("option",{value:"No urgente",children:"No urgente"}),e.jsx("option",{value:"Urgente",children:"Urgente"}),e.jsx("option",{value:"Emergencia",children:"Emergencia"})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-2",children:[e.jsx("button",{type:"button",onClick:d,className:"bg-gray-300 px-3 py-1 rounded",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-3 py-1 rounded",disabled:y,children:"Guardar triaje"})]})]})}function Os(){const[s,r]=t.useState([]),[a,d]=t.useState({}),[x,w]=t.useState(!0),[y,h]=t.useState(null),[j,N]=t.useState(null),[v,C]=t.useState(null),[l,_]=t.useState(!1),[E,o]=t.useState(!1),[g,n]=t.useState(5),[c,m]=t.useState(1),[f,S]=t.useState(""),[L,i]=t.useState(""),[u,b]=t.useState(""),M=()=>{w(!0),fetch(O+"api_consultas.php",{credentials:"include"}).then(p=>p.json()).then(async p=>{if(p.success){r(p.consultas);const T={};await Promise.all(p.consultas.map(async U=>{try{const k=await(await fetch(O+`api_triaje.php?consulta_id=${U.id}`)).json();T[U.id]=k.success&&k.triaje?"Completado":"Pendiente"}catch{T[U.id]="Pendiente"}})),d(T)}else h(p.error||"Error al cargar consultas");w(!1)}).catch(p=>{h("Error de red"),w(!1)})};if(t.useEffect(()=>{M()},[]),x)return e.jsx(ye,{message:"Cargando pacientes en triaje..."});if(y)return e.jsx("div",{className:"text-red-600",children:y});let D=s.filter(p=>{const T=f.trim().toLowerCase();return T&&!(p.historia_clinica&&p.historia_clinica.toLowerCase().includes(T)||p.paciente_nombre&&p.paciente_nombre.toLowerCase().includes(T)||p.paciente_apellido&&p.paciente_apellido.toLowerCase().includes(T)||p.medico_nombre&&p.medico_nombre.toLowerCase().includes(T)||p.medico_apellido&&p.medico_apellido.toLowerCase().includes(T))?!1:!L&&!u?!0:!(!p.fecha||L&&p.fecha<L||u&&p.fecha>u)});const z=D.length,$=Math.ceil(z/g),P=(c-1)*g,A=P+g,I=D.slice(P,A);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-600 rounded-2xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl",children:e.jsx(W,{iconName:"People",className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:z}),e.jsx("div",{className:"text-sm text-emerald-100",children:"Total Pacientes"})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-yellow-500 to-orange-600 rounded-2xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl",children:e.jsx(W,{iconName:"Clock",className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.values(a).filter(p=>p==="Pendiente").length}),e.jsx("div",{className:"text-sm text-yellow-100",children:"Triajes Pendientes"})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl",children:e.jsx(W,{iconName:"CheckMark",className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.values(a).filter(p=>p==="Completado").length}),e.jsx("div",{className:"text-sm text-blue-100",children:"Triajes Completados"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(W,{iconName:"Filter",className:"text-xl text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Filtros de búsqueda"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{iconName:"Search",className:"text-lg text-gray-400"})}),e.jsx("input",{type:"text",value:f,onChange:p=>{S(p.target.value),m(1)},placeholder:"Buscar paciente, médico...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{iconName:"Calendar",className:"text-lg text-gray-400"})}),e.jsx("input",{type:"date",value:L,onChange:p=>{i(p.target.value),m(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300",placeholder:"Fecha desde"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{iconName:"Calendar",className:"text-lg text-gray-400"})}),e.jsx("input",{type:"date",value:u,onChange:p=>{b(p.target.value),m(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300",placeholder:"Fecha hasta"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{iconName:"NumberedList",className:"text-lg text-gray-400"})}),e.jsxs("select",{value:g,onChange:p=>{n(Number(p.target.value)),m(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300 appearance-none bg-white",children:[e.jsx("option",{value:5,children:"5 por página"}),e.jsx("option",{value:10,children:"10 por página"}),e.jsx("option",{value:25,children:"25 por página"})]})]})]}),(f||L||u)&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:()=>{S(""),i(""),b(""),m(1)},className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors duration-300",children:[e.jsx(W,{iconName:"Clear",className:"text-lg"}),e.jsx("span",{children:"Limpiar filtros"})]})})]}),j?e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(W,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold",children:["Triaje: ",j.paciente_nombre," ",j.paciente_apellido]}),e.jsxs("p",{className:"text-emerald-100",children:["Historia Clínica: ",j.historia_clinica||"N/A"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-white/20 rounded-xl px-3 py-2",children:[e.jsx(W,{iconName:"Calendar",className:"text-lg"}),e.jsxs("span",{children:[j.fecha," - ",j.hora]})]})]})}),e.jsx("div",{className:"p-6",children:E?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-emerald-200 border-t-emerald-500 rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Cargando datos de triaje..."})]})}):e.jsx(Bs,{consulta:j,initialData:v,onGuardar:async p=>{_(!0);const T={consulta_id:j.id,datos:{...p,paciente_id:j.paciente_id}};try{const K=await(await fetch(O+"api_triaje.php",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(T)})).json();K.success||(console.error("Error al guardar triaje:",K.error),alert("Error al guardar triaje: "+(K.error||"Error desconocido")))}catch(U){console.error("Error de red al guardar triaje:",U),alert("Error de red al guardar triaje")}_(!1),N(null),C(null),M()},onCancelar:()=>{N(null),C(null)},guardando:l})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{iconName:"Table",className:"text-xl text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Lista de Pacientes para Triaje"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:D.length>0?`Mostrando ${I.length} de ${D.length} pacientes`:"No hay pacientes"})]})}),e.jsx("div",{className:"overflow-x-auto",children:D.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex items-center justify-center w-20 h-20 bg-gray-100 rounded-full mx-auto mb-4",children:e.jsx(W,{iconName:"Health",className:"text-4xl text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No hay pacientes"}),e.jsx("p",{className:"text-gray-500",children:"No se encontraron pacientes pendientes de triaje"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Historia Clínica"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Paciente"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Médico"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Fecha y Hora"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Estado"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Acción"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:I.map(p=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-200",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{iconName:"NumberField",className:"text-lg text-gray-400"}),e.jsx("span",{className:"font-mono text-sm",children:p.historia_clinica||"-"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-emerald-100 rounded-full",children:e.jsx(W,{iconName:"Contact",className:"text-lg text-emerald-600"})}),e.jsx("div",{children:e.jsxs("div",{className:"font-semibold text-gray-800",children:[p.paciente_nombre," ",p.paciente_apellido]})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{iconName:"Health",className:"text-lg text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:(p.medico_nombre||"")+(p.medico_apellido?" "+p.medico_apellido:"")||"-"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{iconName:"Calendar",className:"text-lg text-gray-400"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-800",children:p.fecha}),e.jsx("div",{className:"text-gray-500",children:p.hora})]})]})}),e.jsx("td",{className:"px-6 py-4",children:a[p.id]==="Completado"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:[e.jsx(W,{iconName:"CheckMark",className:"text-sm"}),"Completado"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(W,{iconName:"Clock",className:"text-sm"}),"Pendiente"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-emerald-500 to-green-600 text-white font-semibold rounded-xl hover:from-emerald-600 hover:to-green-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",onClick:async()=>{N(p),o(!0),C(null);try{const U=await(await fetch(O+`api_triaje.php?consulta_id=${p.id}`)).json();U.success&&U.triaje&&U.triaje.datos?C(U.triaje.datos):C(null)}catch{C(null)}o(!1)},children:[e.jsx(W,{iconName:"Health",className:"text-lg"}),"Realizar Triaje"]})})]},p.id))})]})}),e.jsx("div",{className:"lg:hidden p-4 space-y-4",children:I.map(p=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 shadow-sm hover:shadow-md transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-emerald-100 rounded-full",children:e.jsx(W,{iconName:"Contact",className:"text-xl text-emerald-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-800 text-lg",children:[p.paciente_nombre," ",p.paciente_apellido]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(W,{iconName:"NumberField",className:"text-sm"}),"HC: ",p.historia_clinica||"N/A"]})]})]}),a[p.id]==="Completado"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(W,{iconName:"CheckMark",className:"text-xs"}),"Completado"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(W,{iconName:"Clock",className:"text-xs"}),"Pendiente"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{iconName:"Health",className:"text-lg text-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Médico"}),e.jsx("div",{className:"text-sm text-gray-800",children:(p.medico_nombre||"")+(p.medico_apellido?" "+p.medico_apellido:"")||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{iconName:"Calendar",className:"text-lg text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Fecha y Hora"}),e.jsxs("div",{className:"text-sm text-gray-800",children:[p.fecha," - ",p.hora]})]})]})]}),e.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-emerald-500 to-green-600 text-white font-semibold rounded-xl hover:from-emerald-600 hover:to-green-700 transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl",onClick:async()=>{N(p),o(!0),C(null);try{const U=await(await fetch(O+`api_triaje.php?consulta_id=${p.id}`)).json();U.success&&U.triaje&&U.triaje.datos?C(U.triaje.datos):C(null)}catch{C(null)}o(!1)},children:[e.jsx(W,{iconName:"Health",className:"text-xl"}),"Realizar Triaje"]})]},p.id))})]})})]}),D.length>0&&$>1&&e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",P+1," - ",Math.min(A,z)," de ",z," pacientes"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>m(c-1),disabled:c===1,className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 text-gray-700 rounded-xl transition-all duration-300 disabled:cursor-not-allowed",children:[e.jsx(W,{iconName:"ChevronLeft",className:"text-lg"}),e.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"px-3 py-2 text-sm font-medium text-gray-600",children:["Página ",c," de ",$]})}),e.jsxs("button",{onClick:()=>m(c+1),disabled:c===$,className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 text-gray-700 rounded-xl transition-all duration-300 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx(W,{iconName:"ChevronRight",className:"text-lg"})]})]})]})})]})]})}function Rs(){const[s,r]=t.useState("triage"),a=[{key:"triage",label:"Triaje",icon:"Health",color:"emerald",description:"Evaluación inicial de pacientes"},{key:"tratamientos",label:"Tratamientos",icon:"Health",color:"blue",description:"Gestión de tratamientos"},{key:"hospitalizacion",label:"Hospitalización",icon:"Hospital",color:"purple",description:"Control de hospitalización"}],d=(x,w)=>({emerald:w?"bg-gradient-to-r from-emerald-500 to-green-600 text-white shadow-lg border-emerald-300":"bg-white text-emerald-700 border-emerald-200 hover:bg-emerald-50 hover:border-emerald-300",blue:w?"bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg border-blue-300":"bg-white text-blue-700 border-blue-200 hover:bg-blue-50 hover:border-blue-300",purple:w?"bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg border-purple-300":"bg-white text-purple-700 border-purple-200 hover:bg-purple-50 hover:border-purple-300"})[x];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 via-cyan-50 to-blue-50 p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-teal-600 via-cyan-600 to-blue-600 rounded-2xl p-6 sm:p-8 text-white shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-12 -translate-x-12"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-white/20 rounded-2xl backdrop-blur-sm",children:e.jsx(W,{iconName:"Health",className:"text-3xl text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold drop-shadow-lg",children:"Panel de Enfermería"}),e.jsx("p",{className:"text-lg text-white/90 mt-1",children:"Gestión integral de cuidados médicos"})]})]})})]})}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto",children:a.map(x=>e.jsxs("button",{className:`group relative p-6 rounded-2xl border-2 font-semibold transition-all duration-300 transform hover:scale-[1.02] ${d(x.color,s===x.key)}`,onClick:()=>r(x.key),children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:`flex items-center justify-center w-12 h-12 rounded-xl ${s===x.key?"bg-white/20":`bg-${x.color}-100`}`,children:e.jsx(W,{iconName:x.icon,className:`text-2xl ${s===x.key?"text-white":`text-${x.color}-600`}`})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:x.label}),e.jsx("div",{className:`text-sm ${s===x.key?"text-white/80":"text-gray-600"}`,children:x.description})]})]}),s===x.key&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-white rounded-full shadow-lg flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"})})]},x.key))})}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[s==="triage"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(W,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Control de Triaje"}),e.jsx("p",{className:"text-emerald-100",children:"Evaluación y clasificación de pacientes"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx(Os,{})})]}),s==="tratamientos"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(W,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gestión de Tratamientos"}),e.jsx("p",{className:"text-blue-100",children:"Control y seguimiento de tratamientos"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full mx-auto mb-4",children:e.jsx(W,{iconName:"Health",className:"text-4xl text-blue-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Módulo en Desarrollo"}),e.jsx("p",{className:"text-gray-600",children:"La gestión de tratamientos estará disponible próximamente"})]})})]}),s==="hospitalizacion"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(W,{iconName:"Hospital",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Control de Hospitalización"}),e.jsx("p",{className:"text-purple-100",children:"Gestión de pacientes hospitalizados"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex items-center justify-center w-20 h-20 bg-purple-100 rounded-full mx-auto mb-4",children:e.jsx(W,{iconName:"Hospital",className:"text-4xl text-purple-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Módulo en Desarrollo"}),e.jsx("p",{className:"text-gray-600",children:"El control de hospitalización estará disponible próximamente"})]})})]})]})]})}function Hs(){return e.jsx(Rs,{})}pe.createElement;function Is({selected:s,setSelected:r}){const[a,d]=t.useState([]),[x,w]=t.useState(""),[y,h]=t.useState(!1);t.useEffect(()=>{h(!0),fetch(O+"api_examenes_laboratorio.php",{credentials:"include"}).then(v=>v.json()).then(v=>d(v.examenes||[])).finally(()=>h(!1))},[]);const j=a.filter(v=>v.nombre.toLowerCase().includes(x.toLowerCase())||v.metodologia&&v.metodologia.toLowerCase().includes(x.toLowerCase())),N=v=>{r(C=>C.includes(v)?C.filter(l=>l!==v):[...C,v])};return e.jsxs("div",{className:"mb-2",children:[e.jsx("input",{type:"text",value:x,onChange:v=>w(v.target.value),placeholder:"Buscar examen...",className:"border rounded p-2 text-xs w-full mb-2"}),e.jsx("div",{className:"max-h-48 overflow-y-auto border rounded bg-white",children:y?e.jsx("div",{className:"p-2 text-center text-gray-500 text-xs",children:"Cargando..."}):j.length===0?e.jsx("div",{className:"p-2 text-center text-gray-500 text-xs",children:"Sin exámenes"}):j.map(v=>e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 border-b last:border-b-0 cursor-pointer hover:bg-blue-50 text-xs",children:[e.jsx("input",{type:"checkbox",checked:s.includes(v.id),onChange:()=>N(v.id)}),e.jsx("span",{className:"font-medium",children:v.nombre}),e.jsx("span",{className:"text-gray-400",children:v.metodologia})]},v.id))})]})}function Vs({consultaId:s,mostrarPrecios:r=!0}){const[a,d]=t.useState([]),[x,w]=t.useState([]),[y,h]=t.useState(!1),[j,N]=t.useState("");t.useEffect(()=>{fetch(O+"api_examenes_laboratorio.php",{credentials:"include"}).then(_=>_.json()).then(_=>w(_.examenes||[]))},[]);const v=x.filter(_=>a.includes(_.id)),C=v.reduce((_,E)=>_+(parseFloat(E.precio_publico)||0),0),l=async _=>{_.preventDefault(),h(!0),N("");try{if((await fetch(O+"api_ordenes_laboratorio.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:s,examenes:a})})).ok)N("Orden enviada correctamente"),d([]),setTimeout(()=>N(""),3e3);else throw new Error("Error al enviar la orden")}catch{N("Error al enviar la orden. Intente nuevamente."),setTimeout(()=>N(""),5e3)}finally{h(!1)}};return t.useEffect(()=>{fetch(O+"api_examenes_laboratorio.php",{credentials:"include"}).then(_=>_.json()).then(_=>w(_.examenes||[]))},[]),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 border border-emerald-200 rounded-xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx("svg",{className:"w-7 h-7 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-emerald-800",children:"🔬 Solicitud de Análisis de Laboratorio"}),e.jsx("p",{className:"text-sm text-emerald-600",children:"Seleccione los exámenes requeridos para el diagnóstico"})]})]}),e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-emerald-100 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),e.jsx("label",{className:"font-semibold text-emerald-800",children:"Exámenes Disponibles:"})]}),e.jsx(Is,{selected:a,setSelected:d})]}),a.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"font-semibold text-blue-800",children:["📋 Exámenes Seleccionados (",a.length,")"]})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-3",children:v.map(_=>e.jsx("div",{className:"bg-white rounded-lg p-3 border border-blue-100 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:_.nombre}),r&&e.jsxs("div",{className:"text-sm text-green-700 font-semibold mt-1",children:["Precio público: S/ ",parseFloat(_.precio_publico).toFixed(2)]}),(_.condicion_paciente||_.tiempo_resultado)&&e.jsxs("div",{className:"mt-1 space-y-1",children:[_.condicion_paciente&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3 text-amber-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-xs text-amber-700 font-medium",children:_.condicion_paciente})]}),_.tiempo_resultado&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-xs text-gray-600",children:["⏱️ ",_.tiempo_resultado]})]})]})]})]})},_.id))}),r&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800 font-bold text-lg flex justify-end",children:["Total cotización: S/ ",C.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"submit",className:`
              px-6 py-3 rounded-lg font-semibold text-white shadow-lg transition-all duration-200
              flex items-center gap-2 min-w-[140px] justify-center
              ${a.length===0||y?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-emerald-600 to-teal-700 hover:from-emerald-700 hover:to-teal-800 hover:shadow-xl transform hover:-translate-y-0.5"}
            `,disabled:y||a.length===0,children:y?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Enviando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),e.jsx("span",{children:"Solicitar Exámenes"})]})}),e.jsx("div",{className:"text-sm text-emerald-700 font-medium",children:a.length===0?e.jsx("span",{className:"text-gray-500",children:"Ningún examen seleccionado"}):e.jsxs("span",{children:["✅ ",a.length," examen",a.length!==1?"es":""," seleccionado",a.length!==1?"s":""]})})]}),j&&e.jsxs("div",{className:`
            rounded-lg p-4 border shadow-sm flex items-center gap-3
            ${j.includes("correctamente")?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}
          `,children:[j.includes("correctamente")?e.jsx("svg",{className:"w-6 h-6 text-green-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-6 h-6 text-red-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"font-semibold",children:j})]})]})]})}function Ws(){const{consultaId:s}=de();let r=!0;try{const a=sessionStorage.getItem("usuario"),d=sessionStorage.getItem("medico"),x=a?JSON.parse(a):d?JSON.parse(d):null;x&&x.rol==="medico"&&(r=!1)}catch{r=!0}return e.jsxs("div",{className:"max-w-xl mx-auto p-6 bg-white rounded shadow mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Solicitud de Análisis de Laboratorio"}),e.jsxs("div",{className:"mb-4 text-center text-gray-600",children:[e.jsx("b",{children:"Consulta ID:"})," ",s]}),e.jsx(Vs,{consultaId:s,mostrarPrecios:r}),e.jsx("div",{className:"text-center",children:e.jsx(te,{to:-1,className:"text-blue-600 hover:underline",children:"← Volver a la historia clínica"})})]})}function qs(){const[s,r]=t.useState(!1),[a,d]=t.useState([]),[x,w]=t.useState(0),y=ne(),{pacienteId:h}=de(),[j,N]=t.useState([]),[v,C]=t.useState([]),[l,_]=t.useState([]),[E,o]=t.useState([]),[g,n]=t.useState(!0),[c,m]=t.useState(""),[f,S]=t.useState(""),[L,i]=t.useState(""),[u,b]=t.useState(0),[M,D]=t.useState(3),[z,$]=t.useState(null),[P,A]=t.useState(null);t.useEffect(()=>{Promise.all([fetch(`${O}api_examenes_laboratorio.php`,{credentials:"include"}).then(R=>R.json()),fetch(`${O}api_tarifas.php`,{credentials:"include"}).then(R=>R.json()),fetch(`${O}api_examenes_laboratorio_ranking.php`,{credentials:"include"}).then(R=>R.json()),h?fetch(`${O}api_pacientes.php?id=${h}`,{credentials:"include"}).then(R=>R.json()):Promise.resolve({success:!1})]).then(([R,F,H,V])=>{N(R.examenes||[]),o(F.tarifas||[]),C(H.ranking||[]),V&&V.success&&V.paciente&&A(V.paciente),n(!1)})},[h]);const I=R=>{_(F=>F.includes(R)?F.filter(H=>H!==R):[...F,R]),S("")},p=()=>l.reduce((R,F)=>{const H=E.find(V=>V.servicio_tipo==="laboratorio"&&V.examen_id===F&&V.activo===1);return R+(H?parseFloat(H.precio_particular):0)},0);if(g)return e.jsx("div",{children:"Cargando exámenes y tarifas..."});const T=Array.from(new Set(j.map(R=>R.categoria).filter(Boolean))),U=v.map(R=>parseInt(R.id)),k=[...j].sort((R,F)=>{const H=U.indexOf(R.id),V=U.indexOf(F.id);return H===-1&&V===-1?R.nombre.localeCompare(F.nombre):H===-1?1:V===-1?-1:H-V}).filter(R=>{const F=c.trim().length===0||R.nombre.toLowerCase().includes(c.toLowerCase()),H=L===""||R.categoria===L;return F&&H}),G=Math.max(1,Math.ceil(k.length/M)),J=k.slice(u*M,u*M+M),Z=()=>{_([]),S("")},B=()=>{if(l.length===0){S("Selecciona al menos un examen para cobrar.");return}const R=l.map(F=>{const H=j.find(ee=>ee.id===F),V=E.find(ee=>ee.servicio_tipo==="laboratorio"&&ee.examen_id===F&&ee.activo===1);let ae=H&&typeof H.nombre=="string"&&H.nombre.trim()!==""&&H.nombre!=="0"?H.nombre:"Examen sin nombre";return{servicio_tipo:"laboratorio",servicio_id:F,descripcion:ae,cantidad:1,precio_unitario:V?parseFloat(V.precio_particular):0,subtotal:V?parseFloat(V.precio_particular):0}});d(R),w(R.reduce((F,H)=>F+H.subtotal,0)),r(!0)};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 md:p-8 bg-white rounded-xl shadow-lg mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"🔬"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Cotización de Laboratorio"})]}),e.jsx("button",{onClick:()=>y("/seleccionar-servicio",{state:{pacienteId:h}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"})]}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("b",{children:"ID Paciente:"})," ",h]}),e.jsx("input",{type:"text",value:c,onChange:R=>m(R.target.value),placeholder:"Buscar examen...",className:"border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-64"})]}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-2 items-center",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Filtrar por categoría:"}),e.jsxs("select",{value:L,onChange:R=>i(R.target.value),className:"border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-64",children:[e.jsx("option",{value:"",children:"Todas"}),T.map(R=>e.jsx("option",{value:R,children:R},R))]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Selecciona los exámenes:"}),e.jsx("div",{className:"mb-2 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:e.jsxs("div",{className:"w-full bg-white shadow-md rounded-xl border border-gray-200 px-4 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"text-sm text-gray-700 flex gap-4 items-center",children:[e.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1",children:["Total exámenes: ",e.jsx("b",{children:k.length})]}),e.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1",children:["Páginas: ",e.jsx("b",{children:G})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("button",{disabled:u===0||G===1,onClick:()=>b(R=>Math.max(0,R-1)),className:"px-2 py-1 rounded-full bg-blue-100 text-blue-700 disabled:opacity-50 hover:bg-blue-200 transition-colors shadow-sm",title:"Página anterior",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("span",{className:"px-3 py-1 text-sm font-medium bg-gray-50 rounded",children:["Página ",u+1," de ",G||1]}),e.jsx("button",{disabled:u>=G-1||G===1,onClick:()=>b(R=>Math.min(G-1,R+1)),className:"px-2 py-1 rounded-full bg-blue-100 text-blue-700 disabled:opacity-50 hover:bg-blue-200 transition-colors shadow-sm",title:"Página siguiente",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsxs("select",{value:M,onChange:R=>{D(Number(R.target.value)),b(0)},className:"border border-gray-300 rounded-lg px-2 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 ml-2",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]})]})}),k.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No hay exámenes para mostrar."}):e.jsx("div",{className:"bg-white rounded-lg shadow border border-gray-200",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:J.map(R=>{const F=E.find(H=>H.servicio_tipo==="laboratorio"&&H.examen_id===R.id&&H.activo===1);return e.jsxs("li",{className:"flex items-center px-4 py-3 hover:bg-blue-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:l.includes(R.id),onChange:()=>I(R.id),className:"mr-3 accent-blue-600 w-5 h-5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:R.nombre}),R.categoria&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded mt-1 inline-block",children:R.categoria})]}),e.jsxs("div",{className:"font-bold text-green-700 text-lg",children:["S/ ",F?F.precio_particular:"-"]})]},R.id)})})})]})}),e.jsxs("div",{className:"w-full md:w-96 md:sticky md:top-8 h-fit",children:[l.length>0&&!s&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotización"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:l.map(R=>{const F=j.find(V=>V.id===R),H=E.find(V=>V.servicio_tipo==="laboratorio"&&V.examen_id===R&&V.activo===1);return e.jsxs("li",{className:"py-2 flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:F?.nombre}),F?.condicion_paciente&&e.jsxs("span",{className:"block text-xs text-gray-400 mt-1",children:["Condición: ",F.condicion_paciente]}),F?.tiempo_resultado&&e.jsxs("span",{className:"block text-xs text-gray-400",children:["Tiempo: ",F.tiempo_resultado]})]}),e.jsxs("div",{className:"font-bold text-green-700 text-right",children:["S/ ",H?H.precio_particular:"-"]})]},R)})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",p().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:Z,className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:B,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Cobrar"})]})]}),s&&P&&e.jsx(me,{paciente:P,servicio:{key:"laboratorio",label:"Laboratorio"},detalles:a,total:x,onCobroCompleto:()=>{r(!1),S("Cotización procesada correctamente.")},onCancelar:()=>r(!1)})]})]}),f&&e.jsx("div",{className:`mt-6 text-center font-semibold ${f.includes("correctamente")?"text-green-600":"text-red-600"}`,children:f}),z&&e.jsxs("div",{className:"mt-8 mx-auto max-w-lg bg-white rounded-xl shadow-lg border border-blue-200 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-700 mb-2",children:"Comprobante de Cotización"}),e.jsxs("div",{className:"mb-2 text-blue-800 font-semibold",children:["Nº comprobante: ",z.numero]}),e.jsxs("div",{className:"mb-2 text-gray-600 text-sm",children:["Fecha: ",z.fecha]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-4",children:z.detalles.map((R,F)=>e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-800",children:R.descripcion}),e.jsxs("span",{className:"text-green-700 font-bold",children:["S/ ",R.precio_unitario.toFixed(2)]})]},F))}),e.jsxs("div",{className:"text-right text-lg font-bold text-blue-700 border-t pt-2",children:["Total: S/ ",z.total.toFixed(2)]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Imprimir"}),e.jsx("button",{onClick:()=>$(null),className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Cerrar"})]})]})]})}function Gs(){const[s,r]=t.useState(!1),[a,d]=t.useState([]),[x,w]=t.useState(0),{pacienteId:y}=de(),h=ne(),[j,N]=t.useState(null),[v,C]=t.useState([]),[l,_]=t.useState([]),[E,o]=t.useState({}),[g,n]=t.useState("");t.useEffect(()=>{fetch(`${O}api_pacientes.php?id=${y}`).then(i=>i.json()).then(i=>{i.success&&i.paciente&&N(i.paciente)}),fetch(`${O}api_tarifas.php`,{credentials:"include"}).then(i=>i.json()).then(i=>{const u=(i.tarifas||[]).filter(b=>b.servicio_tipo==="rayosx");C(u)})},[y]);const c=i=>{_(u=>u.includes(i)?u:[...u,i]),o(u=>({...u,[i]:1}))},m=i=>{_(u=>u.filter(b=>b!==i)),o(u=>{const b={...u};return delete b[i],b})},f=(i,u)=>{o(b=>({...b,[i]:u}))},S=()=>l.reduce((i,u)=>{const b=v.find(D=>D.id===u),M=E[u]||1;return b?i+b.precio_particular*M:i},0),L=async()=>{if(l.length===0){n("Selecciona al menos un estudio de Rayos X.");return}const i=l.map(u=>{const b=v.find(D=>D.id===u),M=E[u]||1;return b?{servicio_tipo:"rayosx",servicio_id:u,descripcion:b.descripcion||b.nombre,cantidad:M,precio_unitario:b.precio_particular,subtotal:b.precio_particular*M}:null}).filter(Boolean);d(i),w(S()),r(!0)};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-2xl shadow-2xl mt-8 border border-blue-100",children:[e.jsx("button",{onClick:()=>h("/seleccionar-servicio",{state:{pacienteId:y}}),className:"mb-4 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded text-gray-700 font-semibold",children:"← Volver"}),e.jsxs("h2",{className:"text-2xl font-bold text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"rayosx",children:"🩻"})," Cotizador de Rayos X"]}),j&&e.jsxs("div",{className:"mb-4 p-2 bg-blue-50 rounded text-blue-800 text-sm",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",j.nombres||j.nombre," ",j.apellidos||j.apellido," (DNI: ",j.dni,")"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"mb-4 max-h-[500px] overflow-y-auto",children:[e.jsx("div",{className:"font-bold mb-2",children:"Estudios disponibles:"}),v.length===0?e.jsx("div",{className:"text-gray-500",children:"No hay estudios de Rayos X registrados."}):e.jsx("ul",{className:"divide-y divide-gray-100",children:v.map(i=>e.jsxs("li",{className:"flex items-center gap-4 py-3 px-2 hover:bg-blue-50 rounded-lg transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:i.descripcion||i.nombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Precio: S/ ",i.precio_particular]})]}),l.includes(i.id)?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:1,value:E[i.id]||1,onChange:u=>f(i.id,Math.max(1,Number(u.target.value))),className:"border rounded-lg px-2 w-16 bg-white"}),e.jsx("button",{onClick:()=>m(i.id),className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-xl shadow transition","aria-label":"Quitar",children:"✕"})]}):e.jsx("button",{onClick:()=>c(i.id),className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-100 hover:bg-green-200 text-green-700 text-xl shadow transition","aria-label":"Agregar",children:"+"})]},i.id))})]}),e.jsxs("div",{className:"w-full md:w-96 md:sticky md:top-8 h-fit",children:[l.length>0&&!s&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"font-semibold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"📝"}),"Resumen de Cotización"]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-2 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:l.map(i=>{const u=v.find(M=>M.id===i),b=E[i]||1;return u?e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{children:u.descripcion||u.nombre}),e.jsxs("span",{children:[b," estudio(s)"]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",(u.precio_particular*b).toFixed(2)]})]},i):null})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",S().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>{_([]),n("")},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:L,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Registrar Cotización"})]})]}),s&&e.jsx(me,{paciente:j,servicio:{key:"rayosx",label:"Rayos X"},detalles:a,total:x,onCobroCompleto:()=>{r(!1),_([]),o({}),n("Cobro procesado correctamente.")},onCancelar:()=>r(!1)})]})]}),g&&e.jsx("div",{className:"mt-4 text-center font-semibold text-green-600",children:g})]})}function Us(){const[s,r]=t.useState(!1),[a,d]=t.useState([]),[x,w]=t.useState(0),{pacienteId:y}=de(),h=ne(),[j,N]=t.useState(null),[v,C]=t.useState([]),[l,_]=t.useState([]),[E,o]=t.useState({}),[g,n]=t.useState("");t.useEffect(()=>{fetch(`${O}api_pacientes.php?id=${y}`).then(i=>i.json()).then(i=>{i.success&&i.paciente&&N(i.paciente)}),fetch(`${O}api_tarifas.php`,{credentials:"include"}).then(i=>i.json()).then(i=>{const u=(i.tarifas||[]).filter(b=>b.servicio_tipo==="ecografia");C(u)})},[y]);const c=i=>{_(u=>u.includes(i)?u:[...u,i]),o(u=>({...u,[i]:1}))},m=i=>{_(u=>u.filter(b=>b!==i)),o(u=>{const b={...u};return delete b[i],b})},f=(i,u)=>{o(b=>({...b,[i]:u}))},S=()=>l.reduce((i,u)=>{const b=v.find(D=>D.id===u),M=E[u]||1;return b?i+b.precio_particular*M:i},0),L=async()=>{if(l.length===0){n("Selecciona al menos una ecografía.");return}const i=l.map(u=>{const b=v.find($=>$.id===u),M=E[u]||1;let z=b&&b.descripcion&&b.descripcion!=="0"?b.descripcion:b&&b.nombre&&b.nombre!=="0"?b.nombre:"Ecografía sin nombre";return b?{servicio_tipo:"ecografia",servicio_id:u,descripcion:z,cantidad:M,precio_unitario:b.precio_particular,subtotal:b.precio_particular*M}:null}).filter(Boolean);d(i),w(S()),r(!0)};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-2xl shadow-2xl mt-8 border border-blue-100",children:[e.jsx("button",{onClick:()=>h("/seleccionar-servicio",{state:{pacienteId:y}}),className:"mb-4 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded text-gray-700 font-semibold",children:"← Volver"}),e.jsxs("h2",{className:"text-2xl font-bold text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"eco",children:"📡"})," Cotizador de Ecografías"]}),j&&e.jsxs("div",{className:"mb-4 p-2 bg-blue-50 rounded text-blue-800 text-sm",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",j.nombres||j.nombre," ",j.apellidos||j.apellido," (DNI: ",j.dni,")"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"mb-4 max-h-[500px] overflow-y-auto",children:[e.jsx("div",{className:"font-bold mb-2",children:"Ecografías disponibles:"}),v.length===0?e.jsx("div",{className:"text-gray-500",children:"No hay ecografías registradas."}):e.jsx("ul",{className:"divide-y divide-gray-100",children:v.map(i=>e.jsxs("li",{className:"flex items-center gap-4 py-3 px-2 hover:bg-blue-50 rounded-lg transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:i.descripcion||i.nombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Precio: S/ ",i.precio_particular]})]}),l.includes(i.id)?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:1,value:E[i.id]||1,onChange:u=>f(i.id,Math.max(1,Number(u.target.value))),className:"border rounded-lg px-2 w-16 bg-white"}),e.jsx("button",{onClick:()=>m(i.id),className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-xl shadow transition","aria-label":"Quitar",children:"✕"})]}):e.jsx("button",{onClick:()=>c(i.id),className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-100 hover:bg-green-200 text-green-700 text-xl shadow transition","aria-label":"Agregar",children:"+"})]},i.id))})]}),l.length>0&&!s&&e.jsxs("div",{className:"bg-blue-50 rounded-2xl p-6 border border-blue-200 shadow mb-4 max-h-[500px] overflow-y-auto",children:[e.jsxs("h4",{className:"font-semibold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"📝"}),"Resumen de Cotización"]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-2",children:l.map(i=>{const u=v.find(M=>M.id===i),b=E[i]||1;return u?e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{children:u.descripcion||u.nombre}),e.jsxs("span",{children:[b," estudio(s)"]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",(u.precio_particular*b).toFixed(2)]})]},i):null})}),e.jsxs("div",{className:"text-right text-xl font-bold text-blue-800 flex items-center gap-2",children:["Total: ",e.jsx("span",{children:"💲"})," S/ ",S().toFixed(2)]}),e.jsxs("button",{onClick:L,className:"mt-6 bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 flex items-center gap-2 text-lg",children:[e.jsx("span",{children:"🛒"}),"Registrar Cotización"]})]}),s&&j&&e.jsx(me,{paciente:j,servicio:{key:"ecografia",label:"Ecografía"},detalles:a,total:x,onCobroCompleto:()=>{r(!1),n("Cotización procesada correctamente.")},onCancelar:()=>r(!1)})]}),g&&e.jsx("div",{className:"mt-4 text-center font-semibold text-green-600",children:g})]})}function Js({onSeleccionarOrden:s}){const[r,a]=t.useState("table"),[d,x]=t.useState(10),[w,y]=t.useState(0),[h,j]=t.useState([]),[N,v]=t.useState(!0),[C,l]=t.useState(""),[_,E]=t.useState([]),[o,g]=t.useState(""),[n,c]=t.useState(""),[m,f]=t.useState(""),[S,L]=t.useState("");if(t.useEffect(()=>{v(!0),fetch(O+"api_ordenes_laboratorio.php",{credentials:"include"}).then(P=>P.json()).then(P=>{P.success?j(P.ordenes):l(P.error||"Error al cargar órdenes"),v(!1)}).catch(P=>{l("Error de conexión con el servidor"),v(!1),console.error("Error al cargar órdenes:",P)}),fetch(O+"api_examenes_laboratorio.php",{credentials:"include"}).then(P=>P.json()).then(P=>{E(P.examenes||[])})},[]),N||_.length===0)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"flex items-center gap-3 text-purple-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),e.jsx("span",{children:"Cargando órdenes de laboratorio..."})]})});if(C)return e.jsx("div",{className:"p-4 text-red-600 bg-red-50 rounded-lg border border-red-200",children:C});const u=(P=>P.filter(A=>{if((o||n)&&A.fecha){const I=new Date(A.fecha),p=o?new Date(o):null,T=n?new Date(n):null;if(p&&I<p||T&&I>new Date(T+"T23:59:59"))return!1}if(m.trim()!==""){const I=m.toLowerCase(),p=(A.paciente_nombre+" "+A.paciente_apellido).toLowerCase(),T=((A.medico_nombre||"")+" "+(A.medico_apellido||"")).toLowerCase();if(!p.includes(I)&&!T.includes(I))return!1}return!(S&&A.estado!==S)}))(h),b={total:h.length,pendientes:h.filter(P=>P.estado==="pendiente").length,completadas:h.filter(P=>P.estado==="completado").length,hoy:h.filter(P=>{if(!P.fecha)return!1;const A=new Date(P.fecha).toDateString(),I=new Date().toDateString();return A===I}).length},M=Math.ceil(u.length/d),D=u.slice(w*d,(w+1)*d),z=P=>Array.isArray(P)?P.map(A=>{const I=_.find(p=>p.id==A);return I?I.nombre:A}).join(", "):"",$=P=>P?new Date(P).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"N/A";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm",children:"Total Órdenes"}),e.jsx("p",{className:"text-2xl font-bold",children:b.total})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"📋"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-100 text-sm",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold",children:b.pendientes})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"⏳"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-emerald-100 text-sm",children:"Completadas"}),e.jsx("p",{className:"text-2xl font-bold",children:b.completadas})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"✅"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm",children:"Hoy"}),e.jsx("p",{className:"text-2xl font-bold",children:b.hoy})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"📅"})]})})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Desde"}),e.jsx("input",{type:"date",value:o,onChange:P=>{g(P.target.value),y(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hasta"}),e.jsx("input",{type:"date",value:n,onChange:P=>{c(P.target.value),y(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar"}),e.jsx("input",{type:"text",value:m,onChange:P=>{f(P.target.value),y(0)},placeholder:"Paciente o médico...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsxs("select",{value:S,onChange:P=>{L(P.target.value),y(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"completado",children:"Completado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Por página"}),e.jsxs("select",{value:d,onChange:P=>{x(Number(P.target.value)),y(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vista:"}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>a("table"),className:`px-3 py-1 rounded-md text-sm transition-colors ${r==="table"?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"📊 Tabla"}),e.jsx("button",{onClick:()=>a("cards"),className:`px-3 py-1 rounded-md text-sm transition-colors ${r==="cards"?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"🗃️ Tarjetas"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",D.length," de ",u.length," órdenes"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{disabled:w===0,onClick:()=>y(P=>Math.max(0,P-1)),className:"px-3 py-1 rounded-lg bg-gray-100 disabled:opacity-50 hover:bg-gray-200 transition-colors",children:"←"}),e.jsxs("span",{className:"px-3 py-1 text-sm",children:[w+1," / ",M||1]}),e.jsx("button",{disabled:w>=M-1,onClick:()=>y(P=>Math.min(M-1,P+1)),className:"px-3 py-1 rounded-lg bg-gray-100 disabled:opacity-50 hover:bg-gray-200 transition-colors",children:"→"})]})]})]}),u.length===0?e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No se encontraron órdenes con los filtros aplicados"})]}):e.jsxs(e.Fragment,{children:[r==="table"&&e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Paciente"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Tipo de Cotización"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden md:table-cell",children:"Médico"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden lg:table-cell",children:"Consulta"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden lg:table-cell",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Acciones"})]})}),e.jsx("tbody",{children:D.map(P=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-purple-50/50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:["#",P.id]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"font-medium",children:[P.paciente_nombre," ",P.paciente_apellido]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:P.consulta_id?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 border border-blue-200",children:"Médico"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-pink-100 text-pink-800 border border-pink-200",children:"Particular"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden md:table-cell",children:(P.medico_nombre||"")+(P.medico_apellido?" "+P.medico_apellido:"")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden lg:table-cell",children:P.consulta_id}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden lg:table-cell",children:$(P.fecha)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${P.estado==="completado"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,children:P.estado==="completado"?"✅ Completado":"⏳ Pendiente"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>s(P),className:"inline-flex items-center px-3 py-1.5 bg-gradient-to-r from-purple-500 to-indigo-500 text-white text-xs font-medium rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-all transform hover:scale-105 shadow-md",title:P.estado==="completado"?"Editar resultado":"Llenar resultados",children:P.estado==="completado"?"✏️ Editar":"📝 Procesar"})})})]},P.id))})]})})}),r==="cards"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:D.map(P=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6 hover:shadow-xl transition-all transform hover:scale-105",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"🧪"}),e.jsxs("span",{className:"font-bold text-gray-900",children:["#",P.id]})]}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${P.estado==="completado"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,children:P.estado==="completado"?"✅":"⏳"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Paciente"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[P.paciente_nombre," ",P.paciente_apellido]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Médico"}),e.jsx("p",{className:"text-sm text-gray-700",children:(P.medico_nombre||"")+(P.medico_apellido?" "+P.medico_apellido:"")||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Consulta"}),e.jsx("p",{className:"text-sm text-gray-700",children:P.consulta_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Fecha"}),e.jsx("p",{className:"text-sm text-gray-700",children:$(P.fecha)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Exámenes"}),e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:z(P.examenes)})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>s(P),className:"flex-1 bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-2.5 px-4 rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-all font-medium text-sm shadow-md hover:shadow-lg transform hover:scale-105",children:P.estado==="completado"?"✏️ Editar Resultado":"📝 Procesar Orden"})})})]},P.id))})]})]})}function Xs({orden:s,onVolver:r,onGuardado:a}){const[d,x]=t.useState([]),[w,y]=t.useState({}),[h,j]=t.useState(!1),[N,v]=t.useState(""),[C,l]=t.useState("success");t.useEffect(()=>{fetch(O+"api_examenes_laboratorio.php",{credentials:"include"}).then(n=>n.json()).then(n=>x(n.examenes||[]))},[]),t.useEffect(()=>{if(!(!d||d.length===0))if(s.resultados&&typeof s.resultados=="object")y({...s.resultados});else{const n={};let c=[];if(typeof s.examenes=="string")try{c=JSON.parse(s.examenes)}catch{c=s.examenes.split(",").map(m=>m.trim()).filter(m=>m)}else Array.isArray(s.examenes)?c=s.examenes:s.examenes&&(c=[s.examenes]);c.forEach(m=>{const f=typeof m=="object"?m.id:m,S=d.find(L=>L.id==f);S&&Array.isArray(S.valores_referenciales)&&S.valores_referenciales.length>0?S.valores_referenciales.forEach(L=>{(L.tipo===void 0||L.tipo==="Parámetro")&&L.nombre&&L.nombre.trim()!==""&&(n[`${f}__${L.nombre}`]="")}):n[`${f}`]=""}),y(n)}},[s,d]);function _(n,c){if(!n)return"";let m=n;Object.keys(c).sort((S,L)=>L.length-S.length).forEach(S=>{const L=c[S]||0,i=new RegExp(S.replace(/[.*+?^${}()|[\]\\]/g,"$&"),"g");m=m.replace(i,L===""?0:L)});try{const S=$e(m);return typeof S=="number"&&!isNaN(S)?S.toFixed(1):S}catch{return""}}const E=n=>{const c={...w,[n.target.name]:n.target.value};y(c)},o=async n=>{n.preventDefault(),j(!0),v("");try{const c={...w};let m=[];if(typeof s.examenes=="string")try{m=JSON.parse(s.examenes)}catch{m=s.examenes.split(",").map(i=>i.trim()).filter(i=>i)}else Array.isArray(s.examenes)?m=s.examenes:s.examenes&&(m=[s.examenes]);m.forEach(i=>{const u=typeof i=="object"?i.id:i,b=d.find(D=>D.id==u);if(!b||!Array.isArray(b.valores_referenciales))return;const M={};b.valores_referenciales.forEach(D=>{(D.tipo===void 0||D.tipo==="Parámetro")&&D.nombre&&D.nombre.trim()!==""&&(M[D.nombre]=c[`${u}__${D.nombre}`]||"")}),b.valores_referenciales.forEach(D=>{if((D.tipo===void 0||D.tipo==="Parámetro")&&D.nombre&&D.nombre.trim()!==""&&D.formula&&D.formula.trim()!==""){const z=_(D.formula,M);M[D.nombre]=z??"",c[`${u}__${D.nombre}`]=z??""}})});const f=s.consulta_id?s.consulta_id:s.id,L=await(await fetch(O+"api_resultados_laboratorio.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:f,tipo_examen:"varios",resultados:c})})).json();L.success?(v("✅ Resultados guardados correctamente"),l("success"),setTimeout(()=>{a&&a()},1e3)):(v("❌ "+(L.error||"Error al guardar")),l("error"))}catch{v("❌ Error de conexión"),l("error")}finally{j(!1)}},g=(n,c)=>{let m=!1,f=null,S=null;!isNaN(parseFloat(n.min))&&n.min!==null&&n.min!==""?f=parseFloat(n.min):n.referencias&&n.referencias[0]&&!isNaN(parseFloat(n.referencias[0].valor_min))&&(f=parseFloat(n.referencias[0].valor_min)),!isNaN(parseFloat(n.max))&&n.max!==null&&n.max!==""?S=parseFloat(n.max):n.referencias&&n.referencias[0]&&!isNaN(parseFloat(n.referencias[0].valor_max))&&(S=parseFloat(n.referencias[0].valor_max));let L=parseFloat(c);return isNaN(L)||(f!==null&&L<f&&(m=!0),S!==null&&L>S&&(m=!0)),{fueraDeRango:m,min:f,max:S}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-2xl",children:"📊"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Procesar Resultados de Laboratorio"}),e.jsx("p",{className:"text-purple-100",children:"Complete los valores para cada examen solicitado"})]})]})}),e.jsxs("form",{onSubmit:o,className:"space-y-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6",children:e.jsx("div",{className:"max-h-[600px] overflow-y-auto space-y-6",children:(()=>{let n=[];if(typeof s.examenes=="string")try{n=JSON.parse(s.examenes)}catch{n=s.examenes.split(",").map(c=>c.trim()).filter(c=>c)}else Array.isArray(s.examenes)?n=s.examenes:s.examenes&&(n=[s.examenes]);return n.map(c=>{const m=typeof c=="object"?c.id:c,f=d.find(S=>S.id==m);if(f&&Array.isArray(f.valores_referenciales)&&f.valores_referenciales.length>0){const S={};return f.valores_referenciales.forEach(L=>{(L.tipo===void 0||L.tipo==="Parámetro")&&L.nombre&&L.nombre.trim()!==""&&(S[L.nombre]=w[`${m}__${L.nombre}`]||"")}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-4 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"🧪"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:f.nombre}),e.jsx("p",{className:"text-sm text-gray-600",children:"Complete todos los parámetros requeridos"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:f.valores_referenciales.map(L=>{if((L.tipo===void 0||L.tipo==="Parámetro")&&L.nombre&&L.nombre.trim()!==""){const i=L.formula&&L.formula.trim()!=="";let u=w[`${m}__${L.nombre}`]||"";i&&(u=_(L.formula,S)),typeof u=="number"&&isNaN(u)&&(u=""),u==null&&(u="");const{fueraDeRango:b,min:M,max:D}=g(L,u);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{children:L.nombre}),i&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"🧮 Calculado"})]}),i&&e.jsxs("span",{className:"text-xs text-blue-600 font-normal",children:["Fórmula: ",L.formula]}),(M!==null||D!==null)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Rango de referencia: ",M!==null?`${M}`:"∞"," - ",D!==null?`${D}`:"∞"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:`${m}__${L.nombre}`,value:u,onChange:i?void 0:E,readOnly:i,required:!0,className:`w-full px-4 py-3 border-2 rounded-lg transition-all duration-200 ${b?"border-red-400 bg-red-50 text-red-700 font-semibold focus:ring-2 focus:ring-red-500":i?"border-blue-200 bg-blue-50 text-blue-800 cursor-not-allowed":"border-gray-300 bg-white hover:border-purple-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:i?"Valor calculado automáticamente":"Ingrese el valor"}),u&&!i&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:b?e.jsx("span",{className:"text-red-500 font-bold",children:"⚠️"}):e.jsx("span",{className:"text-green-500 font-bold",children:"✓"})})]}),b&&(M!==null||D!==null)&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-600 font-medium bg-red-50 px-2 py-1 rounded-md",children:[e.jsx("span",{children:"⚠️"}),e.jsx("span",{children:"Valor fuera del rango de referencia"})]})]},L.nombre)}return null})})]},m)}else if(f)return e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"🧪"}),e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:f.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Resultado del examen"}),e.jsx("textarea",{name:`${m}`,value:w[`${m}`]||"",onChange:E,rows:4,required:!0,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200",placeholder:"Ingrese el resultado completo del examen..."})]})]},m);return null})})()})}),"        ",e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e.jsx("button",{type:"button",onClick:r,className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium border border-gray-300",children:"← Cancelar"}),e.jsx("button",{type:"submit",disabled:h,className:"px-8 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:h?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Guardando..."]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"💾"}),"Guardar Resultados"]})})]}),N&&e.jsx("div",{className:`p-4 rounded-lg border ${C==="success"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:e.jsx("div",{className:"flex items-center gap-2 font-medium",children:N})})]})]})}function Ks(){const[s,r]=t.useState("ordenes"),[a,d]=t.useState(null),[x,w]=t.useState(0),[y,h]=t.useState([]);t.useEffect(()=>{fetch(O+"api_examenes_laboratorio.php",{credentials:"include"}).then(l=>l.json()).then(l=>h(l.examenes||[]))},[]);const j=async l=>{if(l.estado==="completado"){const _=l.consulta_id?l.consulta_id:l.id,o=await(await fetch(O+`api_get_resultados_laboratorio.php?orden_id=${_}`)).json();if(o.success&&o.resultado){d({...l,resultados:o.resultado.resultados}),r("procesar");return}}d(l),r("procesar")},N=()=>{d(null),w(l=>l+1),r("ordenes")},v=l=>{if(!l)return"";let _;if(typeof l=="string")try{_=JSON.parse(l)}catch{_=l.split(",").map(E=>E.trim()).filter(E=>E)}else if(Array.isArray(l))_=l;else return l.toString();return Array.isArray(_)?_.map(E=>{if(typeof E=="object"&&E.nombre)return E.nombre;const o=y.find(g=>g.id==E);return o?o.nombre:E}).join(", "):""},C=[{id:"ordenes",label:"Órdenes de Laboratorio",icon:"🧪",color:"from-purple-600 to-indigo-600"},{id:"procesar",label:"Procesar Resultados",icon:"📊",color:"from-blue-600 to-cyan-600",disabled:!a}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-indigo-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 text-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-2xl",children:"🔬"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Panel de Laboratorio"}),e.jsx("p",{className:"text-purple-100",children:"Gestión de órdenes y resultados de laboratorio"})]})]}),e.jsx("div",{className:"flex gap-1 bg-white/10 backdrop-blur-sm rounded-lg p-1",children:C.map(l=>e.jsxs("button",{onClick:()=>!l.disabled&&r(l.id),disabled:l.disabled,className:`flex items-center gap-2 px-4 py-2 rounded-md transition-all duration-200 text-sm font-medium ${s===l.id?"bg-white text-purple-600 shadow-lg":l.disabled?"text-purple-200 cursor-not-allowed opacity-50":"text-white hover:bg-white/20"}`,children:[e.jsx("span",{className:"text-lg",children:l.icon}),e.jsx("span",{className:"hidden sm:inline",children:l.label})]},l.id))})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[s==="ordenes"&&e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl shadow-xl border border-white/20",children:e.jsx(Js,{onSeleccionarOrden:j},x)}),s==="procesar"&&a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-sm rounded-lg shadow-md hover:bg-white transition-colors border border-white/20 text-gray-700 hover:text-gray-900",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Volver a órdenes"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Orden"}),e.jsxs("div",{className:"text-xl font-bold",children:["#",a.id]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Paciente"}),e.jsxs("div",{className:"text-xl font-bold",children:[a.paciente_nombre," ",a.paciente_apellido]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Consulta ID"}),e.jsx("div",{className:"text-xl font-bold",children:a.consulta_id})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Estado"}),e.jsx("div",{className:`text-xl font-bold ${a.estado==="completado"?"text-green-300":"text-yellow-300"}`,children:a.estado==="completado"?"Completado":"Pendiente"})]})]}),e.jsxs("div",{className:"mt-4 bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm mb-2",children:"Exámenes solicitados"}),e.jsx("div",{className:"text-lg",children:v(a.examenes)})]})]}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl shadow-xl border border-white/20 p-6",children:e.jsx(Xs,{orden:a,onVolver:N,onGuardado:N})})]})]})]})}function Ys(){const{consultaId:s}=de(),[r,a]=t.useState([]),[d,x]=t.useState([]),[w,y]=t.useState(!0),[h,j]=t.useState("");t.useEffect(()=>{y(!0),Promise.all([fetch(`${O}api_resultados_laboratorio.php?consulta_id=${s}`).then(o=>o.json()),fetch(`${O}api_examenes_laboratorio.php`,{credentials:"include"}).then(o=>o.json())]).then(([o,g])=>{o.success?a(o.resultados||[]):j(o.error||"No hay resultados"),x(g.examenes||[]),y(!1)}).catch(()=>{j("Error al cargar resultados"),y(!1)})},[s]);const N={},v={},C={};for(const o of d)N[o.id]=o.nombre,v[o.id]=o.unidad||"",C[o.id]=Array.isArray(o.valores_referenciales)?o.valores_referenciales:[];function l(o,g=null){if(!Array.isArray(o)||o.length===0)return null;if(g){const n=o.find(c=>c.nombre===g);if(n)return n}return o.find(n=>!n.desc||n.desc.toLowerCase()==="general")||o[0]}function _(o){let g=null,n=null;if(!o)return{min:g,max:n};if(Array.isArray(o.referencias)&&o.referencias.length>0){const c=o.referencias[0];isNaN(parseFloat(c.valor_min))||(g=parseFloat(c.valor_min)),isNaN(parseFloat(c.valor_max))||(n=parseFloat(c.valor_max))}return g===null&&!isNaN(parseFloat(o.valor_min))&&o.valor_min!==null&&o.valor_min!==""?g=parseFloat(o.valor_min):g===null&&o.min!==void 0&&!isNaN(parseFloat(o.min))&&(g=parseFloat(o.min)),n===null&&!isNaN(parseFloat(o.valor_max))&&o.valor_max!==null&&o.valor_max!==""?n=parseFloat(o.valor_max):n===null&&o.max!==void 0&&!isNaN(parseFloat(o.max))&&(n=parseFloat(o.max)),{min:g,max:n}}function E(o,g){if(!g||o==null||o==="")return!1;const{min:n,max:c}=_(g),m=parseFloat(o);return isNaN(m)?!1:n!==null&&m<n||c!==null&&m>c}return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-white rounded-xl shadow-xl mt-6",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("h2",{className:"text-3xl font-bold text-green-800",children:"📋 Resultados de Laboratorio"})]}),e.jsx("p",{className:"text-green-600",children:"Reporte completo de los análisis médicos"})]}),e.jsxs(te,{to:-1,className:"mb-6 inline-flex items-center gap-2 px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg font-medium transition-colors duration-200 hover:scale-105",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"⬅️ Volver"]}),w?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando resultados..."})]}):h?e.jsx("div",{className:"p-6 text-red-600 bg-red-50 border border-red-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),h]})}):r.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("p",{className:"text-gray-500 text-lg",children:"No hay resultados registrados para esta consulta."})]}):e.jsx("div",{className:"space-y-6",children:r.map((o,g)=>e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-green-200",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-4 8v4m-4-4h8m-8-4h8a2 2 0 002-2V7a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})}),e.jsxs("span",{className:"text-sm font-bold text-green-800",children:["📅 Fecha del Análisis: ",new Date(o.fecha).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),o.resultados&&typeof o.resultados=="object"?e.jsx("div",{children:(()=>{const n={};return Object.entries(o.resultados).forEach(([c,m])=>{let f=c,S=null;c.includes("__")&&([f,S]=c.split("__")),n[f]||(n[f]=[]),n[f].push({nombreParam:S,val:m,ex:c})}),Object.entries(n).map(([c,m])=>{const f=N[c]||c;return e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-semibold text-base mb-1",children:f}),e.jsx("ul",{className:"list-disc ml-5",children:m.map(({nombreParam:S,val:L,ex:i})=>{const u=C[c]||[],b=l(u,S),M=v[c]?` ${v[c]}`:"",{min:D,max:z}=_(b),$=b&&E(L,b);return e.jsxs("li",{children:[e.jsxs("b",{children:[S||f,":"]})," ",e.jsxs("span",{className:$?"text-red-600 font-bold":"",children:[L,M]}),(D!==null||z!==null)&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["[",D!==null?`min: ${D}`:"",D!==null&&z!==null?", ":"",z!==null?`max: ${z}`:"","]"]}),$&&(D!==null||z!==null)&&e.jsx("span",{className:"text-xs text-red-600 ml-1 font-semibold",children:"Fuera de rango"})]},i)})})]},c)})})()}):e.jsx("div",{children:JSON.stringify(o.resultados)})]},g))})]})}function Qs(){return e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Reportes"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(te,{to:"/lista-consultas",className:"bg-blue-600 text-white rounded-lg p-6 text-center font-semibold shadow hover:bg-blue-700 transition-all",children:"Lista de Consultas"}),e.jsx(te,{to:"/reporte-pacientes",className:"bg-green-600 text-white rounded-lg p-6 text-center font-semibold shadow hover:bg-green-700 transition-all",children:"Reporte de Pacientes"}),e.jsx(te,{to:"/reporte-finanzas",className:"bg-purple-600 text-white rounded-lg p-6 text-center font-semibold shadow hover:bg-purple-700 transition-all",children:"Reporte de Finanzas"})]})]})}function Zs(){const[s,r]=t.useState([]),[a,d]=t.useState(3),[x,w]=t.useState(1),[y,h]=t.useState(!0),[j,N]=t.useState(""),[v,C]=t.useState(""),[l,_]=t.useState(""),[E,o]=t.useState("");t.useEffect(()=>{fetch(O+"api_consultas.php").then(i=>i.json()).then(i=>{i.success?r(i.consultas):N(i.error||"Error al cargar consultas"),h(!1)}).catch(()=>{N("Error de conexión con el servidor"),h(!1)})},[]);const n=(i=>{let u=i;if((v||l)&&(u=u.filter(b=>{if(!b.fecha)return!1;const M=b.fecha.slice(0,10);return!(v&&M<v||l&&M>l)})),E.trim()!==""){const b=E.trim().toLowerCase();u=u.filter(M=>M.paciente_nombre&&M.paciente_nombre.toLowerCase().includes(b)||M.paciente_apellido&&M.paciente_apellido.toLowerCase().includes(b)||M.medico_nombre&&M.medico_nombre.toLowerCase().includes(b)||M.medico_apellido&&M.medico_apellido.toLowerCase().includes(b)||M.motivo&&M.motivo.toLowerCase().includes(b)||M.estado&&M.estado.toLowerCase().includes(b)||M.id&&M.id.toString().includes(b))}return u})(s),c=n.length,m=Math.max(1,Math.ceil(c/a)),f=n.slice((x-1)*a,x*a),S=()=>{const i=ce.json_to_sheet(n.map($=>({ID:$.id,Fecha:$.fecha?.slice(0,16).replace("T"," "),Paciente:$.paciente_nombre+" "+$.paciente_apellido,Medico:$.medico_nombre,Motivo:$.motivo,Estado:$.estado}))),u=ce.book_new();ce.book_append_sheet(u,i,"Consultas");const b=Pe(u,{bookType:"xlsx",type:"array"}),M=new Blob([b],{type:"application/octet-stream"}),D=new Date().toISOString().slice(0,10),z=document.createElement("a");z.href=URL.createObjectURL(M),z.download=`consultas_${D}.xlsx`,document.body.appendChild(z),z.click(),document.body.removeChild(z)},L=()=>{const i=new je;i.text("Lista de Consultas",14,10),Ne(i,{head:[["ID","Fecha","Paciente","Médico","Motivo","Estado"]],body:n.map(b=>[b.id,b.fecha?.slice(0,16).replace("T"," "),b.paciente_nombre+" "+b.paciente_apellido,b.medico_nombre,b.motivo,b.estado]),startY:18,styles:{fontSize:9},headStyles:{fillColor:[59,130,246]}});const u=new Date().toISOString().slice(0,10);i.save(`consultas_${u}.pdf`)};return e.jsxs("div",{className:"max-w-5xl mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Lista de Consultas"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[e.jsx("label",{className:"text-sm",children:"Filas por página:"}),e.jsxs("select",{value:a,onChange:i=>{d(Number(i.target.value)),w(1)},className:"border rounded px-2 py-1",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]}),e.jsx("input",{type:"text",value:E,onChange:i=>o(i.target.value),placeholder:"Buscar por paciente, médico, motivo, estado o ID...",className:"border rounded px-2 py-1 min-w-[180px]"}),e.jsx("label",{className:"text-sm",children:"Desde:"}),e.jsx("input",{type:"date",value:v,onChange:i=>C(i.target.value),className:"border rounded px-2 py-1"}),e.jsx("label",{className:"text-sm",children:"Hasta:"}),e.jsx("input",{type:"date",value:l,onChange:i=>_(i.target.value),className:"border rounded px-2 py-1"}),(v||l||E)&&e.jsx("button",{onClick:()=>{C(""),_(""),o("")},className:"text-blue-600 underline ml-2",children:"Limpiar filtro"}),e.jsx("button",{onClick:S,className:"bg-green-600 text-white px-3 py-1 rounded font-semibold text-xs hover:bg-green-700 transition-all",children:"Exportar Excel"}),e.jsx("button",{onClick:L,className:"bg-red-600 text-white px-3 py-1 rounded font-semibold text-xs hover:bg-red-700 transition-all",children:"Exportar PDF"})]}),y?e.jsx("div",{className:"text-center",children:"Cargando..."}):j?e.jsx("div",{className:"text-center text-red-600",children:j}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full text-xs md:text-sm border bg-white rounded shadow",children:[e.jsx("thead",{className:"bg-blue-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 w-12 text-center",children:"ID"}),e.jsx("th",{className:"p-2",children:"Fecha"}),e.jsx("th",{className:"p-2",children:"Paciente"}),e.jsx("th",{className:"p-2",children:"Médico"}),e.jsx("th",{className:"p-2",children:"Motivo"}),e.jsx("th",{className:"p-2",children:"Estado"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-4",children:"No hay consultas registradas"})}):f.map(i=>e.jsxs("tr",{className:"border-b hover:bg-blue-50",children:[e.jsx("td",{className:"p-2 w-12 text-center",children:i.id}),e.jsx("td",{className:"p-2",children:i.fecha?.slice(0,16).replace("T"," ")}),e.jsxs("td",{className:"p-2",children:[i.paciente_nombre," ",i.paciente_apellido]}),e.jsx("td",{className:"p-2",children:(i.medico_nombre||"")+(i.medico_apellido?" "+i.medico_apellido:"")}),e.jsx("td",{className:"p-2",children:i.motivo}),e.jsx("td",{className:"p-2",children:i.estado})]},i.id))})]}),e.jsxs("div",{className:"flex justify-end items-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>w(i=>Math.max(1,i-1)),disabled:x===1,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{className:"text-sm",children:["Página ",x," de ",m]}),e.jsx("button",{onClick:()=>w(i=>Math.min(m,i+1)),disabled:x===m,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Siguiente"})]})]})]})}function et(){return e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Reporte de Pacientes"}),e.jsx("div",{className:"text-gray-500 text-center",children:"(Vista en construcción)"})]})}function st(){return e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Reporte de Finanzas"}),e.jsx("div",{className:"text-gray-500 text-center",children:"(Vista en construcción)"})]})}function tt(){const[s,r]=t.useState({nombre_clinica:"",direccion:"",telefono:"",email:"",horario_atencion:"",logo_url:"",website:"",ruc:"",especialidades:"",mision:"",vision:"",valores:"",director_general:"",jefe_enfermeria:"",contacto_emergencias:""}),[a,d]=t.useState(!1),[x,w]=t.useState(!0),[y,h]=t.useState(!1),[j,N]=t.useState("");t.useEffect(()=>{v()},[]);const v=async()=>{try{w(!0);const g=await fetch(O+"api_get_configuracion.php",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(g.ok){const n=await g.json();if(n.success)r(n.data),n.data&&n.data.logo_url&&N(n.data.logo_url);else throw new Error(n.error||"Error al cargar la configuración")}else if(g.status===401){const n=await g.json();throw new Error("🔒 Acceso denegado: "+(n.error||"No está autenticado como administrador"))}else{const n=await g.text();throw console.error("❌ Error del servidor:",n),new Error(`Error del servidor: ${g.status} - ${n}`)}}catch(g){console.error("🚨 Error al cargar configuración:",g),g.message.includes("🔒 Acceso denegado")?q.fire({title:"🔒 Acceso Denegado",text:"Necesita estar autenticado como administrador para ver la configuración.",icon:"warning",confirmButtonText:"Ir a Login",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed&&(window.location.href="/")}):q.fire({title:"Error",text:"No se pudo cargar la configuración: "+g.message,icon:"error",confirmButtonText:"OK"})}finally{w(!1)}},C=(g,n)=>{r(c=>({...c,[g]:n}))},l=async()=>{if(!s.nombre_clinica||!s.direccion||!s.telefono||!s.email){q.fire({title:"Error",text:"Por favor, complete todos los campos obligatorios.",icon:"error",confirmButtonText:"OK"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)){q.fire({title:"Error",text:"Por favor, ingrese un email válido.",icon:"error",confirmButtonText:"OK"});return}d(!0);try{const n=await fetch(O+"api_configuracion.php",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(n.ok){const c=await n.json();if(c.success)q.fire({title:"¡Configuración guardada!",text:c.message||"Los cambios se han aplicado exitosamente.",icon:"success",confirmButtonText:"OK"}),s.logo_url&&N(s.logo_url);else throw new Error(c.error||"Error al guardar la configuración")}else if(n.status===401){await n.json(),q.fire({title:"🔒 Acceso Denegado",text:"Necesita estar autenticado como administrador para modificar la configuración.",icon:"warning",confirmButtonText:"Ir a Login",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(c=>{c.isConfirmed&&(window.location.href="/")});return}else{const c=await n.text();throw console.error("❌ Error del servidor:",c),new Error(`Error del servidor: ${n.status} - ${c}`)}}catch(n){console.error("🚨 Error al guardar configuración:",n),q.fire({title:"Error",text:"No se pudo guardar la configuración: "+n.message,icon:"error",confirmButtonText:"OK"})}finally{d(!1)}},_=g=>{const n=g.target.files&&g.target.files[0];if(!n)return;const c=URL.createObjectURL(n);N(c),r(m=>({...m,_logo_file:n}))},E=async()=>{const g=s._logo_file;if(!g){q.fire({title:"Info",text:"Seleccione un archivo primero.",icon:"info"});return}h(!0);try{const n=new FormData;n.append("logo",g);const c=await fetch(O+"api_upload_logo.php",{method:"POST",credentials:"include",body:n}),m=await c.json();if(c.ok&&m.success)r(f=>({...f,logo_url:m.path,_logo_file:null})),N(m.path),q.fire({title:"Listo",text:"Logo subido correctamente.",icon:"success"});else throw new Error(m.error||"Error subiendo archivo")}catch(n){console.error("Error upload logo",n),q.fire({title:"Error",text:"No se pudo subir el logo: "+n.message,icon:"error"})}finally{h(!1)}},o=()=>{r(g=>({...g,logo_url:""})),N("")};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-blue-800",children:"⚙️ Configuración del Sistema"}),x?e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando configuración..."})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-800",children:"Información de la Clínica"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la Clínica *"}),e.jsx("input",{type:"text",value:s.nombre_clinica,onChange:g=>C("nombre_clinica",g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Teléfono *"}),e.jsx("input",{type:"tel",value:s.telefono,onChange:g=>C("telefono",g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",value:s.email,onChange:g=>C("email",g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"RUC (opcional)"}),e.jsx("input",{type:"text",value:s.ruc||"",onChange:g=>C("ruc",g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dirección *"}),e.jsx("input",{type:"text",value:s.direccion,onChange:g=>C("direccion",g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Director General"}),e.jsx("input",{type:"text",value:s.director_general||"",onChange:g=>C("director_general",g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Dr. Juan Pérez"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Jefe de Enfermería"}),e.jsx("input",{type:"text",value:s.jefe_enfermeria||"",onChange:g=>C("jefe_enfermeria",g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enf. María González"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL del Logo (opcional) / Subir logo"}),e.jsx("input",{type:"url",value:s.logo_url||"",onChange:g=>C("logo_url",g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2",placeholder:"https://ejemplo.com/logo.png"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:_,className:"text-sm"}),e.jsx("button",{type:"button",onClick:E,disabled:y,className:"bg-green-600 text-white px-3 py-1 rounded-md hover:bg-green-700 disabled:bg-gray-300 text-sm",children:y?"Subiendo...":"Subir Logo"}),e.jsx("button",{type:"button",onClick:o,className:"bg-red-100 text-red-700 px-3 py-1 rounded-md hover:bg-red-200 text-sm",children:"Eliminar"})]}),j?e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Vista previa:"}),e.jsx("img",{src:j.startsWith("http")?j:"/"+j.replace(/^\/+/,""),alt:"Logo preview",style:{maxHeight:96}})]}):null]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sitio Web (opcional)"}),e.jsx("input",{type:"url",value:s.website||"",onChange:g=>C("website",g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://www.ejemplo.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contacto de Emergencias"}),e.jsx("input",{type:"tel",value:s.contacto_emergencias||"",onChange:g=>C("contacto_emergencias",g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Emergencias 24h: +51 987-654-321"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Especialidades"}),e.jsx("textarea",{value:s.especialidades||"",onChange:g=>C("especialidades",g.target.value),rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Medicina General, Pediatría, Ginecología, Traumatología..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Horario de Atención"}),e.jsx("textarea",{value:s.horario_atencion||"",onChange:g=>C("horario_atencion",g.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Lunes a Viernes: 7:00 AM - 8:00 PM..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Misión Institucional"}),e.jsx("textarea",{value:s.mision||"",onChange:g=>C("mision",g.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brindar servicios de salud de calidad..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Visión Institucional"}),e.jsx("textarea",{value:s.vision||"",onChange:g=>C("vision",g.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ser el centro de salud de referencia..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valores Institucionales"}),e.jsx("textarea",{value:s.valores||"",onChange:g=>C("valores",g.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Compromiso, Excelencia, Humanización, Integridad..."})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"* Campos obligatorios"}),e.jsx("button",{onClick:l,disabled:a,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 font-medium transition-colors",children:a?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Guardando..."]}):"💾 Guardar Configuración"})]})})]}),e.jsxs("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"ℹ️ Información del Sistema"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Versión:"})," 1.0.0"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Base de datos:"})," MySQL"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Servidor web:"})," Apache (Laragon)"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Framework:"})," React + Vite"]})]})]})]})}function at(){const[s,r]=t.useState([]),[a,d]=t.useState([]),[x,w]=t.useState(!0),[y,h]=t.useState(!1),[j,N]=t.useState(null),[v,C]=t.useState("todos"),[l,_]=t.useState(1),[E,o]=t.useState(5),g=[{value:"consulta",label:"Consultas Médicas"},{value:"rayosx",label:"Rayos X"},{value:"ecografia",label:"Ecografía"},{value:"ocupacional",label:"Medicina Ocupacional"},{value:"procedimientos",label:"Procedimientos Médicos"},{value:"cirugias",label:"Cirugías Menores"},{value:"tratamientos",label:"Tratamientos Especializados"},{value:"emergencias",label:"Emergencias"}],n=[...g],[c,m]=t.useState({servicio_tipo:"consulta",medico_id:"",descripcion_base:"",descripcion:"",precio_particular:"",precio_seguro:"",precio_convenio:"",activo:1});t.useEffect(()=>{L(),f()},[]);const f=async()=>{try{const G=await(await fetch(`${O}api_medicos.php`)).json();if(G.success){const J=(G.medicos||[]).map(Z=>({...Z,id:parseInt(Z.id)}));d(J)}}catch(k){console.error("Error al cargar médicos:",k)}},S=t.useCallback((k,G)=>{if(!k||k==="general"||k==="")return G||"Consulta General";const J=a.find(Z=>Z.id===parseInt(k));if(J){const Z=J.nombre,B=J.especialidad?` - ${J.especialidad}`:"";return`${Z}${B} - ${G||"Consulta"}`}return G||"Consulta"},[a]),L=async()=>{try{w(!0);const G=await(await fetch(`${O}api_tarifas.php`,{credentials:"include"})).json();G.success?r(G.tarifas||[]):console.error("Error al cargar tarifas:",G.error)}catch(k){console.error("Error:",k),q.fire("Error","Error de conexión al cargar tarifas","error")}finally{w(!1)}},i=(k=null)=>{if(k&&(k.fuente==="medicamentos"||k.fuente==="examenes_laboratorio")){q.fire({title:"No Editable",text:k.fuente==="medicamentos"?"Los precios de medicamentos se gestionan desde el módulo de farmacia.":"Los precios de exámenes se gestionan desde el módulo de laboratorio.",icon:"info",confirmButtonText:"Entendido"});return}if(k){N(k);const G=k.descripcion;let J="general",Z=G;const B=a.find(R=>G.includes(R.nombre));if(B){J=B.id.toString();const R=new RegExp(`^${B.nombre}(\\s*-\\s*${B.especialidad})?\\s*-\\s*`,"i");Z=G.replace(R,"").trim()}m({servicio_tipo:k.servicio_tipo,medico_id:J,descripcion_base:Z,descripcion:G,precio_particular:k.precio_particular,precio_seguro:k.precio_seguro||"",precio_convenio:k.precio_convenio||"",activo:k.activo})}else N(null),m({servicio_tipo:"consulta",medico_id:"general",descripcion_base:"",descripcion:"",precio_particular:"",precio_seguro:"",precio_convenio:"",activo:1});h(!0)},u=()=>{h(!1),N(null),m({servicio_tipo:"consulta",medico_id:"general",descripcion_base:"",descripcion:"",precio_particular:"",precio_seguro:"",precio_convenio:"",activo:1})},b=async()=>{if(!c.descripcion.trim()){q.fire("Error","La descripción es obligatoria","error");return}if(!c.precio_particular||parseFloat(c.precio_particular)<=0){q.fire("Error","El precio particular debe ser mayor a 0","error");return}try{const k=j?`${O}api_tarifas.php`:`${O}api_tarifas.php`,G=j?"PUT":"POST",J=j?{...c,id:j.id}:c,B=await(await fetch(k,{method:G,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(J)})).json();B.success?(q.fire({title:"¡Éxito!",text:j?"Tarifa actualizada correctamente":"Tarifa creada correctamente",icon:"success",confirmButtonText:"OK"}),u(),L()):q.fire("Error",B.error||"Error al guardar la tarifa","error")}catch(k){console.error("Error:",k),q.fire("Error","Error de conexión","error")}},M=async(k,G)=>{if(typeof k=="string"&&(k.startsWith("med_")||k.startsWith("lab_"))){q.fire({title:"No Eliminable",text:k.startsWith("med_")?"Los medicamentos se eliminan desde el módulo de farmacia.":"Los exámenes se eliminan desde el módulo de laboratorio.",icon:"info",confirmButtonText:"Entendido"});return}if((await q.fire({title:"¿Estás seguro?",text:`¿Deseas eliminar la tarifa "${G}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33"})).isConfirmed)try{const B=await(await fetch(`${O}api_tarifas.php`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:k})})).json();B.success?(q.fire("¡Eliminado!","La tarifa ha sido eliminada","success"),L()):q.fire("Error",B.error||"Error al eliminar la tarifa","error")}catch(Z){console.error("Error:",Z),q.fire("Error","Error de conexión","error")}},D=async(k,G)=>{try{const Z=await(await fetch(`${O}api_tarifas.php`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:k,activo:G})})).json();Z.success?L():q.fire("Error",Z.error||"Error al cambiar estado","error")}catch(J){console.error("Error:",J),q.fire("Error","Error de conexión","error")}},z=v==="todos"?s.filter(k=>!["laboratorio","farmacia"].includes(k.servicio_tipo)):s.filter(k=>k.servicio_tipo===v&&!["laboratorio","farmacia"].includes(k.servicio_tipo)),$=z.length,P=Math.ceil($/E),A=(l-1)*E,I=A+E,p=z.slice(A,I),T=k=>{_(k)},U=k=>{o(k),_(1)};t.useEffect(()=>{_(1)},[v]),t.useEffect(()=>{if(a.length>0&&c.medico_id&&c.descripcion_base){const k=S(c.medico_id,c.descripcion_base);m(G=>({...G,descripcion:k}))}},[a,c.medico_id,c.descripcion_base,S]);const K=k=>{const G=n.find(J=>J.value===k);return G?G.label:k};return x?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"text-xl",children:"Cargando tarifas..."})}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-blue-800",children:"💰 Gestión de Tarifas"}),e.jsx("button",{onClick:()=>i(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-medium",children:"➕ Nueva Tarifa"})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Filtrar por servicio:"}),e.jsxs("select",{value:v,onChange:k=>C(k.target.value),className:"border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"todos",children:"Todos los servicios"}),n.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))]}),e.jsxs("span",{className:"text-gray-600",children:["(",$," tarifa",$!==1?"s":""," - Página ",l," de ",P,")"]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"font-medium text-gray-700 text-sm sm:text-base",children:"Elementos por página:"}),e.jsxs("select",{value:E,onChange:k=>U(parseInt(k.target.value)),className:"border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]}),P>1&&e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>T(1),disabled:l===1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 whitespace-nowrap",children:[e.jsx("span",{className:"hidden sm:inline",children:"Primera"}),e.jsx("span",{className:"sm:hidden",children:"❮❮"})]}),e.jsxs("button",{onClick:()=>T(l-1),disabled:l===1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:[e.jsx("span",{className:"hidden sm:inline",children:"Anterior"}),e.jsx("span",{className:"sm:hidden",children:"❮"})]}),e.jsx("div",{className:"hidden sm:flex items-center gap-2",children:Array.from({length:Math.min(5,P)},(k,G)=>{let J;return P<=5?J=G+1:J=Math.max(1,Math.min(l-2,P-4))+G,e.jsx("button",{onClick:()=>T(J),className:`px-3 py-1 text-sm border rounded ${l===J?"bg-blue-500 text-white":"hover:bg-gray-100"}`,children:J},J)})}),e.jsx("div",{className:"flex sm:hidden items-center gap-1",children:Array.from({length:Math.min(3,P)},(k,G)=>{let J;return P<=3?J=G+1:J=Math.max(1,Math.min(l-1,P-2))+G,e.jsx("button",{onClick:()=>T(J),className:`px-2 py-1 text-xs border rounded ${l===J?"bg-blue-500 text-white":"hover:bg-gray-100"}`,children:J},`mobile-${J}`)})}),e.jsxs("button",{onClick:()=>T(l+1),disabled:l===P,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx("span",{className:"sm:hidden",children:"❯"})]}),e.jsxs("button",{onClick:()=>T(P),disabled:l===P,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 whitespace-nowrap",children:[e.jsx("span",{className:"hidden sm:inline",children:"Última"}),e.jsx("span",{className:"sm:hidden",children:"❯❯"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Servicio"}),e.jsx("th",{className:"hidden sm:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Particular"}),e.jsx("th",{className:"hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Seguro"}),e.jsx("th",{className:"hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Convenio"}),e.jsx("th",{className:"hidden md:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map(k=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex items-center mb-1 sm:mb-0",children:[e.jsx("span",{className:"text-lg mr-2",children:k.fuente==="medicamentos"?"💊":k.fuente==="examenes_laboratorio"?"🔬":"🏥"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:K(k.servicio_tipo)})]}),k.fuente&&k.fuente!=="tarifas"&&e.jsx("span",{className:"ml-0 sm:ml-2 px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full",children:k.fuente==="medicamentos"?"Desde Farmacia":"Desde Laboratorio"}),e.jsx("div",{className:"sm:hidden mt-2 text-sm font-medium text-gray-900",children:k.descripcion})]})}),e.jsx("td",{className:"hidden sm:table-cell px-6 py-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:k.descripcion})}),e.jsxs("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.jsxs("div",{className:"font-medium",children:["S/ ",parseFloat(k.precio_particular).toFixed(2)]}),e.jsxs("div",{className:"block lg:hidden text-xs text-gray-500 mt-1",children:[k.precio_seguro&&e.jsxs("div",{children:["Seguro: S/ ",parseFloat(k.precio_seguro).toFixed(2)]}),k.precio_convenio&&e.jsxs("div",{children:["Convenio: S/ ",parseFloat(k.precio_convenio).toFixed(2)]})]})]}),e.jsx("td",{className:"hidden lg:table-cell px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:k.precio_seguro?`S/ ${parseFloat(k.precio_seguro).toFixed(2)}`:"-"}),e.jsx("td",{className:"hidden lg:table-cell px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:k.precio_convenio?`S/ ${parseFloat(k.precio_convenio).toFixed(2)}`:"-"}),e.jsx("td",{className:"hidden md:table-cell px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>D(k.id,k.activo===1?0:1),className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${k.activo===1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:k.activo===1?"✓ Activo":"✗ Inactivo"})}),e.jsx("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-2 space-y-1 sm:space-y-0",children:[e.jsx("div",{className:"block md:hidden mb-2",children:e.jsx("button",{onClick:()=>D(k.id,k.activo===1?0:1),className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${k.activo===1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:k.activo===1?"✓ Activo":"✗ Inactivo"})}),k.fuente==="medicamentos"?e.jsxs("button",{onClick:()=>window.open("/farmacia-medicamentos","_blank"),className:"text-blue-600 hover:text-blue-900 px-2 sm:px-3 py-1 bg-blue-100 rounded text-xs sm:text-sm",children:["🏥 ",e.jsx("span",{className:"hidden sm:inline",children:"Gestionar en"})," Farmacia"]}):k.fuente==="examenes_laboratorio"?e.jsxs("button",{onClick:()=>window.open("/laboratorio-examenes","_blank"),className:"text-green-600 hover:text-green-900 px-2 sm:px-3 py-1 bg-green-100 rounded text-xs sm:text-sm",children:["🧪 ",e.jsx("span",{className:"hidden sm:inline",children:"Gestionar en"})," Lab"]}):e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-1 sm:space-y-0 sm:space-x-2",children:[e.jsx("button",{onClick:()=>i(k),className:"text-blue-600 hover:text-blue-900 px-2 py-1 bg-blue-100 rounded text-xs sm:text-sm",children:"✏️ Editar"}),e.jsx("button",{onClick:()=>M(k.id,k.descripcion),className:"text-red-600 hover:text-red-900 px-2 py-1 bg-red-100 rounded text-xs sm:text-sm",children:"🗑️ Eliminar"})]})]})})]},k.id))})]})}),z.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay tarifas registradas para este filtro"})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:j?"Editar Tarifa":"Nueva Tarifa"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Servicio *"}),e.jsx("select",{value:c.servicio_tipo,onChange:k=>m({...c,servicio_tipo:k.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:g.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Médico * ",a.length===0&&e.jsx("span",{className:"text-gray-400",children:"(Cargando...)"})]}),e.jsxs("select",{value:c.medico_id,onChange:k=>{const G=k.target.value,J=S(G,c.descripcion_base);m({...c,medico_id:G,descripcion:J})},className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:a.length===0,children:[e.jsx("option",{value:"general",children:"Tarifa General (Todos los médicos)"}),a.map(k=>e.jsxs("option",{value:k.id,children:["Dr(a). ",k.nombre," ",k.apellido||""," - ",k.especialidad||"General"]},k.id))]}),a.length===0&&e.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"⚠️ No se pudieron cargar los médicos. Verifique la conexión."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción Base *"}),e.jsx("input",{type:"text",value:c.descripcion_base,onChange:k=>{const G=k.target.value,J=S(c.medico_id,G);m({...c,descripcion_base:G,descripcion:J})},className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ej: Consulta Especializada, Procedimiento, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción Final (Se genera automáticamente)"}),e.jsx("input",{type:"text",value:c.descripcion,readOnly:!0,className:"w-full border rounded px-3 py-2 bg-gray-100 text-gray-600",placeholder:"Se generará automáticamente al seleccionar médico y descripción base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Particular * (S/)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:c.precio_particular,onChange:k=>m({...c,precio_particular:k.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Seguro (S/) - Opcional"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:c.precio_seguro,onChange:k=>m({...c,precio_seguro:k.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Convenio (S/) - Opcional"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:c.precio_convenio,onChange:k=>m({...c,precio_convenio:k.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:c.activo===1,onChange:k=>m({...c,activo:k.target.checked?1:0}),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Activo"})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-6",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:b,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:j?"Actualizar":"Crear"})]})]})})]})}const rt={administrador:"/usuarios",recepcionista:"/pacientes",enfermero:"/panel-enfermero",medico:"/mis-consultas",laboratorista:"/panel-laboratorio"};function Q({usuario:s,rolesPermitidos:r,children:a}){if(!s)return e.jsx(he,{to:"/",replace:!0});if(r&&!r.includes(s.rol)){const d=rt[s.rol]||"/";return e.jsx(he,{to:d,replace:!0})}return a}function nt({medicamento:s,usuario:r,onClose:a}){const[d,x]=t.useState([]),[w,y]=t.useState(!0),[h,j]=t.useState(null),[N,v]=t.useState({tipo:"entrada",cantidad:1,observaciones:"",usuario_id:""}),[C,l]=t.useState(!1),[_,E]=t.useState([]);t.useEffect(()=>{ue.get(O+"api_medicos.php").then(m=>E(m.data.medicos||[])).catch(()=>E([]))},[]);const o=`${O}api_movimientos_medicamento.php`,g=()=>{y(!0),j(null);let m=o+`?medicamento_id=${s.id}`;fetch(m,{credentials:"include"}).then(async f=>{const S=await f.json();if(!f.ok||S.error)throw new Error(S.error||`Error HTTP: ${f.status}`);return S}).then(x).catch(f=>j(f.message)).finally(()=>y(!1))};t.useEffect(()=>{g()},[s.id]);const n=m=>{const{name:f,value:S}=m.target;v(L=>({...L,[f]:f==="cantidad"?Number(S):S}))},c=m=>{m.preventDefault(),l(!0),fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({medicamento_id:s.id,tipo:N.tipo,cantidad:N.cantidad,usuario_id:r?.id?Number(r.id):1,medico_id:N.usuario_id?Number(N.usuario_id):null,observaciones:N.observaciones})}).then(f=>f.json()).then(()=>{v({tipo:"entrada",cantidad:1,observaciones:"",usuario_id:""}),g()}).finally(()=>l(!1))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-2xl w-full p-6 relative",children:[e.jsx("button",{onClick:a,className:"absolute top-2 right-2 text-gray-500 hover:text-black",children:"✕"}),e.jsx("h2",{className:"text-xl font-bold mb-2 text-center",children:"Historial de Movimientos"}),e.jsxs("div",{className:"mb-4 text-center text-lg font-semibold text-purple-700",children:[s.nombre," (",s.codigo,")"]}),e.jsxs("form",{onSubmit:c,className:"flex flex-wrap gap-2 items-end mb-6",children:[e.jsxs("select",{name:"tipo",value:N.tipo,onChange:n,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"entrada",children:"Entrada"}),e.jsx("option",{value:"salida",children:"Salida"})]}),e.jsx("input",{name:"cantidad",type:"number",min:1,value:N.cantidad,onChange:n,className:"border rounded px-2 py-1 w-24",required:!0}),e.jsxs("select",{name:"usuario_id",value:N.usuario_id,onChange:n,className:"border rounded px-2 py-1 w-56",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona médico responsable"}),_.map(m=>e.jsxs("option",{value:m.id,children:[(m.nombre||"")+(m.apellido?" "+m.apellido:"")," (",m.email,")"]},m.id))]}),e.jsx("input",{name:"observaciones",value:N.observaciones,onChange:n,className:"border rounded px-2 py-1 flex-1",placeholder:"Observaciones"}),e.jsx("button",{type:"submit",disabled:C,className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Registrar"})]}),w?e.jsx("div",{className:"text-center text-gray-500",children:"Cargando movimientos..."}):h?e.jsx("div",{className:"text-center text-red-500",children:h}):e.jsx("div",{className:"overflow-x-auto max-h-72",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200 rounded-lg text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-purple-100",children:[e.jsx("th",{className:"py-1 px-2 border-b",children:"Fecha"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Tipo"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Cantidad"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Usuario"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Médico responsable"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Observaciones"})]})}),e.jsx("tbody",{children:Array.isArray(d)&&d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-3 text-gray-400",children:"Sin movimientos registrados"})}):Array.isArray(d)?d.map(m=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-1 px-2 border-b",children:new Date(m.fecha_hora).toLocaleString()}),e.jsx("td",{className:"py-1 px-2 border-b",children:m.tipo_movimiento}),e.jsx("td",{className:"py-1 px-2 border-b text-right",children:m.cantidad}),e.jsx("td",{className:"py-1 px-2 border-b",children:m.usuario_nombre||m.usuario_id||"-"}),e.jsx("td",{className:"py-1 px-2 border-b",children:(m.medico_nombre||"")+(m.medico_apellido?" "+m.medico_apellido:"")||"-"}),e.jsx("td",{className:"py-1 px-2 border-b",children:m.observaciones})]},m.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-3 text-red-500",children:"Error al cargar movimientos o sesión/rol incorrecto"})})})]})})]})})}function it({initialData:s,onSave:r,onCancel:a}){const[d,x]=t.useState({codigo:s?.codigo||"",nombre:s?.nombre||"",presentacion:s?.presentacion||"",concentracion:s?.concentracion||"",laboratorio:s?.laboratorio||"",stock:s?.stock??0,unidades_por_caja:s?.unidades_por_caja??30,fecha_vencimiento:s?.fecha_vencimiento||"",estado:s?.estado||"activo",precio_compra:s?.precio_compra!==void 0&&s?.precio_compra!==null?String(s.precio_compra):"",margen_ganancia:s?.margen_ganancia!==void 0&&s?.margen_ganancia!==null?String(s.margen_ganancia):"30",id:s?.id||void 0}),[w,y]=t.useState(""),h=N=>{const{name:v,value:C}=N.target;x(l=>v==="stock"||v==="unidades_por_caja"?{...l,[v]:Number(C)}:{...l,[v]:C})},j=async N=>{if(N.preventDefault(),!d.codigo.trim()||!d.nombre.trim()){y("El código y el nombre son obligatorios");return}if(!d.fecha_vencimiento){y("La fecha de vencimiento es obligatoria");return}if(!d.unidades_por_caja||d.unidades_por_caja<1){y("Las unidades por caja deben ser mayor a 0");return}y("");const v={...d,precio_compra:parseFloat(d.precio_compra)||0,margen_ganancia:parseFloat(d.margen_ganancia)||0,unidades_por_caja:parseInt(d.unidades_por_caja)||1};if(r){const C=await r(v);C&&C.error&&C.error.toLowerCase().includes("código ya existe")&&q.fire({icon:"error",title:"Código duplicado",text:C.error,confirmButtonColor:"#e53e3e"})}};return e.jsxs("form",{onSubmit:j,className:"p-4 bg-white rounded shadow max-w-lg mx-auto",children:[e.jsx("h2",{className:"text-lg font-bold mb-4 text-center",children:s?"Editar Medicamento":"Nuevo Medicamento"}),w&&e.jsx("div",{className:"text-red-500 text-center mb-2",children:w}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Código *"}),e.jsx("input",{name:"codigo",value:d.codigo,onChange:h,className:"w-full border rounded px-2 py-1",maxLength:30,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Nombre *"}),e.jsx("input",{name:"nombre",value:d.nombre,onChange:h,className:"w-full border rounded px-2 py-1",maxLength:100,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Presentación"}),e.jsx("input",{name:"presentacion",value:d.presentacion,onChange:h,className:"w-full border rounded px-2 py-1",maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Concentración"}),e.jsx("input",{name:"concentracion",value:d.concentracion,onChange:h,className:"w-full border rounded px-2 py-1",maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Laboratorio"}),e.jsx("input",{name:"laboratorio",value:d.laboratorio,onChange:h,className:"w-full border rounded px-2 py-1",maxLength:100})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Stock (unidades)"}),e.jsx("input",{name:"stock",type:"number",min:0,value:d.stock,onChange:h,className:"w-full border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Unidades por caja *"}),e.jsx("input",{name:"unidades_por_caja",type:"number",min:1,value:d.unidades_por_caja,onChange:h,className:"w-full border rounded px-2 py-1",required:!0}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ejemplo: 30 pastillas por caja, 100 jeringas por caja"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Fecha de vencimiento *"}),e.jsx("input",{name:"fecha_vencimiento",type:"date",value:d.fecha_vencimiento,onChange:h,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Estado"}),e.jsxs("select",{name:"estado",value:d.estado,onChange:h,className:"w-full border rounded px-2 py-1",children:[e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"inactivo",children:"Inactivo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Precio de compra (S/)"}),e.jsx("input",{name:"precio_compra",type:"number",min:0,step:"0.01",value:d.precio_compra!==void 0&&d.precio_compra!==null?String(d.precio_compra):"",onChange:h,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Margen de ganancia (%)"}),e.jsx("input",{name:"margen_ganancia",type:"number",min:0,max:100,step:"0.1",value:d.margen_ganancia!==void 0&&d.margen_ganancia!==null?String(d.margen_ganancia):"",onChange:h,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Precio de venta sugerido (S/)"}),e.jsx("input",{value:Number(d.precio_compra)+Number(d.precio_compra)*Number(d.margen_ganancia)/100,readOnly:!0,className:"w-full border rounded px-2 py-1 bg-gray-100 text-gray-700"})]})]}),e.jsxs("div",{className:"flex justify-center mt-6 gap-2",children:[e.jsx("button",{type:"button",onClick:a,className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Guardar"})]})]})}function Le(){const[s,r]=t.useState(null),[a,d]=t.useState(""),[x,w]=t.useState(""),[y,h]=t.useState(null),[j,N]=t.useState([]),[v,C]=t.useState(!0),[l,_]=t.useState(null),[E,o]=t.useState(!1),[g,n]=t.useState(null),[c,m]=t.useState(""),[f,S]=t.useState(1),[L,i]=t.useState(3),[u,b]=t.useState(!1),[M,D]=t.useState(null),[z,$]=t.useState(""),[P,A]=t.useState(!1),I=()=>{C(!0),_(null);const B=`${O}api_medicamentos.php`;fetch(B,{credentials:"include"}).then(R=>{if(!R.ok)throw new Error("Error al cargar medicamentos");return R.json()}).then(N).catch(_).finally(()=>C(!1))};t.useEffect(()=>{I()},[]);const p=()=>{n(null),o(!0)},T=B=>{n(B),o(!0)},U=B=>{const R=`${O}api_medicamentos.php`;return fetch(R,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)}).then(F=>F.json()).then(F=>F.success?(o(!1),I(),{success:!0}):{error:F.error||"Error al guardar"}).catch(()=>({error:"Error de red o servidor"}))};let K=j.filter(B=>B.nombre.toLowerCase().includes(c.toLowerCase())||B.codigo.toLowerCase().includes(c.toLowerCase()));K.sort((B,R)=>B.id&&R.id?R.id-B.id:0),P&&(K=K.filter(B=>B.estado==="cuarentena")),a&&(K=K.filter(B=>B.fecha_vencimiento&&B.fecha_vencimiento>=a)),x&&(K=K.filter(B=>B.fecha_vencimiento&&B.fecha_vencimiento<=x));const k=Math.ceil(K.length/L),G=K.slice((f-1)*L,f*L),J=B=>{i(Number(B.target.value)),S(1)},Z=B=>{B>=1&&B<=k&&S(B)};return e.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-blue-600 mb-2",children:"💊 Gestión de Medicamentos"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Sistema integral de inventario farmacéutico"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-4 gap-2",children:[e.jsx("input",{type:"text",placeholder:"Buscar por código o nombre...",value:c,onChange:B=>m(B.target.value),className:"border rounded px-3 py-2 w-full sm:w-72"}),e.jsxs("select",{value:L,onChange:J,className:"border rounded px-2 py-2 ml-2",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]}),e.jsx("span",{className:"ml-2 text-sm",children:"por página"}),e.jsxs("button",{onClick:p,className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-lg shadow-lg hover:from-purple-700 hover:to-blue-700 transform hover:scale-105 transition-all duration-200 font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"+"}),"Nuevo Medicamento"]})]}),e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-2 sm:p-4 mb-6 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-base font-semibold text-yellow-900 flex-wrap",children:[e.jsx("span",{className:"inline-block text-yellow-600 mr-1",children:"🗓️"}),e.jsx("label",{className:"text-xs sm:text-base",children:"Filtrar por vencimiento:"}),e.jsx("span",{className:"ml-1 text-xs font-normal text-gray-700",children:"Desde"}),e.jsx("input",{type:"date",value:a,onChange:B=>d(B.target.value),className:"border border-yellow-400 rounded px-1 py-1 focus:ring-2 focus:ring-yellow-300 w-16 sm:w-24 md:w-28"}),e.jsx("span",{className:"ml-1 text-xs font-normal text-gray-700",children:"Hasta"}),e.jsx("input",{type:"date",value:x,onChange:B=>w(B.target.value),className:"border border-yellow-400 rounded px-1 py-1 focus:ring-2 focus:ring-yellow-300 w-16 sm:w-24 md:w-28"}),e.jsx("button",{type:"button",onClick:()=>{d(""),w("")},className:"ml-1 px-2 py-1 rounded bg-yellow-300 text-yellow-900 font-semibold border border-yellow-400 hover:bg-yellow-400 transition text-xs sm:text-sm",title:"Limpiar filtros de vencimiento",children:"Limpiar"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 sm:mt-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:B=>A(B.target.checked)}),"Solo cuarentena"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Medicamentos en cuarentena deben ser llevados a puntos de acopio autorizados (DIGEMID)."})]})]}),v&&e.jsx("div",{className:"text-center text-gray-500",children:"Cargando..."}),l&&e.jsx("div",{className:"text-center text-red-500",children:l.message||"Error"}),!v&&!l&&e.jsxs("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 rounded-lg",children:[e.jsxs("table",{className:"min-w-full bg-white border border-gray-200 rounded-lg text-xs sm:text-sm md:text-base",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white",children:[e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider",children:"Código"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider sm:hidden",children:"Acciones"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider hidden md:table-cell",children:"Presentación"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider hidden lg:table-cell",children:"Concentración"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider hidden xl:table-cell",children:"Laboratorio"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden md:table-cell",children:"Stock"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Vencimiento"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Precio Compra (S/)"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Margen (%)"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Precio Venta (S/)"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Estado"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Acciones"})]})}),e.jsx("tbody",{children:G.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-4 text-gray-400",children:"No hay medicamentos registrados"})}):G.map((B,R)=>{let F=R%2===0?"bg-white":"bg-gray-50",H="";if(B.fecha_vencimiento){const V=new Date,ee=(new Date(B.fecha_vencimiento)-V)/(1e3*60*60*24);ee<0?(H="bg-red-100 border-l-4 border-red-500",F=""):ee<90&&(H="bg-orange-100 border-l-4 border-orange-500",F="")}return e.jsxs("tr",{className:`transition-colors duration-200 hover:bg-purple-100 hover:shadow-sm ${F} ${H}`,children:[e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 font-medium text-gray-900",children:B.codigo}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 font-semibold text-gray-800",children:B.nombre}),e.jsxs("td",{className:"py-3 px-4 border-b border-gray-200 text-center sm:hidden flex flex-row gap-2 justify-center",children:[e.jsx("button",{onClick:()=>r(B),className:"p-2 text-blue-600 hover:text-white hover:bg-blue-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Ver detalles",children:e.jsx(ze,{size:16})}),e.jsx("button",{onClick:()=>T(B),className:"p-2 text-indigo-600 hover:text-white hover:bg-indigo-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Editar",children:e.jsx(we,{size:16})}),e.jsx("button",{onClick:()=>h(B),className:"p-2 text-purple-600 hover:text-white hover:bg-purple-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Historial",children:e.jsx(Ce,{size:16})}),B.estado!=="cuarentena"&&e.jsx("button",{onClick:()=>{D(B),b(!0),$("")},className:"p-2 text-yellow-600 hover:text-white hover:bg-yellow-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Cuarentena",children:e.jsx(ke,{size:16})})]}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 hidden md:table-cell",children:B.presentacion}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 hidden lg:table-cell",children:B.concentracion}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 hidden xl:table-cell",children:B.laboratorio}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 text-right font-medium text-gray-700 hidden md:table-cell",children:B.stock}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 text-center hidden sm:table-cell",children:B.fecha_vencimiento?new Date(B.fecha_vencimiento).toLocaleDateString():"-"}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 text-right font-mono text-sm hidden sm:table-cell",children:B.precio_compra!==void 0?Number(B.precio_compra).toFixed(2):"-"}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 text-right hidden sm:table-cell",children:B.margen_ganancia!==void 0?Number(B.margen_ganancia).toFixed(1):"-"}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 text-right font-semibold text-green-700 font-mono text-sm hidden sm:table-cell",children:B.precio_compra!==void 0&&B.margen_ganancia!==void 0?(Number(B.precio_compra)+Number(B.precio_compra)*Number(B.margen_ganancia)/100).toFixed(2):"-"}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 hidden sm:table-cell font-medium text-center "+(B.estado==="cuarentena"?"bg-yellow-200 text-yellow-900 font-bold":""),children:B.estado==="cuarentena"?"CUARENTENA":B.estado}),e.jsxs("td",{className:"py-3 px-4 border-b border-gray-200 text-center gap-2 justify-center hidden sm:table-cell",children:[e.jsx("button",{onClick:()=>T(B),className:"p-2 text-indigo-600 hover:text-white hover:bg-indigo-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Editar",children:e.jsx(we,{size:16})}),e.jsx("button",{onClick:()=>h(B),className:"p-2 text-purple-600 hover:text-white hover:bg-purple-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Historial",children:e.jsx(Ce,{size:16})}),B.estado!=="cuarentena"&&e.jsx("button",{onClick:()=>{D(B),b(!0),$("")},className:"p-2 text-yellow-600 hover:text-white hover:bg-yellow-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Cuarentena",children:e.jsx(ke,{size:16})})]})]},B.id)})})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-xs w-full relative",children:[e.jsx("button",{onClick:()=>r(null),className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-xl",children:"×"}),e.jsx("h2",{className:"text-lg font-bold mb-2 text-blue-800",children:"Detalles del Medicamento"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Código:"})," ",s.codigo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",s.nombre]}),e.jsxs("div",{children:[e.jsx("b",{children:"Presentación:"})," ",s.presentacion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Concentración:"})," ",s.concentracion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Laboratorio:"})," ",s.laboratorio]}),e.jsxs("div",{children:[e.jsx("b",{children:"Stock:"})," ",s.stock]}),e.jsxs("div",{children:[e.jsx("b",{children:"Vencimiento:"})," ",s.fecha_vencimiento?new Date(s.fecha_vencimiento).toLocaleDateString():"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Precio compra:"})," S/"," ",s.precio_compra!==void 0?Number(s.precio_compra).toFixed(2):"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Margen ganancia:"})," ",s.margen_ganancia!==void 0?Number(s.margen_ganancia).toFixed(1):"-","%"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Precio venta:"})," S/"," ",s.precio_compra!==void 0&&s.margen_ganancia!==void 0?(Number(s.precio_compra)+Number(s.precio_compra)*Number(s.margen_ganancia)/100).toFixed(2):"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Estado:"})," ",s.estado]})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full relative",children:[e.jsx("h2",{className:"text-lg font-bold mb-2 text-yellow-800",children:"Enviar a cuarentena"}),e.jsxs("p",{className:"mb-2 text-sm",children:["Medicamento: ",e.jsx("b",{children:M?.nombre})," (",M?.codigo,")"]}),e.jsxs("label",{className:"block mb-2 text-sm",children:["Motivo de cuarentena ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{className:"w-full border rounded px-2 py-1 mb-4",rows:3,value:z,onChange:B=>$(B.target.value),required:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>b(!1),className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Cancelar"}),e.jsx("button",{className:"bg-yellow-600 text-white px-4 py-2 rounded",disabled:!z.trim(),onClick:async()=>{if(!M)return;const B=`${O}api_medicamentos.php`,R=new Date().toISOString().slice(0,10),F={...M,estado:"cuarentena",fecha_cuarentena:R,motivo_cuarentena:z};await fetch(B,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)}),b(!1),D(null),$(""),I()},children:"Confirmar"})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Página ",f," de ",k," (",K.length," ","resultados)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Z(1),disabled:f===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"«"}),e.jsx("button",{onClick:()=>Z(f-1),disabled:f===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"‹"}),e.jsx("span",{className:"px-2 py-1",children:f}),e.jsx("button",{onClick:()=>Z(f+1),disabled:f===k||k===0,className:"px-2 py-1 border rounded disabled:opacity-50",children:"›"}),e.jsx("button",{onClick:()=>Z(k),disabled:f===k||k===0,className:"px-2 py-1 border rounded disabled:opacity-50",children:"»"})]})]})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-0 max-w-lg w-full relative",children:e.jsx(it,{initialData:g,onSave:U,onCancel:()=>o(!1)})})}),y&&e.jsx(nt,{medicamento:y,usuario:null,onClose:()=>{h(null),I()}})]})}function ge(){const s=()=>{if(n.length===0){U("Selecciona al menos un medicamento.");return}const F=n.map(H=>{const V=_.find(se=>se.id===H),ae=S[H]||"unidad",ee=m[H]||1,xe=i[H]||30,ie=K(V);let le=0,X=V&&V.nombre&&V.nombre!=="0"?V.nombre:"Medicamento sin nombre";return ae==="caja"?(le=ie*xe*ee,X+=" (Caja)"):(le=ie*ee,X+=" (Unidad)"),{servicio_tipo:"farmacia",servicio_id:H,descripcion:X,cantidad:ee,precio_unitario:ie,subtotal:le}});x(F),y(R()),a(!0)},[r,a]=t.useState(!1),[d,x]=t.useState([]),[w,y]=t.useState(0),h=ne(),j=de(),[N,v]=t.useState(!1),[C,l]=t.useState(!1),[_,E]=t.useState([]),[o,g]=t.useState(""),[n,c]=t.useState([]),[m,f]=t.useState({}),[S,L]=t.useState({}),[i,u]=t.useState({}),b=j.pacienteId||null,[M,D]=t.useState(null),[z,$]=t.useState(""),[P,A]=t.useState(""),[I,p]=t.useState(""),[T,U]=t.useState("");t.useEffect(()=>{fetch(`${O}api_medicamentos.php`,{credentials:"include"}).then(F=>F.json()).then(F=>{E(F.medicamentos||F||[]);const H={};(F.medicamentos||F||[]).forEach(V=>{H[V.id]=V.unidades_por_caja||30}),u(H)})},[]),t.useEffect(()=>{b&&fetch(`${O}api_pacientes.php?id=${b}`).then(F=>F.json()).then(F=>{F.success&&F.paciente&&D({id:F.paciente.id,dni:F.paciente.dni,nombre:(F.paciente.nombres||F.paciente.nombre||"")+" "+(F.paciente.apellidos||F.paciente.apellido||""),historia_clinica:F.paciente.historia_clinica||""})})},[b]);const K=F=>{if(!F)return 0;const H=Number(F.precio_compra||0),V=Number(F.margen_ganancia||0);return H+H*V/100},k=_.filter(F=>F.nombre.toLowerCase().includes(o.toLowerCase())||F.codigo&&F.codigo.toLowerCase().includes(o.toLowerCase())),G=F=>{c(H=>H.includes(F)?H:[...H,F]),f(H=>({...H,[F]:1})),L(H=>({...H,[F]:"unidad"}))},J=F=>{c(H=>H.filter(V=>V!==F)),f(H=>{const V={...H};return delete V[F],V}),L(H=>{const V={...H};return delete V[F],V})},Z=(F,H)=>{f(V=>({...V,[F]:H}))},B=(F,H)=>{L(V=>({...V,[F]:H})),H==="caja"&&f(V=>({...V,[F]:1}))},R=()=>n.reduce((F,H)=>{const V=_.find(xe=>xe.id===H),ae=m[H]||1,ee=S[H]||"unidad";return V?ee==="caja"?F+K(V)*i[H]*ae:F+K(V)*ae:F},0);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 bg-white rounded-2xl shadow-2xl mt-8 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-blue-900 flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"medicamentos",children:"💊"}),"Cotizador de Medicamentos"]}),e.jsx("button",{className:"bg-blue-100 text-blue-800 px-4 py-2 rounded font-semibold border border-blue-300 hover:bg-blue-200 transition",onClick:()=>{b?h("/seleccionar-servicio",{state:{pacienteId:b}}):h("/seleccionar-servicio")},children:"← Volver a Servicios"})]}),e.jsxs("div",{className:"mb-4",children:[!j.pacienteId&&e.jsx(Fe,{onPacienteEncontrado:F=>{D({id:F.id,dni:F.dni||"",nombre:((F.nombre||"")+" "+(F.apellido||"")).trim(),historia_clinica:F.historia_clinica||""}),$(""),A(""),p(""),l(!0),U("")},onNoEncontrado:()=>{D(null),v(!0),l(!0),U("Paciente no encontrado. Verifica el DNI, nombre o historia clínica.")},onNuevaBusqueda:()=>{D(null),v(!1),l(!1)}}),!j.pacienteId&&!b&&!z&&!N&&C&&!M&&e.jsx("button",{className:"mt-2 px-3 py-1 bg-yellow-100 text-yellow-800 rounded border border-yellow-300 text-sm",onClick:()=>v(!0),children:"Paciente no encontrado"}),!j.pacienteId&&N&&!b&&e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx("input",{type:"text",value:z,onChange:F=>$(F.target.value),placeholder:"DNI",className:"border px-2 py-1 rounded w-32"}),e.jsx("input",{type:"text",value:P,onChange:F=>A(F.target.value),placeholder:"Nombres",className:"border px-2 py-1 rounded w-40",required:!0}),e.jsx("input",{type:"text",value:I,onChange:F=>p(F.target.value),placeholder:"Apellidos",className:"border px-2 py-1 rounded w-40",required:!0})]}),(b||z)&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded text-blue-800 text-sm",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",M?`${M.nombre} (DNI: ${M.dni})`:`${P} ${I} (DNI: ${z})`]})]}),e.jsxs("div",{className:"mb-4 flex gap-2 items-center",children:[e.jsx("span",{className:"text-blue-700 text-xl",children:"🔍"}),e.jsx("input",{type:"text",value:o,onChange:F=>g(F.target.value),placeholder:"Buscar medicamento...",className:"border px-3 py-2 rounded-lg w-full max-w-md focus:ring-2 focus:ring-blue-300"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:_.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No hay medicamentos registrados en el sistema."}):k.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-8",children:['Sin coincidencias para "',o,'".']}):e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:k.map(F=>{const H=i[F.id]||30,V=F.stock,ae=Math.floor(V/H);return e.jsxs("li",{className:"flex items-center gap-4 py-3 px-2 hover:bg-blue-50 rounded-lg transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"🧪"}),F.nombre]}),e.jsxs("div",{className:"text-xs text-gray-500 flex gap-2 items-center",children:[e.jsxs("span",{children:["📦 ",ae," cajas"]}),e.jsxs("span",{children:["💊 ",V," unidades"]}),e.jsxs("span",{children:["💲 S/ ",K(F).toFixed(2)," / unidad"]})]})]}),n.includes(F.id)?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:S[F.id]||"unidad",onChange:ee=>B(F.id,ee.target.value),className:"border rounded-lg px-2 py-1 mr-2 bg-white",children:[e.jsx("option",{value:"unidad",children:"Unidad"}),e.jsx("option",{value:"caja",children:"Caja"})]}),S[F.id]==="caja"?e.jsx("input",{type:"number",min:1,max:ae,value:m[F.id]||1,onChange:ee=>Z(F.id,Math.max(1,Math.min(ae,Number(ee.target.value)))),className:"border rounded-lg px-2 w-16 bg-white"}):e.jsx("input",{type:"number",min:1,max:V,value:m[F.id]||1,onChange:ee=>Z(F.id,Math.max(1,Math.min(V,Number(ee.target.value)))),className:"border rounded-lg px-2 w-16 bg-white"}),e.jsx("button",{onClick:()=>J(F.id),className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-xl shadow transition","aria-label":"Quitar",children:e.jsx(Be,{})})]}):e.jsx("button",{onClick:()=>G(F.id),className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-100 hover:bg-green-200 text-green-700 text-xl shadow transition","aria-label":"Agregar",children:e.jsx(Oe,{})})]},F.id)})})})}),e.jsxs("div",{className:"col-span-1 md:sticky md:top-24 md:ml-8 w-full md:w-96",children:[n.length>0&&!r&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotización"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:n.map(F=>{const H=_.find(be=>be.id===F),V=S[F]||"unidad",ae=m[F]||1,ee=i[F]||30,xe=K(H);let ie=0,le=H?.nombre||"";return V==="caja"?(ie=xe*ee*ae,le+=" (Caja)"):(ie=xe*ae,le+=" (Unidad)"),e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"💊"}),le]}),e.jsxs("span",{children:[ae," ",V==="caja"?"caja(s)":"unidad(es)"]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",ie.toFixed(2)]})]},F)})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",R().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>{c([]),U("")},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:s,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Registrar Venta"})]})]}),r&&(M&&M.nombre&&M.dni&&M.historia_clinica?e.jsx(me,{paciente:M,servicio:{key:"farmacia",label:"Farmacia"},detalles:d,total:w,onCobroCompleto:()=>{a(!1),c([]),f({}),U("Venta procesada correctamente.")},onCancelar:()=>a(!1)}):C?e.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-lg font-semibold text-center",children:"Faltan datos completos del paciente (nombre, DNI y historia clínica). Por favor, ingrésalos antes de continuar con el cobro."}):null)]})]})}),T&&e.jsx("div",{className:`mt-4 text-center font-semibold ${T.includes("registrada")?"text-green-600":"text-red-600"}`,children:T})]})}function lt(){const{pacienteId:s}=de(),r=ne(),[a,d]=t.useState([]),[x,w]=t.useState([]),[y,h]=t.useState({}),[j,N]=t.useState(!1),[v,C]=t.useState([]),[l,_]=t.useState(0),[E,o]=t.useState(""),[g,n]=t.useState(null);t.useEffect(()=>{fetch(`${O}api_tarifas.php`,{credentials:"include"}).then(i=>i.json()).then(i=>{const u=(i.tarifas||[]).filter(b=>(b.servicio_tipo==="procedimiento"||b.servicio_tipo==="procedimientos")&&b.activo===1);d(u)}),fetch(`${O}api_pacientes.php?id=${s}`).then(i=>i.json()).then(i=>{i.success&&i.paciente&&n(i.paciente)}),w([]),h({}),N(!1),o("")},[s]);const c=i=>{w(u=>u.includes(i)?u:[...u,i]),h(u=>({...u,[i]:1}))},m=i=>{w(u=>u.filter(b=>b!==i)),h(u=>{const b={...u};return delete b[i],b})},f=(i,u)=>{h(b=>({...b,[i]:u}))},S=()=>x.reduce((i,u)=>{const b=a.find(D=>D.id===u),M=y[u]||1;return b?i+b.precio_particular*M:i},0),L=()=>{if(x.length===0){o("Selecciona al menos un procedimiento.");return}const i=x.map(u=>{const b=a.find(z=>z.id===u),M=y[u]||1;let D=b&&b.descripcion?b.descripcion:b&&b.nombre?b.nombre:"";return(D===0||D==="0"||D===null||D===void 0)&&(D=b&&b.nombre?b.nombre:""),b?{servicio_tipo:"procedimiento",servicio_id:u,descripcion:D,cantidad:M,precio_unitario:b.precio_particular,subtotal:b.precio_particular*M}:null}).filter(Boolean);C(i),_(S()),N(!0)};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 md:p-8 bg-white rounded-xl shadow-lg mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"🛠️"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Cotización de Procedimientos"})]}),e.jsx("button",{onClick:()=>r("/seleccionar-servicio",{state:{pacienteId:s}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"})]}),e.jsx("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:e.jsxs("div",{className:"text-gray-600",children:[e.jsx("b",{children:"ID Paciente:"})," ",s]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Selecciona los procedimientos:"}),a.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No hay procedimientos para mostrar."}):e.jsx("div",{className:"bg-white rounded-lg shadow border border-gray-200",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:a.map(i=>e.jsxs("li",{className:"flex items-center px-4 py-3 hover:bg-blue-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:x.includes(i.id),onChange:()=>x.includes(i.id)?m(i.id):c(i.id),className:"mr-3 accent-orange-600 w-5 h-5"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"font-semibold text-gray-800",children:i.descripcion||i.nombre})}),e.jsxs("div",{className:"font-bold text-green-700 text-lg",children:["S/ ",i.precio_particular]}),x.includes(i.id)&&e.jsx("input",{type:"number",min:1,value:y[i.id]||1,onChange:u=>f(i.id,Math.max(1,Number(u.target.value))),className:"border rounded-lg px-2 w-16 bg-white ml-2"})]},i.id))})})]})}),e.jsxs("div",{className:"w-full md:w-96 md:sticky md:top-8 h-fit",children:[x.length>0&&!j&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotización"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:x.map(i=>{const u=a.find(M=>M.id===i),b=y[i]||1;return u?e.jsxs("li",{className:"py-2 flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx("div",{children:e.jsx("span",{className:"font-medium text-gray-900",children:u.descripcion||u.nombre})}),e.jsxs("div",{className:"font-bold text-green-700 text-right",children:["S/ ",(u.precio_particular*b).toFixed(2)]})]},i):null})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",S().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>{w([]),o("")},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:L,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Cotizar"})]})]}),j&&e.jsx(me,{paciente:g,servicio:{key:"procedimiento",label:"Procedimiento"},detalles:v,total:l,onCobroCompleto:()=>{N(!1),w([]),h({}),o("Cotización procesada correctamente.")},onCancelar:()=>N(!1)})]})]}),E&&e.jsx("div",{className:`mt-6 text-center font-semibold ${E.includes("correctamente")?"text-green-600":"text-red-600"}`,children:E})]})}function ot(){const[s,r]=t.useState(!1),[a,d]=t.useState(null),[x,w]=t.useState([]),[y,h]=t.useState(""),[j,N]=t.useState(""),{pacienteId:v}=de(),C=ne(),[l,_]=t.useState(null),[E,o]=t.useState(!0),[g,n]=t.useState(""),[c,m]=t.useState(1),[f,S]=t.useState(3);if(t.useEffect(()=>{m(1)},[f]),t.useEffect(()=>{fetch(`${O}api_consumos_paciente.php?paciente_id=${v}`,{credentials:"include"}).then(A=>A.json()).then(A=>{A.success?_(A):n(A.error||"Error al cargar consumo"),o(!1)}).catch(()=>{n("Error de conexión con el servidor"),o(!1)})},[v]),E)return e.jsx(ye,{});if(g)return e.jsx("div",{className:"text-red-600 font-bold p-6",children:g});let L=l.historial;function i(A){return A.split(" ")[0]}y&&(L=L.filter(A=>i(A.fecha)>=y)),j&&(L=L.filter(A=>i(A.fecha)<=j));function u(A){const I={};return A.forEach(p=>{const T=i(p.fecha)+"_"+p.monto+"_"+p.servicio;I[T]||(I[T]={fecha:p.fecha,servicio:p.servicio,montoTotal:0,detalles:[]}),I[T].detalles.push(p),I[T].montoTotal+=Number(p.monto)}),Object.values(I)}const M=u(L).length,D=Math.max(1,Math.ceil(M/f)),z=(c-1)*f,$=z+f;function P(){if(!a||!x)return;const A=new Date(a.fecha).toLocaleString("es-PE"),I=l.apellido?`${l.nombre} ${l.apellido}`:l.nombre,p=a.tipo_pago?a.tipo_pago.toUpperCase():a.detalles&&a.detalles[0]?.tipo_pago?a.detalles[0].tipo_pago.toUpperCase():"EFECTIVO",T=a.cobertura?a.cobertura.toUpperCase():a.detalles&&a.detalles[0]?.cobertura?a.detalles[0].cobertura.toUpperCase():"PARTICULAR",U=`
      <div style="font-family: monospace; width: 320px; margin: 0 auto;">
        <h3 style="text-align: center; margin-bottom: 10px;">🏥 CLÍNICA 2 DE MAYO</h3>
        <hr>
        <p><strong>COMPROBANTE DE PAGO #${a.cobro_id||""}</strong></p>
        <p>Fecha: ${A}</p>
        <p>Paciente: ${I}</p>
        <p>DNI: ${l.dni}</p>
        <p>H.C.: ${l.historia_clinica}</p>
        <hr>
        <p><strong>DETALLE:</strong></p>
        ${x.map(K=>`<p>${K.descripcion} x${K.cantidad||1} .... S/ ${(K.subtotal||K.monto).toFixed(2)}</p>`).join("")}
        <hr>
        <p style="font-weight:bold; font-size:17px; color:#008000;">TOTAL: S/ ${x.reduce((K,k)=>K+Number(k.subtotal||k.monto),0).toFixed(2)}</p>
        <p>Tipo de pago: ${p}</p>
        <p>Cobertura: ${T}</p>
        <hr>
        <div style="text-align: center; font-size: 12px;">Gracias por su preferencia<br>Conserve este comprobante</div>
      </div>
    `;q.fire({title:"Ticket de Cobro",html:U,icon:"info",confirmButtonText:"Imprimir",showCancelButton:!0,cancelButtonText:"Cerrar"}).then(K=>{if(K.isConfirmed){const k=window.open("","_blank","width=400,height=600");k.document.write(`<html><head><title>Ticket</title></head><body>${U}</body></html>`),k.document.close(),k.print()}})}return e.jsxs("div",{className:"max-w-3xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8 font-sans",children:[s&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-red-600 text-xl font-bold",onClick:()=>r(!1),children:"×"}),e.jsx("h3",{className:"text-lg font-bold mb-2 text-blue-800",children:"Detalle del Cobro"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Fecha:"})," ",a.fecha,e.jsx("br",{})]}),e.jsxs("table",{className:"min-w-full border rounded mb-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1 border text-left",children:"Servicio"}),e.jsx("th",{className:"px-2 py-1 border text-left",children:"Descripción"}),e.jsx("th",{className:"px-2 py-1 border text-right",children:"Monto (S/)"})]})}),e.jsx("tbody",{children:x.map((A,I)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:A.servicio_tipo||a.servicio}),e.jsx("td",{className:"border px-2 py-1",children:A.descripcion&&A.descripcion!=="0"?A.descripcion:e.jsx("span",{className:"italic text-gray-500",children:"Sin detalle"})}),e.jsx("td",{className:"border px-2 py-1 text-right",children:Number(A.subtotal||A.monto).toFixed(2)})]},I))})]}),e.jsxs("div",{className:"font-bold text-right text-green-700 text-lg mb-4",children:["Total: S/ ",x.reduce((A,I)=>A+Number(I.subtotal||I.monto),0).toFixed(2)]}),e.jsx("button",{className:"w-full py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded shadow",onClick:P,children:"Imprimir ticket"})]})}),e.jsx("button",{onClick:()=>C(-1),className:"mb-4 bg-gradient-to-r from-blue-200 to-purple-200 px-4 py-2 rounded hover:bg-blue-300 flex items-center gap-2 text-blue-900 font-semibold",children:"← Volver"}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Re,{className:"text-3xl text-blue-700"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Consumo del Paciente"})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-2 gap-4 bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"ID:"})," ",l.paciente_id," ",e.jsx("br",{}),e.jsx("span",{className:"font-semibold text-gray-700",children:"Nombre:"})," ",l.nombre," ",l.apellido," ",e.jsx("br",{}),e.jsx("span",{className:"font-semibold text-gray-700",children:"DNI:"})," ",l.dni]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Historia Clínica:"})," ",l.historia_clinica," ",e.jsx("br",{}),e.jsxs("span",{className:"inline-flex items-center gap-2 font-bold text-green-700 text-lg mt-2",children:[e.jsx(_e,{className:"text-2xl"}),"Consumo Total: S/ ",l.consumo_total.toFixed(2)]}),l.deuda_total>0&&e.jsxs("span",{className:"inline-flex items-center gap-2 font-bold text-red-600 text-lg mt-2 ml-4",children:[e.jsx(_e,{className:"text-2xl"}),"Deuda: S/ ",l.deuda_total.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-8 mb-2",children:[e.jsx(He,{className:"text-xl text-purple-700"}),e.jsx("h4",{className:"font-semibold text-lg text-purple-800",children:"Historial de Servicios"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"fechaInicio",className:"font-semibold text-gray-700",children:"Desde:"}),e.jsx("input",{type:"date",id:"fechaInicio",value:y,onChange:A=>h(A.target.value),className:"border rounded px-2 py-1 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"fechaFin",className:"font-semibold text-gray-700",children:"Hasta:"}),e.jsx("input",{type:"date",id:"fechaFin",value:j,onChange:A=>N(A.target.value),className:"border rounded px-2 py-1 text-sm"})]}),e.jsx("button",{onClick:()=>{h(""),N("")},className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 font-semibold",children:"Limpiar Filtros"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border rounded-lg shadow-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-purple-100",children:[e.jsx("th",{className:"px-3 py-2 border text-left",children:"Fecha"}),e.jsx("th",{className:"px-3 py-2 border text-left",children:"Servicio"}),e.jsx("th",{className:"px-3 py-2 border text-left",children:"Descripción"}),e.jsx("th",{className:"px-3 py-2 border text-right",children:"Monto (S/)"})]})}),e.jsx("tbody",{children:l.historial.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-6 text-gray-500",children:"No hay servicios registrados."})}):l.historial.slice(z,$).map((A,I)=>e.jsxs("tr",{className:I%2===0?"bg-white":"bg-blue-50",children:[e.jsx("td",{className:"border px-3 py-2",children:A.fecha}),e.jsx("td",{className:"border px-3 py-2",children:e.jsxs("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold ${A.servicio==="consulta"?"bg-green-100 text-green-700":A.servicio==="laboratorio"?"bg-yellow-100 text-yellow-700":A.servicio==="farmacia"?"bg-purple-100 text-purple-700":A.servicio==="procedimiento"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:[A.servicio,A.servicio==="laboratorio"&&A.resultados_laboratorio&&e.jsx("button",{className:"ml-2 text-purple-700 hover:text-purple-900",title:"Descargar resultados",onClick:()=>window.open(A.resultados_laboratorio,"_blank"),children:e.jsx("span",{role:"img","aria-label":"descargar",children:"📥"})})]})}),e.jsx("td",{className:"border px-3 py-2",children:e.jsx("button",{className:"px-3 py-1 bg-blue-100 hover:bg-blue-200 rounded text-blue-900 font-semibold text-xs shadow",onClick:()=>{d(A),w(A.detalles),r(!0)},children:"Ver detalle"})}),e.jsx("td",{className:"border px-3 py-2 text-right font-semibold text-green-700",children:Number(A.monto).toFixed(2)})]},I))})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-semibold text-gray-700",children:"Filas por página:"}),e.jsxs("select",{id:"itemsPerPage",value:f,onChange:A=>S(Number(A.target.value)),className:"border rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]}),D>1&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:`px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-sm font-semibold ${c===1?"opacity-50 cursor-not-allowed":""}`,onClick:()=>m(c-1),disabled:c===1,children:"Anterior"}),e.jsxs("span",{className:"font-semibold text-blue-700",children:["Página ",c," de ",D]}),e.jsx("button",{className:`px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-sm font-semibold ${c===D?"opacity-50 cursor-not-allowed":""}`,onClick:()=>m(c+1),disabled:c===D,children:"Siguiente"})]})]})]})}function ct(){const[s,r]=t.useState([]),[a,d]=t.useState(!0),[x,w]=t.useState(null),[y,h]=t.useState([]),[j,N]=t.useState(!1),[v,C]=t.useState(""),[l,_]=t.useState(""),[E,o]=t.useState(1),[g,n]=t.useState(3),[c,m]=t.useState(0),f=()=>{d(!0);let u=`${O}api_cotizaciones_farmacia.php`;const b=[`page=${E}`,`limit=${g}`];let M=v,D=l;(M&&!D||!M&&D)&&(M=M||D,D=D||M),M&&D&&(b.push(`fecha_inicio=${M}`),b.push(`fecha_fin=${D}`)),u+="?"+b.join("&"),fetch(u,{credentials:"include"}).then(z=>{if(!z.ok)throw new Error(`Error HTTP: ${z.status}`);return z.json()}).then(z=>{r(z.cotizaciones||[]),m(z.total||0),d(!1)}).catch(z=>{d(!1),console.error("Error al cargar ventas:",z),alert("Error al cargar ventas: "+z.message)})};t.useEffect(()=>{f()},[v,l,E,g]);const S=u=>{w(u),N(!0),fetch(`${O}api_cotizaciones_farmacia.php?cotizacion_id=${u.id}`,{credentials:"include"}).then(b=>b.json()).then(b=>{h(b.cotizacion?.detalles||[])})},L=()=>{const u=new je;u.text("Ventas de Farmacia",14,14),Ne(u,{head:[["Fecha","Paciente","DNI","Usuario","Total","Estado"]],body:s.map(b=>[b.fecha,b.paciente_nombre||"-",b.paciente_dni||"-",b.usuario_nombre||b.usuario_id,b.total,b.estado])}),u.save("ventas_farmacia.pdf")},i=()=>{const u=ce.json_to_sheet(s.map(M=>({Fecha:M.fecha,Paciente:M.paciente_nombre||"-",DNI:M.paciente_dni||"-",Usuario:M.usuario_nombre||M.usuario_id,Total:M.total,Estado:M.estado}))),b=ce.book_new();ce.book_append_sheet(b,u,"Ventas"),Ie(b,"ventas_farmacia.xlsx")};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-800 mb-4",children:"Ventas de Farmacia"}),e.jsxs("div",{className:"flex gap-4 mb-4 items-center",children:[e.jsxs("label",{className:"text-sm",children:["Mostrar:",e.jsxs("select",{value:g,onChange:u=>{n(Number(u.target.value)),o(1)},className:"ml-2 border rounded px-2 py-1",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]}),e.jsx("button",{className:"px-3 py-1 bg-green-600 text-white rounded",onClick:L,children:"Exportar PDF"}),e.jsx("button",{className:"px-3 py-1 bg-amber-500 text-white rounded",onClick:i,children:"Exportar Excel"}),e.jsxs("label",{className:"text-sm",children:["Desde:",e.jsx("input",{type:"date",value:v,onChange:u=>C(u.target.value),className:"ml-2 border rounded px-2 py-1"})]}),e.jsxs("label",{className:"text-sm",children:["Hasta:",e.jsx("input",{type:"date",value:l,onChange:u=>_(u.target.value),className:"ml-2 border rounded px-2 py-1"})]}),e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded",onClick:f,children:"Filtrar"}),(v||l)&&e.jsx("button",{className:"px-2 py-1 bg-gray-200 text-gray-700 rounded",onClick:()=>{C(""),_("")},children:"Limpiar"})]}),a?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Cargando ventas..."}):s.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No hay ventas registradas."}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-50",children:[e.jsx("th",{className:"p-2",children:"Fecha"}),e.jsx("th",{className:"p-2",children:"Paciente"}),e.jsx("th",{className:"p-2",children:"DNI"}),e.jsx("th",{className:"p-2",children:"Usuario"}),e.jsx("th",{className:"p-2",children:"Total"}),e.jsx("th",{className:"p-2",children:"Estado"}),e.jsx("th",{className:"p-2",children:"Detalle"})]})}),e.jsx("tbody",{children:s.map(u=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:u.fecha}),e.jsx("td",{className:"p-2",children:u.paciente_nombre||u.paciente_nombre||"-"}),e.jsx("td",{className:"p-2",children:u.paciente_dni||"-"}),e.jsx("td",{className:"p-2",children:u.usuario_nombre||u.usuario_id}),e.jsxs("td",{className:"p-2 font-bold text-blue-700",children:["S/ ",u.total]}),e.jsx("td",{className:"p-2",children:u.estado}),e.jsx("td",{className:"p-2",children:e.jsx("button",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded",onClick:()=>S(u),children:"Ver"})})]},u.id))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("span",{className:"text-sm",children:["Página ",E," de ",Math.max(1,Math.ceil(c/g))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded",disabled:E===1,onClick:()=>o(E-1),children:"Anterior"}),e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded",disabled:E>=Math.ceil(c/g),onClick:()=>o(E+1),children:"Siguiente"})]})]})]}),j&&x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 text-xl",onClick:()=>N(!1),children:"✕"}),e.jsx("h3",{className:"text-xl font-bold mb-2 text-blue-700",children:"Detalle de Venta"}),e.jsxs("div",{className:"mb-2 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Paciente:"})," ",x.paciente_nombre||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",x.paciente_dni||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Usuario:"})," ",x.usuario_nombre||x.usuario_id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Fecha:"})," ",x.fecha]}),e.jsxs("div",{children:[e.jsx("b",{children:"Total:"})," S/ ",x.total]})]}),e.jsxs("table",{className:"w-full text-sm border mb-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-50",children:[e.jsx("th",{className:"p-2",children:"Medicamento"}),e.jsx("th",{className:"p-2",children:"Cantidad"}),e.jsx("th",{className:"p-2",children:"Precio Unitario"}),e.jsx("th",{className:"p-2",children:"Subtotal"})]})}),e.jsx("tbody",{children:y.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:u.descripcion}),e.jsx("td",{className:"p-2",children:u.cantidad}),e.jsxs("td",{className:"p-2",children:["S/ ",u.precio_unitario]}),e.jsxs("td",{className:"p-2",children:["S/ ",u.subtotal]})]},u.id))})]})]})})]})}function dt(){const s=fe(),r=ne(),[a,d]=t.useState(null),x=s.state?.pacienteId,[w,y]=t.useState([]);return t.useEffect(()=>{fetch(O+"api_tarifas.php",{credentials:"include"}).then(h=>h.json()).then(h=>{if(h.success&&Array.isArray(h.tarifas)){const j=["consulta","laboratorio","farmacia","ecografia","rayosx","ocupacional"],N=h.tarifas.filter(v=>v.activo===1&&!j.includes(v.servicio_tipo)).map(v=>({key:v.servicio_tipo+"_"+v.id,label:v.descripcion,tarifaId:v.id}));y(N)}})},[]),t.useEffect(()=>{x&&fetch(`${O}api_pacientes.php?id=${x}`).then(h=>h.json()).then(h=>{h.success&&h.paciente?d(h.paciente):d(null)})},[x]),e.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-blue-400 rounded-t-xl p-4 mb-0",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"🗂️"})," Atención en Recepción"]}),e.jsx("p",{className:"text-white text-sm",children:"Gestión de pacientes y servicios"})]}),e.jsxs("div",{className:"bg-white rounded-b-xl shadow p-4",children:[e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded font-bold hover:bg-blue-600 mb-4",onClick:()=>r("/"),children:"Volver al Dashboard"}),a?e.jsxs("div",{className:"bg-blue-50 rounded p-4 mb-4",children:[e.jsx("div",{className:"font-bold text-blue-800 mb-2",children:"Paciente encontrado:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",a.nombre]}),e.jsxs("div",{children:[e.jsx("b",{children:"Apellido:"})," ",a.apellido]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",a.dni]}),e.jsxs("div",{children:[e.jsx("b",{children:"Fecha de nacimiento:"})," ",a.fecha_nacimiento]}),e.jsxs("div",{children:[e.jsx("b",{children:"Sexo:"})," ",a.sexo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Dirección:"})," ",a.direccion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Teléfono:"})," ",a.telefono]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",a.email]}),e.jsxs("div",{children:[e.jsx("b",{children:"Tipo de seguro:"})," ",a.tipo_seguro]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Historia Clínica:"})," ",a.historia_clinica]}),e.jsxs("div",{children:[e.jsx("b",{children:"Edad:"})," ",a.edad?a.edad+" años":a.fecha_nacimiento?(()=>{const h=new Date(a.fecha_nacimiento);return isNaN(h)?"Edad no disponible":Math.floor((new Date-h)/(365.25*24*60*60*1e3))+" años"})():"Edad no disponible"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Procedencia:"})," ",a.procedencia]})]})]})]}):e.jsx("div",{className:"text-center text-gray-500 mb-4",children:"Busca un paciente por DNI para mostrar los servicios."}),a&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-2",children:[e.jsxs("div",{className:"font-semibold text-blue-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"🔽"})," Seleccionar Servicio para: ",e.jsxs("span",{className:"text-black",children:[a.nombre," ",a.apellido]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-100 font-bold",onClick:()=>r("/agendar-consulta",{state:{pacienteId:a.id}}),children:"👨‍⚕️ Consulta Médica"}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-green-100 font-bold",onClick:()=>r(`/cotizar-laboratorio/${a.id}`),children:["🧪 Laboratorio ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-purple-100 font-bold",onClick:()=>r(`/cotizar-farmacia/${a.id}`),children:["💊 Farmacia ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-50 font-bold",onClick:()=>r(`/cotizar-rayosx/${a.id}`),children:["🩻 Rayos X ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-50 font-bold",onClick:()=>r(`/cotizar-ecografia/${a.id}`),children:["🩺 Ecografías ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-orange-100 font-bold",onClick:()=>r(`/cotizar-procedimientos/${a.id}`),children:["🛠️ Procedimientos ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-50 font-bold",onClick:()=>{q.fire({title:"Página en construcción",text:"La funcionalidad de Medicina Ocupacional estará disponible próximamente.",icon:"info",confirmButtonText:"OK"})},children:["👨‍⚕️ Medicina Ocupacional ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 flex gap-4 items-center",children:[e.jsx("span",{children:"💰 = Requiere pago previo"}),e.jsx("span",{children:"📅 = Agendar primero, cobrar después"})]})]})]})]})})}function xt(){const[s,r]=t.useState(()=>{const d=sessionStorage.getItem("usuario"),x=sessionStorage.getItem("medico");return d?JSON.parse(d):x?JSON.parse(x):null}),a=async()=>{try{await fetch("/policlinico-2demayo/api_logout.php",{method:"POST",credentials:"include"})}catch(d){console.error("Error al cerrar sesión en el backend:",d)}r(null),sessionStorage.removeItem("usuario"),sessionStorage.removeItem("medico"),window.location.href="/"};return t.useEffect(()=>{s&&(s.rol==="medico"?(sessionStorage.setItem("medico",JSON.stringify(s)),sessionStorage.removeItem("usuario")):(sessionStorage.setItem("usuario",JSON.stringify(s)),sessionStorage.removeItem("medico")))},[s]),e.jsx(Ve,{children:s?e.jsx(es,{usuario:s,onLogout:a,children:e.jsxs(We,{children:[e.jsx(Y,{path:"/",element:s?.rol==="medico"?e.jsx(he,{to:"/mis-consultas",replace:!0}):s?.rol==="laboratorista"?e.jsx(he,{to:"/panel-laboratorio",replace:!0}):s?.rol==="enfermero"?e.jsx(he,{to:"/panel-enfermero",replace:!0}):s?.rol==="químico"||s?.rol==="quimico"?e.jsx(he,{to:"/medicamentos",replace:!0}):e.jsx(is,{usuario:s})}),e.jsx(Y,{path:"/pacientes",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(ls,{})})}),e.jsx(Y,{path:"/usuarios",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(os,{})})}),e.jsx(Y,{path:"/agendar-consulta",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(xs,{})})}),s?.rol==="medico"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{path:"/mis-consultas",element:e.jsx(Q,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(hs,{usuario:s})})}),e.jsx(Y,{path:"/panel-medico",element:e.jsx(Q,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(ws,{})})}),e.jsx(Y,{path:"/historia-clinica/:pacienteId",element:e.jsx(Q,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Ee,{})})}),e.jsx(Y,{path:"/historia-clinica/:pacienteId/:consultaId",element:e.jsx(Q,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Ee,{})})}),e.jsx(Y,{path:"/historial-consultas",element:e.jsx(Q,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(zs,{medicoId:s.id})})}),e.jsx(Y,{path:"/solicitud-laboratorio/:consultaId",element:e.jsx(Q,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Ws,{})})}),e.jsx(Y,{path:"/resultados-laboratorio/:consultaId",element:e.jsx(Q,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Ys,{})})})]}),(s?.rol==="químico"||s?.rol==="quimico")&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{path:"/medicamentos",element:e.jsx(Q,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(Le,{})})}),e.jsx(Y,{path:"/farmacia/cotizador",element:e.jsx(Q,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(ge,{})})}),e.jsx(Y,{path:"/farmacia/ventas",element:e.jsx(Q,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(ct,{})})})]}),s?.rol==="enfermero"&&e.jsx(Y,{path:"/panel-enfermero",element:e.jsx(Q,{usuario:s,rolesPermitidos:["enfermero"],children:e.jsx(Hs,{})})}),(s?.rol==="administrador"||s?.rol==="recepcionista")&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{path:"/medicos",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(Ns,{})})}),e.jsx(Y,{path:"/reportes",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Qs,{})})}),e.jsx(Y,{path:"/lista-consultas",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Zs,{})})}),e.jsx(Y,{path:"/reporte-pacientes",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(et,{})})}),e.jsx(Y,{path:"/reporte-finanzas",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(st,{})})}),e.jsx(Y,{path:"/configuracion",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(tt,{})})}),e.jsx(Y,{path:"/gestion-tarifas",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(at,{})})}),e.jsx(Y,{path:"/cotizar-laboratorio/:pacienteId",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(qs,{})})}),e.jsx(Y,{path:"/cotizar-rayosx/:pacienteId",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Gs,{})})}),e.jsx(Y,{path:"/cotizar-ecografia/:pacienteId",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Us,{})})}),e.jsx(Y,{path:"/cotizar-farmacia/:pacienteId",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(ge,{})})}),e.jsx(Y,{path:"/cotizar-procedimientos/:pacienteId",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(lt,{})})}),e.jsx(Y,{path:"/seleccionar-servicio",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(dt,{})})}),e.jsx(Y,{path:"/consumo-paciente/:pacienteId",element:e.jsx(Q,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(ot,{})})})]}),s?.rol==="laboratorista"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{path:"/panel-laboratorio",element:e.jsx(Q,{usuario:s,rolesPermitidos:["laboratorista"],children:e.jsx(Ks,{})})}),e.jsx(Y,{path:"/examenes-laboratorio",element:e.jsx(Q,{usuario:s,rolesPermitidos:["laboratorista"],children:e.jsx(Ge,{})})})]}),(s?.rol==="químico"||s?.rol==="quimico")&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{path:"/medicamentos",element:e.jsx(Q,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(Le,{})})}),e.jsx(Y,{path:"/farmacia/cotizador",element:e.jsx(Q,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(ge,{})})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-800 via-blue-500 to-green-400",children:e.jsx(Ke,{onLogin:r})})})}class mt extends pe.Component{constructor(r){super(r),this.state={hasError:!1}}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,a){console.error("Error capturado por ErrorBoundary:",r,a)}render(){return this.state.hasError?e.jsxs("div",{className:"max-w-md mx-auto mt-6 p-4 bg-red-100 text-red-700 rounded shadow text-center",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"¡Ups! Algo salió mal."}),e.jsx("p",{children:"Por favor, recarga la página o intenta más tarde."})]}):this.props.children}}qe.createRoot(document.getElementById("root")).render(e.jsx(pe.StrictMode,{children:e.jsx(mt,{children:e.jsx(xt,{})})}));
