import{r as s,q as se,j as e,S as f,x as ne,y as X,z as Y,A as Z,D as oe}from"./vendor-B5yQt2qK.js";import{B as E}from"./examenes-laboratorio-crud-BJk1fG4Z.js";function ie({medicamento:n,usuario:i,onClose:c}){const T=async t=>{if((await f.fire({title:"¬øEliminar movimiento?",text:"Esta acci√≥n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"S√≠, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33"})).isConfirmed)try{const v=await(await fetch(A,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:t.id})})).json();v.success?(await f.fire("¬°Eliminado!","El movimiento ha sido eliminado correctamente.","success"),F()):await f.fire("Error",v.error||"No se pudo eliminar el movimiento.","error")}catch{await f.fire("Error","Error de red o servidor","error")}},[a,M]=s.useState([]),[l,m]=s.useState(1),[o,L]=s.useState(3),[N,x]=s.useState(!0),[p,_]=s.useState(null),[h,z]=s.useState({tipo:"entrada",cantidad:1,observaciones:"",usuario_id:""}),[B,q]=s.useState(!1),[V,C]=s.useState([]);s.useEffect(()=>{se.get(E+"api_medicos.php").then(t=>C(t.data.medicos||[])).catch(()=>C([]))},[]);const A=`${E}api_movimientos_medicamento.php`,F=()=>{x(!0),_(null);let t=A+`?medicamento_id=${n.id}`;fetch(t,{credentials:"include"}).then(async u=>{const y=await u.json();if(!u.ok||y.error)throw new Error(y.error||`Error HTTP: ${u.status}`);return y}).then(M).catch(u=>_(u.message)).finally(()=>x(!1))};s.useEffect(()=>{F()},[n.id]);const w=t=>{const{name:u,value:y}=t.target;z(v=>({...v,[u]:u==="cantidad"?Number(y):y}))},I=t=>{t.preventDefault(),q(!0),fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({medicamento_id:n.id,tipo:h.tipo,cantidad:h.cantidad,usuario_id:i?.id?Number(i.id):1,medico_id:h.usuario_id?Number(h.usuario_id):null,observaciones:h.observaciones})}).then(u=>u.json()).then(()=>{z({tipo:"entrada",cantidad:1,observaciones:"",usuario_id:""}),F()}).finally(()=>q(!1))},d=Math.ceil(a.length/o),S=a.slice((l-1)*o,l*o);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-screen-2xl w-[98vw] p-10 relative",children:[e.jsx("button",{onClick:c,className:"absolute top-2 right-2 text-gray-500 hover:text-black",children:"‚úï"}),e.jsx("h2",{className:"text-xl font-bold mb-2 text-center",children:"Historial de Movimientos"}),e.jsxs("div",{className:"mb-4 text-center text-lg font-semibold text-purple-700",children:[n.nombre," (",n.codigo,")"]}),e.jsxs("form",{onSubmit:I,className:"flex flex-wrap gap-2 items-end mb-6",children:[e.jsxs("select",{name:"tipo",value:h.tipo,onChange:w,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"entrada",children:"Entrada"}),e.jsx("option",{value:"salida",children:"Salida"})]}),e.jsx("input",{name:"cantidad",type:"number",min:1,value:h.cantidad,onChange:w,className:"border rounded px-2 py-1 w-24",required:!0}),e.jsxs("select",{name:"usuario_id",value:h.usuario_id,onChange:w,className:"border rounded px-2 py-1 w-56",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona responsable"}),i&&e.jsxs("option",{value:i.id,children:[i.nombre,i.rol?` (${i.rol})`:""]}),V.map(t=>e.jsxs("option",{value:t.id,children:[t.nombre," ",t.apellido," (",t.email,")"]},t.id))]}),e.jsx("input",{name:"observaciones",value:h.observaciones,onChange:w,className:"border rounded px-2 py-1 flex-1",placeholder:"Observaciones"}),e.jsx("button",{type:"submit",disabled:B,className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Registrar"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"Mostrar:"}),e.jsxs("select",{value:o,onChange:t=>{L(Number(t.target.value)),m(1)},className:"border rounded px-2 py-1",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]}),e.jsx("span",{className:"text-sm",children:"por p√°gina"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(1),disabled:l===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"¬´"}),e.jsx("button",{onClick:()=>m(l-1),disabled:l===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"‚Äπ"}),e.jsx("span",{className:"px-2 py-1",children:l}),e.jsx("button",{onClick:()=>m(l+1),disabled:l===d||d===0,className:"px-2 py-1 border rounded disabled:opacity-50",children:"‚Ä∫"}),e.jsx("button",{onClick:()=>m(d),disabled:l===d||d===0,className:"px-2 py-1 border rounded disabled:opacity-50",children:"¬ª"})]})]}),N?e.jsx("div",{className:"text-center text-gray-500",children:"Cargando movimientos..."}):p?e.jsx("div",{className:"text-center text-red-500",children:p}):e.jsx("div",{className:"overflow-x-auto max-h-72",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200 rounded-lg text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-purple-100",children:[e.jsx("th",{className:"py-1 px-2 border-b",children:"Fecha"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Tipo"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Cantidad"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Usuario"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"M√©dico responsable"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Observaciones"})]})}),e.jsx("tbody",{children:Array.isArray(S)&&S.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-3 text-gray-400",children:"Sin movimientos registrados"})}):Array.isArray(S)?S.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-1 px-2 border-b",children:new Date(t.fecha_hora).toLocaleString()}),e.jsx("td",{className:"py-1 px-2 border-b",children:t.tipo_movimiento}),e.jsx("td",{className:"py-1 px-2 border-b text-right",children:t.cantidad}),e.jsx("td",{className:"py-1 px-2 border-b",children:t.usuario_nombre||t.usuario_id||"-"}),e.jsx("td",{className:"py-1 px-2 border-b",children:t.medico_nombre&&t.medico_apellido?`${t.medico_nombre} ${t.medico_apellido}`:t.medico_nombre||"-"}),e.jsxs("td",{className:"py-1 px-2 border-b flex gap-2 items-center",children:[e.jsx("span",{children:t.observaciones}),e.jsx("button",{title:"Eliminar movimiento",className:"ml-2 px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-xs",onClick:()=>T(t),children:"Eliminar"})]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-3 text-red-500",children:"Error al cargar movimientos o sesi√≥n/rol incorrecto"})})})]})})]})})}function le({initialData:n,onSave:i,onCancel:c}){function T(){return"MED"+Math.floor(1e4+Math.random()*9e4)}const[a,M]=s.useState({codigo:n?.codigo||(n?"":T()),nombre:n?.nombre||"",presentacion:n?.presentacion||"",concentracion:n?.concentracion||"",laboratorio:n?.laboratorio||"",stock:n?.stock??0,unidades_por_caja:n?.unidades_por_caja??30,fecha_vencimiento:n?.fecha_vencimiento||"",estado:n?.estado||"activo",precio_compra:n?.precio_compra!==void 0&&n?.precio_compra!==null?String(n.precio_compra):"",margen_ganancia:n?.margen_ganancia!==void 0&&n?.margen_ganancia!==null?String(n.margen_ganancia):"30",id:n?.id||void 0}),[l,m]=s.useState(""),o=N=>{const{name:x,value:p}=N.target;M(_=>x==="stock"||x==="unidades_por_caja"?{..._,[x]:Number(p)}:{..._,[x]:p})},L=async N=>{if(N.preventDefault(),!a.codigo.trim()||!a.nombre.trim()){m("El c√≥digo y el nombre son obligatorios");return}if(!a.fecha_vencimiento){m("La fecha de vencimiento es obligatoria");return}if(!a.unidades_por_caja||a.unidades_por_caja<1){m("Las unidades por caja deben ser mayor a 0");return}m("");const x={...a,precio_compra:parseFloat(a.precio_compra)||0,margen_ganancia:parseFloat(a.margen_ganancia)||0,unidades_por_caja:parseInt(a.unidades_por_caja)||1};if(i){const p=await i(x);p&&p.error&&p.error.toLowerCase().includes("c√≥digo ya existe")&&f.fire({icon:"error",title:"C√≥digo duplicado",text:p.error,confirmButtonColor:"#e53e3e"})}};return e.jsx("div",{className:"flex justify-center items-center w-full h-full",children:e.jsxs("form",{onSubmit:L,className:"p-10 bg-white rounded-2xl shadow-2xl w-[95vw] max-w-5xl mx-auto",children:[e.jsx("h2",{className:"text-lg font-bold mb-4 text-center",children:n?"Editar Medicamento":"Nuevo Medicamento"}),l&&e.jsx("div",{className:"text-red-500 text-center mb-2",children:l}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"C√≥digo *"}),e.jsx("input",{name:"codigo",value:a.codigo,onChange:o,className:"w-full border rounded px-2 py-1",maxLength:30,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Nombre *"}),e.jsx("input",{name:"nombre",value:a.nombre,onChange:o,className:"w-full border rounded px-2 py-1",maxLength:100,required:!0,autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Presentaci√≥n"}),e.jsx("input",{name:"presentacion",value:a.presentacion,onChange:o,className:"w-full border rounded px-2 py-1",maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Concentraci√≥n"}),e.jsx("input",{name:"concentracion",value:a.concentracion,onChange:o,className:"w-full border rounded px-2 py-1",maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Laboratorio"}),e.jsx("input",{name:"laboratorio",value:a.laboratorio,onChange:o,className:"w-full border rounded px-2 py-1",maxLength:100})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Stock (unidades)"}),e.jsx("input",{name:"stock",type:"number",min:0,value:a.stock,onChange:o,className:"w-full border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Unidades por caja *"}),e.jsx("input",{name:"unidades_por_caja",type:"number",min:1,value:a.unidades_por_caja!==void 0&&a.unidades_por_caja!==null?a.unidades_por_caja:"",onChange:o,className:"w-full border rounded px-2 py-1",required:!0}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ejemplo: 30 pastillas por caja, 100 jeringas por caja"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Fecha de vencimiento *"}),e.jsx("input",{name:"fecha_vencimiento",type:"date",value:a.fecha_vencimiento,onChange:o,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Estado"}),e.jsxs("select",{name:"estado",value:a.estado,onChange:o,className:"w-full border rounded px-2 py-1",children:[e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"inactivo",children:"Inactivo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Precio de compra (S/)"}),e.jsx("input",{name:"precio_compra",type:"number",min:0,step:"0.01",value:a.precio_compra!==void 0&&a.precio_compra!==null?String(a.precio_compra):"",onChange:o,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Margen de ganancia (%)"}),e.jsx("input",{name:"margen_ganancia",type:"number",min:0,max:100,step:"0.1",value:a.margen_ganancia!==void 0&&a.margen_ganancia!==null?String(a.margen_ganancia):"",onChange:o,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Precio de venta sugerido (S/)"}),e.jsx("input",{value:Number(a.precio_compra)+Number(a.precio_compra)*Number(a.margen_ganancia)/100,readOnly:!0,className:"w-full border rounded px-2 py-1 bg-gray-100 text-gray-700"})]})]}),e.jsxs("div",{className:"flex justify-center mt-6 gap-2",children:[e.jsx("button",{type:"button",onClick:c,className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Guardar"})]})]})})}function de(){const[n,i]=s.useState(null);return s.useEffect(()=>{fetch(E+"api_auth_status.php",{credentials:"include"}).then(c=>c.json()).then(c=>{c.success&&c.authenticated?i({id:c.usuario_id,nombre:c.nombre,rol:c.rol,usuario:c.usuario}):i(null)}).catch(()=>i(null))},[]),n}function ue(){const[n,i]=s.useState(!1),c=async r=>{if(!(await f.fire({title:`¬øSeguro que deseas eliminar el medicamento "${r.nombre}"?`,text:"Esta acci√≥n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"S√≠, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33"})).isConfirmed)return;i(!0);const g=`${E}api_medicamentos.php`;try{const P=await(await fetch(g,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r.id})})).json();P.success?(await f.fire("¬°Eliminado!","El medicamento ha sido eliminado correctamente.","success"),$()):P.error&&P.error.includes("foreign key constraint fails")?await f.fire({title:"No se puede eliminar",text:"Este medicamento tiene movimientos registrados. Elimina primero los movimientos asociados antes de borrar el medicamento.",icon:"error",confirmButtonText:"Entendido",confirmButtonColor:"#3085d6"}):await f.fire("Error",P.error||"Error al eliminar","error")}catch{await f.fire("Error","Error de red o servidor","error")}i(!1)},T=de(),[a,M]=s.useState(null),[l,m]=s.useState(""),[o,L]=s.useState(""),[N,x]=s.useState(null),[p,_]=s.useState([]),[h,z]=s.useState(!0),[B,q]=s.useState(null),[V,C]=s.useState(!1),[A,F]=s.useState(null),[w,I]=s.useState(""),[d,S]=s.useState(1),[t,u]=s.useState(3),[y,v]=s.useState(!1),[D,J]=s.useState(null),[R,O]=s.useState(""),[G,ee]=s.useState(!1),$=()=>{z(!0),q(null);const r=`${E}api_medicamentos.php`;fetch(r,{credentials:"include"}).then(b=>{if(!b.ok)throw new Error("Error al cargar medicamentos");return b.json()}).then(_).catch(q).finally(()=>z(!1))};s.useEffect(()=>{$()},[]);const re=()=>{F(null),C(!0)},K=r=>{F(r),C(!0)},ae=r=>{const b=`${E}api_medicamentos.php`;return fetch(b,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(g=>g.json()).then(g=>g.success?(C(!1),$(),{success:!0}):{error:g.error||"Error al guardar"}).catch(()=>({error:"Error de red o servidor"}))};let j=p.filter(r=>r.nombre.toLowerCase().includes(w.toLowerCase())||r.codigo.toLowerCase().includes(w.toLowerCase()));j.sort((r,b)=>r.id&&b.id?b.id-r.id:0),G&&(j=j.filter(r=>r.estado==="cuarentena")),l&&(j=j.filter(r=>r.fecha_vencimiento&&r.fecha_vencimiento>=l)),o&&(j=j.filter(r=>r.fecha_vencimiento&&r.fecha_vencimiento<=o));const k=Math.ceil(j.length/t),Q=j.slice((d-1)*t,d*t),te=r=>{u(Number(r.target.value)),S(1)},U=r=>{r>=1&&r<=k&&S(r)};return e.jsxs("div",{className:"w-full mx-auto px-0 sm:px-4 md:px-8 lg:px-16 xl:px-32 2xl:px-0 py-10",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-blue-600 mb-2",children:"üíä"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Sistema integral de inventario farmac√©utico"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-4 gap-2",children:[e.jsx("input",{type:"text",placeholder:"Buscar por c√≥digo o nombre...",value:w,onChange:r=>I(r.target.value),className:"border rounded px-3 py-2 w-full sm:w-72"}),e.jsxs("select",{value:t,onChange:te,className:"border rounded px-2 py-2 ml-2",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]}),e.jsx("span",{className:"ml-2 text-sm",children:"por p√°gina"}),e.jsxs("button",{onClick:re,className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-lg shadow-lg hover:from-purple-700 hover:to-blue-700 transform hover:scale-105 transition-all duration-200 font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"+"}),"Nuevo Medicamento"]})]}),e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-2 sm:p-4 mb-6 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-base font-semibold text-yellow-900 flex-wrap",children:[e.jsx("span",{className:"inline-block text-yellow-600 mr-1",children:"üóìÔ∏è"}),e.jsx("label",{className:"text-xs sm:text-base",children:"Filtrar por vencimiento:"}),e.jsx("span",{className:"ml-1 text-xs font-normal text-gray-700",children:"Desde"}),e.jsx("input",{type:"date",value:l,onChange:r=>m(r.target.value),className:"border border-yellow-400 rounded px-1 py-1 focus:ring-2 focus:ring-yellow-300 w-16 sm:w-24 md:w-28"}),e.jsx("span",{className:"ml-1 text-xs font-normal text-gray-700",children:"Hasta"}),e.jsx("input",{type:"date",value:o,onChange:r=>L(r.target.value),className:"border border-yellow-400 rounded px-1 py-1 focus:ring-2 focus:ring-yellow-300 w-16 sm:w-24 md:w-28"}),e.jsx("button",{type:"button",onClick:()=>{m(""),L("")},className:"ml-1 px-2 py-1 rounded bg-yellow-300 text-yellow-900 font-semibold border border-yellow-400 hover:bg-yellow-400 transition text-xs sm:text-sm",title:"Limpiar filtros de vencimiento",children:"Limpiar"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 sm:mt-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm",children:[e.jsx("input",{type:"checkbox",checked:G,onChange:r=>ee(r.target.checked)}),"Solo cuarentena"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Medicamentos en cuarentena deben ser llevados a puntos de acopio autorizados (DIGEMID)."})]})]}),h&&e.jsx("div",{className:"text-center text-gray-500",children:"Cargando..."}),B&&e.jsx("div",{className:"text-center text-red-500",children:B.message||"Error"}),!h&&!B&&e.jsxs("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 rounded-lg",children:[e.jsxs("table",{className:"w-full bg-white border border-gray-200 rounded-lg text-xs sm:text-sm md:text-base",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white",children:[e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider",children:"C√≥digo"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider sm:hidden",children:"Acciones"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider hidden md:table-cell",children:"Presentaci√≥n"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider hidden lg:table-cell",children:"Concentraci√≥n"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider hidden xl:table-cell",children:"Laboratorio"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden md:table-cell",children:"Stock"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Vencimiento"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Precio Compra (S/)"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Margen (%)"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Precio Venta (S/)"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Estado"}),e.jsx("th",{className:"py-3 px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Acciones"})]})}),e.jsx("tbody",{children:Q.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-4 text-gray-400",children:"No hay medicamentos registrados"})}):Q.map((r,b)=>{let g=b%2===0?"bg-white":"bg-gray-50",H="";if(r.fecha_vencimiento){const P=new Date,W=(new Date(r.fecha_vencimiento)-P)/(1e3*60*60*24);W<0?(H="bg-red-100 border-l-4 border-red-500",g=""):W<90&&(H="bg-orange-100 border-l-4 border-orange-500",g="")}return e.jsxs("tr",{className:`transition-colors duration-200 hover:bg-purple-100 hover:shadow-sm ${g} ${H}`,children:[e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 font-medium text-gray-900",children:r.codigo}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 font-semibold text-gray-800",children:r.nombre}),e.jsxs("td",{className:"py-3 px-4 border-b border-gray-200 text-center sm:hidden flex flex-row gap-2 justify-center",children:[e.jsx("button",{onClick:()=>M(r),className:"p-2 text-blue-600 hover:text-white hover:bg-blue-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Ver detalles",children:e.jsx(ne,{size:16})}),e.jsx("button",{onClick:()=>K(r),className:"p-2 text-indigo-600 hover:text-white hover:bg-indigo-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Editar",children:e.jsx(X,{size:16})}),e.jsx("button",{onClick:()=>x(r),className:"p-2 text-purple-600 hover:text-white hover:bg-purple-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Historial",children:e.jsx(Y,{size:16})}),r.estado!=="cuarentena"&&e.jsx("button",{onClick:()=>{J(r),v(!0),O("")},className:"p-2 text-yellow-600 hover:text-white hover:bg-yellow-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Cuarentena",children:e.jsx(Z,{size:16})})]}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 hidden md:table-cell",children:r.presentacion}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 hidden lg:table-cell",children:r.concentracion}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 hidden xl:table-cell",children:r.laboratorio}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 text-right font-medium text-gray-700 hidden md:table-cell",children:r.stock}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 text-center hidden sm:table-cell",children:r.fecha_vencimiento?new Date(r.fecha_vencimiento).toLocaleDateString():"-"}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 text-right font-mono text-sm hidden sm:table-cell",children:r.precio_compra!==void 0?Number(r.precio_compra).toFixed(2):"-"}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 text-right hidden sm:table-cell",children:r.margen_ganancia!==void 0?Number(r.margen_ganancia).toFixed(1):"-"}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 text-right font-semibold text-green-700 font-mono text-sm hidden sm:table-cell",children:r.precio_compra!==void 0&&r.margen_ganancia!==void 0?(Number(r.precio_compra)+Number(r.precio_compra)*Number(r.margen_ganancia)/100).toFixed(2):"-"}),e.jsx("td",{className:"py-3 px-4 border-b border-gray-200 hidden sm:table-cell font-medium text-center "+(r.estado==="cuarentena"?"bg-yellow-200 text-yellow-900 font-bold":""),children:r.estado==="cuarentena"?"CUARENTENA":r.estado}),e.jsxs("td",{className:"py-3 px-4 border-b border-gray-200 text-center gap-2 justify-center hidden sm:table-cell",children:[e.jsx("button",{onClick:()=>K(r),className:"p-2 text-indigo-600 hover:text-white hover:bg-indigo-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Editar",children:e.jsx(X,{size:16})}),e.jsx("button",{onClick:()=>x(r),className:"p-2 text-purple-600 hover:text-white hover:bg-purple-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Historial",children:e.jsx(Y,{size:16})}),r.estado!=="cuarentena"&&e.jsx("button",{onClick:()=>{J(r),v(!0),O("")},className:"p-2 text-yellow-600 hover:text-white hover:bg-yellow-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Cuarentena",children:e.jsx(Z,{size:16})}),e.jsx("button",{onClick:()=>c(r),className:"p-2 text-red-600 hover:text-white hover:bg-red-600 rounded-md transition-all duration-200 transform hover:scale-105",title:"Eliminar",disabled:n,children:e.jsx(oe,{size:16})})]})]},r.id)})})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-xs w-full relative",children:[e.jsx("button",{onClick:()=>M(null),className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-xl",children:"√ó"}),e.jsx("h2",{className:"text-lg font-bold mb-2 text-blue-800",children:"Detalles del Medicamento"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("b",{children:"C√≥digo:"})," ",a.codigo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",a.nombre]}),e.jsxs("div",{children:[e.jsx("b",{children:"Presentaci√≥n:"})," ",a.presentacion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Concentraci√≥n:"})," ",a.concentracion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Laboratorio:"})," ",a.laboratorio]}),e.jsxs("div",{children:[e.jsx("b",{children:"Stock:"})," ",a.stock]}),e.jsxs("div",{children:[e.jsx("b",{children:"Vencimiento:"})," ",a.fecha_vencimiento?new Date(a.fecha_vencimiento).toLocaleDateString():"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Precio compra:"})," S/"," ",a.precio_compra!==void 0?Number(a.precio_compra).toFixed(2):"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Margen ganancia:"})," ",a.margen_ganancia!==void 0?Number(a.margen_ganancia).toFixed(1):"-","%"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Precio venta:"})," S/"," ",a.precio_compra!==void 0&&a.margen_ganancia!==void 0?(Number(a.precio_compra)+Number(a.precio_compra)*Number(a.margen_ganancia)/100).toFixed(2):"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Estado:"})," ",a.estado]})]})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full relative",children:[e.jsx("h2",{className:"text-lg font-bold mb-2 text-yellow-800",children:"Enviar a cuarentena"}),e.jsxs("p",{className:"mb-2 text-sm",children:["Medicamento: ",e.jsx("b",{children:D?.nombre})," (",D?.codigo,")"]}),e.jsxs("label",{className:"block mb-2 text-sm",children:["Motivo de cuarentena ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{className:"w-full border rounded px-2 py-1 mb-4",rows:3,value:R,onChange:r=>O(r.target.value),required:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>v(!1),className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Cancelar"}),e.jsx("button",{className:"bg-yellow-600 text-white px-4 py-2 rounded",disabled:!R.trim(),onClick:async()=>{if(!D)return;const r=`${E}api_medicamentos.php`,b=new Date().toISOString().slice(0,10),g={...D,estado:"cuarentena",fecha_cuarentena:b,motivo_cuarentena:R};await fetch(r,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}),v(!1),J(null),O(""),$()},children:"Confirmar"})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["P√°gina ",d," de ",k," (",j.length," ","resultados)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>U(1),disabled:d===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"¬´"}),e.jsx("button",{onClick:()=>U(d-1),disabled:d===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"‚Äπ"}),e.jsx("span",{className:"px-2 py-1",children:d}),e.jsx("button",{onClick:()=>U(d+1),disabled:d===k||k===0,className:"px-2 py-1 border rounded disabled:opacity-50",children:"‚Ä∫"}),e.jsx("button",{onClick:()=>U(k),disabled:d===k||k===0,className:"px-2 py-1 border rounded disabled:opacity-50",children:"¬ª"})]})]})]}),V&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-0 max-w-5xl w-[95vw] flex items-center justify-center",children:e.jsx(le,{initialData:A,onSave:ae,onCancel:()=>C(!1)})})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-0 max-w-5xl w-[95vw] flex items-center justify-center",children:e.jsx(ie,{medicamento:N,usuario:T,onClose:()=>{x(null),$()}})})})]})}export{ue as default};
