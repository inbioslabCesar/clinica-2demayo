import{r as n,S as i,j as e}from"./vendor-B5yQt2qK.js";import{B as j,M as T}from"./examenes-laboratorio-crud-BJk1fG4Z.js";const N={titulo:"",descripcion:"",precio_antes:"",precio_oferta:"",fecha_inicio:"",fecha_fin:"",imagen_url:"",orden:0,activo:!0};function I(){const[v,h]=n.useState(!0),[x,w]=n.useState([]),[y,c]=n.useState(!1),[t,r]=n.useState(N),[d,b]=n.useState(null),[m,u]=n.useState(null),p=n.useMemo(()=>`${j}api_web_ofertas.php`,[]),_=n.useMemo(()=>`${j}api_web_ofertas_upload.php`,[]),f=n.useCallback(async()=>{h(!0);try{const s=await(await fetch(p,{credentials:"include"})).json();if(!s?.success)throw new Error(s?.error||"No se pudo cargar");w(s.ofertas||[])}catch(a){i.fire("Error",a?.message||"Error al cargar ofertas","error")}finally{h(!1)}},[p]);n.useEffect(()=>{f()},[f]);function C(){b(null),r(N),u(null),c(!0)}function E(a){b(a.id),r({titulo:a.titulo||"",descripcion:a.descripcion||"",precio_antes:a.precio_antes??"",precio_oferta:a.precio_oferta??"",fecha_inicio:a.fecha_inicio||"",fecha_fin:a.fecha_fin||"",imagen_url:a.imagen_url||"",orden:a.orden??0,activo:!!a.activo}),u(null),c(!0)}async function S(){if(!m)return null;const a=(m.name||"").toLowerCase();if(!(a.endsWith(".png")||a.endsWith(".jpg")||a.endsWith(".jpeg")))throw new Error("La imagen debe ser PNG o JPG");const s=new FormData;s.append("imagen",m);const o=await fetch(_,{method:"POST",body:s,credentials:"include"}),l=await o.json().catch(()=>null);if(!o.ok||!l?.success)throw new Error(l?.error||"No se pudo subir la imagen");return l.url}async function k(a){a.preventDefault();try{const s=await S(),o={...t,precio_antes:t.precio_antes===""?null:Number(t.precio_antes),precio_oferta:t.precio_oferta===""?null:Number(t.precio_oferta),fecha_inicio:t.fecha_inicio===""?null:t.fecha_inicio,fecha_fin:t.fecha_fin===""?null:t.fecha_fin,orden:Number(t.orden||0),activo:!!t.activo};s&&(o.imagen_url=s);const l=d?"PUT":"POST";d&&(o.id=d);const g=await(await fetch(p,{method:l,headers:{"Content-Type":"application/json"},body:JSON.stringify(o),credentials:"include"})).json();if(!g?.success)throw new Error(g?.error||"No se pudo guardar");c(!1),u(null),await f(),i.fire("Listo","Guardado correctamente","success")}catch(s){i.fire("Error",s?.message||"Error al guardar","error")}}async function P(a){if((await i.fire({title:"¿Desactivar oferta?",text:"La oferta dejará de mostrarse en la web pública",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, desactivar",cancelButtonText:"Cancelar"})).isConfirmed)try{const l=await(await fetch(p,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a}),credentials:"include"})).json();if(!l?.success)throw new Error(l?.error||"No se pudo desactivar");await f()}catch(o){i.fire("Error",o?.message||"Error al desactivar","error")}}return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-800",children:"Ofertas Web"}),e.jsx("button",{onClick:C,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"+ Nuevo"})]}),v?e.jsx("div",{className:"text-gray-600",children:"Cargando…"}):e.jsx("div",{className:"bg-white rounded shadow overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Título"}),e.jsx("th",{className:"p-2 text-left",children:"Oferta"}),e.jsx("th",{className:"p-2 text-left",children:"Vigencia"}),e.jsx("th",{className:"p-2 text-left",children:"Activo"}),e.jsx("th",{className:"p-2 text-left",children:"Acciones"})]})}),e.jsxs("tbody",{children:[x.map(a=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:a.titulo}),e.jsx("td",{className:"p-2",children:a.precio_oferta??""}),e.jsx("td",{className:"p-2",children:(a.fecha_inicio||"")+(a.fecha_fin?` a ${a.fecha_fin}`:"")}),e.jsx("td",{className:"p-2",children:a.activo?"Sí":"No"}),e.jsxs("td",{className:"p-2 flex gap-2",children:[e.jsx("button",{className:"px-3 py-1 rounded bg-yellow-500 text-white",onClick:()=>E(a),children:"Editar"}),e.jsx("button",{className:"px-3 py-1 rounded bg-red-600 text-white",onClick:()=>P(a.id),children:"Desactivar"})]})]},a.id)),x.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-4 text-gray-600",colSpan:5,children:"No hay ofertas."})})]})]})}),e.jsxs(T,{open:y,onClose:()=>c(!1),children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:[d?"Editar":"Nueva"," oferta"]}),e.jsxs("form",{onSubmit:k,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Título"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",value:t.titulo,onChange:a=>r(s=>({...s,titulo:a.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Imagen URL (opcional)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",value:t.imagen_url,onChange:a=>r(s=>({...s,imagen_url:a.target.value}))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Subir imagen (PNG o JPG)"}),e.jsx("input",{className:"w-full",type:"file",accept:".png,.jpg,.jpeg,image/png,image/jpeg",onChange:a=>u(a.target.files?.[0]||null)}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Si seleccionas una imagen, se subirá y reemplazará la URL."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Descripción"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",rows:3,value:t.descripcion,onChange:a=>r(s=>({...s,descripcion:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Precio antes (opcional)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",type:"number",step:"0.01",value:t.precio_antes,onChange:a=>r(s=>({...s,precio_antes:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Precio oferta (opcional)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",type:"number",step:"0.01",value:t.precio_oferta,onChange:a=>r(s=>({...s,precio_oferta:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Fecha inicio (opcional)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",type:"date",value:t.fecha_inicio,onChange:a=>r(s=>({...s,fecha_inicio:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Fecha fin (opcional)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",type:"date",value:t.fecha_fin,onChange:a=>r(s=>({...s,fecha_fin:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Orden"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",type:"number",value:t.orden,onChange:a=>r(s=>({...s,orden:a.target.value}))})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-6",children:[e.jsx("input",{type:"checkbox",checked:!!t.activo,onChange:a=>r(s=>({...s,activo:a.target.checked}))}),e.jsx("span",{className:"text-sm",children:"Activo"})]}),e.jsxs("div",{className:"md:col-span-2 flex gap-3",children:[e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",type:"submit",children:"Guardar"}),e.jsx("button",{className:"border px-4 py-2 rounded",type:"button",onClick:()=>c(!1),children:"Cancelar"})]})]})]})]})}export{I as default};
