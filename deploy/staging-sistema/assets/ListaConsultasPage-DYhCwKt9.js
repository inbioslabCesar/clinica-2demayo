const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-B5yQt2qK.js","assets/examenes-laboratorio-crud-BJk1fG4Z.js","assets/vendor-DDKpoaqD.css"])))=>i.map(i=>d[i]);
import{B as M,_ as f}from"./examenes-laboratorio-crud-BJk1fG4Z.js";import{r as o,j as e}from"./vendor-B5yQt2qK.js";function T(){const[d,E]=o.useState([]),[S,P]=o.useState(0),[x,C]=o.useState(3),[r,m]=o.useState(1),[D,b]=o.useState(!0),[v,j]=o.useState(""),[p,N]=o.useState(""),[u,y]=o.useState(""),[h,w]=o.useState("");o.useEffect(()=>{b(!0),j("");const t=new URLSearchParams({page:r,limit:x,busqueda:h.trim(),fechaDesde:p,fechaHasta:u});fetch(`${M}api_consultas.php?${t.toString()}`).then(a=>a.json()).then(a=>{a.success?(E(a.consultas||[]),P(a.total||0)):j(a.error||"Error al cargar consultas"),b(!1)}).catch(()=>{j("Error de conexión con el servidor"),b(!1)})},[r,x,h,p,u]);const _=Math.max(1,Math.ceil(S/x)),L=d,R=async()=>{const t=await f(()=>import("./vendor-B5yQt2qK.js").then(l=>l.O),__vite__mapDeps([0,1,2])),a=t.utils.json_to_sheet(d.map(l=>({ID:l.id,Fecha:l.fecha?.slice(0,16).replace("T"," "),Paciente:l.paciente_nombre+" "+l.paciente_apellido,Medico:l.medico_nombre,Motivo:l.motivo,Estado:l.estado}))),n=t.utils.book_new();t.utils.book_append_sheet(n,a,"Consultas");const g=t.write(n,{bookType:"xlsx",type:"array"}),s=new Blob([g],{type:"application/octet-stream"}),c=new Date().toISOString().slice(0,10),i=document.createElement("a");i.href=URL.createObjectURL(s),i.download=`consultas_${c}.xlsx`,document.body.appendChild(i),i.click(),document.body.removeChild(i)},k=async()=>{const t=(await f(async()=>{const{default:s}=await import("./vendor-B5yQt2qK.js").then(c=>c.P);return{default:s}},__vite__mapDeps([0,1,2]))).default,a=(await f(async()=>{const{default:s}=await import("./vendor-B5yQt2qK.js").then(c=>c.Q);return{default:s}},__vite__mapDeps([0,1,2]))).default,n=new t;n.text("Lista de Consultas",14,10),a(n,{head:[["ID","Fecha","Paciente","Médico","Motivo","Estado"]],body:d.map(s=>[s.id,s.fecha?.slice(0,16).replace("T"," "),s.paciente_nombre+" "+s.paciente_apellido,s.medico_nombre,s.motivo,s.estado]),startY:18,styles:{fontSize:9},headStyles:{fillColor:[59,130,246]}});const g=new Date().toISOString().slice(0,10);n.save(`consultas_${g}.pdf`)};return e.jsxs("div",{className:"max-w-5xl mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Lista de Consultas"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[e.jsx("label",{className:"text-sm",children:"Filas por página:"}),e.jsxs("select",{value:x,onChange:t=>{C(Number(t.target.value)),m(1)},className:"border rounded px-2 py-1",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]}),e.jsx("input",{type:"text",value:h,onChange:t=>w(t.target.value),placeholder:"Buscar por paciente, médico, motivo, estado o ID...",className:"border rounded px-2 py-1 min-w-[180px]"}),e.jsx("label",{className:"text-sm",children:"Desde:"}),e.jsx("input",{type:"date",value:p,onChange:t=>N(t.target.value),className:"border rounded px-2 py-1"}),e.jsx("label",{className:"text-sm",children:"Hasta:"}),e.jsx("input",{type:"date",value:u,onChange:t=>y(t.target.value),className:"border rounded px-2 py-1"}),(p||u||h)&&e.jsx("button",{onClick:()=>{N(""),y(""),w("")},className:"text-blue-600 underline ml-2",children:"Limpiar filtro"}),e.jsx("button",{onClick:R,className:"bg-green-600 text-white px-3 py-1 rounded font-semibold text-xs hover:bg-green-700 transition-all",children:"Exportar Excel"}),e.jsx("button",{onClick:k,className:"bg-red-600 text-white px-3 py-1 rounded font-semibold text-xs hover:bg-red-700 transition-all",children:"Exportar PDF"})]}),D?e.jsx("div",{className:"text-center",children:"Cargando..."}):v?e.jsx("div",{className:"text-center text-red-600",children:v}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full text-xs md:text-sm border bg-white rounded shadow",children:[e.jsx("thead",{className:"bg-blue-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 w-12 text-center",children:"ID"}),e.jsx("th",{className:"p-2",children:"Fecha"}),e.jsx("th",{className:"p-2",children:"Paciente"}),e.jsx("th",{className:"p-2",children:"Médico"}),e.jsx("th",{className:"p-2",children:"Motivo"}),e.jsx("th",{className:"p-2",children:"Estado"})]})}),e.jsx("tbody",{children:d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-4",children:"No hay consultas registradas"})}):L.map(t=>e.jsxs("tr",{className:"border-b hover:bg-blue-50",children:[e.jsx("td",{className:"p-2 w-12 text-center",children:t.id}),e.jsx("td",{className:"p-2",children:t.fecha?.slice(0,16).replace("T"," ")}),e.jsxs("td",{className:"p-2",children:[t.paciente_nombre," ",t.paciente_apellido]}),e.jsx("td",{className:"p-2",children:t.medico_nombre}),e.jsx("td",{className:"p-2",children:t.motivo}),e.jsx("td",{className:"p-2",children:t.estado})]},t.id))})]}),e.jsxs("div",{className:"flex justify-end items-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>m(t=>Math.max(1,t-1)),disabled:r===1,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{className:"text-sm",children:["Página ",r," de ",_]}),e.jsx("button",{onClick:()=>m(t=>Math.min(_,t+1)),disabled:r===_,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Siguiente"})]})]})]})}export{T as default};
