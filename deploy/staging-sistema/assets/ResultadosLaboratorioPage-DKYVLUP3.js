import{t as H,r as b,j as t,h as I}from"./vendor-B5yQt2qK.js";import{B as E}from"./examenes-laboratorio-crud-BJk1fG4Z.js";function U(){const{consultaId:p}=H(),[v,R]=b.useState([]),[V,z]=b.useState([]),[B,N]=b.useState(!0),[y,k]=b.useState("");b.useEffect(()=>{N(!0),Promise.all([fetch(`${E}api_resultados_laboratorio.php?consulta_id=${p}`).then(e=>e.json()),fetch(`${E}api_examenes_laboratorio.php`,{credentials:"include"}).then(e=>e.json())]).then(([e,s])=>{e.success?R(e.resultados||[]):k(e.error||"No hay resultados"),z(s.examenes||[]),N(!1)}).catch(()=>{k("Error al cargar resultados"),N(!1)})},[p]);function u(e){if(e==null)return 0;if(typeof e=="number")return e;let s=String(e).trim();s=s.replace(/,/g,".");const n=s.match(/-?\d+(?:\.\d+)?/);if(!n)return 0;const r=parseFloat(n[0]);return Number.isFinite(r)?r:0}const w={},F={};for(const e of V)w[e.id]=e.nombre,F[e.id]=Array.isArray(e.valores_referenciales)?e.valores_referenciales:[];function _(e){return e?String(e).trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):""}function C(e,s=null){if(!Array.isArray(e)||e.length===0||!s)return null;const n=_(s);return e.find(l=>!l||typeof l!="object"||!(l.tipo===void 0||l.tipo==="ParÃ¡metro")?!1:_(l.nombre||"")===n)||null}function $(e){let s=null,n=null;if(!e)return{min:s,max:n};if(Array.isArray(e.referencias)&&e.referencias.length>0){const r=e.referencias[0]||{},l=u(r.valor_min),a=u(r.valor_max);if(Number.isFinite(l)&&(s=l),Number.isFinite(a)&&(n=a),s===null&&n===null&&typeof r.valor=="string"&&r.valor.trim()!==""){let o=r.valor.replace(/,/g,".").replace(/\bN\s*:|\bNormal\s*:\s*/i,"").trim();const f=o.match(/(-?\d+(?:\.\d+)?)\s*(?:-|â€“|â€”|a|hasta|\bentre\b)\s*(-?\d+(?:\.\d+)?)/i);if(f){const m=parseFloat(f[1]),d=parseFloat(f[2]);Number.isFinite(m)&&(s=m),Number.isFinite(d)&&(n=d)}else{const m=o.match(/-?\d+(?:\.\d+)?/);if(m){const d=parseFloat(m[0]);Number.isFinite(d)&&(s=d,n=d)}}}}if(s===null&&e.valor_min!==void 0){const r=u(e.valor_min);Number.isFinite(r)&&(s=r)}else if(s===null&&e.min!==void 0){const r=u(e.min);Number.isFinite(r)&&(s=r)}if(n===null&&e.valor_max!==void 0){const r=u(e.valor_max);Number.isFinite(r)&&(n=r)}else if(n===null&&e.max!==void 0){const r=u(e.max);Number.isFinite(r)&&(n=r)}return{min:s,max:n}}function D(e,s){if(!s||e==null||e==="")return!1;const{min:n,max:r}=$(s),l=u(e);return Number.isFinite(l)?n!==null&&l<n||r!==null&&l>r:!1}return t.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-white rounded-xl shadow-xl mt-6",children:[t.jsxs("div",{className:"mb-8 text-center",children:[t.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[t.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),t.jsx("h2",{className:"text-3xl font-bold text-green-800",children:"ðŸ“‹ Resultados de Laboratorio"})]}),t.jsx("p",{className:"text-green-600",children:"Reporte completo de los anÃ¡lisis mÃ©dicos"})]}),t.jsxs(I,{to:-1,className:"mb-6 inline-flex items-center gap-2 px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg font-medium transition-colors duration-200 hover:scale-105",children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"â¬…ï¸ Volver"]}),B?t.jsxs("div",{className:"flex items-center justify-center p-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"}),t.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando resultados..."})]}):y?t.jsx("div",{className:"p-6 text-red-600 bg-red-50 border border-red-200 rounded-xl",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),y]})}):v.length===0?t.jsxs("div",{className:"p-8 text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),t.jsx("p",{className:"text-gray-500 text-lg",children:"No hay resultados registrados para esta consulta."})]}):t.jsx("div",{className:"space-y-6",children:v.map((e,s)=>t.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-green-200",children:[t.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-4 8v4m-4-4h8m-8-4h8a2 2 0 002-2V7a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})}),t.jsxs("span",{className:"text-sm font-bold text-green-800",children:["ðŸ“… Fecha del AnÃ¡lisis: ",new Date(e.fecha).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),e.resultados&&typeof e.resultados=="object"?t.jsx("div",{children:(()=>{const n={};return Object.entries(e.resultados).forEach(([r,l])=>{let a=r,o=null;r.includes("__")&&([a,o]=r.split("__")),n[a]||(n[a]=[]),n[a].push({nombreParam:o,val:l,ex:r})}),Object.entries(n).map(([r,l])=>{const a=w[r]||r;return t.jsxs("div",{className:"mb-3",children:[t.jsx("div",{className:"font-semibold text-base mb-1",children:a}),t.jsx("ul",{className:"list-disc ml-5",children:l.map(({nombreParam:o,val:f,ex:m})=>{const d=F[r]||[],g=(d||[]).filter(c=>c&&typeof c=="object"&&(c.tipo===void 0||c.tipo==="ParÃ¡metro")&&c.nombre&&c.nombre.trim()!==""),L=g.filter(c=>/^item\s*\d+$/i.test((c.nombre||"").trim())),M=o?/^item\s*\d+$/i.test(o.trim()):!1,W=M&&o?L.findIndex(c=>(c.nombre||"").trim()===o.trim()):-1;let i=null;o?(i=C(d,o),!i&&g.length>=1&&(i=g[0])):g.length>=1&&(i=g[0]);let j;o?j=M?L.length<=1?a:`${a} â€” ParÃ¡metro ${W+1}`:o:i&&(i.nombre||"").trim()!==""?j=/^item\s*\d+$/i.test((i.nombre||"").trim())?a:i.nombre:j=a;const O=i&&i.unidad?` ${i.unidad}`:"",{min:x,max:h}=$(i),S=i&&Array.isArray(i.referencias)&&i.referencias[0]&&typeof i.referencias[0].valor=="string"&&i.referencias[0].valor.trim()!==""?i.referencias[0].valor:"",A=i&&D(f,i);return t.jsxs("li",{children:[t.jsxs("b",{children:[j,":"]})," ",t.jsxs("span",{className:A?"text-red-600 font-bold":"",children:[f,O]}),(x!==null||h!==null||S)&&t.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["[",x!==null||h!==null?`${x!==null?`min: ${x}`:""}${x!==null&&h!==null?", ":""}${h!==null?`max: ${h}`:""}`:`ref: ${S}`,"]"]}),A&&(x!==null||h!==null)&&t.jsx("span",{className:"text-xs text-red-600 ml-1 font-semibold",children:"Fuera de rango"})]},m)})})]},r)})})()}):t.jsx("div",{children:JSON.stringify(e.resultados)})]},s))})]})}export{U as default};
