import{r as t,j as e,S as i}from"./vendor-B5yQt2qK.js";import{B as m}from"./examenes-laboratorio-crud-BJk1fG4Z.js";function P(){const b=(()=>{try{return JSON.parse(sessionStorage.getItem("usuario"))||{}}catch{return{}}})(),j=async s=>{if((await i.fire({title:"¿Eliminar honorario?",text:"Esta acción eliminará el registro de honorario y no podrá recuperarse.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33"})).isConfirmed)try{const o=await(await fetch(`${m}api_eliminar_honorario.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s}),credentials:"include"})).json();o.success?(i.fire("¡Eliminado!","El honorario ha sido eliminado.","success"),l()):i.fire("Error",o.error||"No se pudo eliminar el honorario.","error")}catch{i.fire("Error","Error de conexión.","error")}},[N,y]=t.useState([]),[_,v]=t.useState([]),[u,C]=t.useState(""),[h,w]=t.useState(""),[c,q]=t.useState("pendiente"),[S,g]=t.useState(!0),[a,x]=t.useState(1),[n,U]=t.useState(3);t.useEffect(()=>{E(),l()},[]);const E=async()=>{try{const r=await(await fetch(`${m}api_medicos.php`)).json();r.success&&v(r.medicos||[])}catch{}},l=async()=>{g(!0);try{const s=[];h&&s.push(`medico_id=${h}`),u&&s.push(`turno=${u}`),c&&s.push(`estado=${c}`),s.push(`page=${a}`),s.push(`limit=${n}`);const r=s.length?`?${s.join("&")}`:"",o=await(await fetch(`${m}api_honorarios_pendientes.php${r}`)).json();o.success&&y(o.honorarios||[])}catch{}finally{g(!1)}},f=async s=>{if((await i.fire({title:"¿Liquidar honorario?",text:"¿Deseas marcar este honorario como pagado?",icon:"question",showCancelButton:!0,confirmButtonText:"Sí, liquidar",cancelButtonText:"Cancelar",confirmButtonColor:"#3085d6"})).isConfirmed)try{const o=await(await fetch(`${m}api_liquidar_honorario.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s}),credentials:"include"})).json();o.success?(i.fire("¡Liquidado!","El honorario ha sido marcado como pagado.","success"),l()):i.fire("Error",o.error||"No se pudo liquidar el honorario.","error")}catch(d){console.error("Error al liquidar honorario:",d),i.fire("Error","Error de conexión.","error")}},p=N.filter((s,r,d)=>d.findIndex(o=>o.id===s.id)===r).filter(s=>s.tipo_servicio==="consulta"||s.tipo_servicio==="ecografia");return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4 text-blue-800",children:"Liquidación de Honorarios Médicos"}),e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded shadow mb-6",children:e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[e.jsxs("div",{className:"flex flex-col bg-blue-50 rounded-lg p-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-semibold text-blue-800 mb-1",children:"Médico:"}),e.jsxs("select",{value:h,onChange:s=>w(s.target.value),className:"border rounded px-2 py-2 text-xs sm:text-sm focus:outline-blue-400",children:[e.jsx("option",{value:"",children:"Todos"}),_.map(s=>e.jsxs("option",{value:s.id,children:[s.nombre," ",s.apellido]},s.id))]})]}),e.jsxs("div",{className:"flex flex-col bg-blue-50 rounded-lg p-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-semibold text-blue-800 mb-1",children:"Turno:"}),e.jsxs("select",{value:u,onChange:s=>C(s.target.value),className:"border rounded px-2 py-2 text-xs sm:text-sm focus:outline-blue-400",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"mañana",children:"Mañana"}),e.jsx("option",{value:"tarde",children:"Tarde"}),e.jsx("option",{value:"noche",children:"Noche"})]})]}),e.jsxs("div",{className:"flex flex-col bg-blue-50 rounded-lg p-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-semibold text-blue-800 mb-1",children:"Estado:"}),e.jsxs("select",{value:c,onChange:s=>q(s.target.value),className:"border rounded px-2 py-2 text-xs sm:text-sm focus:outline-blue-400",children:[e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"pagado",children:"Pagado"})]})]}),e.jsxs("div",{className:"flex flex-col bg-blue-50 rounded-lg p-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-semibold text-blue-800 mb-1",children:"Filas por página:"}),e.jsxs("select",{value:n,onChange:s=>{U(Number(s.target.value)),x(1)},className:"border rounded px-2 py-2 text-xs sm:text-sm focus:outline-blue-400",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]}),e.jsx("div",{className:"flex flex-col justify-end",children:e.jsx("button",{type:"button",onClick:()=>{x(1),l()},className:"bg-blue-600 text-white px-4 py-2 rounded font-bold w-full",children:"Filtrar"})})]})}),S?e.jsx("div",{className:"text-center py-8",children:"Cargando honorarios..."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"space-y-4",children:p.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["No hay honorarios ",c==="pendiente"?"pendientes":"pagados"]}):p.slice((a-1)*n,a*n).map(s=>e.jsxs("div",{className:"rounded-xl shadow-lg border border-blue-100 bg-gradient-to-br from-blue-50 via-white to-blue-100 p-4 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-bold text-blue-800 text-lg",children:`${s.medico_nombre} ${s.medico_apellido}`.toUpperCase()}),e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-blue-200 text-blue-800 font-bold",children:s.tipo_servicio?s.tipo_servicio.toUpperCase():""})]}),e.jsx("div",{className:"text-sm text-gray-700 mb-1",children:s.descripcion?s.descripcion.toUpperCase():""}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",`${s.paciente_nombre} ${s.paciente_apellido}`.toUpperCase()]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Fecha: ",s.fecha?s.fecha.toUpperCase():""]}),e.jsxs("span",{children:["Turno: ",s.turno?s.turno.toUpperCase():""]})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Estado: ",e.jsx("span",{className:s.estado_pago_medico==="pagado"?"text-green-700 font-bold":"text-yellow-700 font-bold",children:s.estado_pago_medico?s.estado_pago_medico.toUpperCase():""})]}),e.jsxs("span",{children:["Monto: ",e.jsxs("span",{className:"font-bold text-blue-800",children:["S/ ",parseFloat(s.monto_medico).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Cobrado por: ",s.cobrado_por_nombre?s.cobrado_por_nombre.toUpperCase():"-"]}),e.jsxs("span",{children:["Liquidado por: ",s.liquidado_por_nombre?s.liquidado_por_nombre.toUpperCase():"-"]})]}),e.jsx("div",{className:"flex gap-2 text-xs text-gray-500",children:e.jsxs("span",{children:["Fecha Liquidación: ",s.fecha_liquidacion?s.fecha_liquidacion.toUpperCase():"-"]})}),e.jsxs("div",{className:"mt-2 flex justify-end gap-2",children:[s.estado_pago_medico==="pendiente"&&e.jsx("button",{onClick:()=>f(s.id),className:"bg-green-600 text-white px-4 py-1 rounded font-bold",children:"Liquidar"}),b.rol==="administrador"&&e.jsx("button",{onClick:()=>j(s.id),className:"bg-red-600 text-white px-4 py-1 rounded font-bold",children:"Eliminar"})]})]},s.id))})}),e.jsxs("div",{className:"hidden md:block",children:[e.jsxs("table",{className:"w-full bg-white rounded shadow",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Médico"}),e.jsx("th",{className:"px-4 py-2",children:"Descripción"}),e.jsx("th",{className:"px-4 py-2",children:"Servicio"}),e.jsx("th",{className:"px-4 py-2",children:"Paciente"}),e.jsx("th",{className:"hidden sm:table-cell px-4 py-2",children:"Fecha"}),e.jsx("th",{className:"hidden sm:table-cell px-4 py-2",children:"Turno"}),e.jsx("th",{className:"px-4 py-2",children:"Monto"}),e.jsx("th",{className:"px-4 py-2",children:"Estado"}),e.jsx("th",{className:"hidden sm:table-cell px-4 py-2",children:"Cobrado por"}),e.jsx("th",{className:"hidden sm:table-cell px-4 py-2",children:"Liquidado por"}),e.jsx("th",{className:"hidden sm:table-cell px-4 py-2",children:"Fecha Liquidación"}),e.jsx("th",{className:"px-4 py-2",children:"Acciones"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:12,className:"text-center py-8 text-gray-500",children:["No hay honorarios ",c==="pendiente"?"pendientes":"pagados"]})}):p.slice((a-1)*n,a*n).map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:`${s.medico_nombre} ${s.medico_apellido}`.toUpperCase()}),e.jsx("td",{className:"px-4 py-2",children:s.descripcion?s.descripcion.toUpperCase():""}),e.jsx("td",{className:"px-4 py-2",children:s.tipo_servicio?s.tipo_servicio.toUpperCase():""}),e.jsx("td",{className:"px-4 py-2",children:`${s.paciente_nombre} ${s.paciente_apellido}`.toUpperCase()}),e.jsx("td",{className:"hidden sm:table-cell px-4 py-2",children:s.fecha?s.fecha.toUpperCase():""}),e.jsx("td",{className:"hidden sm:table-cell px-4 py-2",children:s.turno?s.turno.toUpperCase():""}),e.jsxs("td",{className:"px-4 py-2",children:["S/ ",parseFloat(s.monto_medico).toFixed(2)]}),e.jsx("td",{className:"px-4 py-2",children:s.estado_pago_medico?s.estado_pago_medico.toUpperCase():""}),e.jsx("td",{className:"hidden sm:table-cell px-4 py-2",children:s.cobrado_por_nombre?e.jsxs("span",{children:[s.cobrado_por_nombre.toUpperCase()," ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.cobrado_por_rol?s.cobrado_por_rol.toUpperCase():"",")"]})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"hidden sm:table-cell px-4 py-2",children:s.estado_pago_medico==="pagado"&&s.liquidado_por_nombre?e.jsxs("span",{children:[s.liquidado_por_nombre.toUpperCase()," ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.liquidado_por_rol?s.liquidado_por_rol.toUpperCase():"",")"]})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"hidden sm:table-cell px-4 py-2",children:s.estado_pago_medico==="pagado"&&s.fecha_liquidacion?e.jsx("span",{children:s.fecha_liquidacion.toUpperCase()}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs("td",{className:"px-4 py-2 flex gap-2",children:[s.estado_pago_medico==="pendiente"&&e.jsx("button",{onClick:()=>f(s.id),className:"bg-green-600 text-white px-3 py-1 rounded",children:"Liquidar"}),b.rol==="administrador"&&e.jsx("button",{onClick:()=>j(s.id),className:"bg-red-600 text-white px-3 py-1 rounded",children:"Eliminar"})]})]},s.id))})]}),e.jsxs("div",{className:"flex justify-end items-center mt-4 gap-2",children:[e.jsx("button",{disabled:a===1,onClick:()=>{x(a-1),l()},className:"px-3 py-1 rounded bg-gray-200",children:"Anterior"}),e.jsxs("span",{children:["Página ",a]}),e.jsx("button",{disabled:a*n>=p.length,onClick:()=>{x(a+1),l()},className:"px-3 py-1 rounded bg-gray-200",children:"Siguiente"})]})]})]})]})}export{P as default};
