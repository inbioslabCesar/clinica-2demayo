import{j as e,r as o}from"./vendor-B5yQt2qK.js";import"./examenes-laboratorio-crud-BJk1fG4Z.js";function S({form:t,onChange:a,onSubmit:i,loading:n,editId:d}){return e.jsxs("form",{onSubmit:i,className:"flex flex-col gap-3",children:[e.jsx("input",{name:"monto",type:"number",required:!0,placeholder:"Monto",value:t.monto,onChange:a,className:"w-full px-4 py-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-gray-50 text-gray-800 placeholder-gray-400 transition"}),e.jsx("input",{name:"descripcion",required:!0,placeholder:"DescripciÃ³n",value:t.descripcion,onChange:a,className:"w-full px-4 py-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-gray-50 text-gray-800 placeholder-gray-400 transition"}),e.jsxs("select",{name:"categoria",required:!0,value:t.categoria,onChange:a,className:"w-full px-4 py-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-gray-50 text-gray-800 transition",children:[e.jsx("option",{value:"",children:"CategorÃ­a"}),e.jsx("option",{value:"pasaje",children:"Pasaje"}),e.jsx("option",{value:"servicios",children:"Pago de servicios"}),e.jsx("option",{value:"sueldo",children:"Pago de sueldo"}),e.jsx("option",{value:"otros",children:"Otros"})]}),e.jsxs("select",{name:"tipo_egreso",required:!0,value:t.tipo_egreso,onChange:a,className:"w-full px-4 py-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-gray-50 text-gray-800 transition",children:[e.jsx("option",{value:"",children:"Tipo de Egreso"}),e.jsx("option",{value:"operativo",children:"Operativo"}),e.jsx("option",{value:"otros",children:"Otros"})]}),e.jsxs("select",{name:"turno",required:!0,value:t.turno,onChange:a,className:"w-full px-4 py-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-gray-50 text-gray-800 transition",children:[e.jsx("option",{value:"",children:"Turno"}),e.jsx("option",{value:"maÃ±ana",children:"MaÃ±ana"}),e.jsx("option",{value:"tarde",children:"Tarde"}),e.jsx("option",{value:"noche",children:"Noche"})]}),e.jsxs("select",{name:"metodo_pago",required:!0,value:t.metodo_pago,onChange:a,className:"w-full px-4 py-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-gray-50 text-gray-800 transition",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"transferencia",children:"Transferencia"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"}),e.jsx("option",{value:"yape",children:"Yape"}),e.jsx("option",{value:"plin",children:"Plin"})]}),e.jsx("input",{name:"fecha",type:"date",required:!0,value:t.fecha,onChange:a,className:"w-full px-4 py-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-gray-50 text-gray-800 transition"}),e.jsx("input",{name:"hora",type:"time",required:!0,value:t.hora,onChange:a,className:"w-full px-4 py-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-gray-50 text-gray-800 transition"}),e.jsx("textarea",{name:"observaciones",placeholder:"Observaciones",value:t.observaciones,onChange:a,className:"w-full px-4 py-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-gray-50 text-gray-800 placeholder-gray-400 min-h-[80px] transition"}),e.jsx("button",{type:"submit",className:"w-full py-2 rounded bg-gradient-to-r from-blue-600 to-blue-400 text-white font-bold shadow hover:from-blue-700 hover:to-blue-500 transition disabled:opacity-60",disabled:n,children:d?"Actualizar":"Registrar"})]})}const _=o.forwardRef(function({onEdit:a},i){const[n,d]=o.useState([]),[h,c]=o.useState(!1),[p,y]=o.useState(""),[u,b]=o.useState(""),[g,s]=o.useState(3),[l,x]=o.useState(1);o.useEffect(()=>{f()},[u]),o.useImperativeHandle(i,()=>({fetchEgresos:f}));const f=async()=>{c(!0);let r="/api_egresos.php";u&&(r+=`?fecha=${u}`);const m=await(await fetch(r)).json();c(!1),m.success&&d(m.egresos||[])},j=async r=>{if(!window.confirm("Â¿Eliminar este egreso?"))return;c(!0);const m=await(await fetch(`/api_egresos.php?id=${r}`,{method:"DELETE"})).json();c(!1),m.success?f():alert(m.error||"Error al eliminar egreso")},v=n.filter(r=>r.tipo_egreso!=="honorario_medico").filter(r=>r.descripcion?.toLowerCase().includes(p.toLowerCase())||r.categoria?.toLowerCase().includes(p.toLowerCase())),N=Math.ceil(v.length/g)||1,E=v.slice((l-1)*g,l*g);return e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"bg-white rounded shadow p-3 sm:p-4 mb-4 flex flex-col sm:flex-row gap-2 sm:gap-4 items-stretch sm:items-center",children:[e.jsx("input",{type:"text",placeholder:"Buscar por descripciÃ³n o categorÃ­a",value:p,onChange:r=>{y(r.target.value),x(1)},className:"w-full sm:max-w-xs px-4 py-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-gray-50 text-gray-800 placeholder-gray-400 transition"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4 w-full sm:w-auto items-stretch sm:items-center",children:[e.jsx("label",{className:"font-semibold text-xs sm:text-sm",children:"Filas por pÃ¡gina:"}),e.jsxs("select",{value:g,onChange:r=>{s(Number(r.target.value)),x(1)},className:"px-3 py-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-gray-50 text-gray-800 transition max-w-[80px]",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4 w-full sm:w-auto items-stretch sm:items-center",children:[e.jsx("label",{className:"font-semibold text-xs sm:text-sm",children:"Filtrar por fecha:"}),e.jsx("input",{type:"date",value:u,onChange:r=>b(r.target.value),className:"px-3 py-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-gray-50 text-gray-800 transition max-w-[160px]"}),e.jsx("button",{className:"px-3 py-2 rounded bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold transition disabled:opacity-60",onClick:()=>b(""),disabled:!u,children:"Limpiar fecha"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border border-gray-200 rounded-lg shadow text-xs sm:text-sm bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-50 text-blue-800",children:[e.jsx("th",{className:"px-2 py-2 font-semibold border-b border-gray-200",children:"Monto"}),e.jsx("th",{className:"px-2 py-2 font-semibold border-b border-gray-200",children:"DescripciÃ³n"}),e.jsx("th",{className:"hidden sm:table-cell px-2 py-2 font-semibold border-b border-gray-200",children:"CategorÃ­a"}),e.jsx("th",{className:"hidden sm:table-cell px-2 py-2 font-semibold border-b border-gray-200",children:"Tipo"}),e.jsx("th",{className:"px-2 py-2 font-semibold border-b border-gray-200",children:"Fecha"}),e.jsx("th",{className:"hidden sm:table-cell px-2 py-2 font-semibold border-b border-gray-200",children:"Hora"}),e.jsx("th",{className:"hidden sm:table-cell px-2 py-2 font-semibold border-b border-gray-200",children:"Turno"}),e.jsx("th",{className:"hidden sm:table-cell px-2 py-2 font-semibold border-b border-gray-200",children:"MÃ©todo Pago"}),e.jsx("th",{className:"hidden sm:table-cell px-2 py-2 font-semibold border-b border-gray-200",children:"Usuario"}),e.jsx("th",{className:"px-2 py-2 font-semibold border-b border-gray-200",children:"Acciones"})]})}),e.jsx("tbody",{children:E.map((r,w)=>e.jsxs("tr",{className:w%2===0?"bg-white":"bg-gray-50 hover:bg-blue-50 transition",children:[e.jsxs("td",{className:"px-2 py-2 border-b border-gray-100",children:["S/ ",parseFloat(r.monto).toFixed(2)]}),e.jsx("td",{className:"px-2 py-2 border-b border-gray-100",children:r.descripcion}),e.jsx("td",{className:"hidden sm:table-cell px-2 py-2 border-b border-gray-100",children:r.categoria}),e.jsx("td",{className:"hidden sm:table-cell px-2 py-2 border-b border-gray-100",children:r.tipo_egreso}),e.jsx("td",{className:"px-2 py-2 border-b border-gray-100",children:r.fecha}),e.jsx("td",{className:"hidden sm:table-cell px-2 py-2 border-b border-gray-100",children:r.hora}),e.jsx("td",{className:"hidden sm:table-cell px-2 py-2 border-b border-gray-100",children:r.turno}),e.jsx("td",{className:"hidden sm:table-cell px-2 py-2 border-b border-gray-100",children:r.metodo_pago}),e.jsx("td",{className:"hidden sm:table-cell px-2 py-2 border-b border-gray-100",children:r.usuario_nombre||"-"}),e.jsxs("td",{className:"px-2 py-2 flex gap-2 justify-center border-b border-gray-100",children:[e.jsx("button",{className:"p-1 rounded hover:bg-yellow-100 text-yellow-700",title:"Editar",onClick:()=>a&&a(r),children:e.jsx("span",{role:"img","aria-label":"Editar",className:"text-lg",children:"âœï¸"})}),e.jsx("button",{className:"p-1 rounded hover:bg-red-100 text-red-700",title:"Eliminar",onClick:()=>j(r.id),children:e.jsx("span",{role:"img","aria-label":"Eliminar",className:"text-lg",children:"ðŸ—‘ï¸"})})]})]},r.id))})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mt-4 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-700",children:["PÃ¡gina ",l," de ",N]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-1 rounded bg-blue-100 text-blue-700 font-semibold shadow hover:bg-blue-200 transition disabled:opacity-60 text-xs sm:text-sm",disabled:l===1,onClick:()=>x(l-1),children:"Anterior"}),e.jsx("button",{className:"px-3 py-1 rounded bg-blue-100 text-blue-700 font-semibold shadow hover:bg-blue-200 transition disabled:opacity-60 text-xs sm:text-sm",disabled:l===N,onClick:()=>x(l+1),children:"Siguiente"})]})]}),h&&e.jsx("div",{className:"mt-4 text-blue-600",children:"Cargando..."}),!h&&v.length===0&&e.jsx("div",{className:"mt-4 text-gray-500",children:"No hay egresos registrados."})]})});function T(){const t=o.useRef(),[a,i]=o.useState({fecha:new Date().toISOString().slice(0,10),hora:new Date().toLocaleTimeString().slice(0,5),tipo_egreso:"",categoria:"",descripcion:"",monto:"",metodo_pago:"efectivo",turno:"",estado:"pagado",caja_id:"",observaciones:""}),[n,d]=o.useState(null),[h,c]=o.useState(!1),p=s=>i({...a,[s.target.name]:s.target.value}),y=async s=>{s.preventDefault(),c(!0);let l="/api_egresos.php",x="POST";n&&(l+=`?id=${n}`,x="PUT");const j=await(await fetch(l,{method:x,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)})).json();c(!1),j.success&&(b(!1),d(null),i({fecha:new Date().toISOString().slice(0,10),hora:new Date().toLocaleTimeString().slice(0,5),tipo_egreso:"",categoria:"",descripcion:"",monto:"",metodo_pago:"efectivo",turno:"",estado:"pagado",caja_id:"",observaciones:""}),t.current&&t.current.fetchEgresos&&t.current.fetchEgresos())},[u,b]=o.useState(!1),g=s=>{i({fecha:s.fecha||new Date().toISOString().slice(0,10),hora:s.hora||new Date().toLocaleTimeString().slice(0,5),tipo_egreso:s.tipo_egreso||"",categoria:s.categoria||"",descripcion:s.descripcion||"",monto:s.monto||"",metodo_pago:s.metodo_pago||"efectivo",turno:s.turno||"",estado:s.estado||"pagado",caja_id:s.caja_id||"",observaciones:s.observaciones||""}),d(s.id),b(!0)};return e.jsxs("div",{className:"w-full max-w-[1600px] mx-auto px-2 sm:px-6 py-4",children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-blue-800 text-center mb-6 flex items-center justify-center gap-2",children:[e.jsx("span",{className:"inline-block bg-blue-100 text-blue-700 rounded-full p-2 text-2xl",children:"ðŸ’¸"}),"Registro y GestiÃ³n de Egresos"]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-center items-stretch sm:items-center gap-2 sm:gap-4 mt-8 mb-4",children:e.jsxs("button",{className:"w-full sm:w-auto bg-blue-600 text-white px-4 py-2 sm:px-6 sm:py-3 rounded shadow hover:bg-blue-700 font-semibold text-base sm:text-lg transition",onClick:()=>{b(!0),d(null),i({fecha:new Date().toISOString().slice(0,10),hora:new Date().toLocaleTimeString().slice(0,5),tipo_egreso:"",categoria:"",descripcion:"",monto:"",metodo_pago:"efectivo",turno:"",estado:"pagado",caja_id:"",observaciones:""})},children:[e.jsx("span",{className:"inline-block mr-2",children:"âž•"})," Registrar Egreso"]})}),u&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-2",children:e.jsxs("div",{className:"w-full max-w-md sm:max-w-lg bg-white rounded-xl shadow-lg relative p-4 sm:p-8 flex flex-col",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-2xl font-bold focus:outline-none",onClick:()=>{b(!1),d(null)},title:"Cerrar","aria-label":"Cerrar",children:"Ã—"}),e.jsx("h2",{className:"text-lg sm:text-2xl font-bold mb-4 text-blue-700 text-center",children:n?"Editar Egreso":"Registrar Egreso"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(S,{form:a,onChange:p,onSubmit:y,loading:h,editId:n})})]})}),e.jsx("div",{className:"mt-8",children:e.jsx(_,{ref:t,onEdit:g})})]})}export{T as default};
