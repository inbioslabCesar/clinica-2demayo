const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-B5yQt2qK.js","assets/examenes-laboratorio-crud-BJk1fG4Z.js","assets/vendor-DDKpoaqD.css"])))=>i.map(i=>d[i]);
import{B as g,_ as p}from"./examenes-laboratorio-crud-BJk1fG4Z.js";import{r as n,j as e}from"./vendor-B5yQt2qK.js";function $(){const[o,y]=n.useState([]),[w,m]=n.useState(!0),[c,E]=n.useState(null),[P,S]=n.useState([]),[F,j]=n.useState(!1),[h,b]=n.useState(""),[x,_]=n.useState(""),[r,u]=n.useState(1),[d,v]=n.useState(3),[N,D]=n.useState(0),f=()=>{m(!0);let a=`${g}api_cotizaciones_farmacia.php`;const l=[`page=${r}`,`limit=${d}`];let s=h,t=x;(s&&!t||!s&&t)&&(s=s||t,t=t||s),s&&t&&(l.push(`fecha_inicio=${s}`),l.push(`fecha_fin=${t}`)),a+="?"+l.join("&"),fetch(a,{credentials:"include"}).then(i=>{if(!i.ok)throw new Error(`Error HTTP: ${i.status}`);return i.json()}).then(i=>{y(i.cotizaciones||[]),D(i.total||0),m(!1)}).catch(()=>{m(!1)})};n.useEffect(()=>{f()},[h,x,r,d]);const V=a=>{E(a),j(!0),fetch(`${g}api_cotizaciones_farmacia.php?cotizacion_id=${a.id}`,{credentials:"include"}).then(l=>l.json()).then(l=>{S(l.cotizacion?.detalles||[])})},C=async()=>{const a=(await p(async()=>{const{default:t}=await import("./vendor-B5yQt2qK.js").then(i=>i.P);return{default:t}},__vite__mapDeps([0,1,2]))).default,l=(await p(async()=>{const{default:t}=await import("./vendor-B5yQt2qK.js").then(i=>i.Q);return{default:t}},__vite__mapDeps([0,1,2]))).default,s=new a;s.text("Ventas de Farmacia",14,14),l(s,{head:[["Fecha","Paciente","DNI","Usuario","Total","Estado"]],body:o.map(t=>[t.fecha,t.paciente_nombre||"-",t.paciente_dni||"-",t.usuario_nombre||t.usuario_id,t.total,t.estado])}),s.save("ventas_farmacia.pdf")},k=async()=>{const a=await p(()=>import("./vendor-B5yQt2qK.js").then(t=>t.O),__vite__mapDeps([0,1,2])),l=a.utils.json_to_sheet(o.map(t=>({Fecha:t.fecha,Paciente:t.paciente_nombre||"-",DNI:t.paciente_dni||"-",Usuario:t.usuario_nombre||t.usuario_id,Total:t.total,Estado:t.estado}))),s=a.utils.book_new();a.utils.book_append_sheet(s,l,"Ventas"),a.writeFile(s,"ventas_farmacia.xlsx")};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-800 mb-4",children:"Ventas de Farmacia"}),e.jsxs("div",{className:"flex gap-4 mb-4 items-center",children:[e.jsxs("label",{className:"text-sm",children:["Mostrar:",e.jsxs("select",{value:d,onChange:a=>{v(Number(a.target.value)),u(1)},className:"ml-2 border rounded px-2 py-1",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]}),e.jsx("button",{className:"px-3 py-1 bg-green-600 text-white rounded",onClick:C,children:"Exportar PDF"}),e.jsx("button",{className:"px-3 py-1 bg-amber-500 text-white rounded",onClick:k,children:"Exportar Excel"}),e.jsxs("label",{className:"text-sm",children:["Desde:",e.jsx("input",{type:"date",value:h,onChange:a=>b(a.target.value),className:"ml-2 border rounded px-2 py-1"})]}),e.jsxs("label",{className:"text-sm",children:["Hasta:",e.jsx("input",{type:"date",value:x,onChange:a=>_(a.target.value),className:"ml-2 border rounded px-2 py-1"})]}),e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded",onClick:f,children:"Filtrar"}),(h||x)&&e.jsx("button",{className:"px-2 py-1 bg-gray-200 text-gray-700 rounded",onClick:()=>{b(""),_("")},children:"Limpiar"})]}),w?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Cargando ventas..."}):o.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No hay ventas registradas."}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-50",children:[e.jsx("th",{className:"p-2",children:"Fecha"}),e.jsx("th",{className:"p-2",children:"Paciente"}),e.jsx("th",{className:"p-2",children:"DNI"}),e.jsx("th",{className:"p-2",children:"Usuario"}),e.jsx("th",{className:"p-2",children:"Total"}),e.jsx("th",{className:"p-2",children:"Estado"}),e.jsx("th",{className:"p-2",children:"Detalle"})]})}),e.jsx("tbody",{children:o.map(a=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:a.fecha}),e.jsx("td",{className:"p-2",children:a.paciente_nombre||a.paciente_nombre||"-"}),e.jsx("td",{className:"p-2",children:a.paciente_dni||"-"}),e.jsx("td",{className:"p-2",children:a.usuario_nombre||a.usuario_id}),e.jsxs("td",{className:"p-2 font-bold text-blue-700",children:["S/ ",a.total]}),e.jsx("td",{className:"p-2",children:a.estado}),e.jsx("td",{className:"p-2",children:e.jsx("button",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded",onClick:()=>V(a),children:"Ver"})})]},a.id))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("span",{className:"text-sm",children:["Página ",r," de ",Math.max(1,Math.ceil(N/d))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded",disabled:r===1,onClick:()=>u(r-1),children:"Anterior"}),e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded",disabled:r>=Math.ceil(N/d),onClick:()=>u(r+1),children:"Siguiente"})]})]})]}),F&&c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 text-xl",onClick:()=>j(!1),children:"✕"}),e.jsx("h3",{className:"text-xl font-bold mb-2 text-blue-700",children:"Detalle de Venta"}),e.jsxs("div",{className:"mb-2 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Paciente:"})," ",c.paciente_nombre||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",c.paciente_dni||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Usuario:"})," ",c.usuario_nombre||c.usuario_id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Fecha:"})," ",c.fecha]}),e.jsxs("div",{children:[e.jsx("b",{children:"Total:"})," S/ ",c.total]})]}),e.jsxs("table",{className:"w-full text-sm border mb-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-50",children:[e.jsx("th",{className:"p-2",children:"Medicamento"}),e.jsx("th",{className:"p-2",children:"Cantidad"}),e.jsx("th",{className:"p-2",children:"Precio Unitario"}),e.jsx("th",{className:"p-2",children:"Subtotal"})]})}),e.jsx("tbody",{children:P.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:a.descripcion}),e.jsx("td",{className:"p-2",children:a.cantidad}),e.jsxs("td",{className:"p-2",children:["S/ ",a.precio_unitario]}),e.jsxs("td",{className:"p-2",children:["S/ ",a.subtotal]})]},a.id))})]})]})})]})}export{$ as default};
