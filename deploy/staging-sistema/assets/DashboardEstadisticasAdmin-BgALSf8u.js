import{E as y,d as v,e as h,w,j as e,f as S,L as k,C as T,X as _,Y as C,T as E,g as F,r as l}from"./vendor-B5yQt2qK.js";import"./examenes-laboratorio-crud-BJk1fG4Z.js";function D(s,t="servicios_mas_vendidos.xlsx"){const i=h.json_to_sheet(s),o=h.book_new();h.book_append_sheet(o,i,"Servicios"),w(o,t)}function R(s,t="servicios_mas_vendidos.pdf"){const i=new y;i.text("Servicios mÃ¡s vendidos",14,16),v(i,{startY:22,head:[["Servicio","Tipo","Cantidad","Total vendido"]],body:s.map(o=>[o.nombre,o.tipo,o.cantidad,`S/ ${o.total}`]),styles:{fontSize:10},headStyles:{fillColor:[41,128,185]}}),i.save(t)}const A=({resumen:s})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 flex flex-col gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Resumen"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{children:["Ganancia hoy: ",e.jsxs("span",{className:"font-bold text-green-600",children:["S/ ",s.gananciaDia]})]}),e.jsxs("span",{children:["Ganancia mes: ",e.jsxs("span",{className:"font-bold text-blue-600",children:["S/ ",s.gananciaMes]})]}),e.jsxs("span",{children:["Ganancia trimestre: ",e.jsxs("span",{className:"font-bold text-indigo-600",children:["S/ ",s.gananciaTrimestre]})]}),e.jsxs("span",{children:["Ganancia aÃ±o: ",e.jsxs("span",{className:"font-bold text-pink-600",children:["S/ ",s.gananciaAnio]})]}),e.jsxs("span",{children:["Crecimiento: ",e.jsx("span",{className:`font-bold ${s.crecimiento===null?"text-gray-500":s.crecimiento>=0?"text-green-600":"text-red-600"}`,children:s.crecimiento===null?"-":`${Number(s.crecimiento).toFixed(2)}%`})]}),e.jsxs("span",{children:["Pacientes atendidos: ",e.jsx("span",{className:"font-bold text-purple-600",children:s.pacientes})]}),e.jsxs("span",{children:["Ticket promedio: ",e.jsxs("span",{className:"font-bold text-yellow-600",children:["S/ ",s.ticketPromedio]})]})]})]}),G=({gananciaUsuarios:s})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Ganancia por Usuario (Diario)"}),e.jsx("div",{className:"max-h-64 overflow-y-auto border rounded",children:e.jsx("ul",{className:"space-y-2",children:Array.isArray(s)&&s.map(t=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:t.fecha}),e.jsxs("span",{className:"font-semibold",children:[t.usuario_nombre," (",t.rol,")"]}),e.jsxs("span",{className:"ml-auto text-green-700 font-bold",children:["S/ ",t.ganancia]})]},t.fecha+"-"+t.usuario_id))})})]}),P=({ranking:s})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Ranking Recepcionistas"}),e.jsx("ul",{className:"space-y-2",children:s.map((t,i)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xl ${i===0?"text-yellow-500":"text-gray-400"}`,children:i===0?"ðŸ¥‡":i===1?"ðŸ¥ˆ":"ðŸ¥‰"}),e.jsx("span",{className:"font-semibold",children:t.nombre}),e.jsxs("span",{className:"ml-auto text-green-700 font-bold",children:["S/ ",t.ingresos]})]},t.nombre))})]}),$=({servicios:s,filterTipo:t,setFilterTipo:i,filterNombre:o,setFilterNombre:d,handleExportExcel:x,handleExportPDF:m})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 col-span-1 md:col-span-2 lg:col-span-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Servicios mÃ¡s vendidos"}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("select",{className:"border rounded px-2 py-1",value:t,onChange:a=>i(a.target.value),children:[e.jsx("option",{value:"",children:"Todos los tipos"}),[...new Set(s.map(a=>a.tipo))].map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsxs("select",{className:"border rounded px-2 py-1",value:o,onChange:a=>d(a.target.value),children:[e.jsx("option",{value:"",children:"Todos los servicios"}),[...new Set(s.map(a=>a.nombre))].map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx("button",{className:"bg-green-600 text-white px-3 py-1 rounded shadow hover:bg-green-700",onClick:x,children:"Exportar Excel"}),e.jsx("button",{className:"bg-red-600 text-white px-3 py-1 rounded shadow hover:bg-red-700",onClick:m,children:"Exportar PDF"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"max-h-96 overflow-y-auto border rounded",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase",children:"Servicio"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-semibold text-gray-700 uppercase",children:"Cantidad"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-semibold text-gray-700 uppercase",children:"Total vendido"})]})}),e.jsx("tbody",{children:s.filter(a=>(!t||a.tipo===t)&&(!o||a.nombre===o)).map((a,r)=>e.jsxs("tr",{className:r%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-semibold text-gray-900",children:a.nombre}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-xs text-gray-500",children:a.tipo}),e.jsx("td",{className:"px-4 py-2 text-center text-sm text-gray-700 font-bold",children:a.cantidad}),e.jsxs("td",{className:"px-4 py-2 text-center font-bold text-blue-700",children:["S/ ",Number(a.total).toFixed(2)]})]},a.tipo+"-"+a.nombre))})]})})})]}),U=({tendencias:s})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 col-span-1 md:col-span-2 lg:col-span-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Tendencias de Ingresos"}),e.jsx("div",{className:"w-full",children:s&&s.length>0?e.jsx(S,{width:"100%",height:260,children:e.jsxs(k,{data:s,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(T,{strokeDasharray:"3 3"}),e.jsx(_,{dataKey:"fecha",tick:{fontSize:12}}),e.jsx(C,{tick:{fontSize:12}}),e.jsx(E,{formatter:t=>`S/ ${t}`,labelFormatter:t=>`Fecha: ${t}`}),e.jsx(F,{type:"monotone",dataKey:"total",stroke:"#7c3aed",strokeWidth:3,dot:{r:2}})]})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-gray-400",children:"No hay datos suficientes"})})]}),M=()=>{const[s,t]=l.useState(""),[i,o]=l.useState(""),d=()=>{const n=p.filter(c=>(!s||c.tipo===s)&&(!i||c.nombre===i));D(n)},x=()=>{const n=p.filter(c=>(!s||c.tipo===s)&&(!i||c.nombre===i));R(n)},[m,a]=l.useState(!0),[r,g]=l.useState({}),[j,u]=l.useState([]),[p,b]=l.useState([]),[f,N]=l.useState([]);return l.useEffect(()=>{fetch("/api_dashboard_estadisticas.php",{credentials:"include"}).then(n=>n.json()).then(n=>{n.success&&(g({gananciaDia:n.resumen.gananciaDia,gananciaMes:n.resumen.gananciaMes,gananciaTrimestre:n.resumen.gananciaTrimestre,gananciaAnio:n.resumen.gananciaAnio,pacientes:n.resumen.pacientes,gananciaUsuarios:n.resumen.gananciaUsuarios,crecimiento:n.resumen.crecimiento??null,ticketPromedio:n.resumen.pacientes>0?(n.resumen.gananciaMes/n.resumen.pacientes).toFixed(2):0}),u(n.ranking),b(n.servicios.map(c=>({tipo:c.tipo_servicio,nombre:c.nombre_servicio,cantidad:c.cantidad_total,total:c.monto_total}))),N(n.tendencias)),a(!1)}).catch(()=>a(!1))},[]),e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("h1",{className:"text-3xl font-bold text-purple-800 mb-6 flex items-center gap-3",children:[e.jsx("span",{children:"ðŸ“Š"})," Dashboard EstadÃ­stico Administrativo"]}),m?e.jsxs("div",{className:"flex justify-center items-center h-96",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("span",{className:"ml-4 text-purple-600",children:"Cargando estadÃ­sticas..."})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(A,{resumen:r}),e.jsx(G,{gananciaUsuarios:r.gananciaUsuarios}),e.jsx(P,{ranking:j}),e.jsx($,{servicios:p,filterTipo:s,setFilterTipo:t,filterNombre:i,setFilterNombre:o,handleExportExcel:d,handleExportPDF:x}),e.jsx(U,{tendencias:f})]})]})})};export{M as default};
