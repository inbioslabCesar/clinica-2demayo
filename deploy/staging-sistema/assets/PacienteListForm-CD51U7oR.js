import{j as e,r as m,S as g}from"./vendor-B5yQt2qK.js";import{B as E}from"./examenes-laboratorio-crud-BJk1fG4Z.js";function M({form:o,handleChange:r}){return e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-300",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-800 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Información Básica"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de documento"}),e.jsxs("select",{name:"tipo_documento",value:o.tipo_documento,onChange:r,className:"w-full border rounded-lg px-3 py-2 mb-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"dni",children:"DNI"}),e.jsx("option",{value:"carnet_extranjeria",children:"Carnet de extranjería"}),e.jsx("option",{value:"sin_documento",children:"Sin documento"})]}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:o.tipo_documento==="dni"?"DNI":o.tipo_documento==="carnet_extranjeria"?"Carnet de extranjería":"DNI Provisional"}),e.jsx("input",{name:"dni",value:o.dni,onChange:r,placeholder:o.tipo_documento==="dni"?"Documento de identidad (8 dígitos)":o.tipo_documento==="carnet_extranjeria"?"Carnet de extranjería (12 dígitos)":"Se genera automáticamente",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0,disabled:o.tipo_documento==="sin_documento"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Historia Clínica ",e.jsx("span",{className:"text-xs text-gray-500",children:"(Se genera automáticamente si está vacío)"})]}),e.jsx("input",{name:"historia_clinica",value:o.historia_clinica,onChange:r,placeholder:"HC##### (opcional - se genera automáticamente)",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre *"}),e.jsx("input",{name:"nombre",value:o.nombre,onChange:r,placeholder:"Nombres del paciente",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellido *"}),e.jsx("input",{name:"apellido",value:o.apellido,onChange:r,placeholder:"Apellidos del paciente",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sexo *"}),e.jsxs("select",{name:"sexo",value:o.sexo,onChange:r,className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"M",children:"Masculino"}),e.jsx("option",{value:"F",children:"Femenino"}),e.jsx("option",{value:"Otro",children:"Otro"})]})]})]})]})}function S({form:o,handleChange:r}){return e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-300",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-800 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Información de Edad"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Nacimiento"}),e.jsx("input",{name:"fecha_nacimiento",value:o.fecha_nacimiento,onChange:r,type:"date",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Edad"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{name:"edad",value:o.edad,onChange:r,placeholder:"Edad",type:"number",className:"flex-1 border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:!!o.fecha_nacimiento}),e.jsxs("select",{name:"edad_unidad",value:o.edad_unidad,onChange:r,className:"border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:!!o.fecha_nacimiento,children:[e.jsx("option",{value:"días",children:"Días"}),e.jsx("option",{value:"meses",children:"Meses"}),e.jsx("option",{value:"años",children:"Años"})]})]})]})]})]})}function z({form:o,handleChange:r}){return e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-300",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-800 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"Información Adicional"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Procedencia"}),e.jsx("input",{name:"procedencia",value:o.procedencia,onChange:r,placeholder:"Ciudad o lugar de procedencia",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dirección"}),e.jsx("textarea",{name:"direccion",value:o.direccion,onChange:r,placeholder:"Dirección completa del paciente",rows:"2",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Seguro"}),e.jsx("input",{name:"tipo_seguro",value:o.tipo_seguro,onChange:r,placeholder:"Ej: SIS, EsSalud, Particular, etc.",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})}function A({form:o,handleChange:r}){return e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-300",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-800 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),"Información de Contacto"]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono"}),e.jsx("input",{name:"telefono",value:o.telefono,onChange:r,placeholder:"Número de contacto",type:"tel",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{name:"email",value:o.email,onChange:r,placeholder:"Correo electrónico",type:"email",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})}function L({initialData:o={},onRegistroExitoso:r,guardarPaciente:y}){const[n,x]=m.useState({id:o.id||void 0,dni:o.dni||"",tipo_documento:o.tipo_documento||"dni",nombre:o.nombre||"",apellido:o.apellido||"",historia_clinica:o.historia_clinica||"",fecha_nacimiento:o.fecha_nacimiento||"",edad:o.edad||"",edad_unidad:o.edad_unidad||"años",procedencia:o.procedencia||"",tipo_seguro:o.tipo_seguro||"",sexo:o.sexo||"M",direccion:o.direccion||"",telefono:o.telefono||"",email:o.email||""});m.useEffect(()=>{x({id:o.id||void 0,dni:o.dni||"",tipo_documento:o.tipo_documento||"dni",nombre:o.nombre||"",apellido:o.apellido||"",historia_clinica:o.historia_clinica||"",fecha_nacimiento:o.fecha_nacimiento||"",edad:o.edad||"",edad_unidad:o.edad_unidad||"años",procedencia:o.procedencia||"",tipo_seguro:o.tipo_seguro||"",sexo:o.sexo||"M",direccion:o.direccion||"",telefono:o.telefono||"",email:o.email||""})},[o]);const[j,d]=m.useState("");m.useEffect(()=>{n.edad_unidad==="años"&&n.edad&&Number(n.edad)>150?d("La edad no puede superar los 150 años."):d("")},[n.edad,n.edad_unidad]);const[v,p]=m.useState(!1),f=c=>{const{name:s,value:l}=c.target;if(s==="tipo_documento"){x({...n,tipo_documento:l,dni:l==="sin_documento"?"":n.dni});return}if(!(s==="dni"&&n.tipo_documento==="sin_documento"))if(s==="fecha_nacimiento"&&l){const t=new Date,i=new Date(l);let a="",u="años";const C=t-i,b=Math.floor(C/(1e3*60*60*24));if(b<0)a="";else if(b<31)a=b,u="días";else if(b<365)a=(t.getFullYear()-i.getFullYear())*12+t.getMonth()-i.getMonth(),u="meses";else{let h=t.getFullYear()-i.getFullYear();const N=t.getMonth()-i.getMonth();(N<0||N===0&&t.getDate()<i.getDate())&&h--,a=h,u="años"}x({...n,fecha_nacimiento:l,edad:a,edad_unidad:u})}else x({...n,[s]:l})},w=async c=>{c.preventDefault(),p(!0),d("");let s={...n};if(["nombre","apellido","historia_clinica","procedencia","direccion","tipo_seguro"].forEach(i=>{s[i]&&(s[i]=s[i].toUpperCase())}),s.email&&(s.email=s.email.trim()),s.tipo_documento==="dni"){if(!/^\d{8}$/.test(s.dni)){d("El DNI debe tener exactamente 8 dígitos."),p(!1);return}}else if(s.tipo_documento==="carnet_extranjeria"){if(!/^\d{12}$/.test(s.dni)){d("El Carnet de extranjería debe tener exactamente 12 dígitos."),p(!1);return}}else s.tipo_documento==="sin_documento"&&(s.dni=(9999e4+Math.floor(Math.random()*100)).toString());if(s.tipo_documento==="dni"&&s.dni)try{const a=await(await fetch(`${E}api_pacientes.php?busqueda=${s.dni}&limit=1`,{credentials:"include"})).json();if(a.success&&Array.isArray(a.pacientes)&&a.pacientes.length>0){const u=a.pacientes[0];if(!n.id||u.id!==n.id){g.fire({icon:"warning",title:"DNI ya registrado",html:"<div style='font-size:1.1em'><b>El DNI ingresado ya está registrado en el sistema.</b><br>Verifique los datos o busque el paciente existente.</div>",confirmButtonText:"Aceptar",showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp"}}),p(!1);return}}}catch{}const t=await y(s);p(!1),t.success?(r(t.paciente),g.fire({icon:"success",title:n.id?"Paciente actualizado":"Paciente registrado",html:`<b>Historia Clínica:</b> ${t.paciente.historia_clinica||"-"}`,confirmButtonText:"Aceptar"})):(d(t.error||"Error al guardar paciente"),g.fire({icon:"error",title:n.id?"Error al actualizar paciente":"Error al registrar paciente",html:`<div style='font-size:1.1em'>${t.error||(n.id?"Error al actualizar paciente":"Error al registrar paciente")}</div>`,confirmButtonText:"Aceptar",showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp"}}))},_=m.useRef(null),k=c=>{c.key==="Enter"&&document.activeElement!==_.current&&c.preventDefault()};return e.jsxs("div",{className:"w-full h-full px-2 sm:px-0",children:[e.jsxs("h2",{className:"text-2xl font-extrabold mb-6 flex items-center gap-3 justify-center bg-gradient-to-r from-purple-700 via-pink-500 to-blue-500 text-white rounded-xl shadow-lg py-4 px-6 animate__animated animate__fadeInDown",style:{boxShadow:"0 4px 16px rgba(80,0,120,0.12)"},children:[e.jsx("svg",{className:"w-8 h-8 text-white drop-shadow",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 2a10 10 0 100 20 10 10 0 000-20zm0 7v4m0 4h.01"})}),n.id?"Editar Paciente":"Registrar Nuevo Paciente"]}),j&&e.jsx("div",{className:"mb-3 p-2 bg-red-100 text-red-700 rounded text-center font-semibold",children:j}),e.jsxs("form",{onSubmit:w,onKeyDown:k,className:"flex flex-col space-y-4 bg-blue-50 p-4 rounded border border-blue-200 h-full w-full overflow-y-auto",style:{minHeight:"60vh",maxHeight:"70vh"},children:[e.jsx(M,{form:n,handleChange:f}),e.jsx(S,{form:n,handleChange:f}),e.jsx(z,{form:n,handleChange:f}),e.jsx(A,{form:n,handleChange:f}),e.jsx("div",{className:"fixed left-0 right-0 bottom-0 z-10 bg-blue-50 p-4 border-t border-blue-200 w-full sm:static sm:w-auto sm:p-0 sm:border-0",children:e.jsx("button",{type:"submit",ref:_,className:"w-full bg-purple-800 hover:bg-purple-900 text-white rounded-lg px-4 py-3 font-bold text-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",disabled:v,children:v?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.id?"Actualizando...":"Registrando..."]}):n.id?"Actualizar Paciente":"Registrar Paciente"})})]})]})}export{L as P};
