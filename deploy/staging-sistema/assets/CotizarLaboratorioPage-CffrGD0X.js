import{r as u,u as Se,k as Ce,t as Le,j as e,S as I}from"./vendor-B5yQt2qK.js";import{C as Pe}from"./CobroModuloFinal-Vv0lAaBv.js";import{B as y}from"./examenes-laboratorio-crud-BJk1fG4Z.js";function Fe(){const[K,U]=u.useState(!1),[ae,te]=u.useState([]),[q,P]=u.useState({}),[ie,se]=u.useState(0),Q=Se(),v=Ce(),{pacienteId:C}=Le(),[w,ne]=u.useState([]),[ce,le]=u.useState([]),[S,J]=u.useState([]),[E,de]=u.useState([]),[me,ue]=u.useState(!0),[D,be]=u.useState(""),[V,A]=u.useState(""),[W,pe]=u.useState(""),[z,G]=u.useState(0),[F,xe]=u.useState(3),[$,he]=u.useState(null),[_,fe]=u.useState(null),[X,Y]=u.useState({}),[H,Z]=u.useState([]),[ee,R]=u.useState([]),[M,B]=u.useState(null);u.useEffect(()=>{Promise.all([fetch(`${y}api_examenes_laboratorio.php`,{credentials:"include"}).then(o=>o.json()),fetch(`${y}api_tarifas.php`,{credentials:"include"}).then(o=>o.json()),fetch(`${y}api_examenes_laboratorio_ranking.php`,{credentials:"include"}).then(o=>o.json()),C?fetch(`${y}api_pacientes.php?id=${C}`,{credentials:"include"}).then(o=>o.json()):Promise.resolve({success:!1})]).then(([o,r,a,c])=>{ne(o.examenes||[]),de(r.tarifas||[]),le(a.ranking||[]),c&&c.success&&c.paciente&&fe(c.paciente),ue(!1)})},[C]),u.useEffect(()=>{fetch(`${y}api_caja_estado.php`,{credentials:"include"}).then(o=>o.json()).then(o=>B(o?.estado||"cerrada")).catch(()=>B("cerrada"))},[]),u.useEffect(()=>{const o=new URLSearchParams(v.search),r=o.get("cobro_id"),a=o.get("cotizacion_id"),c=[];(r||a)&&R([]),r&&c.push(fetch(`${y}api_cobros.php?cobro_id=${r}`,{credentials:"include"}).then(t=>t.json()).then(t=>{const b=t.cobro||t?.result?.cobro||null;if(!t.success||!b)return;const l=Array.isArray(b.detalles)?b.detalles:[],s=[];l.forEach(i=>{if((i.servicio_tipo||"").toLowerCase()==="laboratorio")try{const T=JSON.parse(i.descripcion);Array.isArray(T)&&s.push(...T)}catch{}}),s.length&&Z(i=>[...i,...s]),s.length&&R(i=>[...i,...s])})),a&&c.push(fetch(`${y}api_cotizaciones.php?cotizacion_id=${a}`,{credentials:"include"}).then(t=>t.json()).then(t=>{const b=t.cotizacion||null;if(!t.success||!b)return;const s=(Array.isArray(b.detalles)?b.detalles:[]).filter(i=>(i.servicio_tipo||"").toLowerCase()==="laboratorio").map(i=>({servicio_id:i.servicio_id,descripcion:i.descripcion,cantidad:i.cantidad,precio_unitario:i.precio_unitario,subtotal:i.subtotal}));s.length&&Z(i=>[...i,...s]),s.length&&R(i=>[...i,...s])})),c.length&&Promise.all(c).catch(()=>{})},[v.search]),u.useEffect(()=>{if(!H.length||!w.length)return;const o=[],r={},a={};H.forEach(t=>{const b=Number(t.servicio_id);let l=w.find(s=>Number(s.id)===b);if(!l){const s=(t.descripcion||"").toString().trim().toLowerCase();l=w.find(i=>(i.nombre||"").toString().trim().toLowerCase()===s)}if(l){const s=Number(l.id);o.push(s),r[s]={derivado:!!t.derivado,tipo:t.tipo_derivacion||"",valor:t.valor_derivacion??"",laboratorio:t.laboratorio_referencia||""},a[s]||(a[s]={cantidad:0,...r[s]}),a[s].cantidad+=Number(t.cantidad||1)}});const c=Array.from(new Set(o));J(c),P(t=>({...t,...r})),Y(a)},[H,w]);const ge=async()=>{const r=new URLSearchParams(v.search).get("cobro_id");if(!r)return;try{const m=await fetch(`${y}api_caja_estado.php`,{credentials:"include"}).then(n=>n.json());if(!m?.success||m?.estado!=="abierta"){B(m?.estado||"cerrada"),I.fire("Error","No hay caja abierta. Abre caja para actualizar este cobro.","error");return}B("abierta")}catch{I.fire("Error","No se pudo verificar el estado de la caja.","error");return}const a=new Set([...S.map(Number),...Object.keys(X||{}).map(Number)]),c=[],t=[];if(a.forEach(m=>{const n=Number(m),d=S.includes(n),p=Number(X[n]?.cantidad||0),x=(d?Math.max(p,1):0)-p;if(x>0){const N=q[n]||{},j=E.find(L=>L.servicio_tipo==="laboratorio"&&Number(L.examen_id)===n&&L.activo===1),g=w.find(L=>Number(L.id)===n),f=j?parseFloat(j.precio_particular):g&&g.precio_publico?parseFloat(g.precio_publico):0;c.push({servicio_id:n,descripcion:g?.nombre||"Examen",cantidad:x,precio_unitario:f,subtotal:f*x,derivado:!!N.derivado,tipo_derivacion:N.tipo||"",valor_derivacion:N.valor||0,laboratorio_referencia:N.laboratorio||""})}else x<0&&t.push({servicio_id:n,cantidad_eliminar:Math.abs(x)})}),c.length===0&&t.length===0){I.fire("Sin cambios","No hay cambios para aplicar.","info");return}let b="";if(t.length>0){const m=await I.fire({title:"Motivo de la reducci√≥n/eliminaci√≥n",input:"text",inputPlaceholder:"Escribe un motivo",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar",inputValidator:n=>{if(!n||!n.trim())return"Motivo requerido"}});if(!m.isConfirmed)return;b=(m.value||"").toString().trim()}let l=Array.isArray(ee)?[...ee]:[];const s=[...c],i=async()=>{const n=await(await fetch(`${y}api_cobros.php?cobro_id=${Number(r)}`,{credentials:"include"})).json(),d=n.cobro||n?.result?.cobro||null;if(!n?.success||!d)return[];const p=Array.isArray(d.detalles)?d.detalles:[],h=[];for(const x of p)if((x?.servicio_tipo||"").toString().toLowerCase()==="laboratorio")try{const N=JSON.parse(x.descripcion);Array.isArray(N)&&h.push(...N)}catch{}return h},T=m=>{const n=m.toString().toLowerCase();return n.includes("no se encontr√≥ el √≠tem a eliminar")||n.includes("detalle del cobro no encontrado")},re=(m,n,d)=>{let p=-1,h=-1,x=-1,N=-1;for(let j=0;j<m.length;j++){const g=m[j];if(Number(g?.servicio_id)!==Number(n))continue;const f=Number(g?.cantidad||0);if(!(f<=0)){if(f===d){p=j;break}f>d&&(h===-1||f<Number(m[h]?.cantidad||0))&&(h=j),f>N&&(N=f,x=j)}}return p!==-1?p:h!==-1?h:x};try{for(const n of t){let d=Number(n.cantidad_eliminar||0);for(;d>0;){let p=re(l,n.servicio_id,d);if(p===-1&&(l=await i(),p=re(l,n.servicio_id,d),p===-1)){if(!l.some(f=>Number(f?.servicio_id)===Number(n.servicio_id))){d=0;break}throw new Error("No se encontr√≥ el √≠tem a reducir en el cobro.")}const h=l[p],x=Number(h?.cantidad||0);if(x<=0)throw new Error("Cantidad inv√°lida en el detalle del cobro.");const j=await(await fetch(`${y}api_cobro_eliminar_item.php`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({cobro_id:Number(r),servicio_tipo:"laboratorio",item:h,motivo:b})})).json();if(!j?.success){const g=j?.error||"No se pudo eliminar el √≠tem del cobro.";if(T(g)){if(l=await i(),!l.some(L=>Number(L?.servicio_id)===Number(n.servicio_id))){d=0;break}continue}throw new Error(g)}if(l.splice(p,1),x>d){const g=x-d,f=Number(h?.precio_unitario||0)||Number(h?.subtotal||0)/Math.max(1,x);s.push({...h,cantidad:g,precio_unitario:f,subtotal:f*g}),d=0}else d-=x}}if(s.length>0){const d=await(await fetch(`${y}api_cobro_actualizar.php`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({cobro_id:Number(r),servicio_tipo:"laboratorio",items:s})})).json();if(!d?.success)throw new Error(d?.error||"No se pudo actualizar el cobro");l=[...l,...s]}const m={};for(const n of l){const d=Number(n?.servicio_id);if(!Number.isFinite(d)||d<=0)continue;const p=Number(n?.cantidad||0);!Number.isFinite(p)||p<=0||(m[d]||(m[d]={cantidad:0,derivado:!!n?.derivado,tipo:n?.tipo_derivacion||"",valor:n?.valor_derivacion??"",laboratorio:n?.laboratorio_referencia||""}),m[d].cantidad+=p,m[d].derivado=m[d].derivado||!!n?.derivado,!m[d].tipo&&n?.tipo_derivacion&&(m[d].tipo=n.tipo_derivacion),(m[d].valor===""||m[d].valor===null||m[d].valor===void 0)&&(n?.valor_derivacion??"")!==""&&(m[d].valor=n.valor_derivacion),!m[d].laboratorio&&n?.laboratorio_referencia&&(m[d].laboratorio=n.laboratorio_referencia))}Y(m),R(l),I.fire("Actualizado","Se aplicaron los cambios en el cobro.","success")}catch(m){I.fire("Error",m?.message||"Fallo de conexi√≥n con el servidor","error")}},ve=o=>{const r=Number(o);J(a=>a.includes(r)?a.filter(c=>c!==r):[...a,r]),A("")},je=()=>S.reduce((o,r)=>{const a=Number(r),c=w.find(l=>Number(l.id)===a),t=E.find(l=>l.servicio_tipo==="laboratorio"&&Number(l.examen_id)===a&&l.activo===1),b=t?parseFloat(t.precio_particular):c&&c.precio_publico?parseFloat(c.precio_publico):0;return o+b},0);if(me)return e.jsx("div",{children:"Cargando ex√°menes y tarifas..."});const Ne=Array.from(new Set(w.map(o=>o.categoria).filter(Boolean))),oe=ce.map(o=>parseInt(o.id)),O=[...w].sort((o,r)=>{const a=oe.indexOf(o.id),c=oe.indexOf(r.id);return a===-1&&c===-1?o.nombre.localeCompare(r.nombre):a===-1?1:c===-1?-1:a-c}).filter(o=>{const r=D.trim().length===0||o.nombre.toLowerCase().includes(D.toLowerCase()),a=W===""||o.categoria===W;return r&&a}),k=Math.max(1,Math.ceil(O.length/F)),ye=O.slice(z*F,z*F+F),we=()=>{J([]),A("")},_e=()=>{if(S.length===0){A("Selecciona al menos un examen para cobrar.");return}const o=S.map(r=>{const a=Number(r),c=w.find(i=>Number(i.id)===a),t=E.find(i=>i.servicio_tipo==="laboratorio"&&Number(i.examen_id)===a&&i.activo===1);let b=c&&typeof c.nombre=="string"&&c.nombre.trim()!==""&&c.nombre!=="0"?c.nombre:"Examen sin nombre";const l=q[r]||{derivado:!1};let s=t?parseFloat(t.precio_particular):c&&c.precio_publico?parseFloat(c.precio_publico):0;return{servicio_tipo:"laboratorio",servicio_id:a,descripcion:b,cantidad:1,precio_unitario:s,subtotal:s,derivado:l.derivado||!1,tipo_derivacion:l.tipo||"",valor_derivacion:l.valor||0,laboratorio_referencia:l.laboratorio||""}});te(o),se(o.reduce((r,a)=>r+a.subtotal,0)),U(!0)};return e.jsxs("div",{className:"max-w-full mx-auto p-4 md:p-16 bg-white rounded-xl shadow-lg mt-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 md:mb-0",children:[e.jsx("span",{className:"text-3xl",children:"üî¨"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Cotizaci√≥n de Laboratorio"}),(new URLSearchParams(v.search).get("cobro_id")||new URLSearchParams(v.search).get("cotizacion_id"))&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded border border-yellow-300",children:new URLSearchParams(v.search).get("cobro_id")?`Editando cobro #${new URLSearchParams(v.search).get("cobro_id")}`:`Editando cotizaci√≥n #${new URLSearchParams(v.search).get("cotizacion_id")}`})]}),e.jsx("div",{className:"flex w-full md:w-auto justify-end items-end",children:(()=>{const o=new URLSearchParams(v.search),r=o.get("cobro_id"),a=o.get("cotizacion_id");return!(r||a)?e.jsx("button",{onClick:()=>Q("/seleccionar-servicio",{state:{pacienteId:C}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"}):e.jsx("button",{onClick:()=>Q(C?`/consumo-paciente/${C}${r?`?cobro_id=${r}`:""}`:"/pacientes"),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"‚Üê Volver a Consumo del Paciente"})})()})]}),e.jsx("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:e.jsxs("div",{className:"text-gray-600",children:[e.jsx("b",{children:"Paciente:"})," ",_?e.jsxs(e.Fragment,{children:[(_.nombres||_.nombre||"").trim()," ",(_.apellidos||_.apellido||"").trim(),_.dni?` (DNI: ${_.dni})`:""]}):e.jsxs(e.Fragment,{children:["ID ",C]})]})}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-2 items-center",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Filtrar por categor√≠a:"}),e.jsxs("select",{value:W,onChange:o=>pe(o.target.value),className:"border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-64",children:[e.jsx("option",{value:"",children:"Todas"}),Ne.map(o=>e.jsx("option",{value:o,children:o},o))]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"flex-1 md:max-w-2xl mx-auto",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Selecciona los ex√°menes:"}),e.jsx("div",{className:"mb-2",children:e.jsx("input",{type:"text",value:D,onChange:o=>be(o.target.value),placeholder:"Buscar examen...",className:"border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-80"})}),e.jsx("div",{className:"mb-2 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:e.jsxs("div",{className:"w-full bg-white shadow-md rounded-xl border border-gray-200 px-4 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"text-sm text-gray-700 flex gap-4 items-center",children:[e.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1",children:["Total ex√°menes: ",e.jsx("b",{children:O.length})]}),e.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1",children:["P√°ginas: ",e.jsx("b",{children:k})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("button",{disabled:z===0||k===1,onClick:()=>G(o=>Math.max(0,o-1)),className:"px-2 py-1 rounded-full bg-blue-100 text-blue-700 disabled:opacity-50 hover:bg-blue-200 transition-colors shadow-sm",title:"P√°gina anterior",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("span",{className:"px-3 py-1 text-sm font-medium bg-gray-50 rounded",children:["P√°gina ",z+1," de ",k||1]}),e.jsx("button",{disabled:z>=k-1||k===1,onClick:()=>G(o=>Math.min(k-1,o+1)),className:"px-2 py-1 rounded-full bg-blue-100 text-blue-700 disabled:opacity-50 hover:bg-blue-200 transition-colors shadow-sm",title:"P√°gina siguiente",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsxs("select",{value:F,onChange:o=>{xe(Number(o.target.value)),G(0)},className:"border border-gray-300 rounded-lg px-2 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 ml-2",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]})]})}),O.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No hay ex√°menes para mostrar."}):e.jsx("div",{className:"bg-white rounded-lg shadow border border-gray-200",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:ye.map(o=>{const r=Number(o.id),a=E.find(s=>s.servicio_tipo==="laboratorio"&&Number(s.examen_id)===r&&s.activo===1),c=S.includes(r),t=q[r]||{derivado:!1,tipo:"",valor:"",laboratorio:""},b=a?a.precio_particular:o.precio_publico?parseFloat(o.precio_publico):"-",l=b!=="-"?Number(b).toFixed(2):"-";return e.jsxs("li",{className:"flex flex-col px-4 py-3 hover:bg-blue-50 transition-colors border-b",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:()=>ve(r),className:"mr-3 accent-blue-600 w-5 h-5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:o.nombre}),o.categoria&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded mt-1 inline-block",children:o.categoria})]}),e.jsxs("div",{className:"font-bold text-green-700 text-lg",children:["S/ ",l]})]}),c&&e.jsxs("div",{className:"mt-2 bg-gray-50 p-3 rounded flex flex-col gap-2",children:[e.jsx("label",{className:"font-semibold text-sm mb-1",children:"¬øSe deriva a laboratorio externo?"}),e.jsxs("select",{value:t.derivado?"si":"no",onChange:s=>P(i=>({...i,[r]:{...i[r],derivado:s.target.value==="si"}})),className:"border rounded px-2 py-1 w-32",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"si",children:"S√≠"})]}),t.derivado&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"font-semibold text-sm",children:"Laboratorio de referencia"}),e.jsx("input",{type:"text",value:t.laboratorio||"",onChange:s=>P(i=>({...i,[r]:{...i[r],laboratorio:s.target.value}})),className:"border rounded px-2 py-1",placeholder:"Nombre del laboratorio"}),e.jsx("label",{className:"font-semibold text-sm",children:"¬øMonto fijo o porcentaje?"}),e.jsxs("select",{value:t.tipo||"",onChange:s=>P(i=>({...i,[r]:{...i[r],tipo:s.target.value}})),className:"border rounded px-2 py-1 w-32",children:[e.jsx("option",{value:"",children:"Seleccionar"}),e.jsx("option",{value:"monto",children:"Monto fijo"}),e.jsx("option",{value:"porcentaje",children:"Porcentaje"})]}),t.tipo==="monto"&&e.jsx("input",{type:"number",min:"0",step:"0.01",value:t.valor!==void 0?t.valor:"",onChange:s=>P(i=>({...i,[r]:{...i[r],valor:s.target.value}})),className:"border rounded px-2 py-1",placeholder:"Monto S/"}),t.tipo==="porcentaje"&&e.jsx("input",{type:"number",min:"0",max:"100",step:"0.01",value:t.valor!==void 0?t.valor:"",onChange:s=>P(i=>({...i,[r]:{...i[r],valor:s.target.value}})),className:"border rounded px-2 py-1",placeholder:"Porcentaje %"})]})]})]},r)})})})]})}),e.jsxs("div",{className:"w-full md:max-w-xl md:sticky md:top-8 h-fit flex flex-col items-center",children:[S.length>0&&!K&&e.jsxs("div",{className:"mb-6 w-full",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotizaci√≥n"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:S.map(o=>{const r=Number(o),a=w.find(l=>Number(l.id)===r),c=E.find(l=>l.servicio_tipo==="laboratorio"&&Number(l.examen_id)===r&&l.activo===1),t=c?c.precio_particular:a&&a.precio_publico?parseFloat(a.precio_publico):"-",b=t!=="-"?Number(t).toFixed(2):"-";return e.jsxs("li",{className:"py-2 flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:a?.nombre}),a?.condicion_paciente&&e.jsxs("span",{className:"block text-xs text-gray-400 mt-1",children:["Condici√≥n: ",a.condicion_paciente]}),a?.tiempo_resultado&&e.jsxs("span",{className:"block text-xs text-gray-400",children:["Tiempo: ",a.tiempo_resultado]})]}),e.jsxs("div",{className:"font-bold text-green-700 text-right",children:["S/ ",b]})]},r)})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",je().toFixed(2)]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:we,className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selecci√≥n"}),new URLSearchParams(v.search).get("cobro_id")?e.jsx("button",{onClick:ge,disabled:M==="cerrada",className:`px-6 py-2 rounded font-bold ${M==="cerrada"?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:"Actualizar cobro"}):e.jsx("button",{onClick:_e,disabled:M==="cerrada",className:`px-6 py-2 rounded font-bold ${M==="cerrada"?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:"Cobrar"})]}),(new URLSearchParams(v.search).get("cobro_id")||!new URLSearchParams(v.search).get("cobro_id"))&&M==="cerrada"&&e.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2",children:[e.jsxs("span",{className:"text-sm text-red-600",children:["Caja cerrada: abre una caja para poder ",new URLSearchParams(v.search).get("cobro_id")?"actualizar":"cobrar","."]}),e.jsx("button",{onClick:()=>Q("/contabilidad"),className:"text-sm bg-yellow-100 text-yellow-800 px-3 py-1 rounded border border-yellow-300 hover:bg-yellow-200",children:"Ir a Contabilidad"})]})]}),K&&_&&e.jsx("div",{className:"w-full max-w-xl mx-auto",children:e.jsx(Pe,{paciente:_,servicio:{key:"laboratorio",label:"Laboratorio"},detalles:ae,total:ie,onCobroCompleto:()=>{U(!1),A("Cotizaci√≥n procesada correctamente.")},onCancelar:()=>U(!1)})})]})]}),V&&e.jsx("div",{className:`mt-6 text-center font-semibold ${V.includes("correctamente")?"text-green-600":"text-red-600"}`,children:V}),$&&e.jsxs("div",{className:"mt-8 mx-auto max-w-lg bg-white rounded-xl shadow-lg border border-blue-200 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-700 mb-2",children:"Comprobante de Cotizaci√≥n"}),e.jsxs("div",{className:"mb-2 text-blue-800 font-semibold",children:["N¬∫ comprobante: ",$.numero]}),e.jsxs("div",{className:"mb-2 text-gray-600 text-sm",children:["Fecha: ",$.fecha]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-4",children:$.detalles.map((o,r)=>e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-800",children:o.descripcion}),e.jsxs("span",{className:"text-green-700 font-bold",children:["S/ ",o.precio_unitario.toFixed(2)]})]},r))}),e.jsxs("div",{className:"text-right text-lg font-bold text-blue-700 border-t pt-2",children:["Total: S/ ",$.total.toFixed(2)]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Imprimir"}),e.jsx("button",{onClick:()=>he(null),className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Cerrar"})]})]})]})}export{Fe as default};
