import{r as p,j as e,v as G}from"./vendor-B5yQt2qK.js";import{B as L}from"./examenes-laboratorio-crud-BJk1fG4Z.js";function I({onSeleccionarOrden:n}){const[k,g]=p.useState("table"),[j,M]=p.useState(3),[w,_]=p.useState(0),[S,$]=p.useState([]),[C,E]=p.useState(!0),[P,d]=p.useState(""),[b,y]=p.useState([]),[A,D]=p.useState(""),[O,B]=p.useState(""),[t,o]=p.useState(""),[a,m]=p.useState("");if(p.useEffect(()=>{E(!0),fetch(L+"api_ordenes_laboratorio.php",{credentials:"include"}).then(s=>s.json()).then(s=>{s.success?$(s.ordenes):d(s.error||"Error al cargar √≥rdenes"),E(!1)}).catch(s=>{d("Error de conexi√≥n con el servidor"),E(!1),console.error("Error al cargar √≥rdenes:",s)}),fetch(L+"api_examenes_laboratorio.php",{credentials:"include"}).then(s=>s.json()).then(s=>{y(s.examenes||[])})},[]),C||b.length===0)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"flex items-center gap-3 text-purple-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),e.jsx("span",{children:"Cargando √≥rdenes de laboratorio..."})]})});if(P)return e.jsx("div",{className:"p-4 text-red-600 bg-red-50 rounded-lg border border-red-200",children:P});const u=(s=>s.filter(i=>{if((A||O)&&i.fecha){const h=new Date(i.fecha),F=A?new Date(A):null,R=O?new Date(O):null;if(F&&h<F||R&&h>new Date(R+"T23:59:59"))return!1}if(t.trim()!==""){const h=t.toLowerCase(),F=(i.paciente_nombre+" "+i.paciente_apellido).toLowerCase(),R=(i.medico_nombre||"").toLowerCase();if(!F.includes(h)&&!R.includes(h))return!1}return!(a&&i.estado!==a)}))([...S].reverse()),r={total:S.length,pendientes:S.filter(s=>s.estado==="pendiente").length,completadas:S.filter(s=>s.estado==="completado").length,hoy:S.filter(s=>{if(!s.fecha)return!1;const i=new Date(s.fecha).toDateString(),h=new Date().toDateString();return i===h}).length},x=Math.ceil(u.length/j),l=u.slice(w*j,(w+1)*j),N=s=>Array.isArray(s)?s.map(i=>{const h=b.find(F=>F.id==i);return h?h.nombre:i}).join(", "):"",f=s=>s?new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"N/A";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm",children:"Total √ìrdenes"}),e.jsx("p",{className:"text-2xl font-bold",children:r.total})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"üìã"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-100 text-sm",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold",children:r.pendientes})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"‚è≥"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-emerald-100 text-sm",children:"Completadas"}),e.jsx("p",{className:"text-2xl font-bold",children:r.completadas})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"‚úÖ"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm",children:"Hoy"}),e.jsx("p",{className:"text-2xl font-bold",children:r.hoy})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"üìÖ"})]})})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Desde"}),e.jsx("input",{type:"date",value:A,onChange:s=>{D(s.target.value),_(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hasta"}),e.jsx("input",{type:"date",value:O,onChange:s=>{B(s.target.value),_(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar"}),e.jsx("input",{type:"text",value:t,onChange:s=>{o(s.target.value),_(0)},placeholder:"Paciente o m√©dico...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsxs("select",{value:a,onChange:s=>{m(s.target.value),_(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"completado",children:"Completado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Por p√°gina"}),e.jsxs("select",{value:j,onChange:s=>{M(Number(s.target.value)),_(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vista:"}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>g("table"),className:`px-3 py-1 rounded-md text-sm transition-colors ${k==="table"?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"üìä Tabla"}),e.jsx("button",{onClick:()=>g("cards"),className:`px-3 py-1 rounded-md text-sm transition-colors ${k==="cards"?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"üóÉÔ∏è Tarjetas"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",l.length," de ",u.length," √≥rdenes"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{disabled:w===0,onClick:()=>_(s=>Math.max(0,s-1)),className:"px-3 py-1 rounded-lg bg-gray-100 disabled:opacity-50 hover:bg-gray-200 transition-colors",children:"‚Üê"}),e.jsxs("span",{className:"px-3 py-1 text-sm",children:[w+1," / ",x||1]}),e.jsx("button",{disabled:w>=x-1,onClick:()=>_(s=>Math.min(x-1,s+1)),className:"px-3 py-1 rounded-lg bg-gray-100 disabled:opacity-50 hover:bg-gray-200 transition-colors",children:"‚Üí"})]})]})]}),u.length===0?e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üîç"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No se encontraron √≥rdenes con los filtros aplicados"})]}):e.jsxs(e.Fragment,{children:[k==="table"&&e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Paciente"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Tipo de Cotizaci√≥n"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden md:table-cell",children:"M√©dico"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden lg:table-cell",children:"Consulta"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden lg:table-cell",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Acciones"})]})}),e.jsx("tbody",{children:l.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-purple-50/50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:["#",s.id]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"font-medium",children:[s.paciente_nombre," ",s.paciente_apellido]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.consulta_id?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 border border-blue-200",children:"M√©dico"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-pink-100 text-pink-800 border border-pink-200",children:"Particular"})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600 hidden md:table-cell",children:[s.medico_nombre," ",s.medico_apellido]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden lg:table-cell",children:s.consulta_id}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden lg:table-cell",children:f(s.fecha)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.estado==="completado"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,children:s.estado==="completado"?"‚úÖ Completado":"‚è≥ Pendiente"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>n(s),className:"inline-flex items-center px-3 py-1.5 bg-gradient-to-r from-purple-500 to-indigo-500 text-white text-xs font-medium rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-all transform hover:scale-105 shadow-md",title:s.estado==="completado"?"Editar resultado":"Llenar resultados",children:s.estado==="completado"?"‚úèÔ∏è Editar":"üìù Procesar"})})})]},s.id))})]})})}),k==="cards"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(s=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6 hover:shadow-xl transition-all transform hover:scale-105",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"üß™"}),e.jsxs("span",{className:"font-bold text-gray-900",children:["#",s.id]})]}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.estado==="completado"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,children:s.estado==="completado"?"‚úÖ":"‚è≥"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Paciente"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[s.paciente_nombre," ",s.paciente_apellido]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"M√©dico"}),e.jsxs("p",{className:"text-sm text-gray-700",children:[s.medico_nombre," ",s.medico_apellido||""]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Consulta"}),e.jsx("p",{className:"text-sm text-gray-700",children:s.consulta_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Fecha"}),e.jsx("p",{className:"text-sm text-gray-700",children:f(s.fecha)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Ex√°menes"}),e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:N(s.examenes)})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>n(s),className:"flex-1 bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-2.5 px-4 rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-all font-medium text-sm shadow-md hover:shadow-lg transform hover:scale-105",children:s.estado==="completado"?"‚úèÔ∏è Editar Resultado":"üìù Procesar Orden"})})})]},s.id))})]})]})}function z({orden:n,onVolver:k,onGuardado:g}){const[j,M]=p.useState([]),[w,_]=p.useState({}),[S,$]=p.useState(!1),[C,E]=p.useState(""),[P,d]=p.useState("success");p.useEffect(()=>{fetch(L+"api_examenes_laboratorio.php",{credentials:"include"}).then(t=>t.json()).then(t=>M(t.examenes||[]))},[]),p.useEffect(()=>{if(!(!j||j.length===0))if(n.resultados&&typeof n.resultados=="object")_({...n.resultados});else{const t={};let o=[];if(typeof n.examenes=="string")try{o=JSON.parse(n.examenes)}catch{o=n.examenes.split(",").map(a=>a.trim()).filter(a=>a)}else Array.isArray(n.examenes)?o=n.examenes:n.examenes&&(o=[n.examenes]);o.forEach(a=>{const m=typeof a=="object"?a.id:a,c=j.find(x=>x.id==m);let u=null;Array.isArray(n.examenes)&&(u=n.examenes.find(x=>typeof x=="object"&&x.id==m)||null);const r=c&&Array.isArray(c.valores_referenciales)&&c.valores_referenciales.length>0?c.valores_referenciales:u&&Array.isArray(u.valores_referenciales)?u.valores_referenciales:[];r.length>0?r.filter(x=>x&&typeof x=="object").forEach(x=>{(x.tipo===void 0||x.tipo==="Par√°metro")&&x.nombre&&x.nombre.trim()!==""&&(t[`${m}__${x.nombre}`]="")}):t[`${m}`]=""}),_(t)}},[n,j]);function b(t){if(t==null)return NaN;if(typeof t=="number")return Number.isFinite(t)?t:NaN;let o=String(t).trim();o=o.replace(/,/g,".");const a=o.match(/-?\d+(?:\.\d+)?/);if(!a)return NaN;const m=parseFloat(a[0]);return Number.isFinite(m)?m:NaN}function y(t,o){if(!t)return"";let a=t;Object.keys(o).sort((c,u)=>u.length-c.length).forEach(c=>{const u=o[c],r=b(u),x=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=new RegExp(x,"g");a=a.replace(l,Number.isFinite(r)?r:0)});try{const c=G(a);return typeof c=="number"&&!isNaN(c)?c.toFixed(1):c}catch{return""}}function A(t){if(!t)return{min:null,max:null};let o=String(t).trim();o=o.replace(/,/g,"."),o=o.replace(/^(?:N\s*:\s*|Normal\s*:\s*)/i,""),o=o.replace(/Rango(?:\s*de)?\s*referencia\s*:?/i,"");const a=o.match(/(-?\d+(?:\.\d+)?)\s*(?:-|‚Äì|‚Äî|a|hasta|entre|y)\s*(-?\d+(?:\.\d+)?)/i);if(a){const x=parseFloat(a[1]),l=parseFloat(a[2]);return{min:Number.isFinite(x)?x:null,max:Number.isFinite(l)?l:null}}const m=o.match(/(?:>=|‚â•|desde|mayor\s*a?)\s*(-?\d+(?:\.\d+)?)/i),c=o.match(/(?:<=|‚â§|hasta|menor\s*a?)\s*(-?\d+(?:\.\d+)?)/i),u=m?parseFloat(m[1]):null,r=c?parseFloat(c[1]):null;return{min:Number.isFinite(u)?u:null,max:Number.isFinite(r)?r:null}}const D=t=>{const o={...w,[t.target.name]:t.target.value};_(o)},O=async t=>{t.preventDefault(),$(!0),E("");try{const o={...w};let a=[];if(typeof n.examenes=="string")try{a=JSON.parse(n.examenes)}catch{a=n.examenes.split(",").map(r=>r.trim()).filter(r=>r)}else Array.isArray(n.examenes)?a=n.examenes:n.examenes&&(a=[n.examenes]);a.forEach(r=>{const x=typeof r=="object"?r.id:r,l=j.find(i=>i.id==x),N=Array.isArray(n.examenes)?n.examenes.find(i=>typeof i=="object"&&i.id==x):null,f=l&&Array.isArray(l.valores_referenciales)&&l.valores_referenciales.length>0?l.valores_referenciales:N&&Array.isArray(N.valores_referenciales)?N.valores_referenciales:[];if(!Array.isArray(f)||f.length===0)return;const s={};f.filter(i=>i&&typeof i=="object").forEach(i=>{(i.tipo===void 0||i.tipo==="Par√°metro")&&i.nombre&&i.nombre.trim()!==""&&(s[i.nombre]=o[`${x}__${i.nombre}`]||"")}),f.filter(i=>i&&typeof i=="object").forEach(i=>{if((i.tipo===void 0||i.tipo==="Par√°metro")&&i.nombre&&i.nombre.trim()!==""&&i.formula&&i.formula.trim()!==""){const h=y(i.formula,s);s[i.nombre]=h??"",o[`${x}__${i.nombre}`]=h??""}})});const m=n.consulta_id?n.consulta_id:n.id,u=await(await fetch(L+"api_resultados_laboratorio.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:m,tipo_examen:"varios",resultados:o})})).json();u.success?(E("‚úÖ Resultados guardados correctamente"),d("success"),setTimeout(()=>{g&&g()},1e3)):(E("‚ùå "+(u.error||"Error al guardar")),d("error"))}catch{E("‚ùå Error de conexi√≥n"),d("error")}finally{$(!1)}},B=(t,o)=>{let a=!1,m=null,c=null;if(t&&t.min!==null&&t.min!==""){const r=b(t.min);Number.isFinite(r)&&(m=r)}else if(t&&t.referencias&&t.referencias[0]){const r=b(t.referencias[0].valor_min);Number.isFinite(r)&&(m=r)}if(t&&t.max!==null&&t.max!==""){const r=b(t.max);Number.isFinite(r)&&(c=r)}else if(t&&t.referencias&&t.referencias[0]){const r=b(t.referencias[0].valor_max);Number.isFinite(r)&&(c=r)}if(m===null&&c===null&&t&&Array.isArray(t.referencias)&&t.referencias[0]){const r=A(t.referencias[0].valor);r.min!==null&&(m=r.min),r.max!==null&&(c=r.max)}let u=b(o);return Number.isFinite(u)&&(m!==null&&u<m&&(a=!0),c!==null&&u>c&&(a=!0)),{fueraDeRango:a,min:m,max:c}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-2xl",children:"üìä"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Procesar Resultados de Laboratorio"}),e.jsx("p",{className:"text-purple-100",children:"Complete los valores para cada examen solicitado"})]})]})}),e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6",children:e.jsx("div",{className:"max-h-[600px] overflow-y-auto space-y-6",children:(()=>{let t=[];if(typeof n.examenes=="string")try{t=JSON.parse(n.examenes)}catch{t=n.examenes.split(",").map(o=>o.trim()).filter(o=>o)}else Array.isArray(n.examenes)?t=n.examenes:n.examenes&&(t=[n.examenes]);return t.map(o=>{const a=typeof o=="object"?o.id:o,m=j.find(r=>r.id==a),c=Array.isArray(n.examenes)?n.examenes.find(r=>typeof r=="object"&&r.id==a):null,u=m&&Array.isArray(m.valores_referenciales)&&m.valores_referenciales.length>0?m.valores_referenciales:c&&Array.isArray(c.valores_referenciales)?c.valores_referenciales:[];if(Array.isArray(u)&&u.length>0){const r={};u.filter(l=>l&&typeof l=="object").forEach(l=>{(l.tipo===void 0||l.tipo==="Par√°metro")&&l.nombre&&l.nombre.trim()!==""&&(r[l.nombre]=w[`${a}__${l.nombre}`]||"")});const x=m&&m.nombre||c&&c.nombre||`Examen ${a}`;return e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-4 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"üß™"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:x}),e.jsx("p",{className:"text-sm text-gray-600",children:"Complete todos los par√°metros requeridos"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:(u||[]).filter(l=>l&&typeof l=="object").map(l=>{if((l.tipo===void 0||l.tipo==="Par√°metro")&&l.nombre&&l.nombre.trim()!==""){const N=l.formula&&l.formula.trim()!=="";let f=w[`${a}__${l.nombre}`]||"";const i=(u||[]).filter(v=>v&&typeof v=="object"&&(v.tipo===void 0||v.tipo==="Par√°metro")&&v.nombre&&v.nombre.trim()!=="").filter(v=>/^item\s*\d+$/i.test((v.nombre||"").trim())),h=/^item\s*\d+$/i.test((l.nombre||"").trim()),F=h?i.findIndex(v=>v===l):-1,R=h?i.length<=1?x:`${x} ‚Äî Par√°metro ${F+1}`:l.nombre;N&&(f=y(l.formula,r)),typeof f=="number"&&isNaN(f)&&(f=""),f==null&&(f="");const{fueraDeRango:J,min:T,max:V}=B(l,f);let q=null;if(T!==null||V!==null)q=`Rango de referencia: ${T!==null?T:"‚àû"} - ${V!==null?V:"‚àû"}`;else if(Array.isArray(l.referencias)&&l.referencias.length>0){const v=l.referencias[0]||{};v.valor&&String(v.valor).trim()!==""&&(q=`Referencia: ${v.valor}`)}return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{children:R}),N&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"üßÆ Calculado"})]}),N&&e.jsxs("span",{className:"text-xs text-blue-600 font-normal",children:["F√≥rmula: ",l.formula]}),q&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:q})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:`${a}__${l.nombre}`,value:f,onChange:N?void 0:D,readOnly:N,required:!0,className:`w-full px-4 py-3 border-2 rounded-lg transition-all duration-200 ${J?"border-red-400 bg-red-50 text-red-700 font-semibold focus:ring-2 focus:ring-red-500":N?"border-blue-200 bg-blue-50 text-blue-800 cursor-not-allowed":"border-gray-300 bg-white hover:border-purple-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:N?"Valor calculado autom√°ticamente":"Ingrese el valor"}),f&&!N&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:J?e.jsx("span",{className:"text-red-500 font-bold",children:"‚ö†Ô∏è"}):e.jsx("span",{className:"text-green-500 font-bold",children:"‚úì"})})]}),J&&(T!==null||V!==null)&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-600 font-medium bg-red-50 px-2 py-1 rounded-md",children:[e.jsx("span",{children:"‚ö†Ô∏è"}),e.jsx("span",{children:"Valor fuera del rango de referencia"})]})]},l.nombre)}return null})})]},a)}else if(m)return e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"üß™"}),e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:m.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Resultado del examen"}),e.jsx("textarea",{name:`${a}`,value:w[`${a}`]||"",onChange:D,rows:4,required:!0,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200",placeholder:"Ingrese el resultado completo del examen..."})]})]},a);return null})})()})}),"        ",e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e.jsx("button",{type:"button",onClick:k,className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium border border-gray-300",children:"‚Üê Cancelar"}),e.jsx("button",{type:"submit",disabled:S,className:"px-8 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:S?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Guardando..."]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"üíæ"}),"Guardar Resultados"]})})]}),C&&e.jsx("div",{className:`p-4 rounded-lg border ${P==="success"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:e.jsx("div",{className:"flex items-center gap-2 font-medium",children:C})})]})]})}function U(){const[n,k]=p.useState("ordenes"),[g,j]=p.useState(null),[M,w]=p.useState(0),[_,S]=p.useState([]);p.useEffect(()=>{fetch(L+"api_examenes_laboratorio.php",{credentials:"include"}).then(d=>d.json()).then(d=>S(d.examenes||[]))},[]);const $=async d=>{if(d.estado==="completado"){const b=d.consulta_id?d.consulta_id:d.id,A=await(await fetch(L+`api_get_resultados_laboratorio.php?orden_id=${b}`)).json();if(A.success&&A.resultado){j({...d,resultados:A.resultado.resultados}),k("procesar");return}}j(d),k("procesar")},C=()=>{j(null),w(d=>d+1),k("ordenes")},E=d=>{if(!d)return"";let b;if(typeof d=="string")try{b=JSON.parse(d)}catch{b=d.split(",").map(y=>y.trim()).filter(y=>y)}else if(Array.isArray(d))b=d;else return d.toString();return Array.isArray(b)?b.map(y=>{if(typeof y=="object"&&y.nombre)return y.nombre;const A=_.find(D=>D.id==y);return A?A.nombre:y}).join(", "):""},P=[{id:"ordenes",label:"√ìrdenes de Laboratorio",icon:"üß™",color:"from-purple-600 to-indigo-600"},{id:"procesar",label:"Procesar Resultados",icon:"üìä",color:"from-blue-600 to-cyan-600",disabled:!g}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-indigo-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 text-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-2xl",children:"üî¨"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Panel de Laboratorio"}),e.jsx("p",{className:"text-purple-100",children:"Gesti√≥n de √≥rdenes y resultados de laboratorio"})]})]}),e.jsx("div",{className:"flex gap-1 bg-white/10 backdrop-blur-sm rounded-lg p-1",children:P.map(d=>e.jsxs("button",{onClick:()=>!d.disabled&&k(d.id),disabled:d.disabled,className:`flex items-center gap-2 px-4 py-2 rounded-md transition-all duration-200 text-sm font-medium ${n===d.id?"bg-white text-purple-600 shadow-lg":d.disabled?"text-purple-200 cursor-not-allowed opacity-50":"text-white hover:bg-white/20"}`,children:[e.jsx("span",{className:"text-lg",children:d.icon}),e.jsx("span",{className:"hidden sm:inline",children:d.label})]},d.id))})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[n==="ordenes"&&e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl shadow-xl border border-white/20",children:e.jsx(I,{onSeleccionarOrden:$},M)}),n==="procesar"&&g&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-sm rounded-lg shadow-md hover:bg-white transition-colors border border-white/20 text-gray-700 hover:text-gray-900",children:[e.jsx("span",{children:"‚Üê"}),e.jsx("span",{children:"Volver a √≥rdenes"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Orden"}),e.jsxs("div",{className:"text-xl font-bold",children:["#",g.id]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Paciente"}),e.jsxs("div",{className:"text-xl font-bold",children:[g.paciente_nombre," ",g.paciente_apellido]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Consulta ID"}),e.jsx("div",{className:"text-xl font-bold",children:g.consulta_id})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Estado"}),e.jsx("div",{className:`text-xl font-bold ${g.estado==="completado"?"text-green-300":"text-yellow-300"}`,children:g.estado==="completado"?"Completado":"Pendiente"})]})]}),e.jsxs("div",{className:"mt-4 bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm mb-2",children:"Ex√°menes solicitados"}),e.jsx("div",{className:"text-lg",children:E(g.examenes)})]})]}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl shadow-xl border border-white/20 p-6",children:e.jsx(z,{orden:g,onVolver:C,onGuardado:C})})]})]})]})}export{U as default};
