import{e as b,w as v,E as _,d as k,r as l,j as e}from"./vendor-B5yQt2qK.js";import{B as S}from"./examenes-laboratorio-crud-BJk1fG4Z.js";function F(t,i,r="descuentos.xlsx"){const x=[i.map(c=>c.label),...t.map(c=>i.map(h=>c[h.key]))],p=b.aoa_to_sheet(x),d=b.book_new();b.book_append_sheet(d,p,"Descuentos"),v(d,r)}function C(t,i,r="descuentos.pdf"){const x=new _;k(x,{head:[i.map(p=>p.label)],body:t.map(p=>i.map(d=>p[d.key])),styles:{fontSize:8},headStyles:{fillColor:[255,140,0]}}),x.save(r)}function P(){const[t,i]=l.useState([]),[r,x]=l.useState(""),[p,d]=l.useState(!0),[c,h]=l.useState(""),[u,j]=l.useState(0),[o,m]=l.useState(1),[n,N]=l.useState(3);l.useEffect(()=>{f()},[c,o,n]);const f=async()=>{d(!0);const s=new URLSearchParams({fecha:c,limit:n,offset:(o-1)*n}),w=await(await fetch(`${S}api_descuentos.php?${s}`)).json();w.success&&(i(w.descuentos),j(w.total)),d(!1)},y=[{key:"fecha",label:"Fecha"},{key:"hora",label:"Hora"},{key:"usuario_nombre",label:"Usuario"},{key:"paciente_nombre",label:"Paciente"},{key:"servicio",label:"Servicio"},{key:"monto_original",label:"Monto Original"},{key:"tipo_descuento",label:"Tipo Descuento"},{key:"valor_descuento",label:"Valor"},{key:"monto_descuento",label:"Monto Descuento"},{key:"monto_final",label:"Monto Final"},{key:"motivo",label:"Motivo"}],g=l.useMemo(()=>{if(!r.trim())return t;const s=r.trim().toLowerCase();return t.filter(a=>a.paciente_nombre&&a.paciente_nombre.toLowerCase().includes(s)||a.usuario_nombre&&a.usuario_nombre.toLowerCase().includes(s)||a.servicio&&a.servicio.toLowerCase().includes(s)||a.motivo&&a.motivo.toLowerCase().includes(s)||a.fecha&&a.fecha.includes(s)||a.hora&&a.hora.includes(s))},[r,t]);return e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8 text-orange-700 text-center",children:"Descuentos Aplicados"}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("label",{className:"font-semibold",children:"Filtrar por fecha:"}),e.jsx("input",{type:"date",value:c,onChange:s=>{h(s.target.value),m(1)},className:"border px-4 py-2 rounded-lg"}),c&&e.jsx("button",{onClick:()=>{h(""),m(1)},className:"ml-2 px-3 py-2 rounded bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-semibold",title:"Limpiar filtro de fecha",children:"Limpiar"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("label",{className:"font-semibold",children:"Filas por pÃ¡gina:"}),e.jsxs("select",{value:n,onChange:s=>{N(Number(s.target.value)),m(1)},className:"border px-2 py-1 rounded-lg",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-2 md:mt-0",children:[e.jsx("input",{type:"text",value:r,onChange:s=>{x(s.target.value),m(1)},placeholder:"Buscar paciente, usuario, servicio, motivo...",className:"border px-3 py-2 rounded-lg w-48 md:w-64"}),e.jsx("button",{onClick:()=>F(t,y),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded font-semibold text-sm",children:"Exportar Excel"}),e.jsx("button",{onClick:()=>C(t,y),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded font-semibold text-sm",children:"Exportar PDF"})]})]}),p?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Cargando..."}):e.jsxs("div",{className:"overflow-x-auto bg-white rounded-xl shadow-lg",children:[e.jsx("div",{className:"min-w-[700px] md:min-w-full",children:e.jsxs("table",{className:"w-full text-xs md:text-sm lg:text-base",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:"Fecha"}),e.jsx("th",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:"Hora"}),e.jsx("th",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:"Usuario"}),e.jsx("th",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:"Paciente"}),e.jsx("th",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:"Servicio"}),e.jsx("th",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:"Monto Original"}),e.jsx("th",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:"Tipo Descuento"}),e.jsx("th",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:"Valor"}),e.jsx("th",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:"Monto Descuento"}),e.jsx("th",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:"Monto Final"}),e.jsx("th",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:"Motivo"})]})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"text-center py-8 text-gray-500",children:"No hay descuentos registrados"})}):g.slice(0,n).map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:s.fecha}),e.jsx("td",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:s.hora}),e.jsx("td",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:s.usuario_nombre}),e.jsx("td",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:s.paciente_nombre}),e.jsx("td",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:s.servicio}),e.jsxs("td",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:["S/ ",parseFloat(s.monto_original).toFixed(2)]}),e.jsx("td",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:s.tipo_descuento}),e.jsx("td",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:s.tipo_descuento==="porcentaje"?`${s.valor_descuento}%`:`S/ ${parseFloat(s.valor_descuento).toFixed(2)}`}),e.jsxs("td",{className:"px-2 md:px-4 py-2 text-orange-700 font-bold whitespace-nowrap",children:["S/ ",parseFloat(s.monto_descuento).toFixed(2)]}),e.jsxs("td",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:["S/ ",parseFloat(s.monto_final).toFixed(2)]}),e.jsx("td",{className:"px-2 md:px-4 py-2 whitespace-nowrap",children:s.motivo})]},s.id))})]})}),u>n&&e.jsxs("div",{className:"flex justify-between items-center px-4 py-4",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["Mostrando ",(o-1)*n+1," - ",Math.min(o*n,u)," de ",u," descuentos"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:o===1,onClick:()=>m(o-1),className:"px-3 py-1 border rounded-lg disabled:opacity-50",children:"Anterior"}),e.jsx("span",{className:"px-4 py-2 bg-orange-600 text-white rounded-lg",children:o}),e.jsx("button",{disabled:o*n>=u,onClick:()=>m(o+1),className:"px-3 py-1 border rounded-lg disabled:opacity-50",children:"Siguiente"})]})]})]})]})}export{P as default};
