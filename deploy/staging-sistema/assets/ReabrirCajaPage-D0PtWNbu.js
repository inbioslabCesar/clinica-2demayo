import{j as e,r as n,u as R}from"./vendor-B5yQt2qK.js";import{B as w}from"./examenes-laboratorio-crud-BJk1fG4Z.js";import{R as L,H}from"./HistorialReaperturasPage-DWG0CTc7.js";function T({cajas:t,page:a,rowsPerPage:i,userRole:o,onReabrir:l}){return e.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Cajas Cerradas Recientes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Ãšltimas 20 cajas cerradas"})]}),e.jsxs("div",{className:"block md:hidden p-4",children:[t.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay cajas cerradas"}):t.slice((a-1)*i,a*i).map(s=>e.jsxs("div",{className:"rounded-xl shadow-lg border border-yellow-100 bg-gradient-to-br from-yellow-50 via-white to-yellow-100 p-4 flex flex-col gap-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-bold text-yellow-800 text-lg",children:["Caja #",s.id]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${parseFloat(s.diferencia||0)===0?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:["Dif.: S/ ",parseFloat(s.diferencia||0).toFixed(2)]})]}),e.jsxs("div",{className:"text-sm text-gray-700 mb-1",children:[e.jsx("span",{className:"font-bold",children:"Fecha:"})," ",s.fecha]}),e.jsxs("div",{className:"text-sm text-gray-700 mb-1",children:[e.jsx("span",{className:"font-bold",children:"Usuario:"})," ",s.usuario_nombre||"-"]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-500 mb-1",children:[e.jsxs("span",{children:["Turno: ",s.turno||"-"]}),e.jsxs("span",{children:["Hora cierre: ",s.hora_cierre?s.hora_cierre.substr(0,8):"-"]})]}),e.jsx("div",{className:"flex gap-2 text-xs text-gray-500 mb-1",children:e.jsxs("span",{children:["Monto cierre: ",e.jsxs("span",{className:"font-bold text-yellow-800",children:["S/ ",parseFloat(s.monto_cierre||0).toFixed(2)]})]})}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{onClick:()=>l(s),className:`p-2 rounded-full bg-yellow-600 hover:bg-yellow-700 text-white flex items-center justify-center shadow ${o!=="administrador"?"opacity-50 cursor-not-allowed":""}`,disabled:o!=="administrador",title:"Reabrir",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})})]},s.id)),e.jsxs("div",{className:"flex justify-center items-center mt-2 gap-2",children:[e.jsx("button",{className:"px-3 py-1 rounded-full bg-yellow-100 text-yellow-700 disabled:opacity-50 hover:bg-yellow-200 transition-colors shadow-sm",disabled:a===1,onClick:()=>l("prev"),children:"Anterior"}),e.jsxs("span",{className:"px-3 py-1 text-sm font-medium bg-gray-50 rounded",children:["PÃ¡gina ",a," de ",Math.max(1,Math.ceil(t.length/i))]}),e.jsx("button",{className:"px-3 py-1 rounded-full bg-yellow-100 text-yellow-700 disabled:opacity-50 hover:bg-yellow-200 transition-colors shadow-sm",disabled:a===Math.max(1,Math.ceil(t.length/i)),onClick:()=>l("next"),children:"Siguiente"})]})]}),e.jsxs("div",{className:"hidden md:block overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Turno"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"H. Cierre"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Monto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Diferencia"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"No hay cajas cerradas"})}):t.slice((a-1)*i,a*i).map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:s.id}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.fecha}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.usuario_nombre||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.turno||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.hora_cierre?s.hora_cierre.substr(0,8):"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:["S/ ",parseFloat(s.monto_cierre||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:`inline-flex px-2 py-1 text-xs rounded-full ${parseFloat(s.diferencia||0)===0?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:["S/ ",parseFloat(s.diferencia||0).toFixed(2)]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>l(s),className:`bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs font-medium transition-colors ${o!=="administrador"?"opacity-50 cursor-not-allowed":""}`,disabled:o!=="administrador",children:"ðŸ”“ Reabrir"})})]},s.id))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{children:["PÃ¡gina ",a," de ",Math.max(1,Math.ceil(t.length/i))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-sm",disabled:a===1,onClick:()=>l("prev"),children:"Anterior"}),e.jsx("button",{className:"btn btn-sm",disabled:a===Math.max(1,Math.ceil(t.length/i)),onClick:()=>l("next"),children:"Siguiente"})]})]})]})]})}function D({caja:t,motivo:a,setMotivo:i,onClose:o,onConfirm:l,procesando:s}){return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("svg",{className:"w-8 h-8 text-yellow-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirmar Reapertura"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Caja ID:"})," ",t.id]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Fecha:"})," ",t.fecha]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Cerrada:"})," ",t.hora_cierre]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Monto:"})," S/ ",parseFloat(t.monto_cierre||0).toFixed(2)]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo de la reapertura *"}),e.jsx("textarea",{value:a,onChange:y=>i(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Describe el motivo de esta reapertura..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition-colors",disabled:s,children:"Cancelar"}),e.jsx("button",{onClick:l,disabled:s||!a.trim(),className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:opacity-50 transition-colors",children:s?"Reabriendo...":"ðŸ”“ Reabrir Caja"})]})]})})}):null}const I=()=>{const[t,a]=n.useState([]),[i,o]=n.useState([]),[l,s]=n.useState("cajas");R();const[y,g]=n.useState(!0),[v,f]=n.useState(!1),[C,x]=n.useState(!1),[m,b]=n.useState(null),[h,j]=n.useState(""),[p,k]=n.useState(3),[d,u]=n.useState(1);n.useEffect(()=>{N()},[]);const N=async()=>{try{g(!0);const r=await fetch(w+"api_cajas_cerradas.php",{credentials:"include"});if(r.ok){const c=await r.json();c.success&&(a(c.cajas_cerradas),o(c.historial_reaperturas))}}catch(r){console.error("Error al cargar datos:",r)}finally{g(!1)}},S=sessionStorage.getItem("user_role")||localStorage.getItem("user_role")||"recepcionista",M=r=>{r==="prev"?u(d>1?d-1:1):r==="next"?u(d<Math.ceil(t.length/p)?d+1:d):(b(r),j(""),x(!0))},_=()=>{x(!1),b(null)},F=async()=>{if(!(!m||!h.trim())){f(!0);try{const r=await fetch(w+"api_reabrir_caja.php",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({caja_id:m.id,motivo:h})});r.ok&&(await r.json()).success&&(N(),x(!1))}catch(r){console.error("Error al reabrir caja:",r)}finally{f(!1)}}};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"w-full max-w-3xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 mb-2 flex items-center",children:[e.jsx("svg",{className:"w-8 h-8 mr-3 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})}),"Reapertura de Caja"]}),e.jsx("p",{className:"text-gray-600",children:"Gestiona la reapertura de cajas cerradas"})]}),e.jsxs("div",{className:"mb-4 flex gap-4",children:[e.jsx("button",{className:`px-4 py-2 rounded font-semibold transition-colors ${l==="cajas"?"bg-yellow-600 text-white":"bg-gray-200 text-gray-700"}`,onClick:()=>s("cajas"),children:"Cajas Cerradas"}),e.jsx("button",{className:`px-4 py-2 rounded font-semibold transition-colors ${l==="historial"?"bg-yellow-600 text-white":"bg-gray-200 text-gray-700"}`,onClick:()=>s("historial"),children:"Historial de Reaperturas"})]}),l==="cajas"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full flex flex-col items-end mb-4",children:e.jsx(L,{rowsPerPage:p,setRowsPerPage:k,setPage:u})}),e.jsx(T,{cajas:t,page:d,rowsPerPage:p,userRole:S,onReabrir:M})]}):e.jsx(H,{}),C&&e.jsx(D,{caja:m,motivo:h,setMotivo:j,onClose:_,onConfirm:F,procesando:v})]})})};export{I as default};
