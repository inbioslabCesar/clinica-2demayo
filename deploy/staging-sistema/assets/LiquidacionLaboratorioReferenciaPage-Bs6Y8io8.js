import{j as e,r as a}from"./vendor-B5yQt2qK.js";import{B as w}from"./examenes-laboratorio-crud-BJk1fG4Z.js";function E({movimientos:b,paginated:t,onVerDetalles:l,onMarcarPagado:n}){return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"space-y-4",children:t.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay movimientos para mostrar."}):t.map((s,h)=>e.jsxs("div",{className:"rounded-xl shadow-lg border border-blue-100 bg-gradient-to-br from-blue-50 via-white to-blue-100 p-4 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-bold text-blue-800 text-lg",children:s.laboratorio}),e.jsx("span",{className:`text-xs px-2 py-1 rounded font-bold ${s.estado==="pendiente"?"bg-yellow-200 text-yellow-800":"bg-green-200 text-green-800"}`,children:s.estado})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-500 mb-1",children:[e.jsxs("span",{children:["Fecha: ",e.jsx("span",{className:"font-bold",children:s.fecha})]}),e.jsxs("span",{children:["Turno: ",s.turno_cobro||"-"]}),e.jsxs("span",{children:["Hora: ",s.hora_cobro||"-"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-500 mb-1",children:[e.jsxs("span",{children:["Tipo: ",s.tipo==="monto"?"Monto fijo":"Porcentaje"]}),e.jsxs("span",{children:["Monto: ",s.tipo==="monto"?`S/ ${parseFloat(s.monto).toFixed(2)}`:`${parseFloat(s.monto).toFixed(2)} %`]})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-500 mb-1",children:[e.jsxs("span",{children:["Usuario Cobro: ",s.cobrado_por||"-"]}),e.jsxs("span",{children:["Usuario Liquid贸: ",s.liquidado_por||"-"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-500 mb-1",children:[e.jsxs("span",{children:["Turno Liquidaci贸n: ",s.turno_liquidacion||"-"]}),e.jsxs("span",{children:["Hora Liquidaci贸n: ",s.hora_liquidacion||"-"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-500 mb-1 items-center",children:[e.jsx("span",{children:"Ex谩menes:"}),e.jsx("button",{title:"Ver detalles",className:"p-2 rounded-full bg-blue-100 hover:bg-blue-200 text-blue-700 shadow-sm",onClick:()=>l(s),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:s.estado==="pendiente"&&e.jsx("button",{title:"Marcar como pagado",onClick:()=>n(s.id),className:"px-4 py-1 rounded bg-green-600 text-white font-bold",children:"Marcar pagado"})})]},s.id))})}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("table",{className:"w-full table-auto border-separate border-spacing-0 bg-white shadow-lg rounded-xl text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-blue-300 text-blue-900",children:[e.jsx("th",{className:"px-3 py-2 font-semibold border-b border-gray-200",children:"Fecha"}),e.jsx("th",{className:"px-3 py-2 font-semibold border-b border-gray-200",children:"Laboratorio"}),e.jsx("th",{className:"hidden sm:table-cell px-3 py-2 font-semibold border-b border-gray-200",children:"Tipo"}),e.jsx("th",{className:"hidden sm:table-cell px-3 py-2 font-semibold border-b border-gray-200",children:"Monto/Porcentaje"}),e.jsx("th",{className:"hidden sm:table-cell px-3 py-2 font-semibold border-b border-gray-200",children:"Usuario Cobro"}),e.jsx("th",{className:"hidden sm:table-cell px-3 py-2 font-semibold border-b border-gray-200",children:"Turno Cobro"}),e.jsx("th",{className:"hidden sm:table-cell px-3 py-2 font-semibold border-b border-gray-200",children:"Hora Cobro"}),e.jsx("th",{className:"hidden sm:table-cell px-3 py-2 font-semibold border-b border-gray-200",children:"Usuario Liquid贸"}),e.jsx("th",{className:"hidden sm:table-cell px-3 py-2 font-semibold border-b border-gray-200",children:"Turno Liquidaci贸n"}),e.jsx("th",{className:"hidden sm:table-cell px-3 py-2 font-semibold border-b border-gray-200",children:"Hora Liquidaci贸n"}),e.jsx("th",{className:"px-3 py-2 font-semibold border-b border-gray-200",children:"Ex谩menes"}),e.jsx("th",{className:"px-3 py-2 font-semibold border-b border-gray-200",children:"Estado"}),e.jsx("th",{className:"px-3 py-2 font-semibold border-b border-gray-200",children:"Acci贸n"})]})}),e.jsx("tbody",{children:t.map((s,h)=>e.jsxs("tr",{className:h%2===0?"bg-white":"bg-blue-50 hover:bg-blue-100 transition",children:[e.jsx("td",{className:"px-2 py-2 border-b border-gray-100 break-words max-w-[120px]",children:s.fecha}),e.jsx("td",{className:"px-2 py-2 border-b border-gray-100 break-words max-w-[120px]",children:s.laboratorio}),e.jsx("td",{className:"hidden sm:table-cell px-3 py-2 border-b border-gray-100 whitespace-nowrap",children:s.tipo==="monto"?"Monto fijo":"Porcentaje"}),e.jsx("td",{className:"hidden sm:table-cell px-3 py-2 border-b border-gray-100 whitespace-nowrap",children:s.tipo==="monto"?`S/ ${parseFloat(s.monto).toFixed(2)}`:`${parseFloat(s.monto).toFixed(2)} %`}),e.jsx("td",{className:"hidden sm:table-cell px-3 py-2 border-b border-gray-100 whitespace-nowrap",children:s.cobrado_por||"-"}),e.jsx("td",{className:"hidden sm:table-cell px-3 py-2 border-b border-gray-100 whitespace-nowrap",children:s.turno_cobro||"-"}),e.jsx("td",{className:"hidden sm:table-cell px-3 py-2 border-b border-gray-100 whitespace-nowrap",children:s.hora_cobro||"-"}),e.jsx("td",{className:"hidden sm:table-cell px-3 py-2 border-b border-gray-100 whitespace-nowrap",children:s.liquidado_por||"-"}),e.jsx("td",{className:"hidden sm:table-cell px-3 py-2 border-b border-gray-100 whitespace-nowrap",children:s.turno_liquidacion||"-"}),e.jsx("td",{className:"hidden sm:table-cell px-3 py-2 border-b border-gray-100 whitespace-nowrap",children:s.hora_liquidacion||"-"}),e.jsx("td",{className:"px-2 py-2 border-b border-gray-100",children:e.jsx("button",{title:"Ver detalles",className:"p-2 rounded-full bg-blue-100 hover:bg-blue-200 text-blue-700 shadow-sm",onClick:()=>l(s),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),e.jsx("td",{className:`px-2 py-2 border-b border-gray-100 font-bold ${s.estado==="pendiente"?"text-yellow-600":"text-green-700"}`,children:s.estado}),e.jsx("td",{className:"px-2 py-2 border-b border-gray-100 text-center",children:s.estado==="pendiente"?e.jsx("button",{title:"Marcar como pagado",onClick:()=>n(s.id),className:"p-2 rounded-full bg-green-100 hover:bg-green-200 text-green-700 shadow-sm",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):null})]},s.id))})]})})]})}function T({open:b,examenes:t,onClose:l}){return b?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 max-w-md w-full relative",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Detalle de Ex谩menes"]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-4",children:t.map((n,s)=>e.jsx("li",{className:"py-2 text-gray-800 font-medium",children:n},s))}),e.jsx("button",{onClick:l,className:"absolute top-2 right-2 bg-gray-200 text-gray-700 rounded-full p-2 hover:bg-gray-300",title:"Cerrar",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}):null}function H(){const[b,t]=a.useState(!1),[l,n]=a.useState([]),[s,h]=a.useState(null),[N,k]=a.useState([]),[d,p]=a.useState(0),[c,L]=a.useState(3),[M,f]=a.useState(!0),[m,C]=a.useState(""),[u,_]=a.useState(""),[F,P]=a.useState([]),[g,y]=a.useState("");a.useEffect(()=>{v()},[]);const v=()=>{f(!0),fetch(`${w}api_laboratorio_referencia_movimientos.php`,{credentials:"include"}).then(r=>r.json()).then(r=>{k(r.movimientos||[]),P(Array.from(new Set((r.movimientos||[]).map(o=>o.laboratorio_referencia).filter(Boolean)))),f(!1)})},S=r=>{fetch(`${w}api_laboratorio_referencia_movimientos.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({accion:"marcar_pagado",id:r})}).then(o=>o.json()).then(o=>{o.success?(y("Movimiento marcado como pagado."),v()):y("Error al marcar como pagado.")})},x=N.filter(r=>{const o=m===""||r.estado===m,j=u===""||r.laboratorio_referencia===u;return o&&j}),i=Math.max(1,Math.ceil(x.length/c)),q=x.slice(d*c,d*c+c);return e.jsxs("div",{className:"w-full max-w-[1600px] mx-auto p-6 bg-white rounded-xl shadow-lg mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-800 mb-6 flex items-center gap-2",children:" Liquidaci贸n Laboratorios de Referencia"}),e.jsx("div",{className:"mb-4",children:e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex flex-col bg-blue-50 rounded-lg p-2",children:[e.jsx("label",{className:"font-semibold text-blue-800 mb-1",children:"Filtrar por estado:"}),e.jsxs("select",{value:m,onChange:r=>C(r.target.value),className:"border rounded px-2 py-2 text-sm focus:outline-blue-400",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"pagado",children:"Pagado"})]})]}),e.jsxs("div",{className:"flex flex-col bg-blue-50 rounded-lg p-2",children:[e.jsx("label",{className:"font-semibold text-blue-800 mb-1",children:"Filtrar por laboratorio:"}),e.jsxs("select",{value:u,onChange:r=>_(r.target.value),className:"border rounded px-2 py-2 text-sm focus:outline-blue-400",children:[e.jsx("option",{value:"",children:"Todos"}),F.map(r=>e.jsx("option",{value:r,children:r},r))]})]})]})}),M?e.jsx("div",{className:"text-center text-gray-500",children:"Cargando movimientos..."}):x.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No hay movimientos para mostrar."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{className:"text-sm text-gray-700 flex gap-4 items-center",children:[e.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1",children:["Total movimientos: ",e.jsx("b",{children:x.length})]}),e.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1",children:["P谩ginas: ",e.jsx("b",{children:i})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("button",{disabled:d===0||i===1,onClick:()=>p(r=>Math.max(0,r-1)),className:"px-2 py-1 rounded-full bg-blue-100 text-blue-700 disabled:opacity-50 hover:bg-blue-200 transition-colors shadow-sm",title:"P谩gina anterior",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("span",{className:"px-3 py-1 text-sm font-medium bg-gray-50 rounded",children:["P谩gina ",d+1," de ",i||1]}),e.jsx("button",{disabled:d>=i-1||i===1,onClick:()=>p(r=>Math.min(i-1,r+1)),className:"px-2 py-1 rounded-full bg-blue-100 text-blue-700 disabled:opacity-50 hover:bg-blue-200 transition-colors shadow-sm",title:"P谩gina siguiente",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsxs("select",{value:c,onChange:r=>{L(Number(r.target.value)),p(0)},className:"border border-gray-300 rounded-lg px-2 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 ml-2",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]})]}),e.jsx(E,{movimientos:x,paginated:q,onVerDetalles:r=>{let o=[];try{o=JSON.parse(r.observaciones),Array.isArray(o)||(o=[r.observaciones])}catch{o=r.observaciones.split(",").map(j=>j.trim())}n(o),h(r),t(!0)},onMarcarPagado:S}),e.jsx(T,{open:b,examenes:l,onClose:()=>t(!1)})]}),g&&e.jsx("div",{className:`mt-6 text-center font-semibold ${g.includes("pagado")?"text-green-600":"text-red-600"}`,children:g})]})}export{H as default};
