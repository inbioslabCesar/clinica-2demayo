import{r as i,S as n,j as e}from"./vendor-B5yQt2qK.js";import{B as m}from"./examenes-laboratorio-crud-BJk1fG4Z.js";function k(){const[a,c]=i.useState({nombre_clinica:"",direccion:"",telefono:"",email:"",horario_atencion:"",logo_url:"",website:"",ruc:"",especialidades:"",mision:"",vision:"",valores:"",director_general:"",jefe_enfermeria:"",contacto_emergencias:""}),[g,x]=i.useState(!1),[h,f]=i.useState(!0),[b,p]=i.useState(!1),[u,d]=i.useState("");i.useEffect(()=>{j()},[]);const j=async()=>{try{f(!0);const r=await fetch(m+"api_get_configuracion.php",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(r.ok){const o=await r.json();if(o.success)c(o.data),o.data&&o.data.logo_url&&d(o.data.logo_url);else throw new Error(o.error||"Error al cargar la configuraci√≥n")}else if(r.status===401){const o=await r.json();throw new Error("üîí Acceso denegado: "+(o.error||"No est√° autenticado como administrador"))}else{const o=await r.text();throw new Error(`Error del servidor: ${r.status} - ${o}`)}}catch(r){r.message.includes("üîí Acceso denegado")?n.fire({title:"üîí Acceso Denegado",text:"Necesita estar autenticado como administrador para ver la configuraci√≥n.",icon:"warning",confirmButtonText:"Ir a Login",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&(window.location.href="/")}):n.fire({title:"Error",text:"No se pudo cargar la configuraci√≥n: "+r.message,icon:"error",confirmButtonText:"OK"})}finally{f(!1)}},s=(r,o)=>{c(t=>({...t,[r]:o}))},v=async()=>{if(!a.nombre_clinica||!a.direccion||!a.telefono||!a.email){n.fire({title:"Error",text:"Por favor, complete todos los campos obligatorios.",icon:"error",confirmButtonText:"OK"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)){n.fire({title:"Error",text:"Por favor, ingrese un email v√°lido.",icon:"error",confirmButtonText:"OK"});return}x(!0);try{const o=await fetch(m+"api_configuracion.php",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(o.ok){const t=await o.json();if(t.success)n.fire({title:"¬°Configuraci√≥n guardada!",text:t.message||"Los cambios se han aplicado exitosamente.",icon:"success",confirmButtonText:"OK"}),a.logo_url&&d(a.logo_url);else throw new Error(t.error||"Error al guardar la configuraci√≥n")}else if(o.status===401){await o.json(),n.fire({title:"üîí Acceso Denegado",text:"Necesita estar autenticado como administrador para modificar la configuraci√≥n.",icon:"warning",confirmButtonText:"Ir a Login",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&(window.location.href="/")});return}else{const t=await o.text();throw console.error("‚ùå Error del servidor:",t),new Error(`Error del servidor: ${o.status} - ${t}`)}}catch(o){console.error("üö® Error al guardar configuraci√≥n:",o),n.fire({title:"Error",text:"No se pudo guardar la configuraci√≥n: "+o.message,icon:"error",confirmButtonText:"OK"})}finally{x(!1)}},y=r=>{const o=r.target.files&&r.target.files[0];if(!o)return;const t=URL.createObjectURL(o);d(t),c(l=>({...l,_logo_file:o}))},w=async()=>{const r=a._logo_file;if(!r){n.fire({title:"Info",text:"Seleccione un archivo primero.",icon:"info"});return}p(!0);try{const o=new FormData;o.append("logo",r);const t=await fetch(m+"api_upload_logo.php",{method:"POST",credentials:"include",body:o}),l=await t.json();if(t.ok&&l.success)c(C=>({...C,logo_url:l.path,_logo_file:null})),d(l.path),n.fire({title:"Listo",text:"Logo subido correctamente.",icon:"success"});else throw new Error(l.error||"Error subiendo archivo")}catch(o){console.error("Error upload logo",o),n.fire({title:"Error",text:"No se pudo subir el logo: "+o.message,icon:"error"})}finally{p(!1)}},N=()=>{c(r=>({...r,logo_url:""})),d("")};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-blue-800",children:"‚öôÔ∏è Configuraci√≥n del Sistema"}),h?e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando configuraci√≥n..."})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-800",children:"Informaci√≥n de la Cl√≠nica"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la Cl√≠nica *"}),e.jsx("input",{type:"text",value:a.nombre_clinica,onChange:r=>s("nombre_clinica",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tel√©fono *"}),e.jsx("input",{type:"tel",value:a.telefono,onChange:r=>s("telefono",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",value:a.email,onChange:r=>s("email",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"RUC (opcional)"}),e.jsx("input",{type:"text",value:a.ruc||"",onChange:r=>s("ruc",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Direcci√≥n *"}),e.jsx("input",{type:"text",value:a.direccion,onChange:r=>s("direccion",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Director General"}),e.jsx("input",{type:"text",value:a.director_general||"",onChange:r=>s("director_general",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Dr. Juan P√©rez"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Jefe de Enfermer√≠a"}),e.jsx("input",{type:"text",value:a.jefe_enfermeria||"",onChange:r=>s("jefe_enfermeria",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enf. Mar√≠a Gonz√°lez"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL del Logo (opcional) / Subir logo"}),e.jsx("input",{type:"url",value:a.logo_url||"",onChange:r=>s("logo_url",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2",placeholder:"https://ejemplo.com/logo.png"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:y,className:"text-sm"}),e.jsx("button",{type:"button",onClick:w,disabled:b,className:"bg-green-600 text-white px-3 py-1 rounded-md hover:bg-green-700 disabled:bg-gray-300 text-sm",children:b?"Subiendo...":"Subir Logo"}),e.jsx("button",{type:"button",onClick:N,className:"bg-red-100 text-red-700 px-3 py-1 rounded-md hover:bg-red-200 text-sm",children:"Eliminar"})]}),u?e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Vista previa:"}),e.jsx("img",{src:u.startsWith("http")?u:"/"+u.replace(/^\/+/,""),alt:"Logo preview",style:{maxHeight:96}})]}):null]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sitio Web (opcional)"}),e.jsx("input",{type:"url",value:a.website||"",onChange:r=>s("website",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://www.ejemplo.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contacto de Emergencias"}),e.jsx("input",{type:"tel",value:a.contacto_emergencias||"",onChange:r=>s("contacto_emergencias",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Emergencias 24h: +51 987-654-321"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Especialidades"}),e.jsx("textarea",{value:a.especialidades||"",onChange:r=>s("especialidades",r.target.value),rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Medicina General, Pediatr√≠a, Ginecolog√≠a, Traumatolog√≠a..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Horario de Atenci√≥n"}),e.jsx("textarea",{value:a.horario_atencion||"",onChange:r=>s("horario_atencion",r.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Lunes a Viernes: 7:00 AM - 8:00 PM..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Misi√≥n Institucional"}),e.jsx("textarea",{value:a.mision||"",onChange:r=>s("mision",r.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brindar servicios de salud de calidad..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Visi√≥n Institucional"}),e.jsx("textarea",{value:a.vision||"",onChange:r=>s("vision",r.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ser el centro de salud de referencia..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valores Institucionales"}),e.jsx("textarea",{value:a.valores||"",onChange:r=>s("valores",r.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Compromiso, Excelencia, Humanizaci√≥n, Integridad..."})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"* Campos obligatorios"}),e.jsx("button",{onClick:v,disabled:g,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 font-medium transition-colors",children:g?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Guardando..."]}):"üíæ Guardar Configuraci√≥n"})]})})]}),e.jsxs("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"‚ÑπÔ∏è Informaci√≥n del Sistema"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Versi√≥n:"})," 1.0.0"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Base de datos:"})," MySQL"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Servidor web:"})," Apache (Laragon)"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Framework:"})," React + Vite"]})]})]})]})}export{k as default};
