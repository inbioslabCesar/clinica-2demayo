import{r,S as i,j as e}from"./vendor-B5yQt2qK.js";import{B as j,M as T}from"./examenes-laboratorio-crud-BJk1fG4Z.js";const N={titulo:"",descripcion:"",precio:"",icono:"",orden:0,activo:!0};function D(){const[v,h]=r.useState(!0),[f,w]=r.useState([]),[y,c]=r.useState(!1),[t,o]=r.useState(N),[d,g]=r.useState(null),[x,u]=r.useState(null),p=r.useMemo(()=>`${j}api_web_servicios.php`,[]),E=r.useMemo(()=>`${j}api_web_servicios_upload.php`,[]),m=r.useCallback(async()=>{h(!0);try{const a=await(await fetch(p,{credentials:"include"})).json();if(!a?.success)throw new Error(a?.error||"No se pudo cargar");w(a.servicios||[])}catch(s){i.fire("Error",s?.message||"Error al cargar servicios","error")}finally{h(!1)}},[p]);r.useEffect(()=>{m()},[m]);function C(){g(null),o(N),u(null),c(!0)}function S(s){g(s.id),o({titulo:s.titulo||"",descripcion:s.descripcion||"",precio:s.precio??"",icono:s.icono||"",imagen_url:s.imagen_url||"",orden:s.orden??0,activo:!!s.activo}),u(null),c(!0)}async function k(){if(!x)return null;const s=(x.name||"").toLowerCase();if(!(s.endsWith(".png")||s.endsWith(".jpg")||s.endsWith(".jpeg")))throw new Error("La imagen debe ser PNG o JPG");const a=new FormData;a.append("imagen",x);const n=await fetch(E,{method:"POST",body:a,credentials:"include"}),l=await n.json().catch(()=>null);if(!n.ok||!l?.success)throw new Error(l?.error||"No se pudo subir la imagen");return l.url}async function _(s){s.preventDefault();try{const a=await k(),n={...t,precio:t.precio===""?null:Number(t.precio),orden:Number(t.orden||0),activo:!!t.activo};a&&(n.imagen_url=a);const l=d?"PUT":"POST";d&&(n.id=d);const b=await(await fetch(p,{method:l,headers:{"Content-Type":"application/json"},body:JSON.stringify(n),credentials:"include"})).json();if(!b?.success)throw new Error(b?.error||"No se pudo guardar");c(!1),u(null),await m(),i.fire("Listo","Guardado correctamente","success")}catch(a){i.fire("Error",a?.message||"Error al guardar","error")}}async function P(s){if((await i.fire({title:"¿Desactivar servicio?",text:"El servicio dejará de mostrarse en la web pública",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, desactivar",cancelButtonText:"Cancelar"})).isConfirmed)try{const l=await(await fetch(p,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s}),credentials:"include"})).json();if(!l?.success)throw new Error(l?.error||"No se pudo desactivar");await m()}catch(n){i.fire("Error",n?.message||"Error al desactivar","error")}}return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-800",children:"Servicios Web"}),e.jsx("button",{onClick:C,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"+ Nuevo"})]}),v?e.jsx("div",{className:"text-gray-600",children:"Cargando…"}):e.jsx("div",{className:"bg-white rounded shadow overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Título"}),e.jsx("th",{className:"p-2 text-left",children:"Precio"}),e.jsx("th",{className:"p-2 text-left",children:"Orden"}),e.jsx("th",{className:"p-2 text-left",children:"Activo"}),e.jsx("th",{className:"p-2 text-left",children:"Acciones"})]})}),e.jsxs("tbody",{children:[f.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:s.titulo}),e.jsx("td",{className:"p-2",children:s.precio??""}),e.jsx("td",{className:"p-2",children:s.orden??0}),e.jsx("td",{className:"p-2",children:s.activo?"Sí":"No"}),e.jsxs("td",{className:"p-2 flex gap-2",children:[e.jsx("button",{className:"px-3 py-1 rounded bg-yellow-500 text-white",onClick:()=>S(s),children:"Editar"}),e.jsx("button",{className:"px-3 py-1 rounded bg-red-600 text-white",onClick:()=>P(s.id),children:"Desactivar"})]})]},s.id)),f.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-4 text-gray-600",colSpan:5,children:"No hay servicios."})})]})]})}),e.jsxs(T,{open:y,onClose:()=>c(!1),children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:[d?"Editar":"Nuevo"," servicio"]}),e.jsxs("form",{onSubmit:_,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Título"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",value:t.titulo,onChange:s=>o(a=>({...a,titulo:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Precio (opcional)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",type:"number",step:"0.01",value:t.precio,onChange:s=>o(a=>({...a,precio:s.target.value}))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Descripción"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",rows:3,value:t.descripcion,onChange:s=>o(a=>({...a,descripcion:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Icono (opcional)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",value:t.icono,onChange:s=>o(a=>({...a,icono:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Imagen URL (opcional)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",value:t.imagen_url||"",onChange:s=>o(a=>({...a,imagen_url:s.target.value}))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Subir imagen (PNG o JPG)"}),e.jsx("input",{className:"w-full",type:"file",accept:".png,.jpg,.jpeg,image/png,image/jpeg",onChange:s=>u(s.target.files?.[0]||null)}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Si seleccionas una imagen, se subirá y reemplazará la URL."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Orden"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",type:"number",value:t.orden,onChange:s=>o(a=>({...a,orden:s.target.value}))})]}),e.jsxs("div",{className:"md:col-span-2 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!t.activo,onChange:s=>o(a=>({...a,activo:s.target.checked}))}),e.jsx("span",{className:"text-sm",children:"Activo"})]}),e.jsxs("div",{className:"md:col-span-2 flex gap-3",children:[e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",type:"submit",children:"Guardar"}),e.jsx("button",{className:"border px-4 py-2 rounded",type:"button",onClick:()=>c(!1),children:"Cancelar"})]})]})]})]})}export{D as default};
