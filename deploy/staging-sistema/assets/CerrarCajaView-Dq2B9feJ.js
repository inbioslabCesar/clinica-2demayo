import{r as x,u as $,j as e,S as T}from"./vendor-B5yQt2qK.js";import"./examenes-laboratorio-crud-BJk1fG4Z.js";function L(s,a=null){const o=a?.total_efectivo??s.total_efectivo??0,v=a?.total_yape??s.total_yape??0,p=a?.total_plin??s.total_plin??0,w=a?.total_tarjetas??s.total_tarjetas??0,j=a?.total_transferencias??s.total_transferencias??0,f=a?.egreso_honorarios??s.egreso_honorarios??0,u=a?.egreso_lab_ref??s.egreso_lab_ref??0,g=a?.egreso_operativo??s.egreso_operativo??0,n=s.egreso_electronico!==void 0&&s.egreso_electronico!==""&&!isNaN(parseFloat(s.egreso_electronico))?parseFloat(s.egreso_electronico):0,b=a?.total_egresos??f+u+g;let h="";(s.monto_contado!==void 0?parseFloat(s.monto_contado):0)-b<0&&(h="<div style='color:red;font-weight:bold;margin-top:8px;'>No hay efectivo suficiente, egreso cubierto por Yape, Plin, transferencia, o se qued√≥ debiendo tal egreso.</div>");const _=`
    <div style="font-family: monospace; font-size: 18px; width: 320px;">
      <h3 style="text-align:center;margin-bottom:8px;">üßæ Cierre de Caja</h3>
      <hr>
      <div><b>Usuario:</b> ${s.usuario_nombre||"-"}</div>
      <div><b>Rol:</b> ${s.usuario_rol||"-"}</div>
      <div><b>Fecha:</b> ${s.fecha||"-"}</div>
      <div><b>Apertura:</b> S/ ${(s.monto_apertura||0).toFixed(2)}</div>
      <div><b>Hora apertura:</b> ${s.hora_apertura||"-"}</div>
      <div><b>Hora cierre:</b> ${s.hora_cierre||"-"}</div>
      <hr>
      <div><b>Ingresos por tipo:</b></div>
      <ul style="margin-left:10px;">
        <li>Efectivo: S/ ${o.toFixed(2)}</li>
        <li>Yape: S/ ${v.toFixed(2)}</li>
        <li>Plin: S/ ${p.toFixed(2)}</li>
        <li>Tarjeta: S/ ${w.toFixed(2)}</li>
        <li>Transferencia: S/ ${j.toFixed(2)}</li>
      </ul>
      <div><b>Egresos:</b></div>
      <ul style="margin-left:10px;">
        <li>Honorarios M√©dicos: S/ ${f.toFixed(2)}</li>
        <li>Lab. Referencia: S/ ${u.toFixed(2)}</li>
        <li>Operativo: S/ ${g.toFixed(2)}</li>
        <li style="color:purple;"><b>Egresos cubiertos por Yape/Transferencias:</b> S/ ${n.toFixed(2)}</li>
        <li><b>Total egresos:</b> S/ ${b.toFixed(2)}</li>
      </ul>
      <div><b>Ocurrencias:</b></div>
      <div style="white-space:pre-line;">${s.observaciones||""}</div>
      ${h}
      <hr>
      <div style="text-align:center;font-size:12px;margin-top:8px;">Conserve este recibo para archivo</div>
    </div>
  `;T.fire({title:"Cierre de Caja Procesado ‚úÖ",html:_,icon:"success",confirmButtonText:"Imprimir Recibo",showCancelButton:!0,cancelButtonText:"Solo Continuar"}).then(y=>{if(y.isConfirmed){const m=window.open("","_blank");m.document.write(_),m.document.close(),m.print()}})}function R(){const[s,a]=x.useState(""),[o,v]=x.useState(null),[p,w]=x.useState(""),[j,f]=x.useState(!0),[u,g]=x.useState(""),[n,b]=x.useState(""),h=$();x.useEffect(()=>{async function t(){f(!0);try{const r=await(await fetch("/api_resumen_diario.php",{credentials:"include"})).json();r.success?(v(r),g("")):g(r.error||"Error al cargar resumen")}catch{g("Error de conexi√≥n")}finally{f(!1)}}t()},[]);const N=o?.por_pago?o.por_pago.reduce((t,l)=>t+parseFloat(l.total_pago||0),0):0,_=o?N-(parseFloat(o.egreso_honorarios||0)+parseFloat(o.egreso_lab_ref||0)+parseFloat(o.egreso_operativo||0)):0,y=async()=>{let t=0,l=0,r=0,S=0;o?.por_pago?.length&&o.por_pago.forEach(c=>{const i=(c.metodo_pago||c.tipo_pago||"").toLowerCase();i==="yape"&&(t=parseFloat(c.total_pago)),i==="plin"&&(l=parseFloat(c.total_pago)),i==="tarjeta"&&(r=parseFloat(c.total_pago)),i==="transferencia"&&(S=parseFloat(c.total_pago))});try{const i=await(await fetch("/api_cerrar_caja.php",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({monto_contado:p,observaciones:s,total_yape:t,total_plin:l,total_tarjetas:r,total_transferencias:S,egreso_electronico:n})})).json();i.success?(L({...o,observaciones:s,monto_contado:p,egreso_electronico:n,hora_cierre:i.hora_cierre||new Date().toLocaleTimeString("es-PE",{hour:"2-digit",minute:"2-digit",hour12:!0}),usuario_nombre:i.usuario_nombre||(window.sessionStorage.getItem("usuario")?JSON.parse(window.sessionStorage.getItem("usuario")).nombre:""),usuario_rol:i.usuario_rol||(window.sessionStorage.getItem("usuario")?JSON.parse(window.sessionStorage.getItem("usuario")).rol:"")},i.totales),setTimeout(()=>h("/contabilidad"),500)):alert("Error: "+(i.error||"No se pudo cerrar la caja"))}catch{alert("Error de conexi√≥n al cerrar caja")}};if(j)return e.jsx("div",{className:"p-8 text-center",children:"Cargando resumen..."});if(u)return e.jsx("div",{className:"p-8 text-center text-red-600",children:u});if(!o)return null;const m=(()=>{const t=o?.por_pago?.find(l=>(l.metodo_pago||l.tipo_pago)?.toLowerCase()==="efectivo");return t?parseFloat(t.total_pago):0})(),C=n!==""&&!isNaN(parseFloat(n))?parseFloat(n):0,E=(o.egreso_honorarios?o.egreso_honorarios:0)+(o.egreso_lab_ref?o.egreso_lab_ref:0)+(o.egreso_operativo?o.egreso_operativo:0),F=m-(E-C),d=parseFloat(p||0)-F;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"max-w-3xl mx-auto p-4 sm:p-8 bg-gradient-to-br from-red-50 via-white to-red-100 rounded-2xl shadow-2xl",children:[e.jsxs("h2",{className:"text-3xl font-extrabold mb-6 text-red-700 flex items-center gap-3 drop-shadow",children:[e.jsx("span",{className:"inline-block bg-red-100 text-red-700 rounded-full p-2 text-3xl",children:"üßæ"}),"Cierre de Caja"]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 justify-center",children:[e.jsxs("div",{className:"bg-orange-100 rounded-xl px-6 py-3 flex flex-col items-center shadow-lg w-full sm:w-auto",children:[e.jsx("span",{className:"text-xs text-orange-700 font-semibold",children:"Fecha"}),e.jsx("span",{className:"font-bold text-orange-800 text-lg tracking-wide",children:o.fecha})]}),e.jsxs("div",{className:"bg-blue-100 rounded-xl px-6 py-3 flex flex-col items-center shadow-lg w-full sm:w-auto",children:[e.jsx("span",{className:"text-xs text-blue-700 font-semibold",children:"Apertura"}),e.jsxs("span",{className:"font-bold text-blue-800 text-lg tracking-wide",children:["S/ ",o.monto_apertura?.toFixed(2)]})]}),e.jsxs("div",{className:"bg-yellow-100 rounded-xl px-6 py-3 flex flex-col items-center shadow-lg w-full sm:w-auto",children:[e.jsx("span",{className:"text-xs text-yellow-700 font-semibold",children:"Ingreso total del d√≠a"}),e.jsxs("span",{className:"font-bold text-yellow-800 text-lg tracking-wide",children:["S/ ",N.toFixed(2)]})]}),e.jsxs("div",{className:"bg-green-100 rounded-xl px-6 py-3 flex flex-col items-center shadow-lg w-full sm:w-auto",children:[e.jsx("span",{className:"text-xs text-green-700 font-semibold",children:"Ganancia del d√≠a"}),e.jsxs("span",{className:"font-bold text-green-800 text-lg tracking-wide",children:["S/ ",_.toFixed(2)]}),e.jsx("span",{className:"text-xs text-gray-600 mt-1",children:"(Ingreso total - egresos)"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("span",{className:"font-semibold text-gray-700 mb-2 block text-lg",children:"Cobros por tipo de pago:"}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1 scrollbar-thin scrollbar-thumb-blue-200 scrollbar-track-blue-50 snap-x snap-mandatory",children:o.por_pago?.map((t,l)=>{let r="green";return(t.metodo_pago||t.tipo_pago).toLowerCase().includes("tarjeta")?r="blue":(t.metodo_pago||t.tipo_pago).toLowerCase().includes("yape")||(t.metodo_pago||t.tipo_pago).toLowerCase().includes("plin")||(t.metodo_pago||t.tipo_pago).toLowerCase().includes("transfer")?r="purple":(t.metodo_pago||t.tipo_pago).toLowerCase().includes("efectivo")&&(r="yellow"),e.jsxs("div",{className:`rounded-xl shadow-lg bg-white border-t-4 border-${r}-400 px-4 py-3 flex flex-col items-center gap-1 w-full sm:w-[140px] snap-center transition-all hover:scale-105`,children:[e.jsx("span",{className:`font-bold text-${r}-700 text-sm truncate`,children:(t.metodo_pago||t.tipo_pago).toUpperCase()}),e.jsxs("span",{className:`text-base text-${r}-600 font-mono`,children:["S/ ",parseFloat(t.total_pago).toFixed(2)]})]},l)})})]}),e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsxs("div",{className:"bg-yellow-100 rounded-xl px-6 py-5 flex flex-col items-center shadow-lg",children:[e.jsx("span",{className:"text-xs text-yellow-700 font-semibold",children:"Efectivo cobrado"}),e.jsxs("span",{className:"font-bold text-yellow-800 text-2xl",children:["S/ ",m.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-4 flex-wrap justify-center my-2",children:[e.jsxs("div",{className:"bg-orange-100 rounded-xl px-6 py-4 flex flex-col items-center shadow-lg min-w-[160px]",children:[e.jsx("span",{className:"text-xs text-orange-700 font-semibold flex items-center gap-1",children:"ü©∫ Honorarios M√©dicos"}),e.jsxs("span",{className:"font-bold text-orange-800 text-lg",children:["- S/ ",o.egreso_honorarios?o.egreso_honorarios.toFixed(2):"0.00"]})]}),e.jsxs("div",{className:"bg-pink-100 rounded-xl px-6 py-4 flex flex-col items-center shadow-lg min-w-[160px]",children:[e.jsx("span",{className:"text-xs text-pink-700 font-semibold flex items-center gap-1",children:"üßë‚Äçüî¨ Honorarios Lab. Ref."}),e.jsxs("span",{className:"font-bold text-pink-800 text-lg",children:["- S/ ",o.egreso_lab_ref?o.egreso_lab_ref.toFixed(2):"0.00"]})]}),e.jsxs("div",{className:"bg-indigo-100 rounded-xl px-6 py-4 flex flex-col items-center shadow-lg min-w-[160px]",children:[e.jsx("span",{className:"text-xs text-indigo-700 font-semibold flex items-center gap-1",children:"üõ†Ô∏è Egreso Operativo"}),e.jsxs("span",{className:"font-bold text-indigo-800 text-lg",children:["- S/ ",o.egreso_operativo?o.egreso_operativo.toFixed(2):"0.00"]})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap justify-center my-2",children:e.jsxs("div",{className:"bg-gray-100 rounded-xl px-6 py-3 flex flex-col items-center shadow-lg min-w-[160px]",children:[e.jsx("span",{className:"text-xs text-gray-700 font-semibold",children:"Total egresos"}),e.jsxs("span",{className:"font-bold text-gray-800 text-lg",children:["- S/ ",((o.egreso_honorarios?o.egreso_honorarios:0)+(o.egreso_lab_ref?o.egreso_lab_ref:0)+(o.egreso_operativo?o.egreso_operativo:0)).toFixed(2)]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-2",children:[e.jsxs("div",{className:"flex-1 bg-yellow-200 rounded-xl px-6 py-5 flex flex-col items-center shadow-lg",children:[e.jsx("span",{className:"text-xs text-yellow-700 font-semibold",children:"Efectivo esperado"}),e.jsxs("span",{className:"font-bold text-yellow-800 text-3xl",children:["S/ ",F.toFixed(2)]}),e.jsx("span",{className:"text-xs text-gray-700 mt-1",children:"(Efectivo cobrado - total egresos + egreso electr√≥nico)"})]}),e.jsxs("div",{className:"flex-1 bg-purple-100 rounded-xl px-6 py-5 flex flex-col items-center shadow-lg",children:[e.jsx("span",{className:"text-xs text-purple-700 font-semibold",children:"Egresos cubiertos por Yape/Transferencias"}),e.jsx("input",{type:"number",value:n,onChange:t=>b(t.target.value),className:"border-2 border-purple-300 rounded-xl px-4 py-2 mt-2 text-xl text-center font-bold w-full max-w-[160px] focus:ring-2 focus:ring-purple-400 bg-white",placeholder:"S/ 0.00",min:0,step:.01}),e.jsx("span",{className:"text-xs text-gray-700 mt-1",children:"(Descontado del total egreso)"})]}),e.jsxs("div",{className:"flex-1 bg-green-100 rounded-xl px-6 py-5 flex flex-col items-center shadow-lg",children:[e.jsx("span",{className:"text-xs text-green-700 font-semibold",children:"Efectivo contado"}),e.jsx("input",{type:"number",value:p,onChange:t=>w(t.target.value),className:"border-2 border-green-300 rounded-xl px-4 py-2 mt-2 text-xl text-center font-bold w-full max-w-[160px] focus:ring-2 focus:ring-green-400 bg-white",placeholder:"S/ 0.00"})]}),e.jsxs("div",{className:`flex-1 rounded-xl px-6 py-5 flex flex-col items-center shadow-lg ${d===0?"bg-green-200":d>0?"bg-blue-100":"bg-red-100"}`,children:[e.jsx("span",{className:"text-xs font-semibold mb-1",children:"Diferencia"}),e.jsxs("span",{className:`font-bold text-3xl ${d===0?"text-green-700":d>0?"text-blue-700":"text-red-700"}`,children:["S/ ",d.toFixed(2)]}),d===0?e.jsx("span",{className:"text-green-700 text-xs font-semibold mt-1",children:"¬°Cuadre perfecto!"}):d>0?e.jsx("span",{className:"text-blue-700 text-xs font-semibold mt-1",children:"Sobra efectivo"}):e.jsx("span",{className:"text-red-700 text-xs font-semibold mt-1",children:"Falta efectivo"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-base font-semibold text-gray-700 mb-2",htmlFor:"observaciones",children:"Ocurrencias / Observaciones"}),e.jsx("textarea",{id:"observaciones",value:s,onChange:t=>a(t.target.value),className:"w-full border-2 border-red-300 rounded-xl px-4 py-3 min-h-[70px] resize-y focus:ring-2 focus:ring-red-400 bg-white text-base",placeholder:"Escribe aqu√≠ cualquier ocurrencia, incidente o comentario relevante antes del cierre..."})]}),e.jsx("button",{className:"bg-gradient-to-r from-red-500 to-red-700 text-white px-10 py-4 rounded-2xl shadow-xl font-extrabold text-xl w-full mt-2 transition-all hover:scale-105 hover:from-red-600 hover:to-red-800",onClick:y,children:"Confirmar cierre de caja"})]})})}export{R as default};
