import{r as t,c as ie,j as e,I as V,i as Te,L as ae,S as W,d as fe,C as Me,e as De,f as pe,u as de,w as Pe,b as $e,E as je,a as Ne,R as be,l as ve,g as xe,h as Ae,N as ue,k as ze,m as we,n as Ce,o as ke,p as Be,q as Oe,s as Re,t as _e,v as He,x as Ie,B as Ve,y as We,z as Q,A as qe}from"./vendor-21pl5SCj.js";import{B as O,E as Ue}from"./examenes-laboratorio-crud-CdCrF0QH.js";import{P as Ge,a as Je,S as ye}from"./paciente-list-CPVweBQ7.js";import{U as Xe}from"./usuario-list-CiAp3Udi.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))d(x);new MutationObserver(x=>{for(const w of x)if(w.type==="childList")for(const y of w.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&d(y)}).observe(document,{childList:!0,subtree:!0});function a(x){const w={};return x.integrity&&(w.integrity=x.integrity),x.referrerPolicy&&(w.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?w.credentials="include":x.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function d(x){if(x.ep)return;x.ep=!0;const w=a(x);fetch(x.href,w)}})();function Ke({onLogin:s}){const[r,a]=t.useState(""),[d,x]=t.useState(""),[w,y]=t.useState(""),[p,j]=t.useState(!1),[N,v]=t.useState(!1),C=ie(),l=()=>window.location.protocol!=="https:"&&window.location.hostname!=="localhost"?{isValid:!1,message:"⚠️ Conexión insegura detectada. Se requiere HTTPS para proteger tus credenciales."}:{isValid:!0},_=async L=>{L.preventDefault(),y(""),j(!0);const c=l();if(!c.isValid){y(c.message),j(!1);return}const b=r.includes("@")&&r.includes(".");try{if(b){let n,o;try{n=await fetch(O+"api_login_medico.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:r,password:d}),credentials:"include"}),o=await n.json()}catch{n={ok:!1},o={}}if(n.ok&&o.success){const E={...o.medico,rol:"medico"};sessionStorage.setItem("medico",JSON.stringify(E)),s&&s(E),C("/");return}let m,f;try{m=await fetch(O+"api_login.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({usuario:r,password:d}),credentials:"include"}),f=await m.json()}catch{m={ok:!1},f={}}if(m.ok&&f.success){sessionStorage.setItem("usuario",JSON.stringify(f.usuario)),s&&s(f.usuario),C("/");return}}else{let n,o;try{n=await fetch(O+"api_login.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({usuario:r,password:d}),credentials:"include"}),o=await n.json()}catch{n={ok:!1},o={}}if(n.ok&&o.success){sessionStorage.setItem("usuario",JSON.stringify(o.usuario)),s&&s(o.usuario),C("/");return}let m,f;try{m=await fetch(O+"api_login_medico.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:r,password:d}),credentials:"include"}),f=await m.json()}catch{m={ok:!1},f={}}if(m.ok&&f.success){const E={...f.medico,rol:"medico"};sessionStorage.setItem("medico",JSON.stringify(E)),s&&s(E),C("/");return}}y("Usuario o contraseña incorrectos")}catch{y("Error de conexión con el servidor")}finally{j(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-900 via-purple-800 to-indigo-900 flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-blue-400/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-80 h-80 bg-purple-400/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-3/4 left-1/2 w-64 h-64 bg-indigo-400/20 rounded-full blur-3xl"})]}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl border border-white/20 shadow-2xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"relative mx-auto w-20 h-20 mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full blur-lg opacity-60"}),e.jsx("img",{src:"/2demayo.svg",alt:"Logo clínica",className:"relative w-20 h-20 object-contain bg-white/90 rounded-full p-3 shadow-lg ring-4 ring-white/30"})]}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2 drop-shadow-lg",children:"Clínica 2 de Mayo"}),e.jsx("p",{className:"text-lg text-white/80",children:"Acceso al Sistema Médico"})]}),e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(V,{iconName:"Contact",className:"text-xl text-white/60"})}),e.jsx("input",{type:"text",placeholder:"Usuario o email del médico",value:r,onChange:L=>a(L.target.value),className:"w-full bg-white/10 border border-white/20 rounded-2xl pl-12 pr-4 py-4 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:border-transparent backdrop-blur-sm transition-all duration-300",required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(V,{iconName:"Lock",className:"text-xl text-white/60"})}),e.jsx("input",{type:N?"text":"password",placeholder:"Contraseña",value:d,onChange:L=>x(L.target.value),className:"w-full bg-white/10 border border-white/20 rounded-2xl pl-12 pr-12 py-4 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:border-transparent backdrop-blur-sm transition-all duration-300",required:!0}),e.jsx("button",{type:"button",onClick:()=>v(!N),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-white/60 hover:text-white transition-colors",children:e.jsx(V,{iconName:N?"Hide":"RedEye",className:"text-xl"})})]}),e.jsxs("button",{type:"submit",disabled:p,className:"w-full bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 hover:from-blue-700 hover:via-purple-700 hover:to-indigo-800 text-white font-bold rounded-2xl py-4 px-6 shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-3 relative overflow-hidden",children:[p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Verificando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{iconName:"SignIn",className:"text-xl"}),e.jsx("span",{children:"Ingresar al Sistema"})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"})]}),w&&e.jsx("div",{className:"bg-red-500/20 backdrop-blur-sm border border-red-400/30 rounded-2xl p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-200",children:[e.jsx(V,{iconName:"ErrorBadge",className:"text-xl"}),e.jsx("span",{className:"font-medium",children:w})]})})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-white/60 text-sm",children:[e.jsx(V,{iconName:"Shield",className:"text-lg"}),e.jsx("span",{children:"Sistema Seguro y Confiable"})]})})]})})]})}function Ye(){return e.jsx("footer",{className:"w-full bg-purple-800 py-4 border-t border-blue-500 shadow-inner",children:e.jsx("div",{className:"container mx-auto text-center",children:e.jsxs("span",{className:"text-white text-sm font-medium drop-shadow",children:["© ",new Date().getFullYear()," Clínica 2 de Mayo. Todos los derechos reservados."]})})})}Te();function Qe({open:s,onClose:r,onLogout:a,usuario:d}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed inset-0 z-40 bg-black bg-opacity-40 transition-opacity duration-200 md:hidden ${s?"block":"hidden"}`,onClick:r,"aria-hidden":"true"}),e.jsx("aside",{className:`fixed z-50 top-0 left-0 h-full w-64 bg-white border-r border-blue-500 shadow-lg transform transition-transform duration-200 ease-in-out
        ${s?"translate-x-0":"-translate-x-full"}
        md:translate-x-0 md:static md:flex md:flex-col md:z-10 md:h-auto md:shadow-none md:bg-white md:w-64`,children:e.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[e.jsxs("div",{className:"flex flex-col items-center py-6 bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 text-white rounded-b-2xl mx-2 mb-4 shadow-lg",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-full blur-md"}),e.jsx("img",{src:"/2demayo.svg",alt:"Logo",className:"relative h-16 w-16 object-contain bg-white rounded-full p-2 shadow-lg ring-4 ring-white/30",onError:x=>{x.target.onerror=null,x.target.src="/logo.svg"}})]}),e.jsx("h5",{className:"text-lg font-bold text-white mt-3 text-center drop-shadow-lg",children:"Clínica 2 de Mayo"}),e.jsx("div",{className:"w-12 h-0.5 bg-white/30 rounded-full mt-2"})]}),e.jsx("nav",{className:"flex flex-col gap-3 px-4 flex-1 overflow-y-auto",children:d?.rol==="medico"?e.jsxs(e.Fragment,{children:[e.jsxs(ae,{to:"/mis-consultas",className:"py-2 px-3 rounded-lg text-indigo-700 hover:bg-indigo-100 font-medium flex items-center gap-2",onClick:r,children:[e.jsx(V,{iconName:"Contact",className:"text-xl"}),"Mis Consultas"]}),e.jsxs(ae,{to:"/panel-medico",className:"py-2 px-3 rounded-lg text-blue-700 hover:bg-blue-100 font-medium flex items-center gap-2",onClick:r,children:[e.jsx(V,{iconName:"Calendar",className:"text-xl"}),"Disponibilidad"]}),e.jsxs(ae,{to:"/historial-consultas",className:"py-2 px-3 rounded-lg text-blue-700 hover:bg-blue-100 font-medium flex items-center gap-2",onClick:r,children:[e.jsx(V,{iconName:"History",className:"text-xl"}),"Historial de consultas"]})]}):d?.rol==="enfermero"?e.jsx(e.Fragment,{children:e.jsx(ae,{to:"/panel-enfermero",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:r,children:"Panel Enfermería"})}):d?.rol==="laboratorista"?e.jsxs(e.Fragment,{children:[e.jsx(ae,{to:"/panel-laboratorio",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:r,children:"Panel Laboratorio"}),e.jsx(ae,{to:"/examenes-laboratorio",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:r,children:"Gestión de Exámenes"})]}):d?.rol==="químico"||d?.rol==="quimico"?e.jsxs(e.Fragment,{children:[e.jsx(ae,{to:"/medicamentos",className:"py-2 px-3 rounded-lg text-pink-700 hover:bg-pink-100 font-medium",onClick:r,children:"Medicamentos"}),e.jsx(ae,{to:"/farmacia/cotizador",className:"py-2 px-3 rounded-lg text-blue-700 hover:bg-blue-100 font-medium",onClick:r,children:"Cotizador Farmacia"}),e.jsx(ae,{to:"/farmacia/ventas",className:"py-2 px-3 rounded-lg text-green-700 hover:bg-green-100 font-medium",onClick:r,children:"Ventas de Farmacia"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ae,{to:"/",className:"group relative py-3 px-4 rounded-xl bg-gradient-to-r from-purple-600 via-purple-700 to-indigo-800 text-white font-semibold shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 flex items-center gap-3 overflow-hidden",onClick:r,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"relative z-10 flex items-center justify-center w-8 h-8 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(V,{iconName:"ViewDashboard",className:"text-xl text-white"})}),e.jsx("span",{className:"relative z-10 text-lg",children:"Dashboard"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"})]}),e.jsxs(ae,{to:"/pacientes",className:"py-3 px-4 rounded-lg text-cyan-700 hover:bg-gradient-to-r hover:from-cyan-50 hover:to-blue-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:r,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-cyan-100 rounded-lg",children:e.jsx(V,{iconName:"People",className:"text-xl text-cyan-600"})}),e.jsx("span",{children:"Pacientes"})]}),d?.rol==="administrador"&&e.jsxs(e.Fragment,{children:[e.jsxs(ae,{to:"/usuarios",className:"py-3 px-4 rounded-lg text-blue-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:r,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 rounded-lg",children:e.jsx(V,{iconName:"People",className:"text-xl text-blue-600"})}),e.jsx("span",{children:"Usuarios"})]}),e.jsxs(ae,{to:"/medicos",className:"py-3 px-4 rounded-lg text-emerald-700 hover:bg-gradient-to-r hover:from-emerald-50 hover:to-green-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:r,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-emerald-100 rounded-lg",children:e.jsx(V,{iconName:"Health",className:"text-xl text-emerald-600"})}),e.jsx("span",{children:"Médicos"})]}),e.jsxs(ae,{to:"/gestion-tarifas",className:"py-3 px-4 rounded-lg text-amber-700 hover:bg-gradient-to-r hover:from-amber-50 hover:to-yellow-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:r,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-amber-100 rounded-lg",children:e.jsx(V,{iconName:"Money",className:"text-xl text-amber-600"})}),e.jsx("span",{children:"💰 Gestión de Tarifas"})]})]}),e.jsxs(ae,{to:"/reportes",className:"py-3 px-4 rounded-lg text-violet-700 hover:bg-gradient-to-r hover:from-violet-50 hover:to-purple-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:r,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-violet-100 rounded-lg",children:e.jsx(V,{iconName:"BarChart4",className:"text-xl text-violet-600"})}),e.jsx("span",{children:"Reportes"})]}),e.jsxs(ae,{to:"/configuracion",className:"py-3 px-4 rounded-lg text-gray-700 hover:bg-gradient-to-r hover:from-gray-50 hover:to-slate-100 font-medium flex items-center gap-3 transition-all duration-300 hover:shadow-md hover:scale-[1.01]",onClick:r,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-gray-100 rounded-lg",children:e.jsx(V,{iconName:"Settings",className:"text-xl text-gray-600"})}),e.jsx("span",{children:"Configuración"})]})]})}),e.jsx("div",{className:"mt-auto p-4",children:e.jsxs("button",{onClick:a,className:"group w-full bg-gradient-to-r from-red-600 via-red-700 to-rose-800 text-white font-bold rounded-xl py-3 px-4 shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 flex items-center justify-center gap-3 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-700 via-rose-600 to-pink-700 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"relative z-10 flex items-center justify-center w-6 h-6 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(V,{iconName:"SignOut",className:"text-lg text-white"})}),e.jsx("span",{className:"relative z-10",children:"Cerrar sesión"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"})]})})]})})]})}function Ze({usuario:s,onMenu:r}){return e.jsxs("header",{className:"flex items-center justify-between px-6 py-3 bg-purple-800 shadow text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"/2demayo.svg",alt:"Logo",className:"h-10 w-10 object-contain bg-white rounded-full p-1 shadow"}),e.jsx("span",{className:"text-xl font-bold drop-shadow",children:"Clínica 2 de Mayo"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-white/90",children:[s?.nombre," ",s?.apellido||""]}),e.jsx("button",{className:"md:hidden ml-2",onClick:r,"aria-label":"Abrir menú",children:e.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]})]})}function es({usuario:s,onLogout:r,children:a}){const[d,x]=t.useState(!1);return t.useEffect(()=>{const w=()=>{window.innerWidth>=768&&x(!1)};return window.addEventListener("resize",w),w(),()=>window.removeEventListener("resize",w)},[]),e.jsxs("div",{className:"min-h-screen flex flex-col bg-blue-50 overflow-x-hidden",children:[e.jsx(Ze,{usuario:s,onMenu:()=>x(!0)}),e.jsxs("div",{className:"flex flex-1 max-w-full",children:[e.jsx(Qe,{open:d,onClose:()=>x(!1),onLogout:r,usuario:s}),e.jsx("main",{className:"flex-1 px-2 sm:px-4 md:px-8 min-w-0 max-w-full overflow-x-auto",children:a})]}),e.jsx(Ye,{})]})}function Fe({onPacienteEncontrado:s,onNoEncontrado:r,onNuevaBusqueda:a}){const[d,x]=t.useState(""),[w,y]=t.useState("dni"),[p,j]=t.useState([]),[N,v]=t.useState(!1),[C,l]=t.useState(!1),_=async b=>{if(b.preventDefault(),!!d.trim()){v(!0),j([]);try{const o=await(await fetch(O+"api_pacientes_buscar.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tipo:w,valor:d})})).json();o.success&&Array.isArray(o.pacientes)&&o.pacientes.length>0?(j(o.pacientes),l(!1),o.pacientes.length===1&&s&&(l(!1),s(o.pacientes[0]))):(j([]),l(!0),r())}catch{j([]),r()}v(!1)}},L=b=>{x(b.target.value),l(!1),a&&a()},c=b=>{y(b.target.value),l(!1),a&&a()};return e.jsxs("div",{className:"mb-4",children:[e.jsxs("form",{onSubmit:_,className:"flex flex-col md:flex-row gap-2 mb-4",children:[e.jsxs("select",{value:w,onChange:c,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"dni",children:"DNI"}),e.jsx("option",{value:"nombre",children:"Nombre y Apellido"}),e.jsx("option",{value:"historia",children:"Historia Clínica"})]}),e.jsx("input",{type:"text",value:d,onChange:L,placeholder:`Buscar por ${w}`,className:"border rounded px-2 py-1 flex-1"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white rounded px-4 py-1 font-bold",disabled:N,children:"Buscar"})]}),N&&e.jsx("div",{className:"text-blue-600",children:"Buscando..."}),p.length>0&&e.jsxs("div",{className:"mt-2 bg-blue-50 rounded-lg p-2",children:[e.jsx("div",{className:"font-bold mb-2",children:"Selecciona un paciente:"}),e.jsx("ul",{className:"divide-y divide-blue-100",children:p.length===1?e.jsx("li",{className:"py-2 flex flex-col md:flex-row md:items-center gap-2",children:e.jsxs("span",{className:"w-full px-3 py-2 rounded bg-blue-100 font-semibold text-blue-900",children:[p[0].nombre," ",p[0].apellido," | DNI: ",p[0].dni," | HC: ",p[0].historia_clinica]})},p[0].id):p.map(b=>e.jsx("li",{className:"py-2 flex flex-col md:flex-row md:items-center gap-2",children:e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 rounded bg-blue-100 hover:bg-blue-200 font-semibold text-blue-900",onClick:()=>{l(!1),s(b)},children:[b.nombre," ",b.apellido," | DNI: ",b.dni," | HC: ",b.historia_clinica]})},b.id))})]}),C&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded border border-yellow-300 text-sm",disabled:!0,children:"Paciente no encontrado"})})]})}function ss({paciente:s}){return e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4",children:[e.jsx("div",{className:"font-bold text-blue-800 mb-2",children:"Paciente encontrado:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Nombre:"})," ",s.nombre]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Apellido:"})," ",s.apellido]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"DNI:"})," ",s.dni]}),s.fecha_nacimiento&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Fecha de nacimiento:"})," ",s.fecha_nacimiento]}),s.sexo&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Sexo:"})," ",s.sexo]}),s.direccion&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Dirección:"})," ",s.direccion]}),s.telefono&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Teléfono:"})," ",s.telefono]}),s.email&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",s.email]}),s.tipo_seguro&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Tipo de seguro:"})," ",s.tipo_seguro]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Historia Clínica:"})," ",s.historia_clinica]}),s.edad&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Edad:"})," ",s.edad," ",s.edad_unidad||""]}),s.procedencia&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Procedencia:"})," ",s.procedencia]})]})]})]})}function he({paciente:s,servicio:r,onCobroCompleto:a,onCancelar:d,detalles:x,total:w}){const[y,p]=t.useState([]),[j,N]=t.useState("particular"),[v,C]=t.useState("efectivo"),[l,_]=t.useState(""),[L,c]=t.useState(!1);t.useEffect(()=>{x||b()},[x]);const b=async()=>{try{const i=await(await fetch(`${O}api_tarifas.php`,{credentials:"include"})).json();i.success&&p(i.tarifas||[])}catch(S){console.error("Error al cargar tarifas:",S)}},n=t.useMemo(()=>Array.isArray(x)&&x.length>0?x:[],[x]),o=()=>typeof w=="number"&&w>0?w:n.reduce((S,i)=>S+i.subtotal,0),m=async()=>{if(n.length===0){W.fire("Error","No hay servicios para cobrar","error");return}if(!s||!s.nombre||!s.dni){W.fire("Error","Faltan datos del paciente (nombre y DNI son requeridos)","error");return}c(!0);try{const S=JSON.parse(sessionStorage.getItem("usuario")||"{}"),i={paciente_id:s.id,usuario_id:S.id,total:o(),tipo_pago:v,observaciones:l,detalles:n,servicio_info:r,paciente_nombre:s.nombre,paciente_dni:s.dni,paciente_historia_clinica:s.historia_clinica||`MANUAL-${s.dni}`},u=await(await fetch(`${O}api_cobros.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)})).json();if(u.success){if(r?.key==="laboratorio"&&!r?.consulta_id){const M=n.map(z=>z.servicio_id),A=await(await fetch(`${O}api_ordenes_laboratorio.php`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({consulta_id:null,examenes:M,paciente_id:s?.id||null,cobro_id:u.cobro_id})})).json()}await f(u.cobro_id,i),a&&a(u.cobro_id,r)}else W.fire("Error",u.error||"Error al procesar el cobro","error")}catch(S){console.error("Error:",S),W.fire("Error","Error de conexión con el servidor","error")}finally{c(!1)}},f=async(S,i)=>{const h=new Date().toLocaleString("es-PE"),u=s.apellido?`${s.nombre} ${s.apellido}`:s.nombre,M=`
      <div style="text-align: left; font-family: monospace;">
        <h3 style="text-align: center; margin-bottom: 20px;">🏥 CLÍNICA 2 DE MAYO</h3>
        <hr>
        <p><strong>COMPROBANTE DE PAGO #${S}</strong></p>
        <p>Fecha: ${h}</p>
        <p>Paciente: ${u}</p>
        <p>DNI: ${s.dni}</p>
        <p>H.C.: ${s.historia_clinica}</p>
        <hr>
        <p><strong>DETALLE:</strong></p>
        ${i.detalles.map(T=>`<p>${T.descripcion} x${T.cantidad} .... S/ ${T.subtotal.toFixed(2)}</p>`).join("")}
        <hr>
        <p><strong>TOTAL: S/ ${i.total.toFixed(2)}</strong></p>
  <p>Tipo de pago: ${v==="yape"?"Yape":v.toUpperCase()}</p>
        <p>Cobertura: ${j.toUpperCase()}</p>
        <hr>
        <p style="text-align: center; font-size: 12px;">
          Gracias por su preferencia<br>
          Conserve este comprobante
        </p>
      </div>
    `;await W.fire({title:"Cobro Procesado ✅",html:M,icon:"success",confirmButtonText:"Imprimir Comprobante",showCancelButton:!0,cancelButtonText:"Solo Continuar"}).then(T=>{if(T.isConfirmed){const A=window.open("","_blank");A.document.write(M),A.document.close(),A.print()}})};if(!r)return e.jsx("div",{children:"Seleccione un servicio primero"});const E=o();return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-blue-200",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-blue-800",children:"💰 Módulo de Cobros"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Paciente:"}),e.jsx("p",{children:s.nombre}),e.jsxs("p",{children:["DNI: ",s.dni," | H.C.: ",s.historia_clinica]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Tipo de Cobertura:"}),e.jsxs("select",{value:j,onChange:S=>N(S.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"particular",children:"Particular"}),e.jsx("option",{value:"seguro",children:"Seguro"}),e.jsx("option",{value:"convenio",children:"Convenio"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Detalle del Servicio:"}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded",children:[n.map((S,i)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:S.descripcion}),e.jsxs("span",{className:"font-bold",children:["S/ ",S.subtotal.toFixed(2)]})]},i)),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between items-center font-bold text-lg",children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{className:"text-green-600",children:["S/ ",E.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Método de Pago:"}),e.jsxs("select",{value:v,onChange:S=>C(S.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"}),e.jsx("option",{value:"transferencia",children:"Transferencia"}),e.jsx("option",{value:"yape",children:"Yape"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Observaciones:"}),e.jsx("textarea",{value:l,onChange:S=>_(S.target.value),className:"w-full border rounded px-3 py-2 h-20",placeholder:"Observaciones adicionales (opcional)"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:m,disabled:L||E<=0,className:"flex-1 bg-green-600 text-white py-3 px-6 rounded font-bold text-lg hover:bg-green-700 disabled:bg-gray-400",children:L?"Procesando...":`💳 Cobrar S/ ${E.toFixed(2)}`}),e.jsx("button",{onClick:d,className:"bg-gray-500 text-white py-3 px-6 rounded font-bold hover:bg-gray-600",children:"Cancelar"})]})]})}const ts=[{key:"consulta",label:"Consulta Médica",icon:"👨‍⚕️",requiresPayment:!1},{key:"laboratorio",label:"Laboratorio",icon:"🔬",requiresPayment:!0},{key:"farmacia",label:"Farmacia",icon:"💊",requiresPayment:!0},{key:"rayosx",label:"Rayos X",icon:"🩻",requiresPayment:!0},{key:"ecografia",label:"Ecografía",icon:"🩺",requiresPayment:!0},{key:"ocupacional",label:"Medicina Ocupacional",icon:"👷‍⚕️",requiresPayment:!0}],as=["consulta","laboratorio","farmacia","ecografia","rayosx","ocupacional"];function rs({paciente:s}){const r=ie(),[a,d]=t.useState(null),[x,w]=t.useState(!1),[y,p]=t.useState([]);t.useEffect(()=>{fetch(O+"api_tarifas.php",{credentials:"include"}).then(l=>l.json()).then(l=>{if(l.success&&Array.isArray(l.tarifas)){const _=l.tarifas.filter(L=>L.activo===1&&!as.includes(L.servicio_tipo)).map(L=>({key:L.servicio_tipo+"_"+L.id,label:L.descripcion,icon:"🛠️",requiresPayment:!0,tarifaId:L.id}));p(_)}})},[]);const j=l=>{l.key==="consulta"?r("/agendar-consulta",{state:{pacienteId:s.id}}):l.key==="laboratorio"?r(`/cotizar-laboratorio/${s.id}`):l.key==="farmacia"?r(`/cotizar-farmacia/${s.id}`):l.key==="rayosx"?r(`/cotizar-rayosx/${s.id}`):l.key==="ecografia"?r(`/cotizar-ecografia/${s.id}`):l.key==="ocupacional"?W.fire({title:"Página en construcción",text:"La funcionalidad de Medicina Ocupacional estará disponible próximamente.",icon:"info",confirmButtonText:"OK"}):l.key==="procedimiento"?r(`/cotizar-procedimientos/${s.id}`):l.requiresPayment?(d(l),w(!0)):C(l)},N=async(l,_)=>{w(!1),W.fire({title:"💰 Pago Procesado",text:`Servicio de ${_.label} pagado exitosamente.`,icon:"success",confirmButtonText:"OK"})},v=()=>{w(!1),d(null)},C=async l=>{const _=JSON.parse(sessionStorage.getItem("usuario")||"{}");if(!_.id){W.fire("Error","No se pudo identificar al usuario","error");return}try{const c=await(await fetch(O+"api_atenciones.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paciente_id:s.id,usuario_id:_.id,servicio:l.key,observaciones:""})})).json();c.success?W.fire({title:"Atención registrada",text:`Atención registrada para ${l.label}.`,icon:"success",confirmButtonText:"OK"}):W.fire({title:"Error",text:c.error||"No se pudo registrar la atención",icon:"error",confirmButtonText:"OK"})}catch(L){console.error("Error:",L),W.fire("Error","Error de conexión","error")}};return x&&a&&a.key!=="laboratorio"?e.jsx(he,{paciente:s,servicio:a,onCobroCompleto:N,onCancelar:v}):e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 text-blue-800",children:["🏥 Seleccionar Servicio para: ",s.nombre," ",s.apellido]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[ts.map(l=>l.key==="ocupacional"?e.jsxs("button",{onClick:()=>{W.fire({title:"Página en construcción",text:"La funcionalidad de Medicina Ocupacional estará disponible próximamente.",icon:"info",confirmButtonText:"OK"})},className:"flex items-center justify-center gap-2 p-4 bg-white border border-blue-300 rounded-lg hover:bg-blue-100 hover:border-blue-400 transition-colors font-medium text-blue-700 hover:text-blue-800",children:[e.jsx("span",{className:"text-2xl",children:l.icon}),e.jsx("span",{children:l.label}),l.requiresPayment&&e.jsx("span",{className:"text-green-600 text-sm",children:"💰"})]},l.key):e.jsxs("button",{onClick:()=>j(l),className:"flex items-center justify-center gap-2 p-4 bg-white border border-blue-300 rounded-lg hover:bg-blue-100 hover:border-blue-400 transition-colors font-medium text-blue-700 hover:text-blue-800",children:[e.jsx("span",{className:"text-2xl",children:l.icon}),e.jsx("span",{children:l.label}),l.requiresPayment&&e.jsx("span",{className:"text-green-600 text-sm",children:"💰"})]},l.key)),e.jsxs("button",{onClick:()=>j({key:"procedimiento",label:"Procedimientos",icon:"🛠️",requiresPayment:!0}),className:"flex items-center justify-center gap-2 p-4 bg-white border border-orange-300 rounded-lg hover:bg-orange-100 hover:border-orange-400 transition-colors font-medium text-orange-700 hover:text-orange-800",children:[e.jsx("span",{className:"text-2xl",children:"🛠️"}),e.jsx("span",{children:"Procedimientos"}),e.jsx("span",{className:"text-green-600 text-sm",children:"💰"})]},"procedimientos")]}),e.jsx("div",{className:"mt-3 text-sm text-gray-600 text-center",children:"💰 = Requiere pago previo | 🏥 = Agendar primero, cobrar después"})]})}function ns({onPacienteRegistrado:s}){const[r,a]=t.useState(null),[d,x]=t.useState(!1),w=()=>{a(null),x(!1)},y=p=>{a(p),s&&s()};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Fe,{onPacienteEncontrado:a,onNoEncontrado:()=>x(!0),onNuevaBusqueda:w}),r&&e.jsxs(e.Fragment,{children:[e.jsx(ss,{paciente:r}),e.jsx(rs,{paciente:r})]}),d&&!r&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"mb-2 text-blue-700",children:"Paciente no encontrado. ¿Desea registrarlo?"}),e.jsx(Ge,{initialData:{},onRegistroExitoso:y})]})]})}function is({usuario:s}){const[r,a]=t.useState(null),[d,x]=t.useState({pacientesHoy:0,consultasHoy:0,totalPacientes:0}),w=fe(),y=t.useCallback(async()=>{try{const v=await(await fetch(O+"api_estadisticas_dashboard.php")).json();v.success?x({pacientesHoy:v.estadisticas.pacientes_hoy,consultasHoy:v.estadisticas.consultas_hoy,totalPacientes:v.estadisticas.total_pacientes}):(console.error("Error al obtener estadísticas:",v.error),x({pacientesHoy:0,consultasHoy:0,totalPacientes:0}))}catch(N){console.error("Error de conexión al obtener estadísticas:",N),x({pacientesHoy:0,consultasHoy:0,totalPacientes:0})}},[]),p=t.useCallback(()=>{fetch(O+"api_ultima_hc.php").then(N=>N.json()).then(N=>{N.success&&a(N.ultima_hc)}),y()},[y]);t.useEffect(()=>{p(),y()},[s,w.pathname,p,y]);const j=()=>new Intl.DateTimeFormat("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(new Date);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 rounded-2xl p-6 sm:p-8 text-white shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white/10 rounded-full -translate-y-20 translate-x-20"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-white/5 rounded-full translate-y-16 -translate-x-16"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-white/20 rounded-2xl backdrop-blur-sm",children:e.jsx(V,{iconName:"Hospital",className:"text-3xl text-white"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold drop-shadow-lg",children:["¡Bienvenido, ",s?.nombre," ",s?.apellido||"","!"]}),e.jsx("p",{className:"text-lg text-white/90 mt-1",children:j()})]})]}),e.jsx("p",{className:"text-xl text-white/95 font-medium",children:"Panel de Control - Clínica 2 de Mayo"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"group bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border border-cyan-100 hover:border-cyan-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-xl",children:e.jsx(V,{iconName:"People",className:"text-2xl text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:d.pacientesHoy}),e.jsx("p",{className:"text-sm text-gray-500",children:"Hoy"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Pacientes Atendidos"}),e.jsx("p",{className:"text-sm text-gray-600",children:"En el día de hoy"})]}),e.jsxs("div",{className:"group bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border border-emerald-100 hover:border-emerald-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-emerald-400 to-green-500 rounded-xl",children:e.jsx(V,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:d.consultasHoy}),e.jsx("p",{className:"text-sm text-gray-500",children:"Hoy"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Consultas Médicas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"En el día de hoy"})]}),e.jsxs("div",{className:"group bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border border-purple-100 hover:border-purple-200 sm:col-span-2 lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-xl",children:e.jsx(V,{iconName:"Contact",className:"text-2xl text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:d.totalPacientes}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Pacientes Registrados"}),e.jsx("p",{className:"text-sm text-gray-600",children:"En la base de datos"})]})]}),r&&e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-amber-100",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl",children:e.jsx(V,{iconName:"DocumentSearch",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Última Historia Clínica"}),e.jsx("p",{className:"text-gray-600",children:"Registro más reciente en el sistema"})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-amber-100 rounded-lg",children:e.jsx(V,{iconName:"NumberField",className:"text-lg text-amber-700"})}),e.jsx("span",{className:"text-lg font-mono font-bold text-amber-800",children:r}),e.jsxs("span",{className:"text-sm text-amber-600 bg-amber-100 px-2 py-1 rounded-full",children:["HC #",r]})]})})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(V,{iconName:"ContactCard",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Atención en Recepción"}),e.jsx("p",{className:"text-indigo-100",children:"Gestión de pacientes y servicios"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx(ns,{onPacienteRegistrado:p})})]})]})}function ls(){return e.jsx("div",{children:e.jsx(Je,{})})}function os(){return e.jsxs("div",{className:"container py-4",children:[e.jsx("h2",{className:"mb-4 text-2xl font-bold text-purple-800",children:"Gestión de Usuarios"}),e.jsx(Xe,{})]})}function cs(){const[s,r]=t.useState([]),[a,d]=t.useState([]),[x,w]=t.useState([]),[y,p]=t.useState(!1),[j,N]=t.useState(""),[v,C]=t.useState(1),[l,_]=t.useState(new Date),L=["#22c55e","#3b82f6","#f59e42","#e11d48","#a21caf","#facc15","#0ea5e9","#14b8a6","#6366f1","#f472b6"],c=Array.isArray(s)?s:[],b=c.reduce((i,h,u)=>(i[h.id]=L[u%L.length],i),{});t.useEffect(()=>{p(!0),Promise.all([fetch(O+"api_medicos.php").then(i=>i.json()),fetch(O+"api_disponibilidad_medicos.php").then(i=>i.json()),fetch(O+"api_consultas.php").then(i=>i.json())]).then(([i,h,u])=>{r(i.medicos||[]),d(h.disponibilidad||[]),w(u.consultas||[]),p(!1)})},[]);const n={};a.forEach(i=>{i.fecha&&(n[i.fecha]||(n[i.fecha]=[]),n[i.fecha].push(i))});function o(i){const h=i.toISOString().slice(0,10),u=a.filter(A=>A.fecha===h);if(u.length>0)return u;const T=["domingo","lunes","martes","miércoles","jueves","viernes","sábado"][i.getDay()];return a.filter(A=>A.dia_semana===T&&!A.fecha)}const m=o(l);c.filter(i=>m.some(h=>h.medico_id==i.id));const f=j.trim().toLowerCase();let E=[];f?E=a.filter(i=>{const h=c.find(u=>u.id==i.medico_id);return h?h.nombre&&h.nombre.toLowerCase().includes(f)||h.especialidad&&h.especialidad.toLowerCase().includes(f):!1}):E=m;const S=E;return e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-2 text-center",children:"Disponibilidad de Médicos"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4 items-start",children:[e.jsx(Me,{onChange:_,value:l,className:"border rounded shadow !text-base w-full max-w-xs md:!text-base md:w-[350px] md:h-[350px] !h-[320px] md:!h-[350px]",tileContent:({date:i,view:h})=>{if(h!=="month")return null;const u=o(i);if(!u.length)return null;const M=[...new Set(u.map(T=>T.medico_id))];return e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:2},children:M.map((T,A)=>e.jsx("span",{style:{display:"inline-block",width:8,height:8,borderRadius:"50%",background:b[T]||"#888",marginLeft:A>0?2:0}},T))})}}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("input",{type:"text",placeholder:"Buscar por nombre o especialidad...",value:j,onChange:i=>{N(i.target.value),C(1)},className:"border rounded px-3 py-1"})}),y?e.jsx("div",{children:"Cargando..."}):e.jsx("div",{className:"overflow-x-auto",style:{maxHeight:260,minHeight:80},children:e.jsxs("table",{className:"min-w-full text-[11px] md:text-sm border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Médico"}),e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Especialidad"}),e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Horario"}),e.jsx("th",{className:"px-1 py-0.5 md:px-2 md:py-1",children:"Cupos libres"})]})}),e.jsx("tbody",{children:S.map((i,h)=>{const u=c.find(F=>F.id==i.medico_id);if(!u)return null;let M=i.fecha;!M&&i.dia_semana&&(M=i.dia_semana);const T=i.hora_inicio.split(":").map(Number),A=i.hora_fin.split(":").map(Number);let z=0,P=T[0],$=T[1];for(;P<A[0]||P===A[0]&&$<A[1];)z++,$+=30,$>=60&&(P++,$=0);const H=x.filter(F=>F.medico_id==u.id&&(i.fecha?F.fecha===i.fecha:!0)&&F.hora>=i.hora_inicio&&F.hora<i.hora_fin&&F.estado==="pendiente"),g=z-H.length;return e.jsxs("tr",{className:g>0?"bg-green-50":"bg-yellow-100",children:[e.jsxs("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1 font-bold",style:{color:b[u.id]||void 0},children:["Dr(a). ",u.nombre," ",u.apellido||""]}),e.jsx("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1",children:u.especialidad}),e.jsxs("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1",children:[i.hora_inicio," - ",i.hora_fin," ",M?e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",M,")"]}):null]}),e.jsx("td",{className:"px-0.5 py-0.5 md:px-2 md:py-1 font-bold",children:g>0?g:"Sin cupos"})]},i.medico_id+"-"+h)})})]})})]})]})]})}function ds({pacienteId:s}){const[r,a]=t.useState([]),[d,x]=t.useState(0),[w,y]=t.useState([]),[p,j]=t.useState(""),[N,v]=t.useState([]),[C,l]=t.useState(""),[_,L]=t.useState(""),[c,b]=t.useState(""),[n,o]=t.useState(null),[m,f]=t.useState(!1),[E,S]=t.useState(null),[i,h]=t.useState(!1),u=De(W);t.useEffect(()=>{m&&n?fetch(O+"api_tarifas.php",{credentials:"include"}).then(z=>z.json()).then(z=>{if(z.success&&Array.isArray(z.tarifas)){let P=z.tarifas.find($=>$.servicio_tipo==="consulta"&&$.activo===1&&Number($.medico_id)===Number(n.medico_id));if(P||(P=z.tarifas.find($=>$.servicio_tipo==="consulta"&&$.activo===1&&(!$.medico_id||$.medico_id===null))),P){const $={servicio_tipo:"consulta",servicio_id:n.id,descripcion:P.descripcion||`Consulta - ${n.medico_nombre}`,cantidad:1,precio_unitario:parseFloat(P.precio_particular)||0,subtotal:parseFloat(P.precio_particular)||0};a([$]),x($.subtotal)}else a([]),x(0)}}):(a([]),x(0))},[m,n]),t.useEffect(()=>{fetch(O+"api_medicos.php").then(z=>z.json()).then(z=>y(z.medicos||[]))},[]),t.useEffect(()=>{p&&C?(h(!0),fetch(`${O}api_horarios_disponibles.php?medico_id=${p}&fecha=${C}`).then(z=>z.json()).then(z=>{z.success?v(z.horarios_disponibles||[]):(v([]),console.error("Error:",z.error))}).catch(z=>{console.error("Error:",z),v([])}).finally(()=>h(!1))):v([])},[p,C]),t.useEffect(()=>{s&&fetch(`${O}api_pacientes.php?id=${s}`).then(z=>z.json()).then(z=>{z.success&&z.paciente&&S(z.paciente)}).catch(console.error)},[s]);const M=async z=>{if(z.preventDefault(),b(""),!s||!p||!C||!_){b("Completa todos los campos");return}try{const $=await(await fetch(O+"api_consultas.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paciente_id:s,medico_id:p,fecha:C,hora:_,estado:"programada"})})).json();if($.success){const H=w.find(F=>String(F.id)===String(p)),g=`${H?.nombre} ${H?.apellido||""}`.trim();o({id:$.consulta_id||$.id,medico_id:p,medico_nombre:g,medico_especialidad:H?.especialidad,fecha:C,hora:_,paciente_id:s}),f(!0),b("")}else b($.error||"Error al agendar")}catch(P){console.error("Error:",P),b("Error de conexión")}},T=async(z,P)=>{f(!1),u.fire({icon:"success",title:"¡Consulta Agendada y Pagada!",html:`
        <div class="text-left">
          <p><strong>Consulta:</strong> ${n.medico_nombre}</p>
          <p><strong>Especialidad:</strong> ${n.medico_especialidad}</p>
          <p><strong>Fecha:</strong> ${n.fecha}</p>
          <p><strong>Hora:</strong> ${n.hora}</p>
          <p><strong>Cobro ID:</strong> ${z}</p>
        </div>
      `,confirmButtonColor:"#22c55e",confirmButtonText:"Aceptar"}),l(""),L(""),j(""),o(null)},A=()=>{f(!1),u.fire({title:"Cobro Cancelado",text:"La consulta fue agendada pero no se realizó el cobro. Puede cobrarse posteriormente.",icon:"info",confirmButtonText:"Entendido"})};return m&&n&&E?e.jsxs("div",{className:"max-w-2xl mx-auto p-2 md:p-8 w-full",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-4 border border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"✅ Consulta Agendada Exitosamente"}),e.jsxs("div",{className:"text-sm text-blue-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Médico:"})," ",n.medico_nombre," (",n.medico_especialidad,")"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",n.fecha," - ",e.jsx("strong",{children:"Hora:"})," ",n.hora]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Paciente:"})," ",E.nombre," ",E.apellido]})]})]}),e.jsx(he,{paciente:E,servicio:{key:"consulta",label:`Consulta - ${n.medico_nombre}`,medico_id:n.medico_id,consulta_id:n.id},detalles:r,total:d,onCobroCompleto:T,onCancelar:A})]}):e.jsxs("div",{className:"max-w-2xl mx-auto p-2 md:p-8 w-full overflow-x-auto",children:[e.jsx(cs,{}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-4 text-center",children:"Agendar Consulta Médica"}),e.jsxs("form",{onSubmit:M,className:"flex flex-col gap-2 md:gap-4 mb-4 bg-white rounded-lg shadow border border-blue-200 p-2 md:p-8 w-full max-w-full text-xs md:text-base",children:[e.jsx("label",{className:"font-semibold mb-1",htmlFor:"medico-select",children:"Médico"}),e.jsxs("select",{id:"medico-select",value:p,onChange:z=>{j(z.target.value),L("")},className:"border rounded px-3 py-2 md:px-4 md:py-3 text-base md:text-lg",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un médico"}),w.map(z=>e.jsxs("option",{value:z.id,children:["Dr(a). ",z.nombre," ",z.apellido||""," - ",z.especialidad]},z.id))]}),e.jsx("label",{className:"font-semibold mb-1",htmlFor:"fecha-consulta",children:"Fecha de la consulta"}),e.jsx("input",{id:"fecha-consulta",type:"date",value:C,onChange:z=>{l(z.target.value),L("")},className:"border rounded px-3 py-2 md:px-4 md:py-3 text-base md:text-lg",required:!0}),e.jsx("label",{className:"font-semibold mb-1",htmlFor:"hora-select",children:"Horario disponible"}),e.jsxs("select",{id:"hora-select",value:_,onChange:z=>L(z.target.value),className:"border rounded px-3 py-2 md:px-4 md:py-3 text-base md:text-lg",required:!0,disabled:!p||!C||i,children:[e.jsx("option",{value:"",children:i?"Cargando horarios...":!p||!C?"Selecciona médico y fecha primero":N.length===0?"No hay horarios disponibles":"Selecciona un horario"}),N.map(z=>e.jsxs("option",{value:z.hora,children:[z.hora," - ",z.medico_nombre]},`${z.medico_id}-${z.hora}`))]}),e.jsx("button",{type:"submit",className:"bg-green-600 text-white rounded px-4 py-2 md:px-6 md:py-3 font-bold text-base md:text-lg",children:"Agendar Consulta"})]}),c&&e.jsx("div",{className:"mt-2 text-base md:text-lg text-center text-green-700",children:c})]})}function xs(){const s=fe(),r=ie(),a=s.state?.pacienteId;return a?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-800",children:"Agendar Consulta Médica"}),e.jsx("button",{onClick:()=>r("/seleccionar-servicio",{state:{pacienteId:a}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"})]}),e.jsx(ds,{pacienteId:a})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow text-center",children:[e.jsx("p",{className:"text-lg font-bold text-red-600 mb-2",children:"No se ha seleccionado un paciente."}),e.jsx("button",{onClick:()=>r(-1),className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Volver"})]})})}function ms({medicoId:s,onIniciarConsulta:r,onVerDetalle:a}){const d=ie(),[x,w]=t.useState([]),[y,p]=t.useState(1),[j,N]=t.useState(5),[v,C]=t.useState(!1),[l,_]=t.useState(""),[L,c]=t.useState(""),[b,n]=t.useState(""),[o,m]=t.useState("");t.useEffect(()=>{s&&(C(!0),fetch(`${O}api_consultas.php?medico_id=${s}`,{credentials:"include"}).then(g=>g.json()).then(g=>{w(g.consultas||[]),C(!1)}).catch(g=>{console.error("Error cargando consultas:",g),C(!1)}))},[s]);const f=async(g,F)=>{_(""),C(!0);try{await fetch(O+"api_consultas.php",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:g,estado:F})});const Y=await(await fetch(`${O}api_consultas.php?medico_id=${s}`,{credentials:"include"})).json();w(Y.consultas||[]),_(`Consulta ${F} correctamente`)}catch(U){console.error("Error actualizando estado:",U),_("Error al actualizar el estado")}finally{C(!1)}},E=x.filter(g=>{const F=L.trim().toLowerCase();return F&&!(g.paciente_nombre&&g.paciente_nombre.toLowerCase().includes(F)||g.paciente_apellido&&g.paciente_apellido.toLowerCase().includes(F)||g.historia_clinica&&g.historia_clinica.toLowerCase().includes(F)||g.dni&&g.dni.toLowerCase().includes(F))?!1:!b&&!o?!0:!(!g.fecha||b&&g.fecha<b||o&&g.fecha>o)}),S=E.length,i=Math.max(1,Math.ceil(S/j)),h=E.slice((y-1)*j,y*j),u=g=>{N(Number(g.target.value)),p(1)},M=()=>p(g=>Math.max(1,g-1)),T=()=>p(g=>Math.min(i,g+1)),A=g=>{if(!g)return"N/A";try{return new Date(g).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return g}},z=g=>{switch(g?.toLowerCase()){case"pendiente":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"completada":case"completado":return"bg-green-100 text-green-800 border-green-200";case"cancelada":case"cancelado":return"bg-red-100 text-red-800 border-red-200";case"en_proceso":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},P=g=>{switch(g?.toLowerCase()){case"pendiente":return"⏳ ";case"completada":case"completado":return"✅ ";case"cancelada":case"cancelado":return"❌ ";case"en_proceso":return"🔄 ";default:return"📋 "}},$=g=>{switch(g?.toLowerCase()){case"emergencia":return"bg-red-100 text-red-800 border-red-200 animate-pulse";case"urgente":case"urgencia":return"bg-orange-100 text-orange-800 border-orange-200";case"no urgente":case"normal":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},H=g=>{switch(g?.toLowerCase()){case"emergencia":return"🚨 ";case"urgente":case"urgencia":return"⚠️ ";case"no urgente":case"normal":return"🟢 ";default:return"⚪ "}};return e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:max-w-7xl lg:mx-auto",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-3 sm:p-6 mb-4 sm:mb-8 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 sm:w-5 sm:h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-800",children:"🔍 Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"col-span-full lg:col-span-2",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"Búsqueda general"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-2 sm:pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("input",{type:"text",value:L,onChange:g=>{c(g.target.value),p(1)},placeholder:"Buscar por nombre, HC o DNI...",className:"pl-8 sm:pl-10 w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white/80"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"📅 Desde"}),e.jsx("input",{type:"date",value:b,onChange:g=>{n(g.target.value),p(1)},className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white/80"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"📅 Hasta"}),e.jsx("input",{type:"date",value:o,onChange:g=>{m(g.target.value),p(1)},className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 bg-white/80"})]})]}),(L||b||o)&&e.jsx("div",{className:"mt-3 sm:mt-4 flex justify-center sm:justify-end",children:e.jsxs("button",{onClick:()=>{c(""),n(""),m(""),p(1)},className:"inline-flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Limpiar Filtros"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-6 mb-4 sm:mb-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-xs sm:text-sm font-medium",children:"Total Consultas"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:E.length})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-xs sm:text-sm font-medium",children:"Pendientes"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:E.filter(g=>g.estado==="pendiente").length})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-100 text-xs sm:text-sm font-medium",children:"Emergencias"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:E.filter(g=>g.clasificacion==="Emergencia").length})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})})]})})]}),v?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-8 sm:p-12 border border-white/50 flex justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600 font-medium text-sm sm:text-base",children:"🏥 Cargando consultas médicas..."})]})}):h.length===0?e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-8 sm:p-12 border border-white/50 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-r from-gray-300 to-gray-400 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 sm:w-10 sm:h-10 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-700 mb-2",children:"📅 No hay consultas"}),e.jsx("p",{className:"text-gray-500 text-sm sm:text-base",children:"No se encontraron consultas con los filtros aplicados"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/50 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-600 to-indigo-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"👤 Paciente"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"🏥 HC / DNI"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"📅 Fecha"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"⏰ Hora"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"📊 Estado"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"🚨 Clasificación"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"🩺 Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:h.map((g,F)=>{const U=F%2===0;return e.jsxs("tr",{className:`${U?"bg-white/60":"bg-blue-50/40"} hover:bg-blue-100/60 transition-all duration-200 hover:shadow-lg transform hover:-translate-y-0.5`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:((g.paciente_nombre||"")+(g.paciente_apellido||"")).charAt(0)||"P"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:g.paciente_nombre?`${g.paciente_nombre} ${g.paciente_apellido||""}`.trim():`Paciente #${g.paciente_id}`}),e.jsx("div",{className:"text-sm text-gray-500",children:"Consulta médica"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:["HC: ",g.historia_clinica||"N/A"]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:["DNI: ",g.dni||"N/A"]})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"font-medium text-gray-900",children:A(g.fecha)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium text-gray-900",children:g.hora||"N/A"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${z(g.estado)}`,children:[P(g.estado),g.estado||"Sin estado"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${$(g.clasificacion)}`,children:[H(g.clasificacion),g.clasificacion||"Sin clasificar"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[g.estado==="pendiente"&&!g.clasificacion&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f(g.id,"completada"),className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",title:"Completar consulta",children:e.jsx("span",{className:"text-sm",children:"✔️"})}),e.jsx("button",{onClick:()=>f(g.id,"cancelada"),className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",title:"Cancelar consulta",children:e.jsx("span",{className:"text-sm",children:"✖️"})})]}),e.jsx("button",{onClick:()=>d(`/historia-clinica/${g.paciente_id}/${g.id}`),className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",title:"Ver Historia Clínica",children:e.jsx("span",{className:"text-sm",children:"📖"})}),r&&e.jsxs("button",{onClick:()=>r(g),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Iniciar"]}),a&&e.jsxs("button",{onClick:()=>a(g),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 shadow-md",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Ver"]})]})})]},g.id)})})]})})}),e.jsx("div",{className:"lg:hidden space-y-3 sm:space-y-4",children:h.map(g=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/50 p-4 hover:shadow-xl transition-all duration-200 hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-semibold text-lg",children:((g.paciente_nombre||"")+(g.paciente_apellido||"")).charAt(0)||"P"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:g.paciente_nombre?`${g.paciente_nombre} ${g.paciente_apellido||""}`.trim():`Paciente #${g.paciente_id}`}),e.jsx("p",{className:"text-sm text-gray-500",children:"Consulta médica"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"📅 Fecha"}),e.jsx("p",{className:"text-gray-900",children:A(g.fecha)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"⏰ Hora"}),e.jsx("p",{className:"text-gray-900",children:g.hora||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"🏥 HC"}),e.jsx("p",{className:"text-gray-900",children:g.historia_clinica||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"👤 DNI"}),e.jsx("p",{className:"text-gray-900",children:g.dni||"N/A"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${z(g.estado)}`,children:[P(g.estado),g.estado||"Sin estado"]}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${$(g.clasificacion)}`,children:[H(g.clasificacion),g.clasificacion||"Sin clasificar"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[g.estado==="pendiente"&&!g.clasificacion&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>f(g.id,"completada"),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("span",{children:"✔️"}),e.jsx("span",{className:"hidden sm:inline",children:"Completar"})]}),e.jsxs("button",{onClick:()=>f(g.id,"cancelada"),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("span",{children:"✖️"}),e.jsx("span",{className:"hidden sm:inline",children:"Cancelar"})]})]}),e.jsxs("button",{onClick:()=>d(`/historia-clinica/${g.paciente_id}/${g.id}`),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("span",{children:"📖"}),e.jsx("span",{className:"hidden sm:inline",children:"Historia"})]}),r&&e.jsxs("button",{onClick:()=>r(g),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Iniciar"})]}),a&&e.jsxs("button",{onClick:()=>a(g),className:"flex-1 min-w-0 inline-flex items-center justify-center gap-1 px-3 py-2 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 text-sm",children:[e.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),e.jsx("span",{className:"hidden sm:inline",children:"Ver"})]})]})]},g.id))})]}),l&&e.jsx("div",{className:"mt-3 sm:mt-4 p-3 sm:p-4 bg-blue-100 border border-blue-300 rounded-lg sm:rounded-xl text-blue-800 text-center text-sm sm:text-base",children:l}),E.length>0&&e.jsx("div",{className:"mt-4 sm:mt-8 bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-xl p-4 sm:p-6 border border-white/50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:M,disabled:y===1,className:"inline-flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),e.jsx("div",{className:"flex items-center gap-1 sm:gap-2",children:e.jsxs("span",{className:"text-gray-600 font-medium text-sm sm:text-base",children:[y,"/",i]})}),e.jsxs("button",{onClick:T,disabled:y===i,className:"inline-flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 sm:gap-3",children:[e.jsxs("label",{className:"text-xs sm:text-sm font-medium text-gray-700",children:["📄 ",e.jsx("span",{className:"hidden sm:inline",children:"Filas por página:"}),e.jsx("span",{className:"sm:hidden",children:"Por página:"})]}),e.jsxs("select",{value:j,onChange:u,className:"px-2 sm:px-3 py-1.5 sm:py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/80",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 text-center sm:text-left",children:[e.jsxs("span",{className:"block sm:inline",children:[h.length," de ",S]}),e.jsx("span",{className:"hidden sm:inline",children:" consultas"})]})]})]})})]})}function hs({usuario:s}){const r=s?.id;return r?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 shadow-2xl",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 bg-white/10 rounded-full px-6 py-3 backdrop-blur-sm border border-white/20 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 9l6-6m-6 0l6 6"})})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Panel Médico"}),e.jsxs("p",{className:"text-blue-100 text-sm",children:["Dr(a). ",s?.nombre," ",s?.apellido||""]})]})]}),e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"📋 Mis Consultas Programadas"}),e.jsx("p",{className:"text-blue-100 max-w-2xl mx-auto",children:"Gestiona tus citas médicas, revisa el historial de pacientes y mantén un seguimiento completo de tus consultas"})]})})}),e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx(ms,{medicoId:r})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-red-100 flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md mx-4 border border-red-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-red-800 mb-2",children:"Error de Acceso"}),e.jsx("p",{className:"text-red-600 font-medium",children:"No se encontró el médico logueado."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Por favor, inicia sesión nuevamente."})]})})})}const us=()=>{const[s,r]=t.useState([]),[a,d]=t.useState(!0),[x,w]=t.useState(null),[y,p]=t.useState(!1),[j,N]=t.useState({nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),[v,C]=t.useState(""),[l,_]=t.useState(!1),[L,c]=t.useState(!1),[b,n]=t.useState({id:null,nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),[o,m]=t.useState(""),[f,E]=t.useState(!1),[S,i]=t.useState(""),[h,u]=t.useState("id"),[M,T]=t.useState("asc"),[A,z]=t.useState(5),[P,$]=t.useState(1);t.useEffect(()=>{H()},[]);const H=async()=>{d(!0);try{const K=await pe.get(O+"api_medicos.php");r(K.data.medicos||[]),w(null)}catch(K){w("Error al cargar médicos"),console.error("Error fetching medicos:",K)}finally{d(!1)}},g=async K=>{_(!0),C("");try{const se=await pe.post(O+"api_medicos.php",K);se.data.success?(await H(),k(),W.fire({title:"¡Éxito!",text:"Médico registrado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})):C(se.data.message||"Error al registrar médico")}catch(se){C("Error de conexión al registrar médico"),console.error("Error creating medico:",se)}finally{_(!1)}},F=async K=>{E(!0),m("");try{const se=await pe.put(O+"api_medicos.php",K);se.data.success?(await H(),B(),W.fire({title:"¡Éxito!",text:"Médico actualizado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})):m(se.data.message||"Error al actualizar médico")}catch(se){m("Error de conexión al actualizar médico"),console.error("Error updating medico:",se)}finally{E(!1)}},U=async K=>{if((await W.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const re=await pe.delete(O+"api_medicos.php",{data:{id:K}});re.data.success?(await H(),W.fire({title:"¡Eliminado!",text:"Médico eliminado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})):W.fire({title:"Error",text:re.data.message||"Error al eliminar médico",icon:"error"})}catch(re){W.fire({title:"Error",text:"Error de conexión al eliminar médico",icon:"error"}),console.error("Error deleting medico:",re)}},Y=()=>{p(!0),N({nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),C("")},k=()=>{p(!1),N({nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),C("")},q=K=>{const{name:se,value:re}=K.target;N(ce=>({...ce,[se]:re}))},J=async K=>{K.preventDefault(),await g(j)},ee=K=>{c(!0),n({id:K.id,nombre:K.nombre,apellido:K.apellido||"",especialidad:K.especialidad,email:K.email,password:"",cmp:K.cmp||"",rne:K.rne||"",firma:K.firma||null}),m("")},B=()=>{c(!1),n({id:null,nombre:"",apellido:"",especialidad:"",email:"",password:"",cmp:"",rne:"",firma:null}),m("")},R=K=>{const{name:se,value:re}=K.target;n(ce=>({...ce,[se]:re}))},G=async K=>{K.preventDefault(),await F(b)},D=K=>{h===K?T(M==="asc"?"desc":"asc"):(u(K),T("asc")),$(1)},X=[...s.filter(K=>{if(!S)return!0;const se=S.toLowerCase();return K.nombre.toLowerCase().includes(se)||K.apellido&&K.apellido.toLowerCase().includes(se)||K.especialidad.toLowerCase().includes(se)||K.email.toLowerCase().includes(se)})].sort((K,se)=>{let re=K[h],ce=se[h];return typeof re=="string"&&(re=re.toLowerCase(),ce=ce.toLowerCase()),M==="asc"?re<ce?-1:re>ce?1:0:re>ce?-1:re<ce?1:0}),te=X.length,ne=Math.ceil(te/A),le=(P-1)*A,oe=le+A;return{medicos:X.slice(le,oe),allMedicos:X,loading:a,error:x,showModal:y,form:j,formError:v,saving:l,editModal:L,editForm:b,editError:o,editSaving:f,busqueda:S,setBusqueda:i,sortBy:h,sortDir:M,rowsPerPage:A,setRowsPerPage:z,page:P,setPage:$,totalRows:te,totalPages:ne,startIdx:le,endIdx:oe,handleOpenModal:Y,handleCloseModal:k,handleInputChange:q,handleSubmit:J,handleEdit:ee,handleEditClose:B,handleEditChange:R,handleEditSubmit:G,handleSort:D,deleteMedico:U,fetchMedicos:H}},ps=s=>{try{const r=s.map(({id:j,nombre:N,especialidad:v,email:C})=>({ID:j,Nombre:N,Especialidad:v,Email:C})),a=de.json_to_sheet(r),d=de.book_new();de.book_append_sheet(d,a,"Médicos");const x=[{wch:8},{wch:25},{wch:20},{wch:30}];a["!cols"]=x;const w=Pe(d,{bookType:"xlsx",type:"array"}),y=new Blob([w],{type:"application/octet-stream"}),p=`medicos_${new Date().toISOString().slice(0,10)}.xlsx`;return $e.saveAs(y,p),{success:!0,fileName:p}}catch(r){return console.error("Error exportando a Excel:",r),{success:!1,error:r.message}}},bs=s=>{try{const r=new je;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Lista de Médicos",14,15),r.setFontSize(10),r.setFont(void 0,"normal"),r.text(`Fecha de generación: ${new Date().toLocaleDateString()}`,14,25),r.text(`Total de médicos: ${s.length}`,14,30);const a=[{header:"ID",dataKey:"id"},{header:"Nombre",dataKey:"nombre"},{header:"Especialidad",dataKey:"especialidad"},{header:"Email",dataKey:"email"}],d=s.map(w=>({id:w.id,nombre:`${w.nombre} ${w.apellido||""}`.trim(),especialidad:w.especialidad,email:w.email}));Ne(r,{columns:a,body:d,startY:35,styles:{fontSize:9,cellPadding:3},headStyles:{fillColor:[59,130,246],textColor:[255,255,255],fontStyle:"bold"},alternateRowStyles:{fillColor:[245,247,250]},tableLineColor:[209,213,219],tableLineWidth:.1,margin:{top:35,bottom:20,left:14,right:14}});const x=`medicos_${new Date().toISOString().slice(0,10)}.pdf`;return r.save(x),{success:!0,fileName:x}}catch(r){return console.error("Error exportando a PDF:",r),{success:!1,error:r.message}}},gs=({busqueda:s,setBusqueda:r,onAddNew:a,medicos:d,totalCount:x})=>{const w=()=>{const p=ps(d);p.success||console.error("Error al exportar:",p.error)},y=()=>{const p=bs(d);p.success||console.error("Error al exportar:",p.error)};return e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-6 mb-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6",children:[e.jsxs("div",{className:"mb-4 lg:mb-0",children:[e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Gestión de Médicos"}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),x," médicos registrados"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:a,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 font-medium flex items-center justify-center gap-2 shadow-lg hover:shadow-xl",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Médico"}),e.jsx("span",{className:"sm:hidden",children:"Nuevo"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:w,className:"px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 font-medium flex items-center gap-2 shadow-lg hover:shadow-xl",title:"Exportar a Excel",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden lg:inline",children:"Excel"})]}),e.jsxs("button",{onClick:y,className:"px-4 py-3 bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-xl hover:from-red-600 hover:to-pink-700 transition-all duration-200 font-medium flex items-center gap-2 shadow-lg hover:shadow-xl",title:"Exportar a PDF",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),e.jsx("span",{className:"hidden lg:inline",children:"PDF"})]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Buscar médicos por nombre, especialidad o email...",value:s,onChange:p=>r(p.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-white/80 backdrop-blur-sm"}),s&&e.jsx("button",{onClick:()=>r(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("svg",{className:"h-4 w-4 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filtrando por: ",e.jsxs("span",{className:"font-medium text-blue-600",children:['"',s,'"']}),e.jsx("button",{onClick:()=>r(""),className:"text-blue-600 hover:text-blue-700 underline",children:"Limpiar"})]})]})},fs=({medicos:s,loading:r,error:a,sortBy:d,sortDir:x,onSort:w,onEdit:y,onDelete:p,page:j,setPage:N,rowsPerPage:v,setRowsPerPage:C,totalPages:l,totalRows:_,startIdx:L,endIdx:c})=>{if(r)return e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-8 shadow-lg",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-gray-600",children:"Cargando médicos..."})]})})});if(a)return e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-8 shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-red-500 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error al cargar"}),e.jsx("p",{className:"text-gray-600",children:a})]})});if(s.length===0)return e.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-8 shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay médicos"}),e.jsx("p",{className:"text-gray-600",children:"No se encontraron médicos que coincidan con los criterios de búsqueda."})]})});const b=n=>d!==n?e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):x==="asc"?e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"})}):e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:[e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>w("id"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["ID",b("id")]})}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>w("nombre"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Nombre",b("nombre")]})}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>w("especialidad"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"Especialidad",b("especialidad")]})}),e.jsx("th",{className:"px-6 py-4 text-left font-semibold cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>w("email"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),"Email",b("email")]})}),e.jsx("th",{className:"px-6 py-4 text-center font-semibold",children:"Acciones"})]})}),e.jsx("tbody",{children:s.map((n,o)=>e.jsxs("tr",{className:`border-b border-gray-200 hover:bg-blue-50/50 transition-colors ${o%2===0?"bg-white/50":"bg-gray-50/50"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold text-sm",children:n.id})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold",children:n.nombre.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["Dr(a). ",n.nombre," ",n.apellido||""]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",n.id]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:n.especialidad})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-gray-900",children:n.email})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>y(n),className:"p-2 text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-lg transition-colors",title:"Editar médico",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>p(n.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar médico",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},n.id))})]})})}),e.jsx("div",{className:"lg:hidden space-y-4",children:s.map(n=>e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg",children:n.nombre.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900",children:["Dr(a). ",n.nombre," ",n.apellido||""]}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["ID: #",n.id]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(n),className:"p-2 text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-lg transition-colors",title:"Editar médico",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>p(n.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar médico",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-purple-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),e.jsx("span",{className:"text-gray-600 text-sm",children:"Especialidad:"}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:n.especialidad})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),e.jsx("span",{className:"text-gray-600 text-sm",children:"Email:"}),e.jsx("span",{className:"text-gray-900 text-sm",children:n.email})]})]})]},n.id))}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm border border-white/20 rounded-2xl p-4 mt-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"Mostrar:"}),e.jsx("select",{value:v,onChange:n=>C(Number(n.target.value)),className:"border border-gray-300 rounded-lg px-3 py-1.5 text-sm bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent",children:[5,10,20,50].map(n=>e.jsx("option",{value:n,children:n},n))})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("button",{onClick:()=>N(n=>Math.max(1,n-1)),disabled:j===1,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 font-medium",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),e.jsx("div",{className:"flex items-center gap-2 px-4 py-2 bg-white/80 rounded-lg border border-white/20",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Página ",j," de ",l||1]})}),e.jsxs("button",{onClick:()=>N(n=>n<l?n+1:n),disabled:j>=l,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 font-medium",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["Mostrando ",_===0?0:L+1," - ",Math.min(c,_)," de ",_," médicos"]})})]})]})},Se=({isOpen:s,onClose:r,mode:a="create",formData:d,onChange:x,onSubmit:w,error:y,isSaving:p})=>{const[j,N]=t.useState(d.firma||null),[v,C]=t.useState(""),l=t.useRef(null);if(!s)return null;const _=E=>{const S=E.target.files[0];if(!S)return;if(!S.type.match(/^image\/(png|jpeg|jpg)$/)){C("Solo se permiten archivos PNG, JPG o JPEG");return}if(S.size>2*1024*1024){C("El archivo es demasiado grande. Máximo 2MB.");return}const i=new FileReader;i.onload=h=>{const u=h.target.result;N(u),C(""),x({target:{name:"firma",value:u}})},i.readAsDataURL(S)},L=()=>{N(null),C(""),l.current&&(l.current.value=""),x({target:{name:"firma",value:null}})},c=a==="edit",b=c?"Editar Médico":"Registrar Nuevo Médico",n=c?"Actualizar información del médico":"Agregar médico al sistema",o=c?"Actualizar Médico":"Registrar Médico",m=c?"bg-gradient-to-r from-amber-500 to-orange-600":"bg-gradient-to-r from-blue-500 to-purple-600",f=c?"bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700";return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-md lg:max-w-2xl xl:max-w-3xl rounded-2xl shadow-2xl max-h-[95vh] sm:max-h-[88vh] lg:max-h-[85vh] flex flex-col",children:[e.jsx("div",{className:`${m} text-white p-4 sm:p-6 rounded-t-2xl flex-shrink-0`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:b}),e.jsx("p",{className:"text-white/80 text-sm",children:n})]})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-2 sm:py-4",children:e.jsx("form",{id:`medico-form-${a}`,onSubmit:w,className:"h-full flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4 sm:space-y-6 pb-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Información Personal"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Nombre *"]})}),e.jsx("input",{type:"text",name:"nombre",value:d.nombre,onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Juan",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Apellido *"]})}),e.jsx("input",{type:"text",name:"apellido",value:d.apellido||"",onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Pérez García",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"Especialidad *"]})}),e.jsx("input",{type:"text",name:"especialidad",value:d.especialidad,onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Cardiología",required:!0})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a1 1 0 011-1h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Códigos Profesionales"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a1 1 0 011-1h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"C.M.P. (Colegio Médico del Perú) *"]})}),e.jsx("input",{type:"text",name:"cmp",value:d.cmp||"",onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"64201",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Obligatorio para todos los médicos"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"R.N.E. (Registro Nacional de Especialidad)"]})}),e.jsx("input",{type:"text",name:"rne",value:d.rne||"",onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"36922"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Solo para médicos especialistas"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Información de Contacto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})}),"Email *"]})}),e.jsx("input",{type:"email",name:"email",value:d.email,onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"doctor@clinica2demayo.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),c?"Nueva Contraseña":"Contraseña de Acceso *"]})}),e.jsx("input",{type:"password",name:"password",value:d.password,onChange:x,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"••••••••",required:!c,autoComplete:"new-password"}),c&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Dejar vacío para mantener la contraseña actual"}),!c&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Mínimo 8 caracteres recomendados"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"✍️ Firma Digital"})]}),j?e.jsxs("div",{className:"bg-white border-2 border-dashed border-indigo-300 rounded-lg p-4 text-center",children:[e.jsx("img",{src:j,alt:"Firma digital",className:"max-h-32 mx-auto object-contain",style:{maxWidth:"300px"}}),e.jsx("div",{className:"mt-3 flex justify-center gap-2",children:e.jsx("button",{type:"button",onClick:L,className:"px-3 py-1 text-sm bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",children:"🗑️ Eliminar"})})]}):e.jsxs("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("p",{className:"text-gray-500",children:"No hay firma registrada"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Subir Firma Digital"]})}),e.jsx("input",{ref:l,type:"file",accept:"image/png,image/jpeg,image/jpg",onChange:_,className:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white"}),v&&e.jsxs("div",{className:"text-red-600 text-sm flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),v]}),e.jsx("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-3",children:e.jsxs("div",{className:"text-sm text-indigo-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"📋 Requisitos de la firma:"}),e.jsxs("ul",{className:"space-y-1 text-indigo-700 text-xs",children:[e.jsx("li",{children:"• Formato: PNG, JPG o JPEG"}),e.jsx("li",{children:"• Tamaño máximo: 2MB"}),e.jsx("li",{children:"• Recomendado: Fondo transparente"}),e.jsx("li",{children:"• Dimensiones sugeridas: 300x100 píxeles"})]})]})})]}),(d.nombre||d.apellido||d.cmp||j)&&e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Vista Previa - Así aparecerá en los documentos"]}),e.jsxs("div",{className:"bg-white border-2 border-blue-200 rounded-lg p-3 text-center",children:[j&&e.jsx("img",{src:j,alt:"Firma",className:"max-h-12 mx-auto object-contain mb-2"}),e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-800",children:[d.nombre," ",d.apellido]}),d.especialidad&&e.jsx("div",{className:"text-xs text-gray-600",children:d.especialidad}),e.jsxs("div",{className:"text-xs text-gray-600",children:[d.cmp&&`C.M.P. ${d.cmp}`,d.rne&&` - R.N.E ${d.rne}`]})]})]})]})]})]})})}),y&&e.jsx("div",{className:"mx-4 sm:mx-6 mb-4",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-5 w-5 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-red-700 font-medium",children:y})]})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 p-4 sm:p-6 border-t border-gray-200 bg-gray-50/50 rounded-b-2xl flex-shrink-0",children:[e.jsxs("button",{type:"button",onClick:r,className:"flex-1 px-6 py-3 rounded-xl bg-gray-100 text-gray-700 hover:bg-gray-200 transition-all duration-200 font-medium flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Cancelar"]}),e.jsx("button",{type:"submit",form:`medico-form-${a}`,disabled:p,className:`flex-1 px-6 py-3 rounded-xl ${f} text-white disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all duration-200 font-medium flex items-center justify-center gap-2`,children:p?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),o]})})]})]})})};function js(){const{medicos:s,allMedicos:r,loading:a,error:d,showModal:x,form:w,formError:y,saving:p,editModal:j,editForm:N,editError:v,editSaving:C,busqueda:l,setBusqueda:_,sortBy:L,sortDir:c,rowsPerPage:b,setRowsPerPage:n,page:o,setPage:m,totalRows:f,totalPages:E,startIdx:S,endIdx:i,handleOpenModal:h,handleCloseModal:u,handleInputChange:M,handleSubmit:T,handleEdit:A,handleEditClose:z,handleEditChange:P,handleEditSubmit:$,handleSort:H,deleteMedico:g}=us();return e.jsx("div",{className:"bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(gs,{busqueda:l,setBusqueda:_,onAddNew:h,medicos:r,totalCount:f}),e.jsx(fs,{medicos:s,loading:a,error:d,sortBy:L,sortDir:c,onSort:H,onEdit:A,onDelete:g,page:o,setPage:m,rowsPerPage:b,setRowsPerPage:n,totalPages:E,totalRows:f,startIdx:S,endIdx:i}),e.jsx(Se,{isOpen:x,onClose:u,mode:"create",formData:w,onChange:M,onSubmit:T,error:y,isSaving:p}),e.jsx(Se,{isOpen:j,onClose:z,mode:"edit",formData:N,onChange:P,onSubmit:$,error:v,isSaving:C})]})})})}function Ns(){return e.jsx("div",{className:"container mx-auto py-8",children:e.jsx(js,{})})}function vs({onSave:s,bloquesGuardados:r=[]}){const[a,d]=t.useState([]),[x,w]=t.useState({}),[y,p]=t.useState(null),j=new Set(r.map(n=>n.fecha)),N=n=>new Date(n.getTime()-n.getTimezoneOffset()*6e4).toISOString().slice(0,10),v=n=>{const o=new Date,m=new Date(n);return o.setHours(0,0,0,0),m.setHours(0,0,0,0),m<o},C=n=>{let o=Array.isArray(n)?n:[n];o=o.map(m=>N(m)),o=o.filter(m=>!v(m)),d(o),w(m=>{const f={...m};return o.forEach(E=>{f[E]||(f[E]=[{hora_inicio:"08:00:00",hora_fin:"10:00:00"}])}),Object.keys(f).forEach(E=>{o.includes(E)||delete f[E]}),f})},l=n=>{const o=N(n);v(o)&&!j.has(o)||(p(o),!a.includes(o)&&!v(o)&&(d(m=>[...m,o]),w(m=>({...m,[o]:[{hora_inicio:"08:00:00",hora_fin:"10:00:00"}]}))))},_=(n,o,m,f)=>{w(E=>{const S={...E};return S[n][o][m]=f,{...S}})},L=n=>{w(o=>{const m={...o};return m[n]=[...m[n],{hora_inicio:"08:00:00",hora_fin:"10:00:00"}],m})},c=(n,o)=>{w(m=>{const f={...m};return f[n]=f[n].filter((E,S)=>S!==o),f})},b=()=>{const n=[];Object.entries(x).forEach(([o,m])=>{m.forEach(f=>n.push({fecha:o,...f}))}),s&&s(n)};return e.jsxs("div",{className:"max-w-xl mx-auto p-4 border rounded shadow bg-white",children:[e.jsx("h2",{className:"font-bold text-lg mb-2 text-center",children:"Definir Disponibilidad"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Selecciona fechas:"}),e.jsx(Me,{onChange:C,value:a.length===1?new Date(a[0]):a.map(n=>new Date(n)),selectRange:!1,minDetail:"month",maxDetail:"month",allowPartialRange:!1,showNeighboringMonth:!1,locale:"es-ES",selectMultiple:!0,tileClassName:({date:n})=>{const o=N(n);let m=[];return a.includes(o)&&m.push("selected-multiple"),x[o]&&x[o].length>0&&m.push("has-bloques"),j.has(o)&&(v(o)?m.push("fecha-pasada"):m.push("fecha-registrada")),m.join(" ")},onClickDay:l}),e.jsxs("div",{className:"mt-3 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"font-semibold mb-1 text-gray-700",children:"Leyenda:"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-100 border-2 border-green-500 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-green-500 text-xs font-bold",children:"✓"})}),e.jsx("span",{children:"Ya registrado"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-100 border-2 border-gray-400 rounded flex items-center justify-center opacity-70",children:e.jsx("span",{className:"text-gray-500 text-xs font-bold",children:"⏰"})}),e.jsx("span",{children:"Consulta pasada"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-sky-400 rounded"}),e.jsx("span",{children:"Seleccionado"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-100 border border-blue-300 rounded"}),e.jsx("span",{children:"Hoy"})]})]})]})]}),a.length===0&&e.jsx("div",{className:"text-gray-500 text-sm mb-2",children:"Selecciona al menos una fecha en el calendario."}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 min-w-[320px] max-w-md relative",children:[e.jsx("button",{onClick:()=>p(null),className:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold","aria-label":"Cerrar",children:"×"}),e.jsxs("div",{className:"font-semibold mb-2 text-blue-700",children:["Bloques para ",y]}),x[y]&&x[y].map((n,o)=>e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("input",{type:"time",value:n.hora_inicio,onChange:m=>_(y,o,"hora_inicio",m.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("span",{children:"a"}),e.jsx("input",{type:"time",value:n.hora_fin,onChange:m=>_(y,o,"hora_fin",m.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("button",{type:"button",onClick:()=>c(y,o),className:"text-red-600 hover:underline",children:"Eliminar"})]},o)),e.jsx("button",{type:"button",onClick:()=>L(y),className:"text-blue-600 hover:underline text-sm mt-1",children:"+ Agregar otro horario"}),e.jsx("button",{onClick:()=>p(null),className:"bg-blue-600 text-white px-4 py-2 rounded font-bold w-full mt-4",children:"Cerrar"})]})}),a.length>0&&!y&&a.map(n=>e.jsxs("div",{className:"mb-4 border rounded p-2 bg-gray-50",children:[e.jsx("div",{className:"font-semibold mb-1",children:n}),x[n].map((o,m)=>e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("input",{type:"time",value:o.hora_inicio,onChange:f=>_(n,m,"hora_inicio",f.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("span",{children:"a"}),e.jsx("input",{type:"time",value:o.hora_fin,onChange:f=>_(n,m,"hora_fin",f.target.value+":00"),className:"border rounded px-2 py-1",step:"1800"}),e.jsx("button",{type:"button",onClick:()=>c(n,m),className:"text-red-600 hover:underline",children:"Eliminar"})]},m)),e.jsx("button",{type:"button",onClick:()=>L(n),className:"text-blue-600 hover:underline text-sm mt-1",children:"+ Agregar otro horario"})]},n)),e.jsx("button",{onClick:b,className:"bg-blue-600 text-white px-4 py-2 rounded font-bold w-full mt-2",children:"Guardar Disponibilidad"})]})}function ys(){const r=JSON.parse(sessionStorage.getItem("medico")||"null")?.id,[a,d]=t.useState(null),[x,w]=t.useState({hora_inicio:"",hora_fin:""}),y=m=>{d(m.id),w({hora_inicio:m.hora_inicio,hora_fin:m.hora_fin})},p=async m=>{try{(await(await fetch(`${O}api_disponibilidad_medicos.php`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m.id,fecha:m.fecha||"",hora_inicio:x.hora_inicio,hora_fin:x.hora_fin})})).json()).success?(d(null),L(),W.fire({icon:"success",title:"Bloque actualizado",showConfirmButton:!1,timer:1400})):W.fire({icon:"error",title:"No se pudo editar el bloque"})}catch{W.fire({icon:"error",title:"Error de red o servidor al editar"})}},j=()=>{d(null)},N=async m=>{if((await W.fire({title:"¿Seguro que deseas eliminar este bloque?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{(await(await fetch(`${O}api_disponibilidad_medicos.php`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m})})).json()).success?(L(),W.fire({icon:"success",title:"Bloque eliminado",showConfirmButton:!1,timer:1400})):W.fire({icon:"error",title:"No se pudo eliminar el bloque"})}catch{W.fire({icon:"error",title:"Error de red o servidor al eliminar"})}},[v,C]=t.useState([]),[l,_]=t.useState(!1),L=t.useCallback(async()=>{_(!0);try{const f=await(await fetch(`${O}api_disponibilidad_medicos.php?medico_id=${r}`)).json();C(f.disponibilidad||[])}catch{C([])}_(!1)},[r]);t.useEffect(()=>{L()},[L]);const c=async m=>{try{(await(await fetch(`${O}api_disponibilidad_medicos.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({medico_id:r,bloques:m})})).json()).success?(W.fire({icon:"success",title:"Disponibilidad guardada correctamente",showConfirmButton:!1,timer:1400}),L()):W.fire({icon:"error",title:"Error al guardar disponibilidad"})}catch{W.fire({icon:"error",title:"Error de red o servidor"})}},b=v.reduce((m,f)=>(m[f.fecha]||(m[f.fecha]=[]),m[f.fecha].push(f),m),{}),n=m=>m?.slice(0,5),o=m=>{const f=new Date,E=new Date(m);return f.setHours(0,0,0,0),E.setHours(0,0,0,0),E<f};return e.jsxs("div",{className:"max-w-6xl mx-auto mt-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8 text-center col-span-2",children:"Panel del Médico"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"md:w-1/2 w-full",children:e.jsx(vs,{onSave:c,bloquesGuardados:v})}),e.jsxs("div",{className:"md:w-1/2 w-full max-h-[70vh] overflow-y-auto bg-white rounded-lg shadow-inner",children:[e.jsxs("h2",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Disponibilidad registrada"]}),l?e.jsx("div",{className:"text-center py-4",children:e.jsx(ye,{message:"Cargando disponibilidad registrada..."})}):Object.keys(b).length===0?e.jsx("div",{className:"text-gray-500 text-center py-6",children:"No hay bloques registrados aún."}):e.jsx("div",{className:"space-y-6",children:Object.keys(b).sort().map(m=>{const f=o(m);return e.jsxs("div",{className:`rounded-lg shadow p-4 ${f?"bg-gray-50 border-l-4 border-gray-400":"bg-blue-50"}`,children:[e.jsxs("div",{className:`font-semibold mb-2 flex items-center gap-2 ${f?"text-gray-600":"text-blue-700"}`,children:[f?e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(()=>{const[E,S,i]=m.split("-");return new Date(Number(E),Number(S)-1,Number(i)).toLocaleDateString()})(),f&&e.jsx("span",{className:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded-full ml-2",children:"Consulta pasada"})]}),e.jsxs("table",{className:`min-w-full text-sm border rounded overflow-hidden ${f?"opacity-70":""}`,children:[e.jsx("thead",{className:`${f?"bg-gray-200":"bg-blue-100"}`,children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1",children:"Hora inicio"}),e.jsx("th",{className:"px-2 py-1",children:"Hora fin"}),e.jsx("th",{className:"px-2 py-1 text-center",children:f?"Historial":"Acciones"})]})}),e.jsx("tbody",{children:b[m].map(E=>e.jsx("tr",{className:`${f?"hover:bg-gray-100":"hover:bg-blue-200"} transition group`,children:a===E.id&&!f?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-1 text-center",children:e.jsx("input",{type:"time",className:"border rounded px-1 py-0.5 text-green-700 font-mono",value:x.hora_inicio,onChange:S=>w(i=>({...i,hora_inicio:S.target.value}))})}),e.jsx("td",{className:"px-2 py-1 text-center",children:e.jsx("input",{type:"time",className:"border rounded px-1 py-0.5 text-red-700 font-mono",value:x.hora_fin,onChange:S=>w(i=>({...i,hora_fin:S.target.value}))})}),e.jsxs("td",{className:"px-2 py-1 text-center flex gap-1 justify-center",children:[e.jsx("button",{title:"Guardar",onClick:()=>p(E),className:"text-green-600 hover:text-green-800",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("button",{title:"Cancelar",onClick:j,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-1 text-center font-mono text-green-700",children:n(E.hora_inicio)}),e.jsx("td",{className:"px-2 py-1 text-center font-mono text-red-700",children:n(E.hora_fin)}),e.jsx("td",{className:"px-2 py-1 text-center flex gap-1 justify-center",children:f?e.jsx("span",{className:"text-xs text-gray-500 px-2 py-1 bg-gray-100 rounded",children:"Finalizado"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{title:"Editar",onClick:()=>y(E),className:"text-blue-500 hover:text-blue-700 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m2-2l-6 6"})})}),e.jsx("button",{title:"Eliminar",onClick:()=>N(E.id),className:"text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})})]})},E.id))})]})]},m)})})]})]})]})}function ws(){return e.jsx(ys,{})}function Cs({consultaId:s,resultadosLab:r,ordenesLab:a=[]}){const[d,x]=t.useState("laboratorio"),[w,y]=t.useState([]),p=ie();t.useEffect(()=>{fetch(`${O}/api_examenes_laboratorio.php`,{credentials:"include"}).then(N=>N.json()).then(N=>y(N.examenes||[])).catch(N=>console.error("Error al obtener exámenes:",N))},[]);const j=be.useMemo(()=>{const N={};for(const v of w)N[v.id]=v.nombre;return N},[w]);return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 mb-2",children:[e.jsxs("button",{onClick:()=>x("laboratorio"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${d==="laboratorio"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["🧪 ",e.jsx("span",{className:"hidden sm:inline",children:"Laboratorio"}),e.jsx("span",{className:"sm:hidden",children:"Lab"})]}),e.jsxs("button",{onClick:()=>x("rx"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${d==="rx"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["📸 ",e.jsx("span",{className:"hidden sm:inline",children:"RX"})]}),e.jsxs("button",{onClick:()=>x("ecografia"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${d==="ecografia"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["🫀 ",e.jsx("span",{className:"hidden sm:inline",children:"Ecografía"}),e.jsx("span",{className:"sm:hidden",children:"Eco"})]}),e.jsxs("button",{onClick:()=>x("tomografia"),className:`px-2 sm:px-3 py-1 rounded-t text-xs sm:text-sm ${d==="tomografia"?"bg-blue-600 text-white":"bg-gray-200"}`,children:["🔬 ",e.jsx("span",{className:"hidden sm:inline",children:"Tomografía"}),e.jsx("span",{className:"sm:hidden",children:"TAC"})]})]}),e.jsxs("div",{className:"border rounded-b bg-white p-3 overflow-hidden",children:[d==="laboratorio"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mb-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",onClick:()=>p(`/solicitud-laboratorio/${s}`),children:"Solicitar análisis de laboratorio"}),(!a||a.length===0)&&e.jsx("div",{className:"mb-3 p-2 bg-gray-50 border border-gray-200 rounded text-gray-600",children:"No hay exámenes solicitados para esta consulta."}),a&&a.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-yellow-50 border border-yellow-300 rounded",children:[e.jsx("div",{className:"font-semibold text-yellow-800 mb-1",children:"Exámenes solicitados:"}),a.map((N,v)=>e.jsxs("ul",{className:"list-disc ml-5 text-sm",children:[Array.isArray(N.examenes)&&N.examenes.length>0?N.examenes.map((C,l)=>typeof C=="string"||typeof C=="number"?e.jsx("li",{children:j[C]||C},l):e.jsx("li",{children:C.nombre||j[C.id]||JSON.stringify(C)},l)):e.jsx("li",{className:"text-gray-500",children:"Sin detalles de exámenes"}),e.jsxs("li",{className:"text-xs text-gray-500",children:["Estado: ",N.estado||"pendiente"]})]},N.id||v)),(!r||r.length===0||r.every(N=>!N.resultados||typeof N.resultados=="object"&&Object.keys(N.resultados).length===0||typeof N.resultados=="string"&&N.resultados.trim()===""))&&e.jsx("div",{className:"mt-2 text-sm text-gray-500",children:"Aún no hay resultados disponibles."})]}),r&&r.length>0&&r.some(N=>N.resultados&&(typeof N.resultados=="object"&&Object.keys(N.resultados).length>0||typeof N.resultados=="string"&&N.resultados.trim()!==""))&&e.jsxs("div",{className:"mb-6 p-3 sm:p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-green-800",children:"Resultados Disponibles"}),e.jsx("p",{className:"text-xs sm:text-sm text-green-600",children:"Los resultados de laboratorio ya están listos"})]})]}),e.jsxs("button",{className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg hover:shadow-xl text-sm sm:text-base",onClick:()=>p(`/resultados-laboratorio/${s}`),children:[e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden sm:inline",children:"📋 Ver Resultados de Laboratorio"}),e.jsx("span",{className:"sm:hidden",children:"📋 Ver Resultados"}),e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),d==="rx"&&e.jsx("div",{className:"text-gray-500",children:"(Próximamente: solicitud y resultados de Rayos X)"}),d==="ecografia"&&e.jsx("div",{className:"text-gray-500",children:"(Próximamente: solicitud y resultados de Ecografía)"}),d==="tomografia"&&e.jsx("div",{className:"text-gray-500",children:"(Próximamente: solicitud y resultados de Tomografía)"})]})]})}function ks({hc:s,setHc:r}){return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Anamnesis"}),e.jsxs("div",{className:"mb-2 flex flex-col md:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Tiempo de Enfermedad:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.tiempo_enfermedad,onChange:a=>r(d=>({...d,tiempo_enfermedad:a.target.value}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Forma de inicio:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.forma_inicio,onChange:a=>r(d=>({...d,forma_inicio:a.target.value}))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Curso:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.curso,onChange:a=>r(d=>({...d,curso:a.target.value}))})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Descripción general del cuadro actual:"}),e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.descripcion_general||"",onChange:a=>r(d=>({...d,descripcion_general:a.target.value}))})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Antecedentes"}),e.jsx("div",{className:"mb-2",children:e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.antecedentes,onChange:a=>r(d=>({...d,antecedentes:a.target.value}))})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Examen Físico"}),e.jsx("div",{className:"mb-2",children:e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,value:s.examen_fisico,onChange:a=>r(d=>({...d,examen_fisico:a.target.value}))})})]})}function _s({triaje:s}){return s?e.jsxs("div",{className:"space-y-4",children:[s.motivo&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"📋 Motivo de Consulta"}),e.jsx("p",{className:"text-blue-800 leading-relaxed",children:s.motivo})]})]})}),s.sintomas&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-orange-900 mb-2",children:"🩺 Síntomas Principales"}),e.jsx("p",{className:"text-orange-800 leading-relaxed",children:s.sintomas})]})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),"❤️ Signos Vitales"]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:[s.presion_arterial&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Presión Arterial"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:s.presion_arterial}),e.jsx("div",{className:"text-xs text-gray-400",children:"mmHg"})]}),s.frecuencia_cardiaca&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Freq. Cardíaca"}),e.jsx("div",{className:"text-lg font-bold text-pink-600",children:s.frecuencia_cardiaca}),e.jsx("div",{className:"text-xs text-gray-400",children:"lpm"})]}),s.frecuencia_respiratoria&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Freq. Respiratoria"}),e.jsx("div",{className:"text-lg font-bold text-blue-600",children:s.frecuencia_respiratoria}),e.jsx("div",{className:"text-xs text-gray-400",children:"rpm"})]}),s.temperatura&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Temperatura"}),e.jsx("div",{className:"text-lg font-bold text-orange-600",children:s.temperatura}),e.jsx("div",{className:"text-xs text-gray-400",children:"°C"})]}),s.saturacion&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Sat. O₂"}),e.jsx("div",{className:"text-lg font-bold text-cyan-600",children:s.saturacion}),e.jsx("div",{className:"text-xs text-gray-400",children:"%"})]}),s.peso&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Peso"}),e.jsx("div",{className:"text-lg font-bold text-purple-600",children:s.peso}),e.jsx("div",{className:"text-xs text-gray-400",children:"kg"})]}),s.talla&&e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase",children:"Talla"}),e.jsx("div",{className:"text-lg font-bold text-indigo-600",children:s.talla}),e.jsx("div",{className:"text-xs text-gray-400",children:"cm"})]}),s.peso&&s.talla&&e.jsxs("div",{className:"bg-gradient-to-r from-emerald-50 to-teal-50 rounded-lg p-3 shadow-sm border border-emerald-200",children:[e.jsx("div",{className:"text-xs text-emerald-700 font-medium uppercase",children:"IMC"}),e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:(parseFloat(s.peso)/Math.pow(parseFloat(s.talla)/100,2)).toFixed(1)}),e.jsx("div",{className:"text-xs text-emerald-500",children:"kg/m²"})]})]})]}),(s.nivel_conciencia||s.hidratacion||s.coloracion)&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-purple-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"👤 Estado General"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[s.nivel_conciencia&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Conciencia:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.nivel_conciencia==="Alerta"?"bg-green-100 text-green-800":s.nivel_conciencia==="Somnoliento"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.nivel_conciencia})]}),s.hidratacion&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Hidratación:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.hidratacion==="Normal"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:s.hidratacion})]}),s.coloracion&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Coloración:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.coloracion==="Normal"?"bg-green-100 text-green-800":s.coloracion==="Cianosis"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s.coloracion})]})]})]})]}):e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-yellow-700",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"font-medium",children:"No hay datos de triaje registrados"})]}),e.jsx("p",{className:"text-sm text-yellow-600 mt-2",children:"El triaje debe ser realizado por el personal de enfermería"})]})}function Ss({paciente:s}){return s?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",s.nombre," ",s.apellido]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",s.dni]}),e.jsxs("div",{children:[e.jsx("b",{children:"Historia Clínica:"})," ",s.historia_clinica]}),e.jsxs("div",{children:[e.jsx("b",{children:"Edad:"})," ",s.edad," ",s.edad_unidad]}),e.jsxs("div",{children:[e.jsx("b",{children:"Sexo:"})," ",s.sexo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Dirección:"})," ",s.direccion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Teléfono:"})," ",s.telefono]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",s.email]})]}):null}function Es({diagnosticos:s,setDiagnosticos:r}){const[a,d]=t.useState(""),[x,w]=t.useState([]),[y,p]=t.useState(null),[j,N]=t.useState({tipo:"principal",observaciones:""}),[v,C]=t.useState(!1);t.useEffect(()=>{if(a.length<2){w([]);return}C(!0);const b=setTimeout(async()=>{try{const o=await(await fetch(`http://localhost/clinica-2demayo/api_cie10.php?buscar=${encodeURIComponent(a)}&limite=15`)).json();o.success?w(o.data):(console.error("Error en la búsqueda:",o.message),w([]))}catch(n){console.error("Error al buscar códigos CIE10:",n),w([])}finally{C(!1)}},300);return()=>clearTimeout(b)},[a]);const l=()=>{y&&(r(c=>[...c,{...y,...j,fecha:new Date().toISOString().slice(0,10)}]),p(null),N({tipo:"secundario",observaciones:""}),d(""),w([]))},_=c=>{r(b=>b.filter(n=>n.codigo!==c))},L=(c,b)=>{r(n=>n.map(o=>o.codigo===c?{...o,tipo:b}:o))};return e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Diagnóstico (CIE10)"}),e.jsx("div",{className:"mb-2 flex flex-col sm:flex-row gap-2 items-stretch",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",className:"border rounded p-2 w-full pr-10",placeholder:"Buscar diagnóstico por nombre o código CIE10...",value:a,onChange:c=>{d(c.target.value),p(null)}}),v&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]})}),a.length>=2&&!v&&x.length===0&&e.jsxs("div",{className:"border rounded bg-yellow-50 p-3 mb-2 text-center",children:[e.jsxs("div",{className:"text-yellow-700",children:['No se encontraron códigos CIE10 para "',a,'"']}),e.jsx("div",{className:"text-xs text-yellow-600 mt-1",children:"Intenta con otros términos o códigos"})]}),x.length>0&&!y&&e.jsx("div",{className:"border rounded bg-white shadow-lg max-h-60 overflow-y-auto mb-2 z-10",children:x.map(c=>e.jsx("div",{className:"px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>p(c),children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm text-gray-900",children:c.nombre}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded mr-2",children:c.codigo}),c.categoria&&e.jsx("span",{className:"text-blue-600",children:c.categoria}),c.subcategoria&&e.jsxs("span",{className:"text-gray-500",children:[" • ",c.subcategoria]})]}),c.descripcion&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:c.descripcion})]})})},c.id))}),y&&e.jsxs("div",{className:"border rounded p-3 bg-blue-50 mb-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"font-semibold text-lg",children:y.nombre}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-mono bg-blue-100 px-2 py-1 rounded mr-2",children:y.codigo}),y.categoria&&e.jsx("span",{className:"text-blue-600",children:y.categoria}),y.subcategoria&&e.jsxs("span",{className:"text-gray-500",children:[" • ",y.subcategoria]})]}),y.descripcion&&e.jsx("div",{className:"text-sm text-gray-700 mt-2 p-2 bg-white rounded border-l-4 border-blue-400",children:y.descripcion})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-1",children:[e.jsxs("select",{className:"border rounded p-1",value:j.tipo,onChange:c=>N(b=>({...b,tipo:c.target.value})),children:[e.jsx("option",{value:"principal",children:"Principal"}),e.jsx("option",{value:"secundario",children:"Secundario"})]}),e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Observaciones",value:j.observaciones,onChange:c=>N(b=>({...b,observaciones:c.target.value}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:l,children:"Agregar diagnóstico"}),e.jsx("button",{type:"button",className:"bg-gray-400 text-white px-3 py-1 rounded",onClick:()=>p(null),children:"Cancelar"})]})]}),s.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Diagnósticos agregados:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border rounded min-w-max",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Código"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Nombre"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Tipo"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Observaciones"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Fecha"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap w-16",children:"Quitar"})]})}),e.jsx("tbody",{children:s.map((c,b)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1 font-mono text-xs whitespace-nowrap",children:c.codigo}),e.jsx("td",{className:"border px-2 py-1 max-w-xs truncate",title:c.nombre,children:c.nombre}),e.jsx("td",{className:"border px-2 py-1",children:e.jsxs("select",{className:"border rounded p-1 text-xs w-full min-w-0",value:c.tipo,onChange:n=>L(c.codigo,n.target.value),children:[e.jsx("option",{value:"principal",children:"Principal"}),e.jsx("option",{value:"secundario",children:"Secundario"})]})}),e.jsx("td",{className:"border px-2 py-1 max-w-xs truncate",title:c.observaciones,children:c.observaciones}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:c.fecha}),e.jsx("td",{className:"border px-2 py-1 text-center",children:e.jsx("button",{type:"button",className:"text-red-600 hover:text-red-800 bg-red-100 hover:bg-red-200 rounded px-2 py-1 text-xs font-medium transition-colors",onClick:()=>_(c.codigo),title:"Eliminar diagnóstico",children:"✕"})})]},c.codigo+b))})]})})]})]})}function Ls({receta:s,setReceta:r}){const a=Array.isArray(s)?s:[],[d,x]=t.useState(""),[w,y]=t.useState([]),[p,j]=t.useState(!1),[N,v]=t.useState(null),[C,l]=t.useState({dosis:"",frecuencia:"",duracion:"",observaciones:""});t.useEffect(()=>{if(d.length<2){y([]);return}j(!0),fetch(`${O}api_medicamentos.php?busqueda=${encodeURIComponent(d)}`,{credentials:"include"}).then(c=>c.json()).then(c=>y(c)).finally(()=>j(!1))},[d]);const _=()=>{if(!N)return;const c={codigo:N.codigo,nombre:N.nombre,dosis:C.dosis,frecuencia:C.frecuencia,duracion:C.duracion,observaciones:C.observaciones};r(b=>[c,...b]),v(null),l({dosis:"",frecuencia:"",duracion:"",observaciones:""}),x(""),y([])},L=c=>{r(b=>b.filter(n=>n.codigo!==c))};return e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Receta médica"}),e.jsxs("div",{className:"mb-2 flex flex-col sm:flex-row gap-2 items-stretch",children:[e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Buscar medicamento por nombre o código",value:d,onChange:c=>{x(c.target.value),v(null)}}),p&&e.jsx("span",{className:"text-xs text-gray-500",children:"Buscando..."})]}),w.length>0&&!N&&e.jsx("div",{className:"border rounded bg-white shadow max-h-40 overflow-y-auto mb-2",children:w.map(c=>e.jsxs("div",{className:"px-2 py-1 hover:bg-blue-100 cursor-pointer text-sm",onClick:()=>v(c),children:[c.nombre," ",e.jsxs("span",{className:"text-gray-500",children:["(",c.codigo,")"]})]},c.codigo))}),N&&e.jsxs("div",{className:"border rounded p-2 bg-blue-50 mb-2",children:[e.jsxs("div",{className:"font-semibold mb-1",children:[N.nombre," ",e.jsxs("span",{className:"text-gray-500",children:["(",N.codigo,")"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-1",children:[e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Dosis (ej: 500mg)",value:C.dosis,onChange:c=>l(b=>({...b,dosis:c.target.value}))}),e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Frecuencia (ej: cada 8h)",value:C.frecuencia,onChange:c=>l(b=>({...b,frecuencia:c.target.value}))}),e.jsx("input",{type:"text",className:"border rounded p-1 flex-1",placeholder:"Duración (ej: 5 días)",value:C.duracion,onChange:c=>l(b=>({...b,duracion:c.target.value}))})]}),e.jsx("textarea",{className:"border rounded p-1 w-full mb-2",placeholder:"Observaciones",value:C.observaciones,onChange:c=>l(b=>({...b,observaciones:c.target.value})),rows:2}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:_,children:"Agregar a receta"}),e.jsx("button",{type:"button",className:"bg-gray-400 text-white px-3 py-1 rounded",onClick:()=>v(null),children:"Cancelar"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Medicamentos seleccionados:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border rounded min-w-max",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Medicamento"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Dosis"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Frecuencia"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Duración"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Observaciones"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap w-16",children:"Quitar"})]})}),e.jsx("tbody",{children:a.length>0?a.map((c,b)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1 max-w-xs",children:e.jsxs("div",{className:"truncate",title:`${c.nombre} (${c.codigo})`,children:[c.nombre," ",e.jsxs("span",{className:"text-gray-500",children:["(",c.codigo,")"]})]})}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:c.dosis}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:c.frecuencia}),e.jsx("td",{className:"border px-2 py-1 whitespace-nowrap",children:c.duracion}),e.jsx("td",{className:"border px-2 py-1 max-w-xs truncate",title:c.observaciones,children:c.observaciones}),e.jsx("td",{className:"border px-2 py-1 text-center",children:e.jsx("button",{type:"button",className:"text-red-600 hover:text-red-800 bg-red-100 hover:bg-red-200 rounded px-2 py-1 text-xs font-medium transition-colors",onClick:()=>L(c.codigo),title:"Eliminar medicamento",children:"✕"})})]},c.codigo+b)):e.jsx("tr",{children:e.jsx("td",{className:"border px-2 py-1 text-center text-gray-500 italic",colSpan:6,children:"No hay medicamentos seleccionados"})})})]})})]})]})}function Ms({receta:s,setReceta:r,tratamiento:a,setTratamiento:d}){return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 mt-4",children:"Tratamiento"}),e.jsx("div",{className:"mb-2",children:e.jsx("textarea",{className:"w-full border rounded p-1",rows:2,placeholder:"Indicación general, reposo, dieta, fisioterapia, etc.",value:a||"",onChange:x=>d(x.target.value)})}),e.jsx(Ls,{receta:s,setReceta:r})]})}const Ps=({paciente:s,triaje:r,hc:a,diagnosticos:d,medicamentos:x,ordenesLaboratorio:w,medicoInfo:y,configuracionClinica:p})=>{const j=()=>window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?`${window.location.protocol}//${window.location.host}/2demayo.svg`:"/2demayo.svg",N=l=>l?new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",v=l=>l?new Date(l).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"",C=({titulo:l,mensaje:_="No hay información registrada"})=>e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"font-semibold text-gray-600 mb-2 border-b border-gray-300",children:l}),e.jsx("p",{className:"text-sm text-gray-500 italic text-center p-4",children:_})]});return e.jsxs("div",{className:"bg-white p-8 max-w-4xl mx-auto shadow-lg print:shadow-none print:max-w-none",children:[e.jsx("style",{jsx:!0,children:`
        @media print {
          .firma-medico {
            break-inside: avoid;
            page-break-inside: avoid;
          }
          .firma-imagen {
            print-color-adjust: exact;
            -webkit-print-color-adjust: exact;
          }
        }
      `}),e.jsx("div",{className:"text-center border-b-2 border-blue-600 pb-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-2",children:[e.jsx("img",{src:j(),alt:"Logo Clínica 2 de Mayo",className:"h-16 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-800",children:p?.nombre_clinica||"CLÍNICA 2 DE MAYO"}),e.jsx("p",{className:"text-sm text-gray-600",children:p?.direccion||"Dirección de la clínica"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Tel: ",p?.telefono||"123-456-789"," | Email: ",p?.email||"contacto@clinica2demayo.com"]})]})]})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 border-b border-gray-300 pb-2",children:"📋 HISTORIA CLÍNICA"}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mt-2",children:[e.jsxs("span",{children:["Fecha: ",N(new Date)]}),e.jsxs("span",{children:["Hora: ",v(new Date)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6 p-4 bg-blue-50 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2 border-b border-blue-200",children:"👤 DATOS DEL PACIENTE"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Nombre:"})," ",s?.nombres," ",s?.apellidos]}),e.jsxs("p",{children:[e.jsx("strong",{children:"DNI:"})," ",s?.dni]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Edad:"})," ",s?.edad," años"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Sexo:"})," ",s?.sexo]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Teléfono:"})," ",s?.telefono]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2 border-b border-blue-200",children:"🩺 INFORMACIÓN MÉDICA"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Médico:"})," Dr(a). ",y?.nombre," ",y?.apellido]}),e.jsxs("p",{children:[e.jsx("strong",{children:"CMP:"})," ",y?.cmp||"N/A"]}),y?.rne&&e.jsxs("p",{children:[e.jsx("strong",{children:"RNE:"})," ",y.rne]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Especialidad:"})," ",y?.especialidad]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha Consulta:"})," ",N(s?.fecha_consulta)]})]})]})]}),r?.motivo&&e.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-2 border-b border-yellow-300",children:"📝 MOTIVO DE CONSULTA"}),e.jsx("p",{className:"text-sm leading-relaxed",children:r.motivo})]}),r&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-2 border-b border-green-300",children:"❤️ SIGNOS VITALES"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[r.presion_arterial&&e.jsxs("div",{children:[e.jsx("strong",{children:"P/A:"})," ",r.presion_arterial," mmHg"]}),r.frecuencia_cardiaca&&e.jsxs("div",{children:[e.jsx("strong",{children:"FC:"})," ",r.frecuencia_cardiaca," lpm"]}),r.frecuencia_respiratoria&&e.jsxs("div",{children:[e.jsx("strong",{children:"FR:"})," ",r.frecuencia_respiratoria," rpm"]}),r.temperatura&&e.jsxs("div",{children:[e.jsx("strong",{children:"T°:"})," ",r.temperatura,"°C"]}),r.saturacion&&e.jsxs("div",{children:[e.jsx("strong",{children:"SpO₂:"})," ",r.saturacion,"%"]}),r.peso&&e.jsxs("div",{children:[e.jsx("strong",{children:"Peso:"})," ",r.peso," kg"]}),r.talla&&e.jsxs("div",{children:[e.jsx("strong",{children:"Talla:"})," ",r.talla," cm"]}),r.peso&&r.talla&&e.jsxs("div",{children:[e.jsx("strong",{children:"IMC:"})," ",(parseFloat(r.peso)/Math.pow(parseFloat(r.talla)/100,2)).toFixed(1)," kg/m²"]})]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"font-semibold text-purple-800 mb-3 border-b border-purple-300",children:"🔍 ANAMNESIS"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 text-sm",children:[a.tiempo_enfermedad&&e.jsxs("div",{children:[e.jsx("strong",{children:"Tiempo de Enfermedad:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:a.tiempo_enfermedad})]}),a.forma_inicio&&e.jsxs("div",{children:[e.jsx("strong",{children:"Forma de Inicio:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:a.forma_inicio})]}),a.curso&&e.jsxs("div",{children:[e.jsx("strong",{children:"Curso:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:a.curso})]})]}),a.descripcion_general&&e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Descripción General:"}),e.jsx("p",{className:"mt-1 p-2 bg-white rounded border",children:a.descripcion_general})]})]}),a.antecedentes&&e.jsxs("div",{className:"mb-6 p-4 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"font-semibold text-orange-800 mb-2 border-b border-orange-300",children:"📚 ANTECEDENTES"}),e.jsx("p",{className:"text-sm leading-relaxed p-2 bg-white rounded border",children:a.antecedentes})]}),a.examen_fisico&&e.jsxs("div",{className:"mb-6 p-4 bg-teal-50 rounded-lg border border-teal-200",children:[e.jsx("h3",{className:"font-semibold text-teal-800 mb-2 border-b border-teal-300",children:"🔬 EXAMEN FÍSICO"}),e.jsx("p",{className:"text-sm leading-relaxed p-2 bg-white rounded border",children:a.examen_fisico})]}),d&&d.length>0?e.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg border border-red-200 seccion-diagnosticos",children:[e.jsx("h3",{className:"font-semibold text-red-800 mb-2 border-b border-red-300",children:"🎯 DIAGNÓSTICOS CIE-10"}),e.jsx("div",{className:"space-y-3",children:d.map((l,_)=>e.jsx("div",{className:"text-sm p-3 bg-white rounded border border-red-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"inline-block w-6 h-6 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center flex-shrink-0",children:_+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[e.jsx("span",{className:"inline-block px-2 py-1 bg-red-100 text-red-800 text-xs font-semibold rounded",children:l.tipo||"Principal"}),e.jsx("span",{className:"inline-block px-2 py-1 bg-gray-100 text-gray-800 text-xs font-mono rounded",children:l.codigo})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900 leading-relaxed",children:l.descripcion})]})]})},_))})]}):e.jsx(C,{titulo:"🎯 DIAGNÓSTICOS CIE-10",mensaje:"No se han registrado diagnósticos para esta consulta"}),a.tratamiento&&e.jsxs("div",{className:"mb-6 p-4 bg-indigo-50 rounded-lg border border-indigo-200",children:[e.jsx("h3",{className:"font-semibold text-indigo-800 mb-2 border-b border-indigo-300",children:"💊 PLAN DE TRATAMIENTO"}),e.jsx("p",{className:"text-sm leading-relaxed p-2 bg-white rounded border",children:a.tratamiento})]}),x&&x.length>0?e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200 seccion-medicamentos",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-2 border-b border-green-300",children:"💉 RECETA MÉDICA"}),e.jsx("div",{className:"space-y-3",children:x.map((l,_)=>e.jsxs("div",{className:"text-sm p-3 bg-white rounded border border-green-100",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Medicamento:"})," ",l.medicamento]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Concentración:"})," ",l.concentracion]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Forma Farmacéutica:"})," ",l.forma_farmaceutica]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Dosis:"})," ",l.dosis]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Frecuencia:"})," ",l.frecuencia]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duración:"})," ",l.duracion]})]})]}),l.indicaciones&&e.jsx("div",{className:"mt-2 pt-2 border-t border-green-100",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Indicaciones:"})," ",l.indicaciones]})})]},_))})]}):e.jsx(C,{titulo:"💉 RECETA MÉDICA",mensaje:"No se han prescrito medicamentos para esta consulta"}),w&&w.length>0?e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200 seccion-laboratorio",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2 border-b border-blue-300",children:"🔬 EXÁMENES DE LABORATORIO SOLICITADOS"}),e.jsx("div",{className:"space-y-3",children:w.map((l,_)=>e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-blue-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded",children:["Orden #",l.id||_+1]}),e.jsx("span",{className:"text-xs text-gray-500",children:N(l.fecha_solicitud)})]}),l.examenes&&l.examenes.length>0?e.jsx("div",{className:"space-y-2",children:l.examenes.map((L,c)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-blue-50 rounded border-l-4 border-blue-300",children:[e.jsx("span",{className:"w-5 h-5 bg-blue-500 text-white text-xs font-bold rounded-full flex items-center justify-center flex-shrink-0",children:c+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900",children:L.nombre}),L.descripcion&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:L.descripcion}),L.condicion_paciente&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:[e.jsx("strong",{children:"Condición:"})," ",L.condicion_paciente]}),L.tiempo_resultado&&e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[e.jsx("strong",{children:"Tiempo estimado:"})," ",L.tiempo_resultado]})]}),e.jsx("div",{className:"text-xs",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${l.estado==="pendiente"?"bg-yellow-100 text-yellow-800":l.estado==="completado"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:l.estado||"Pendiente"})})]},c))}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No hay exámenes específicos registrados"})]},_))})]}):e.jsx(C,{titulo:"🔬 EXÁMENES DE LABORATORIO SOLICITADOS",mensaje:"No se han solicitado exámenes de laboratorio para esta consulta"}),e.jsx("div",{className:"mt-8 pt-4 border-t-2 border-gray-300",children:e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("p",{children:"Documento generado digitalmente"}),e.jsxs("p",{children:["Fecha de impresión: ",N(new Date)," - ",v(new Date)]})]}),e.jsxs("div",{className:"text-center pie-firma",children:[y?.firma&&e.jsx("div",{className:"mb-4 firma-digital",children:e.jsx("img",{src:y.firma,alt:"Firma digital del médico",className:"mx-auto border border-gray-300 rounded bg-white p-1 firma-img-hc"})}),e.jsxs("div",{className:"border-t-2 border-gray-400 pt-2 min-w-[200px]",children:[e.jsxs("p",{className:"font-semibold text-sm",children:["Dr(a). ",y?.nombre," ",y?.apellido]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["CMP: ",y?.cmp||"N/A"]}),y?.rne&&e.jsxs("p",{className:"text-xs text-gray-600",children:["RNE: ",y.rne]}),e.jsx("p",{className:"text-xs text-gray-600",children:y?.especialidad}),!y?.firma&&e.jsx("div",{className:"mt-2 mb-4 h-16 flex items-center justify-center border border-dashed border-gray-300 text-xs text-gray-400",children:"[Espacio para firma manual]"})]})]})]})})]})},Fs=({paciente:s,ordenesLaboratorio:r,medicoInfo:a,configuracionClinica:d})=>{const x=()=>window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?`${window.location.protocol}//${window.location.host}/2demayo.svg`:"/2demayo.svg",w=p=>p?new Date(p).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",y=p=>p?new Date(p).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"";return e.jsxs("div",{className:"bg-white max-w-2xl mx-auto print:shadow-none print:max-w-none",style:{minHeight:"210mm",maxWidth:"148mm",padding:"10mm",fontFamily:"Arial, sans-serif",fontSize:"12px"},children:[e.jsxs("div",{className:"border-2 border-black p-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-black pb-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:x(),alt:"Logo Clínica 2 de Mayo",className:"h-10 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-bold text-black uppercase leading-tight",children:d?.nombre_clinica||"CLÍNICA 2 DE MAYO"}),e.jsx("p",{className:"text-xs text-black",children:d?.direccion||"Dirección de la clínica"}),e.jsxs("p",{className:"text-xs text-black",children:["Tel: ",d?.telefono||"123-456-789"]}),d?.ruc&&e.jsxs("p",{className:"text-xs text-black",children:["RUC: ",d.ruc]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("h2",{className:"text-sm font-bold text-black leading-tight",children:["Dr(a). ",a?.nombre," ",a?.apellido]}),e.jsx("p",{className:"text-xs text-black",children:a?.especialidad}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",a?.cmp||"N/A"]}),a?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",a.rne]})]})]}),e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-black border-b border-black pb-1",children:"📋 ORDEN DE LABORATORIO"}),e.jsxs("div",{className:"flex justify-between text-xs text-black mt-1",children:[e.jsxs("span",{children:["Fecha: ",w(new Date)]}),e.jsxs("span",{children:["Hora: ",y(new Date)]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-3",children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"👤 DATOS DEL PACIENTE"}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 text-xs",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Paciente:"})," ",s?.nombres," ",s?.apellidos]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"DNI:"})," ",s?.dni]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Edad:"})," ",s?.edad," años"]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Sexo:"})," ",s?.sexo]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"🔬 EXÁMENES SOLICITADOS"}),r&&r.length>0?e.jsx("div",{className:"space-y-2",children:r.map((p,j)=>e.jsxs("div",{className:"border border-gray-300 p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"font-bold text-black text-xs bg-blue-200 px-1 rounded",children:["#",j+1]}),e.jsxs("span",{className:"text-xs text-black",children:["Solicitud: ",w(p.fecha_solicitud)]})]}),p.examenes&&p.examenes.length>0?e.jsx("ul",{className:"list-disc pl-5 text-xs text-black",children:p.examenes.map((N,v)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:N.nombre}),N.condicion_paciente&&e.jsxs("span",{className:"ml-2 bg-yellow-100 px-1 rounded border",children:["⚠️ ",N.condicion_paciente]}),N.tiempo_resultado&&e.jsxs("span",{className:"ml-2 bg-blue-100 px-1 rounded border",children:["⏱️ ",N.tiempo_resultado]})]},v))}):e.jsx("p",{className:"text-xs text-black",children:"Sin detalles disponibles"})]},j))}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{className:"text-xs",children:"No hay órdenes de laboratorio"})})]}),e.jsx("div",{className:"space-y-2 mb-4",children:e.jsxs("div",{className:"border border-black p-2",children:[e.jsx("h3",{className:"text-xs font-bold text-black mb-1",children:"📝 INSTRUCCIONES"}),e.jsxs("div",{className:"text-xs text-black space-y-1",children:[e.jsx("p",{children:"• Presentar DNI original"}),e.jsx("p",{children:"• Seguir preparación específica"}),e.jsx("p",{children:"• Resultados según tiempo indicado"})]})]})}),e.jsx("div",{className:"border-t border-black pt-3 mt-4",children:e.jsxs("div",{className:"flex justify-between items-end text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-16 border border-dashed border-gray-400 flex items-center justify-center mb-1",children:e.jsxs("span",{className:"text-xs text-gray-500 text-center leading-tight",children:["SELLO",e.jsx("br",{}),"LAB"]})}),e.jsx("p",{className:"text-xs text-black font-bold",children:"PROCESADO"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xs text-gray-600",children:["Emitido: ",w(new Date)]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Válido 15 días"})]}),e.jsxs("div",{className:"text-center",children:[a?.firma&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:a.firma,alt:"Firma digital del médico",className:"mx-auto border border-gray-300 rounded bg-white p-1 firma-img-lab"})}),e.jsxs("div",{className:"border-t border-black pt-1 min-w-24",children:[e.jsxs("p",{className:"font-bold text-black text-xs",children:["Dr(a). ",a?.nombre," ",a?.apellido]}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",a?.cmp||"N/A"]}),a?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",a.rne]}),e.jsx("p",{className:"text-xs text-black",children:a?.especialidad}),!a?.firma&&e.jsx("div",{className:"mt-1 mb-2 h-8 flex items-center justify-center border border-dashed border-gray-400 text-xs text-gray-500",children:"[Firma Manual]"}),e.jsx("p",{className:"text-xs text-black font-bold",children:"FIRMA MÉDICO"})]})]})]})})]})},Ts=({paciente:s,medicamentos:r,medicoInfo:a,configuracionClinica:d})=>{const x=()=>window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?`${window.location.protocol}//${window.location.host}/2demayo.svg`:"/2demayo.svg",w=p=>p?new Date(p).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",y=p=>p?new Date(p).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"";return e.jsxs("div",{className:"bg-white max-w-2xl mx-auto print:shadow-none print:max-w-none",style:{minHeight:"210mm",maxWidth:"148mm",padding:"10mm",fontFamily:"Arial, sans-serif",fontSize:"12px"},children:[e.jsxs("div",{className:"border-2 border-black p-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-black pb-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:x(),alt:"Logo Clínica 2 de Mayo",className:"h-10 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-bold text-black uppercase leading-tight",children:d?.nombre_clinica||"CLÍNICA 2 DE MAYO"}),e.jsx("p",{className:"text-xs text-black",children:d?.direccion||"Dirección de la clínica"}),e.jsxs("p",{className:"text-xs text-black",children:["Tel: ",d?.telefono||"123-456-789"]}),d?.ruc&&e.jsxs("p",{className:"text-xs text-black",children:["RUC: ",d.ruc]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("h2",{className:"text-sm font-bold text-black leading-tight",children:["Dr(a). ",a?.nombre," ",a?.apellido]}),e.jsx("p",{className:"text-xs text-black",children:a?.especialidad}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",a?.cmp||"N/A"]}),a?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",a.rne]})]})]}),e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-black border-b border-black pb-1",children:"💊 RECETA MÉDICA"}),e.jsxs("div",{className:"flex justify-between text-xs text-black mt-1",children:[e.jsxs("span",{children:["Fecha: ",w(new Date)]}),e.jsxs("span",{children:["Hora: ",y(new Date)]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-3",children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"👤 DATOS DEL PACIENTE"}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 text-xs",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Paciente:"})," ",s?.nombres," ",s?.apellidos]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"DNI:"})," ",s?.dni]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Edad:"})," ",s?.edad," años"]}),e.jsxs("p",{className:"text-black",children:[e.jsx("strong",{children:"Sexo:"})," ",s?.sexo]})]})]})]}),e.jsxs("div",{className:"border border-black p-2 mb-3",style:{minHeight:"80px"},children:[e.jsx("h3",{className:"text-sm font-bold text-black mb-2 border-b border-black pb-1",children:"💊 MEDICAMENTOS PRESCRITOS"}),r&&r.length>0?e.jsx("ul",{className:"list-disc pl-5 text-xs text-black space-y-1",children:r.map((p,j)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold uppercase",children:p.nombre||"Medicamento no especificado"}),p.dosis&&e.jsxs("span",{className:"ml-2",children:[e.jsx("strong",{children:"Dosis:"})," ",p.dosis]}),p.frecuencia&&e.jsxs("span",{className:"ml-2",children:[e.jsx("strong",{children:"Frecuencia:"})," ",p.frecuencia]}),p.duracion&&e.jsxs("span",{className:"ml-2",children:[e.jsx("strong",{children:"Duración:"})," ",p.duracion]}),p.observaciones&&e.jsxs("span",{className:"ml-2 italic",children:[e.jsx("strong",{children:"Obs:"})," ",p.observaciones]})]},j))}):e.jsx("p",{className:"text-xs text-black italic text-center py-4",children:"No se han prescrito medicamentos."})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"border border-black p-2",children:[e.jsx("h3",{className:"text-xs font-bold text-black mb-1",children:"📋 INSTRUCCIONES"}),e.jsxs("div",{className:"text-xs text-black space-y-1",children:[e.jsx("p",{children:"• Tomar según indicación médica"}),e.jsx("p",{children:"• Completar tratamiento"}),e.jsx("p",{children:"• Contactar médico si efectos adversos"})]})]}),e.jsxs("div",{className:"border border-red-500 bg-red-50 p-2",children:[e.jsx("h3",{className:"text-xs font-bold text-red-800 mb-1",children:"⚠️ ADVERTENCIAS"}),e.jsx("p",{className:"text-xs text-red-800",children:"• Receta personal e intransferible • Fuera del alcance de niños"})]})]}),e.jsx("div",{className:"border-t border-black pt-3 mt-4",children:e.jsxs("div",{className:"flex justify-between items-end text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-16 border border-dashed border-gray-400 flex items-center justify-center mb-1",children:e.jsxs("span",{className:"text-xs text-gray-500 text-center leading-tight",children:["SELLO",e.jsx("br",{}),"FARMACIA"]})}),e.jsx("p",{className:"text-xs text-black font-bold",children:"DESPACHADO"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xs text-gray-600",children:["Emitido: ",w(new Date)]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Válido 30 días"})]}),e.jsxs("div",{className:"text-center",children:[a?.firma&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:a.firma,alt:"Firma digital del médico",className:"mx-auto border border-gray-300 rounded bg-white p-1 firma-img-receta"})}),e.jsxs("div",{className:"border-t border-black pt-1 min-w-24",children:[e.jsxs("p",{className:"font-bold text-black text-xs",children:["Dr(a). ",a?.nombre," ",a?.apellido]}),e.jsxs("p",{className:"text-xs text-black",children:["CMP: ",a?.cmp||"N/A"]}),a?.rne&&e.jsxs("p",{className:"text-xs text-black",children:["RNE: ",a.rne]}),e.jsx("p",{className:"text-xs text-black",children:a?.especialidad}),!a?.firma&&e.jsx("div",{className:"mt-1 mb-2 h-8 flex items-center justify-center border border-dashed border-gray-400 text-xs text-gray-500",children:"[Firma Manual]"}),e.jsx("p",{className:"text-xs text-black font-bold",children:"FIRMA MÉDICO"})]})]})]})})]})},Ds=()=>{const s=t.useRef(),r=ve.useReactToPrint({contentRef:s,documentTitle:"Historia Clínica",onBeforeGetContent:t.useCallback(()=>new Promise(a=>{setTimeout(a,100)}),[]),pageStyle:`
      @page {
        size: A4;
        margin: 10mm;
      }
      
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
        }
        
        .print\\:shadow-none {
          box-shadow: none !important;
        }
        
        .print\\:max-w-none {
          max-width: none !important;
        }
        
        .no-print {
          display: none !important;
        }
        
        /* Colores de fondo para impresión */
        .bg-blue-50, .bg-yellow-50, .bg-green-50, 
        .bg-purple-50, .bg-orange-50, .bg-teal-50, 
        .bg-red-50, .bg-indigo-50 {
          background-color: #f8f9fa !important;
          border: 1px solid #dee2e6 !important;
        }
        
        /* Asegurar que los bordes se impriman */
        .border, .border-b, .border-t-2 {
          border-color: #6c757d !important;
        }
        
        /* Mejorar legibilidad de texto */
        .text-gray-600, .text-gray-800 {
          color: #333 !important;
        }
      }
    `});return{componentRef:s,handlePrint:r}},$s=()=>{const s=t.useRef(),r=ve.useReactToPrint({contentRef:s,documentTitle:"Orden de Laboratorio",onBeforeGetContent:t.useCallback(()=>new Promise(a=>{setTimeout(a,100)}),[]),pageStyle:`
      @page {
        size: A4;
        margin: 15mm;
      }
      
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
          font-family: 'Times New Roman', serif;
        }
        
        .no-print {
          display: none !important;
        }
        
        .print\\:border-black {
          border-color: black !important;
        }
        
        .print\\:text-black {
          color: black !important;
        }
      }
    `});return{componentRef:s,handlePrint:r}},As=()=>{const s=t.useRef(),r=ve.useReactToPrint({contentRef:s,documentTitle:"Receta Médica",onBeforeGetContent:t.useCallback(()=>new Promise(a=>{setTimeout(a,100)}),[]),pageStyle:`
      @page {
        size: A4;
        margin: 15mm;
      }
      
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
          font-family: 'Times New Roman', serif;
        }
        
        .no-print {
          display: none !important;
        }
        
        .print\\:border-black {
          border-color: black !important;
        }
        
        .print\\:text-black {
          color: black !important;
        }
      }
    `});return{componentRef:s,handlePrint:r}};function Ee(){const{pacienteId:s,consultaId:r}=xe(),{componentRef:a,handlePrint:d}=Ds(),{componentRef:x,handlePrint:w}=$s(),{componentRef:y,handlePrint:p}=As(),[j,N]=t.useState(null),[v,C]=t.useState(null),[l,_]=t.useState(null),[L,c]=t.useState([]),[b,n]=t.useState([]);t.useEffect(()=>{r&&(fetch(`${O}api_resultados_laboratorio.php?consulta_id=${r}`).then(F=>F.json()).then(F=>{F.success&&F.resultados?c(F.resultados):c([])}).catch(()=>c([])),fetch(`${O}api_ordenes_laboratorio.php?consulta_id=${r}`).then(F=>F.json()).then(F=>{F.success&&Array.isArray(F.ordenes)?n(F.ordenes):n([])}).catch(F=>{console.error("Error al cargar órdenes de laboratorio:",F),n([])}))},[r]);const[o,m]=t.useState(null),[f,E]=t.useState(null),[S,i]=t.useState(!0),[h,u]=t.useState(""),[M,T]=t.useState({tiempo_enfermedad:"",forma_inicio:"",curso:"",antecedentes:"",examen_fisico:"",tratamiento:"",receta:[]}),[A,z]=t.useState(!1),[P,$]=t.useState(""),[H,g]=t.useState([]);return t.useEffect(()=>{r&&fetch(`${O}api_historia_clinica.php?consulta_id=${r}`,{credentials:"include"}).then(F=>F.json()).then(F=>{F.success&&F.datos&&(T({...F.datos,receta:Array.isArray(F.datos.receta)?F.datos.receta:[]}),Array.isArray(F.datos.diagnosticos)?g(F.datos.diagnosticos):g([]))})},[r]),t.useEffect(()=>{s&&(i(!0),fetch(`${O}api_pacientes.php?id=${s}`).then(F=>F.json()).then(F=>{F.success&&F.paciente?m(F.paciente):u(F.error||"No se encontró el paciente"),i(!1)}).catch(()=>{u("Error de conexión con el servidor"),i(!1)}))},[s]),t.useEffect(()=>{r&&fetch(`${O}api_triaje.php?consulta_id=${r}`).then(F=>F.json()).then(F=>{F.success&&F.triaje&&F.triaje.datos?E(F.triaje.datos):E(null)}).catch(()=>E(null))},[r]),t.useEffect(()=>{fetch(`${O}api_get_configuracion.php`,{credentials:"include"}).then(F=>F.json()).then(F=>{F.success&&F.data&&C(F.data)}).catch(()=>C(null))},[]),t.useEffect(()=>{const F=JSON.parse(sessionStorage.getItem("medico")||"null");F?(N(F),_(F.firma||null)):(N(null),_(null))},[]),S?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-white/50 flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"🏥 Cargando historia clínica..."})]})}):h?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-red-200 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Error"}),e.jsx("p",{className:"text-red-600",children:h})]})}):o?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 py-4 sm:py-8 px-2 sm:px-4 overflow-x-hidden",children:[e.jsxs("div",{className:"max-w-6xl mx-auto w-full",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-4 sm:p-6 lg:p-8 mb-6 border border-white/50 w-full",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 sm:w-8 sm:h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"text-center sm:text-left flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-blue-800 to-indigo-800 bg-clip-text text-transparent",children:"📋 Historia Clínica"}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:"Sistema Médico Integral - Clínica 2 de Mayo"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-green-100 to-blue-100 rounded-full flex-shrink-0",children:[e.jsx("div",{className:"w-2 h-2 sm:w-3 sm:h-3 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-700",children:"En línea"})]})]})}),j&&e.jsx("div",{className:`mb-6 p-4 rounded-2xl border ${l?"bg-green-50/80 border-green-200 backdrop-blur-sm":"bg-amber-50/80 border-amber-200 backdrop-blur-sm"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${l?"bg-green-500":"bg-amber-500"}`,children:l?e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${l?"text-green-800":"text-amber-800"}`,children:l?e.jsxs(e.Fragment,{children:["✍️ ",e.jsx("strong",{children:"Firma Digital Activa:"})," Los documentos impresos incluirán su firma digital."]}):e.jsxs(e.Fragment,{children:["⚠️ ",e.jsx("strong",{children:"Sin Firma Digital:"})," Los documentos impresos tendrán espacio para firma manual."]})}),e.jsxs("p",{className:`text-xs mt-1 ${l?"text-green-600":"text-amber-600"}`,children:["Dr(a). ",j.nombre," ",j.apellido," - CMP: ",j.cmp||"N/A"]})]})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"👤 Información del Paciente"})]}),e.jsx(Ss,{paciente:o})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"🚨 Triaje y Signos Vitales"})]}),e.jsx(_s,{triaje:f})]}),e.jsxs("form",{onSubmit:async F=>{F.preventDefault(),z(!0),$("");const U={...M,diagnosticos:H,receta:M.receta},k=await(await fetch(`${O}api_historia_clinica.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:r,datos:U}),credentials:"include"})).json();z(!1),$(k.success?"Guardado correctamente":k.error||"Error al guardar")},className:"space-y-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-500 to-violet-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"📝 Anamnesis y Examen Físico"})]}),e.jsx(ks,{hc:M,setHc:T})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"🔬 Laboratorio y Apoyo Diagnóstico"})]}),e.jsx(Cs,{consultaId:r,resultadosLab:L,ordenesLab:b})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"🩺 Diagnósticos CIE10"})]}),e.jsx(Es,{diagnosticos:H,setDiagnosticos:g})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-emerald-500 to-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"💊 Tratamiento y Receta Médica"})]}),e.jsx(Ms,{receta:M.receta||[],setReceta:F=>T(U=>({...U,receta:typeof F=="function"?F(U.receta):F})),tratamiento:M.tratamiento||"",setTratamiento:F=>T(U=>({...U,tratamiento:F}))})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/50",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 w-full",children:[e.jsx("button",{type:"submit",className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm whitespace-nowrap",disabled:A,children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Guardando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),e.jsx("span",{children:"💾 Guardar HC"})]})}),e.jsxs("button",{type:"button",onClick:()=>{a.current?d():console.warn("Referencia de impresión no disponible")},className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg text-sm whitespace-nowrap",title:l?"Imprimir HC con firma digital":"Imprimir HC (sin firma digital)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),e.jsx("span",{children:"🖨️ HC"}),l&&e.jsx("span",{className:"text-xs bg-white/20 px-1 rounded",children:"✍️"})]}),e.jsxs("button",{type:"button",onClick:()=>{x.current&&b&&b.length>0?w():console.warn("Referencia de laboratorio no disponible o sin órdenes de laboratorio")},className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg text-sm whitespace-nowrap",disabled:!b||b.length===0,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),e.jsx("span",{children:"🔬 Lab"})]}),e.jsxs("button",{type:"button",onClick:()=>{y.current&&M.receta&&M.receta.length>0?p():console.warn("Referencia de receta no disponible o sin medicamentos")},className:"inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg text-sm whitespace-nowrap",disabled:!M.receta||M.receta.length===0,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),e.jsx("span",{children:"💊 Receta"})]})]}),e.jsxs("div",{className:"text-center w-full mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"✍️ Firma Digital"})]}),l?e.jsxs("div",{className:"flex flex-col items-center gap-3 max-w-xs mx-auto",children:[e.jsx("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-3 shadow-sm",children:e.jsx("img",{src:l,alt:"Firma del médico",className:"max-h-16 max-w-[200px] object-contain"})}),e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2 w-full",children:[e.jsxs("div",{className:"text-xs text-gray-600 font-medium",children:[j?.nombre," ",j?.apellido]}),j?.especialidad&&e.jsx("div",{className:"text-xs text-gray-500",children:j.especialidad}),e.jsxs("div",{className:"text-xs text-gray-500",children:["C.M.P. ",j?.cmp||"N/A",j?.rne&&` - R.N.E ${j.rne}`]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Sistema Médico Digitalizado"})]})]}):e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2 max-w-xs mx-auto",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"FIRMA Y SELLO MÉDICO"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Sistema Médico Digitalizado"}),e.jsx("div",{className:"text-xs text-orange-500 mt-2 italic",children:"⚠️ No hay firma registrada"})]})]})]}),P&&e.jsx("div",{className:`mt-4 p-4 rounded-xl border text-center font-medium ${P.includes("correctamente")?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[P.includes("correctamente")?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),P]})})]})]})]}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px"},children:e.jsx("div",{ref:a,children:e.jsx(Ps,{paciente:o,triaje:f,hc:M,diagnosticos:H,medicamentos:M.receta,ordenesLaboratorio:b,medicoInfo:j,configuracionClinica:v})})}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px"},children:e.jsx("div",{ref:x,children:e.jsx(Fs,{paciente:o,ordenesLaboratorio:b,medicoInfo:j,configuracionClinica:v})})}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px"},children:e.jsx("div",{ref:y,children:e.jsx(Ts,{paciente:o,medicamentos:M.receta,medicoInfo:j,configuracionClinica:v})})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-gray-200 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Paciente no encontrado"}),e.jsx("p",{className:"text-gray-600",children:"No se encontró información del paciente."})]})})}function zs({medicoId:s}){const[r,a]=t.useState([]),[d,x]=t.useState(!0),[w,y]=t.useState(""),[p,j]=t.useState(""),[N,v]=t.useState(3),[C,l]=t.useState(1),_=ie();t.useEffect(()=>{x(!0),fetch(`${O}api_historial_consultas_medico.php?medico_id=${s}`,{credentials:"include"}).then(f=>f.json()).then(f=>{f.success?a(f.historial):y(f.error||"Error al cargar historial"),x(!1)}).catch(()=>{y("Error de conexión"),x(!1)})},[s]);const L=r.filter(f=>f.paciente_nombre.toLowerCase().includes(p.toLowerCase())||f.motivo.toLowerCase().includes(p.toLowerCase())||f.diagnostico.toLowerCase().includes(p.toLowerCase())),c=L.length,b=Math.ceil(c/N),n=(C-1)*N,o=n+N,m=L.slice(n,o);return t.useEffect(()=>{l(1)},[p,N]),e.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Historial de Consultas"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",className:"border rounded p-2 w-full",placeholder:"Buscar por paciente, motivo o diagnóstico",value:p,onChange:f=>j(f.target.value)}),e.jsx("label",{className:"text-xs",children:"Filas por página:"}),e.jsxs("select",{value:N,onChange:f=>v(Number(f.target.value)),className:"border rounded p-1 text-xs",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]}),d?e.jsx("div",{children:"Cargando..."}):w?e.jsx("div",{className:"text-red-600",children:w}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full text-sm border rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1",children:"Fecha"}),e.jsx("th",{className:"px-2 py-1",children:"Paciente"}),e.jsx("th",{className:"px-2 py-1 hidden sm:table-cell",children:"Motivo"}),e.jsx("th",{className:"px-2 py-1 hidden md:table-cell",children:"Diagnóstico"}),e.jsx("th",{className:"px-2 py-1 hidden md:table-cell",children:"Estado"}),e.jsx("th",{className:"px-2 py-1",children:"Detalle"})]})}),e.jsx("tbody",{children:L.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-2",children:"Sin resultados"})}):m.map(f=>e.jsxs("tr",{className:"hover:bg-blue-50",children:[e.jsx("td",{className:"border px-2 py-1",children:f.fecha}),e.jsx("td",{className:"border px-2 py-1",children:f.paciente_nombre}),e.jsx("td",{className:"border px-2 py-1 hidden sm:table-cell",children:f.motivo}),e.jsx("td",{className:"border px-2 py-1 hidden md:table-cell",children:f.diagnostico}),e.jsx("td",{className:"border px-2 py-1 hidden md:table-cell",children:f.estado}),e.jsx("td",{className:"border px-2 py-1 text-center",children:e.jsx("button",{className:"text-blue-600 underline",onClick:()=>_(`/historia-clinica/${f.paciente_id}/${f.consulta_id}`),children:"Ver"})})]},f.id))})]}),c>0&&e.jsxs("div",{className:"flex justify-end items-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>l(C-1),disabled:C===1,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{className:"text-sm",children:["Página ",C," de ",b]}),e.jsx("button",{onClick:()=>l(C+1),disabled:C===b,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Siguiente"})]})]})]})}function Bs({consulta:s,initialData:r,onGuardar:a,onCancelar:d}){const[x,w]=t.useState({presion_arterial:"",frecuencia_cardiaca:"",frecuencia_respiratoria:"",temperatura:"",saturacion:"",peso:"",talla:"",motivo:"",sintomas:"",nivel_conciencia:"Alerta",hidratacion:"Normal",coloracion:"Normal",clasificacion:"No urgente"});t.useEffect(()=>{r&&w({presion_arterial:r.presion_arterial||"",frecuencia_cardiaca:r.frecuencia_cardiaca||"",frecuencia_respiratoria:r.frecuencia_respiratoria||"",temperatura:r.temperatura||"",saturacion:r.saturacion||"",peso:r.peso||"",talla:r.talla||"",motivo:r.motivo||"",sintomas:r.sintomas||"",nivel_conciencia:r.nivel_conciencia||"Alerta",hidratacion:r.hidratacion||"Normal",coloracion:r.coloracion||"Normal",clasificacion:r.clasificacion||"No urgente"})},[r]);const[y,p]=t.useState(!1),j=v=>{w({...x,[v.target.name]:v.target.value})},N=v=>{v.preventDefault(),p(!0);const C={...x,clasificacion:x.clasificacion&&x.clasificacion.trim()?x.clasificacion:"No urgente"};a(C),p(!1)};return e.jsxs("form",{onSubmit:N,className:"space-y-3 p-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{name:"presion_arterial",value:x.presion_arterial,onChange:j,placeholder:"Presión arterial (mmHg)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"frecuencia_cardiaca",value:x.frecuencia_cardiaca,onChange:j,placeholder:"Frecuencia cardíaca (lpm)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"frecuencia_respiratoria",value:x.frecuencia_respiratoria,onChange:j,placeholder:"Frecuencia respiratoria (rpm)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"temperatura",value:x.temperatura,onChange:j,placeholder:"Temperatura (°C)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"saturacion",value:x.saturacion,onChange:j,placeholder:"Saturación O₂ (%)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"peso",value:x.peso,onChange:j,placeholder:"Peso (kg)",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"talla",value:x.talla,onChange:j,placeholder:"Talla (cm)",className:"border rounded px-2 py-1"})]}),e.jsx("textarea",{name:"motivo",value:x.motivo,onChange:j,placeholder:"Motivo de consulta",className:"border rounded px-2 py-1 w-full"}),e.jsx("textarea",{name:"sintomas",value:x.sintomas,onChange:j,placeholder:"Síntomas principales",className:"border rounded px-2 py-1 w-full"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("select",{name:"nivel_conciencia",value:x.nivel_conciencia,onChange:j,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"Alerta",children:"Alerta"}),e.jsx("option",{value:"Somnoliento",children:"Somnoliento"}),e.jsx("option",{value:"Inconsciente",children:"Inconsciente"})]}),e.jsxs("select",{name:"hidratacion",value:x.hidratacion,onChange:j,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"Normal",children:"Hidratación normal"}),e.jsx("option",{value:"Deshidratado",children:"Deshidratado"})]}),e.jsxs("select",{name:"coloracion",value:x.coloracion,onChange:j,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"Normal",children:"Coloración normal"}),e.jsx("option",{value:"Cianosis",children:"Cianosis"}),e.jsx("option",{value:"Palidez",children:"Palidez"}),e.jsx("option",{value:"Ictericia",children:"Ictericia"})]})]}),e.jsxs("select",{name:"clasificacion",value:x.clasificacion,onChange:j,className:"border rounded px-2 py-1 w-full",children:[e.jsx("option",{value:"No urgente",children:"No urgente"}),e.jsx("option",{value:"Urgente",children:"Urgente"}),e.jsx("option",{value:"Emergencia",children:"Emergencia"})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-2",children:[e.jsx("button",{type:"button",onClick:d,className:"bg-gray-300 px-3 py-1 rounded",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-3 py-1 rounded",disabled:y,children:"Guardar triaje"})]})]})}function Os(){const[s,r]=t.useState([]),[a,d]=t.useState({}),[x,w]=t.useState(!0),[y,p]=t.useState(null),[j,N]=t.useState(null),[v,C]=t.useState(null),[l,_]=t.useState(!1),[L,c]=t.useState(!1),[b,n]=t.useState(5),[o,m]=t.useState(1),[f,E]=t.useState(""),[S,i]=t.useState(""),[h,u]=t.useState(""),M=()=>{w(!0),fetch(O+"api_consultas.php",{credentials:"include"}).then(g=>g.json()).then(async g=>{if(g.success){r(g.consultas);const F={};await Promise.all(g.consultas.map(async U=>{try{const k=await(await fetch(O+`api_triaje.php?consulta_id=${U.id}`)).json();F[U.id]=k.success&&k.triaje?"Completado":"Pendiente"}catch{F[U.id]="Pendiente"}})),d(F)}else p(g.error||"Error al cargar consultas");w(!1)}).catch(g=>{p("Error de red"),w(!1)})};if(t.useEffect(()=>{M()},[]),x)return e.jsx(ye,{message:"Cargando pacientes en triaje..."});if(y)return e.jsx("div",{className:"text-red-600",children:y});let T=s.filter(g=>{const F=f.trim().toLowerCase();return F&&!(g.historia_clinica&&g.historia_clinica.toLowerCase().includes(F)||g.paciente_nombre&&g.paciente_nombre.toLowerCase().includes(F)||g.paciente_apellido&&g.paciente_apellido.toLowerCase().includes(F)||g.medico_nombre&&g.medico_nombre.toLowerCase().includes(F))?!1:!S&&!h?!0:!(!g.fecha||S&&g.fecha<S||h&&g.fecha>h)});const A=T.length,z=Math.ceil(A/b),P=(o-1)*b,$=P+b,H=T.slice(P,$);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-600 rounded-2xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl",children:e.jsx(V,{iconName:"People",className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:A}),e.jsx("div",{className:"text-sm text-emerald-100",children:"Total Pacientes"})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-yellow-500 to-orange-600 rounded-2xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl",children:e.jsx(V,{iconName:"Clock",className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.values(a).filter(g=>g==="Pendiente").length}),e.jsx("div",{className:"text-sm text-yellow-100",children:"Triajes Pendientes"})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl",children:e.jsx(V,{iconName:"CheckMark",className:"text-2xl"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.values(a).filter(g=>g==="Completado").length}),e.jsx("div",{className:"text-sm text-blue-100",children:"Triajes Completados"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(V,{iconName:"Filter",className:"text-xl text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Filtros de búsqueda"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(V,{iconName:"Search",className:"text-lg text-gray-400"})}),e.jsx("input",{type:"text",value:f,onChange:g=>{E(g.target.value),m(1)},placeholder:"Buscar paciente, médico...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(V,{iconName:"Calendar",className:"text-lg text-gray-400"})}),e.jsx("input",{type:"date",value:S,onChange:g=>{i(g.target.value),m(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300",placeholder:"Fecha desde"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(V,{iconName:"Calendar",className:"text-lg text-gray-400"})}),e.jsx("input",{type:"date",value:h,onChange:g=>{u(g.target.value),m(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300",placeholder:"Fecha hasta"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(V,{iconName:"NumberedList",className:"text-lg text-gray-400"})}),e.jsxs("select",{value:b,onChange:g=>{n(Number(g.target.value)),m(1)},className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-300 appearance-none bg-white",children:[e.jsx("option",{value:5,children:"5 por página"}),e.jsx("option",{value:10,children:"10 por página"}),e.jsx("option",{value:25,children:"25 por página"})]})]})]}),(f||S||h)&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:()=>{E(""),i(""),u(""),m(1)},className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors duration-300",children:[e.jsx(V,{iconName:"Clear",className:"text-lg"}),e.jsx("span",{children:"Limpiar filtros"})]})})]}),j?e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(V,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold",children:["Triaje: ",j.paciente_nombre," ",j.paciente_apellido]}),e.jsxs("p",{className:"text-emerald-100",children:["Historia Clínica: ",j.historia_clinica||"N/A"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-white/20 rounded-xl px-3 py-2",children:[e.jsx(V,{iconName:"Calendar",className:"text-lg"}),e.jsxs("span",{children:[j.fecha," - ",j.hora]})]})]})}),e.jsx("div",{className:"p-6",children:L?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-emerald-200 border-t-emerald-500 rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Cargando datos de triaje..."})]})}):e.jsx(Bs,{consulta:j,initialData:v,onGuardar:async g=>{_(!0);const F={consulta_id:j.id,datos:{...g,paciente_id:j.paciente_id}};try{const Y=await(await fetch(O+"api_triaje.php",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(F)})).json();Y.success||(console.error("Error al guardar triaje:",Y.error),alert("Error al guardar triaje: "+(Y.error||"Error desconocido")))}catch(U){console.error("Error de red al guardar triaje:",U),alert("Error de red al guardar triaje")}_(!1),N(null),C(null),M()},onCancelar:()=>{N(null),C(null)},guardando:l})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{iconName:"Table",className:"text-xl text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Lista de Pacientes para Triaje"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:T.length>0?`Mostrando ${H.length} de ${T.length} pacientes`:"No hay pacientes"})]})}),e.jsx("div",{className:"overflow-x-auto",children:T.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex items-center justify-center w-20 h-20 bg-gray-100 rounded-full mx-auto mb-4",children:e.jsx(V,{iconName:"Health",className:"text-4xl text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No hay pacientes"}),e.jsx("p",{className:"text-gray-500",children:"No se encontraron pacientes pendientes de triaje"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Historia Clínica"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Paciente"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Médico"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Fecha y Hora"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Estado"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Acción"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:H.map(g=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-200",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{iconName:"NumberField",className:"text-lg text-gray-400"}),e.jsx("span",{className:"font-mono text-sm",children:g.historia_clinica||"-"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-emerald-100 rounded-full",children:e.jsx(V,{iconName:"Contact",className:"text-lg text-emerald-600"})}),e.jsx("div",{children:e.jsxs("div",{className:"font-semibold text-gray-800",children:[g.paciente_nombre," ",g.paciente_apellido]})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{iconName:"Health",className:"text-lg text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:g.medico_nombre||"-"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{iconName:"Calendar",className:"text-lg text-gray-400"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-800",children:g.fecha}),e.jsx("div",{className:"text-gray-500",children:g.hora})]})]})}),e.jsx("td",{className:"px-6 py-4",children:a[g.id]==="Completado"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:[e.jsx(V,{iconName:"CheckMark",className:"text-sm"}),"Completado"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(V,{iconName:"Clock",className:"text-sm"}),"Pendiente"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-emerald-500 to-green-600 text-white font-semibold rounded-xl hover:from-emerald-600 hover:to-green-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",onClick:async()=>{N(g),c(!0),C(null);try{const U=await(await fetch(O+`api_triaje.php?consulta_id=${g.id}`)).json();U.success&&U.triaje&&U.triaje.datos?C(U.triaje.datos):C(null)}catch{C(null)}c(!1)},children:[e.jsx(V,{iconName:"Health",className:"text-lg"}),"Realizar Triaje"]})})]},g.id))})]})}),e.jsx("div",{className:"lg:hidden p-4 space-y-4",children:H.map(g=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 shadow-sm hover:shadow-md transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-emerald-100 rounded-full",children:e.jsx(V,{iconName:"Contact",className:"text-xl text-emerald-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-800 text-lg",children:[g.paciente_nombre," ",g.paciente_apellido]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(V,{iconName:"NumberField",className:"text-sm"}),"HC: ",g.historia_clinica||"N/A"]})]})]}),a[g.id]==="Completado"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(V,{iconName:"CheckMark",className:"text-xs"}),"Completado"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(V,{iconName:"Clock",className:"text-xs"}),"Pendiente"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{iconName:"Health",className:"text-lg text-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Médico"}),e.jsx("div",{className:"text-sm text-gray-800",children:g.medico_nombre||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{iconName:"Calendar",className:"text-lg text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Fecha y Hora"}),e.jsxs("div",{className:"text-sm text-gray-800",children:[g.fecha," - ",g.hora]})]})]})]}),e.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-emerald-500 to-green-600 text-white font-semibold rounded-xl hover:from-emerald-600 hover:to-green-700 transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl",onClick:async()=>{N(g),c(!0),C(null);try{const U=await(await fetch(O+`api_triaje.php?consulta_id=${g.id}`)).json();U.success&&U.triaje&&U.triaje.datos?C(U.triaje.datos):C(null)}catch{C(null)}c(!1)},children:[e.jsx(V,{iconName:"Health",className:"text-xl"}),"Realizar Triaje"]})]},g.id))})]})})]}),T.length>0&&z>1&&e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",P+1," - ",Math.min($,A)," de ",A," pacientes"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>m(o-1),disabled:o===1,className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 text-gray-700 rounded-xl transition-all duration-300 disabled:cursor-not-allowed",children:[e.jsx(V,{iconName:"ChevronLeft",className:"text-lg"}),e.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"px-3 py-2 text-sm font-medium text-gray-600",children:["Página ",o," de ",z]})}),e.jsxs("button",{onClick:()=>m(o+1),disabled:o===z,className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 text-gray-700 rounded-xl transition-all duration-300 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx(V,{iconName:"ChevronRight",className:"text-lg"})]})]})]})})]})]})}function Rs(){const[s,r]=t.useState("triage"),a=[{key:"triage",label:"Triaje",icon:"Health",color:"emerald",description:"Evaluación inicial de pacientes"},{key:"tratamientos",label:"Tratamientos",icon:"Health",color:"blue",description:"Gestión de tratamientos"},{key:"hospitalizacion",label:"Hospitalización",icon:"Hospital",color:"purple",description:"Control de hospitalización"}],d=(x,w)=>({emerald:w?"bg-gradient-to-r from-emerald-500 to-green-600 text-white shadow-lg border-emerald-300":"bg-white text-emerald-700 border-emerald-200 hover:bg-emerald-50 hover:border-emerald-300",blue:w?"bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg border-blue-300":"bg-white text-blue-700 border-blue-200 hover:bg-blue-50 hover:border-blue-300",purple:w?"bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg border-purple-300":"bg-white text-purple-700 border-purple-200 hover:bg-purple-50 hover:border-purple-300"})[x];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 via-cyan-50 to-blue-50 p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-gradient-to-r from-teal-600 via-cyan-600 to-blue-600 rounded-2xl p-6 sm:p-8 text-white shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-12 -translate-x-12"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-white/20 rounded-2xl backdrop-blur-sm",children:e.jsx(V,{iconName:"Health",className:"text-3xl text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold drop-shadow-lg",children:"Panel de Enfermería"}),e.jsx("p",{className:"text-lg text-white/90 mt-1",children:"Gestión integral de cuidados médicos"})]})]})})]})}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto",children:a.map(x=>e.jsxs("button",{className:`group relative p-6 rounded-2xl border-2 font-semibold transition-all duration-300 transform hover:scale-[1.02] ${d(x.color,s===x.key)}`,onClick:()=>r(x.key),children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:`flex items-center justify-center w-12 h-12 rounded-xl ${s===x.key?"bg-white/20":`bg-${x.color}-100`}`,children:e.jsx(V,{iconName:x.icon,className:`text-2xl ${s===x.key?"text-white":`text-${x.color}-600`}`})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:x.label}),e.jsx("div",{className:`text-sm ${s===x.key?"text-white/80":"text-gray-600"}`,children:x.description})]})]}),s===x.key&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-white rounded-full shadow-lg flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"})})]},x.key))})}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[s==="triage"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(V,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Control de Triaje"}),e.jsx("p",{className:"text-emerald-100",children:"Evaluación y clasificación de pacientes"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx(Os,{})})]}),s==="tratamientos"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(V,{iconName:"Health",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gestión de Tratamientos"}),e.jsx("p",{className:"text-blue-100",children:"Control y seguimiento de tratamientos"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full mx-auto mb-4",children:e.jsx(V,{iconName:"Health",className:"text-4xl text-blue-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Módulo en Desarrollo"}),e.jsx("p",{className:"text-gray-600",children:"La gestión de tratamientos estará disponible próximamente"})]})})]}),s==="hospitalizacion"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(V,{iconName:"Hospital",className:"text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Control de Hospitalización"}),e.jsx("p",{className:"text-purple-100",children:"Gestión de pacientes hospitalizados"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex items-center justify-center w-20 h-20 bg-purple-100 rounded-full mx-auto mb-4",children:e.jsx(V,{iconName:"Hospital",className:"text-4xl text-purple-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Módulo en Desarrollo"}),e.jsx("p",{className:"text-gray-600",children:"El control de hospitalización estará disponible próximamente"})]})})]})]})]})}function Hs(){return e.jsx(Rs,{})}be.createElement;function Is({selected:s,setSelected:r}){const[a,d]=t.useState([]),[x,w]=t.useState(""),[y,p]=t.useState(!1);t.useEffect(()=>{p(!0),fetch(O+"api_examenes_laboratorio.php",{credentials:"include"}).then(v=>v.json()).then(v=>d(v.examenes||[])).finally(()=>p(!1))},[]);const j=a.filter(v=>v.nombre.toLowerCase().includes(x.toLowerCase())||v.metodologia&&v.metodologia.toLowerCase().includes(x.toLowerCase())),N=v=>{r(C=>C.includes(v)?C.filter(l=>l!==v):[...C,v])};return e.jsxs("div",{className:"mb-2",children:[e.jsx("input",{type:"text",value:x,onChange:v=>w(v.target.value),placeholder:"Buscar examen...",className:"border rounded p-2 text-xs w-full mb-2"}),e.jsx("div",{className:"max-h-48 overflow-y-auto border rounded bg-white",children:y?e.jsx("div",{className:"p-2 text-center text-gray-500 text-xs",children:"Cargando..."}):j.length===0?e.jsx("div",{className:"p-2 text-center text-gray-500 text-xs",children:"Sin exámenes"}):j.map(v=>e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 border-b last:border-b-0 cursor-pointer hover:bg-blue-50 text-xs",children:[e.jsx("input",{type:"checkbox",checked:s.includes(v.id),onChange:()=>N(v.id)}),e.jsx("span",{className:"font-medium",children:v.nombre}),e.jsx("span",{className:"text-gray-400",children:v.metodologia})]},v.id))})]})}function Vs({consultaId:s,mostrarPrecios:r=!0}){const[a,d]=t.useState([]),[x,w]=t.useState([]),[y,p]=t.useState(!1),[j,N]=t.useState("");t.useEffect(()=>{fetch(O+"api_examenes_laboratorio.php",{credentials:"include"}).then(_=>_.json()).then(_=>w(_.examenes||[]))},[]);const v=x.filter(_=>a.includes(_.id)),C=v.reduce((_,L)=>_+(parseFloat(L.precio_publico)||0),0),l=async _=>{_.preventDefault(),p(!0),N("");try{if((await fetch(O+"api_ordenes_laboratorio.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:s,examenes:a})})).ok)N("Orden enviada correctamente"),d([]),setTimeout(()=>N(""),3e3);else throw new Error("Error al enviar la orden")}catch{N("Error al enviar la orden. Intente nuevamente."),setTimeout(()=>N(""),5e3)}finally{p(!1)}};return t.useEffect(()=>{fetch(O+"api_examenes_laboratorio.php",{credentials:"include"}).then(_=>_.json()).then(_=>w(_.examenes||[]))},[]),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 border border-emerald-200 rounded-xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx("svg",{className:"w-7 h-7 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-emerald-800",children:"🔬 Solicitud de Análisis de Laboratorio"}),e.jsx("p",{className:"text-sm text-emerald-600",children:"Seleccione los exámenes requeridos para el diagnóstico"})]})]}),e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-emerald-100 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),e.jsx("label",{className:"font-semibold text-emerald-800",children:"Exámenes Disponibles:"})]}),e.jsx(Is,{selected:a,setSelected:d})]}),a.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"font-semibold text-blue-800",children:["📋 Exámenes Seleccionados (",a.length,")"]})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-3",children:v.map(_=>e.jsx("div",{className:"bg-white rounded-lg p-3 border border-blue-100 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:_.nombre}),r&&e.jsxs("div",{className:"text-sm text-green-700 font-semibold mt-1",children:["Precio público: S/ ",parseFloat(_.precio_publico).toFixed(2)]}),(_.condicion_paciente||_.tiempo_resultado)&&e.jsxs("div",{className:"mt-1 space-y-1",children:[_.condicion_paciente&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3 text-amber-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-xs text-amber-700 font-medium",children:_.condicion_paciente})]}),_.tiempo_resultado&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-xs text-gray-600",children:["⏱️ ",_.tiempo_resultado]})]})]})]})]})},_.id))}),r&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800 font-bold text-lg flex justify-end",children:["Total cotización: S/ ",C.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"submit",className:`
              px-6 py-3 rounded-lg font-semibold text-white shadow-lg transition-all duration-200
              flex items-center gap-2 min-w-[140px] justify-center
              ${a.length===0||y?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-emerald-600 to-teal-700 hover:from-emerald-700 hover:to-teal-800 hover:shadow-xl transform hover:-translate-y-0.5"}
            `,disabled:y||a.length===0,children:y?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Enviando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),e.jsx("span",{children:"Solicitar Exámenes"})]})}),e.jsx("div",{className:"text-sm text-emerald-700 font-medium",children:a.length===0?e.jsx("span",{className:"text-gray-500",children:"Ningún examen seleccionado"}):e.jsxs("span",{children:["✅ ",a.length," examen",a.length!==1?"es":""," seleccionado",a.length!==1?"s":""]})})]}),j&&e.jsxs("div",{className:`
            rounded-lg p-4 border shadow-sm flex items-center gap-3
            ${j.includes("correctamente")?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}
          `,children:[j.includes("correctamente")?e.jsx("svg",{className:"w-6 h-6 text-green-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-6 h-6 text-red-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"font-semibold",children:j})]})]})]})}function Ws(){const{consultaId:s}=xe();let r=!0;try{const a=sessionStorage.getItem("usuario"),d=sessionStorage.getItem("medico"),x=a?JSON.parse(a):d?JSON.parse(d):null;x&&x.rol==="medico"&&(r=!1)}catch{r=!0}return e.jsxs("div",{className:"max-w-xl mx-auto p-6 bg-white rounded shadow mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Solicitud de Análisis de Laboratorio"}),e.jsxs("div",{className:"mb-4 text-center text-gray-600",children:[e.jsx("b",{children:"Consulta ID:"})," ",s]}),e.jsx(Vs,{consultaId:s,mostrarPrecios:r}),e.jsx("div",{className:"text-center",children:e.jsx(ae,{to:-1,className:"text-blue-600 hover:underline",children:"← Volver a la historia clínica"})})]})}function qs(){const[s,r]=t.useState(!1),[a,d]=t.useState([]),[x,w]=t.useState(0),y=ie(),{pacienteId:p}=xe(),[j,N]=t.useState([]),[v,C]=t.useState([]),[l,_]=t.useState([]),[L,c]=t.useState([]),[b,n]=t.useState(!0),[o,m]=t.useState(""),[f,E]=t.useState(""),[S,i]=t.useState(""),[h,u]=t.useState(0),[M,T]=t.useState(3),[A,z]=t.useState(null),[P,$]=t.useState(null);t.useEffect(()=>{Promise.all([fetch(`${O}api_examenes_laboratorio.php`,{credentials:"include"}).then(R=>R.json()),fetch(`${O}api_tarifas.php`,{credentials:"include"}).then(R=>R.json()),fetch(`${O}api_examenes_laboratorio_ranking.php`,{credentials:"include"}).then(R=>R.json()),p?fetch(`${O}api_pacientes.php?id=${p}`,{credentials:"include"}).then(R=>R.json()):Promise.resolve({success:!1})]).then(([R,G,D,I])=>{N(R.examenes||[]),c(G.tarifas||[]),C(D.ranking||[]),I&&I.success&&I.paciente&&$(I.paciente),n(!1)})},[p]);const H=R=>{_(G=>G.includes(R)?G.filter(D=>D!==R):[...G,R]),E("")},g=()=>l.reduce((R,G)=>{const D=L.find(I=>I.servicio_tipo==="laboratorio"&&I.examen_id===G&&I.activo===1);return R+(D?parseFloat(D.precio_particular):0)},0);if(b)return e.jsx("div",{children:"Cargando exámenes y tarifas..."});const F=Array.from(new Set(j.map(R=>R.categoria).filter(Boolean))),U=v.map(R=>parseInt(R.id)),k=[...j].sort((R,G)=>{const D=U.indexOf(R.id),I=U.indexOf(G.id);return D===-1&&I===-1?R.nombre.localeCompare(G.nombre):D===-1?1:I===-1?-1:D-I}).filter(R=>{const G=o.trim().length===0||R.nombre.toLowerCase().includes(o.toLowerCase()),D=S===""||R.categoria===S;return G&&D}),q=Math.max(1,Math.ceil(k.length/M)),J=k.slice(h*M,h*M+M),ee=()=>{_([]),E("")},B=()=>{if(l.length===0){E("Selecciona al menos un examen para cobrar.");return}const R=l.map(G=>{const D=j.find(te=>te.id===G),I=L.find(te=>te.servicio_tipo==="laboratorio"&&te.examen_id===G&&te.activo===1);let X=D&&typeof D.nombre=="string"&&D.nombre.trim()!==""&&D.nombre!=="0"?D.nombre:"Examen sin nombre";return{servicio_tipo:"laboratorio",servicio_id:G,descripcion:X,cantidad:1,precio_unitario:I?parseFloat(I.precio_particular):0,subtotal:I?parseFloat(I.precio_particular):0}});d(R),w(R.reduce((G,D)=>G+D.subtotal,0)),r(!0)};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 md:p-8 bg-white rounded-xl shadow-lg mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"🔬"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Cotización de Laboratorio"})]}),e.jsx("button",{onClick:()=>y("/seleccionar-servicio",{state:{pacienteId:p}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"})]}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{className:"text-gray-600",children:[e.jsx("b",{children:"ID Paciente:"})," ",p]}),e.jsx("input",{type:"text",value:o,onChange:R=>m(R.target.value),placeholder:"Buscar examen...",className:"border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-64"})]}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-2 items-center",children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"Filtrar por categoría:"}),e.jsxs("select",{value:S,onChange:R=>i(R.target.value),className:"border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-64",children:[e.jsx("option",{value:"",children:"Todas"}),F.map(R=>e.jsx("option",{value:R,children:R},R))]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Selecciona los exámenes:"}),e.jsx("div",{className:"mb-2 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:e.jsxs("div",{className:"w-full bg-white shadow-md rounded-xl border border-gray-200 px-4 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"text-sm text-gray-700 flex gap-4 items-center",children:[e.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1",children:["Total exámenes: ",e.jsx("b",{children:k.length})]}),e.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1",children:["Páginas: ",e.jsx("b",{children:q})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("button",{disabled:h===0||q===1,onClick:()=>u(R=>Math.max(0,R-1)),className:"px-2 py-1 rounded-full bg-blue-100 text-blue-700 disabled:opacity-50 hover:bg-blue-200 transition-colors shadow-sm",title:"Página anterior",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("span",{className:"px-3 py-1 text-sm font-medium bg-gray-50 rounded",children:["Página ",h+1," de ",q||1]}),e.jsx("button",{disabled:h>=q-1||q===1,onClick:()=>u(R=>Math.min(q-1,R+1)),className:"px-2 py-1 rounded-full bg-blue-100 text-blue-700 disabled:opacity-50 hover:bg-blue-200 transition-colors shadow-sm",title:"Página siguiente",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsxs("select",{value:M,onChange:R=>{T(Number(R.target.value)),u(0)},className:"border border-gray-300 rounded-lg px-2 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 ml-2",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"})]})]})]})}),k.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No hay exámenes para mostrar."}):e.jsx("div",{className:"bg-white rounded-lg shadow border border-gray-200",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:J.map(R=>{const G=L.find(D=>D.servicio_tipo==="laboratorio"&&D.examen_id===R.id&&D.activo===1);return e.jsxs("li",{className:"flex items-center px-4 py-3 hover:bg-blue-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:l.includes(R.id),onChange:()=>H(R.id),className:"mr-3 accent-blue-600 w-5 h-5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:R.nombre}),R.categoria&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded mt-1 inline-block",children:R.categoria})]}),e.jsxs("div",{className:"font-bold text-green-700 text-lg",children:["S/ ",G?G.precio_particular:"-"]})]},R.id)})})})]})}),e.jsxs("div",{className:"w-full md:w-96 md:sticky md:top-8 h-fit",children:[l.length>0&&!s&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotización"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:l.map(R=>{const G=j.find(I=>I.id===R),D=L.find(I=>I.servicio_tipo==="laboratorio"&&I.examen_id===R&&I.activo===1);return e.jsxs("li",{className:"py-2 flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:G?.nombre}),G?.condicion_paciente&&e.jsxs("span",{className:"block text-xs text-gray-400 mt-1",children:["Condición: ",G.condicion_paciente]}),G?.tiempo_resultado&&e.jsxs("span",{className:"block text-xs text-gray-400",children:["Tiempo: ",G.tiempo_resultado]})]}),e.jsxs("div",{className:"font-bold text-green-700 text-right",children:["S/ ",D?D.precio_particular:"-"]})]},R)})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",g().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:ee,className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:B,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Cobrar"})]})]}),s&&P&&e.jsx(he,{paciente:P,servicio:{key:"laboratorio",label:"Laboratorio"},detalles:a,total:x,onCobroCompleto:()=>{r(!1),E("Cotización procesada correctamente.")},onCancelar:()=>r(!1)})]})]}),f&&e.jsx("div",{className:`mt-6 text-center font-semibold ${f.includes("correctamente")?"text-green-600":"text-red-600"}`,children:f}),A&&e.jsxs("div",{className:"mt-8 mx-auto max-w-lg bg-white rounded-xl shadow-lg border border-blue-200 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-700 mb-2",children:"Comprobante de Cotización"}),e.jsxs("div",{className:"mb-2 text-blue-800 font-semibold",children:["Nº comprobante: ",A.numero]}),e.jsxs("div",{className:"mb-2 text-gray-600 text-sm",children:["Fecha: ",A.fecha]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-4",children:A.detalles.map((R,G)=>e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-800",children:R.descripcion}),e.jsxs("span",{className:"text-green-700 font-bold",children:["S/ ",R.precio_unitario.toFixed(2)]})]},G))}),e.jsxs("div",{className:"text-right text-lg font-bold text-blue-700 border-t pt-2",children:["Total: S/ ",A.total.toFixed(2)]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Imprimir"}),e.jsx("button",{onClick:()=>z(null),className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Cerrar"})]})]})]})}function Us(){const[s,r]=t.useState(!1),[a,d]=t.useState([]),[x,w]=t.useState(0),{pacienteId:y}=xe(),p=ie(),[j,N]=t.useState(null),[v,C]=t.useState([]),[l,_]=t.useState([]),[L,c]=t.useState({}),[b,n]=t.useState("");t.useEffect(()=>{fetch(`${O}api_pacientes.php?id=${y}`).then(i=>i.json()).then(i=>{i.success&&i.paciente&&N(i.paciente)}),fetch(`${O}api_tarifas.php`,{credentials:"include"}).then(i=>i.json()).then(i=>{const h=(i.tarifas||[]).filter(u=>u.servicio_tipo==="rayosx");C(h)})},[y]);const o=i=>{_(h=>h.includes(i)?h:[...h,i]),c(h=>({...h,[i]:1}))},m=i=>{_(h=>h.filter(u=>u!==i)),c(h=>{const u={...h};return delete u[i],u})},f=(i,h)=>{c(u=>({...u,[i]:h}))},E=()=>l.reduce((i,h)=>{const u=v.find(T=>T.id===h),M=L[h]||1;return u?i+u.precio_particular*M:i},0),S=async()=>{if(l.length===0){n("Selecciona al menos un estudio de Rayos X.");return}const i=l.map(h=>{const u=v.find(T=>T.id===h),M=L[h]||1;return u?{servicio_tipo:"rayosx",servicio_id:h,descripcion:u.descripcion||u.nombre,cantidad:M,precio_unitario:u.precio_particular,subtotal:u.precio_particular*M}:null}).filter(Boolean);d(i),w(E()),r(!0)};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-2xl shadow-2xl mt-8 border border-blue-100",children:[e.jsx("button",{onClick:()=>p("/seleccionar-servicio",{state:{pacienteId:y}}),className:"mb-4 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded text-gray-700 font-semibold",children:"← Volver"}),e.jsxs("h2",{className:"text-2xl font-bold text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"rayosx",children:"🩻"})," Cotizador de Rayos X"]}),j&&e.jsxs("div",{className:"mb-4 p-2 bg-blue-50 rounded text-blue-800 text-sm",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",j.nombres||j.nombre," ",j.apellidos||j.apellido," (DNI: ",j.dni,")"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"mb-4 max-h-[500px] overflow-y-auto",children:[e.jsx("div",{className:"font-bold mb-2",children:"Estudios disponibles:"}),v.length===0?e.jsx("div",{className:"text-gray-500",children:"No hay estudios de Rayos X registrados."}):e.jsx("ul",{className:"divide-y divide-gray-100",children:v.map(i=>e.jsxs("li",{className:"flex items-center gap-4 py-3 px-2 hover:bg-blue-50 rounded-lg transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:i.descripcion||i.nombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Precio: S/ ",i.precio_particular]})]}),l.includes(i.id)?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:1,value:L[i.id]||1,onChange:h=>f(i.id,Math.max(1,Number(h.target.value))),className:"border rounded-lg px-2 w-16 bg-white"}),e.jsx("button",{onClick:()=>m(i.id),className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-xl shadow transition","aria-label":"Quitar",children:"✕"})]}):e.jsx("button",{onClick:()=>o(i.id),className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-100 hover:bg-green-200 text-green-700 text-xl shadow transition","aria-label":"Agregar",children:"+"})]},i.id))})]}),e.jsxs("div",{className:"w-full md:w-96 md:sticky md:top-8 h-fit",children:[l.length>0&&!s&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"font-semibold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"📝"}),"Resumen de Cotización"]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-2 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:l.map(i=>{const h=v.find(M=>M.id===i),u=L[i]||1;return h?e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{children:h.descripcion||h.nombre}),e.jsxs("span",{children:[u," estudio(s)"]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",(h.precio_particular*u).toFixed(2)]})]},i):null})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",E().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>{_([]),n("")},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:S,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Registrar Cotización"})]})]}),s&&e.jsx(he,{paciente:j,servicio:{key:"rayosx",label:"Rayos X"},detalles:a,total:x,onCobroCompleto:()=>{r(!1),_([]),c({}),n("Cobro procesado correctamente.")},onCancelar:()=>r(!1)})]})]}),b&&e.jsx("div",{className:"mt-4 text-center font-semibold text-green-600",children:b})]})}function Gs(){const[s,r]=t.useState(!1),[a,d]=t.useState([]),[x,w]=t.useState(0),{pacienteId:y}=xe(),p=ie(),[j,N]=t.useState(null),[v,C]=t.useState([]),[l,_]=t.useState([]),[L,c]=t.useState({}),[b,n]=t.useState("");t.useEffect(()=>{fetch(`${O}api_pacientes.php?id=${y}`).then(i=>i.json()).then(i=>{i.success&&i.paciente&&N(i.paciente)}),fetch(`${O}api_tarifas.php`,{credentials:"include"}).then(i=>i.json()).then(i=>{const h=(i.tarifas||[]).filter(u=>u.servicio_tipo==="ecografia");C(h)})},[y]);const o=i=>{_(h=>h.includes(i)?h:[...h,i]),c(h=>({...h,[i]:1}))},m=i=>{_(h=>h.filter(u=>u!==i)),c(h=>{const u={...h};return delete u[i],u})},f=(i,h)=>{c(u=>({...u,[i]:h}))},E=()=>l.reduce((i,h)=>{const u=v.find(T=>T.id===h),M=L[h]||1;return u?i+u.precio_particular*M:i},0),S=async()=>{if(l.length===0){n("Selecciona al menos una ecografía.");return}const i=l.map(h=>{const u=v.find(z=>z.id===h),M=L[h]||1;let A=u&&u.descripcion&&u.descripcion!=="0"?u.descripcion:u&&u.nombre&&u.nombre!=="0"?u.nombre:"Ecografía sin nombre";return u?{servicio_tipo:"ecografia",servicio_id:h,descripcion:A,cantidad:M,precio_unitario:u.precio_particular,subtotal:u.precio_particular*M}:null}).filter(Boolean);d(i),w(E()),r(!0)};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-2xl shadow-2xl mt-8 border border-blue-100",children:[e.jsx("button",{onClick:()=>p("/seleccionar-servicio",{state:{pacienteId:y}}),className:"mb-4 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded text-gray-700 font-semibold",children:"← Volver"}),e.jsxs("h2",{className:"text-2xl font-bold text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"eco",children:"📡"})," Cotizador de Ecografías"]}),j&&e.jsxs("div",{className:"mb-4 p-2 bg-blue-50 rounded text-blue-800 text-sm",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",j.nombres||j.nombre," ",j.apellidos||j.apellido," (DNI: ",j.dni,")"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"mb-4 max-h-[500px] overflow-y-auto",children:[e.jsx("div",{className:"font-bold mb-2",children:"Ecografías disponibles:"}),v.length===0?e.jsx("div",{className:"text-gray-500",children:"No hay ecografías registradas."}):e.jsx("ul",{className:"divide-y divide-gray-100",children:v.map(i=>e.jsxs("li",{className:"flex items-center gap-4 py-3 px-2 hover:bg-blue-50 rounded-lg transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:i.descripcion||i.nombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Precio: S/ ",i.precio_particular]})]}),l.includes(i.id)?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:1,value:L[i.id]||1,onChange:h=>f(i.id,Math.max(1,Number(h.target.value))),className:"border rounded-lg px-2 w-16 bg-white"}),e.jsx("button",{onClick:()=>m(i.id),className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-xl shadow transition","aria-label":"Quitar",children:"✕"})]}):e.jsx("button",{onClick:()=>o(i.id),className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-100 hover:bg-green-200 text-green-700 text-xl shadow transition","aria-label":"Agregar",children:"+"})]},i.id))})]}),l.length>0&&!s&&e.jsxs("div",{className:"bg-blue-50 rounded-2xl p-6 border border-blue-200 shadow mb-4 max-h-[500px] overflow-y-auto",children:[e.jsxs("h4",{className:"font-semibold text-blue-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"📝"}),"Resumen de Cotización"]}),e.jsx("ul",{className:"divide-y divide-gray-100 mb-2",children:l.map(i=>{const h=v.find(M=>M.id===i),u=L[i]||1;return h?e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{children:h.descripcion||h.nombre}),e.jsxs("span",{children:[u," estudio(s)"]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",(h.precio_particular*u).toFixed(2)]})]},i):null})}),e.jsxs("div",{className:"text-right text-xl font-bold text-blue-800 flex items-center gap-2",children:["Total: ",e.jsx("span",{children:"💲"})," S/ ",E().toFixed(2)]}),e.jsxs("button",{onClick:S,className:"mt-6 bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 flex items-center gap-2 text-lg",children:[e.jsx("span",{children:"🛒"}),"Registrar Cotización"]})]}),s&&j&&e.jsx(he,{paciente:j,servicio:{key:"ecografia",label:"Ecografía"},detalles:a,total:x,onCobroCompleto:()=>{r(!1),n("Cotización procesada correctamente.")},onCancelar:()=>r(!1)})]}),b&&e.jsx("div",{className:"mt-4 text-center font-semibold text-green-600",children:b})]})}function Js({onSeleccionarOrden:s}){const[r,a]=t.useState("table"),[d,x]=t.useState(10),[w,y]=t.useState(0),[p,j]=t.useState([]),[N,v]=t.useState(!0),[C,l]=t.useState(""),[_,L]=t.useState([]),[c,b]=t.useState(""),[n,o]=t.useState(""),[m,f]=t.useState(""),[E,S]=t.useState("");if(t.useEffect(()=>{v(!0),fetch(O+"api_ordenes_laboratorio.php",{credentials:"include"}).then(P=>P.json()).then(P=>{P.success?j(P.ordenes):l(P.error||"Error al cargar órdenes"),v(!1)}).catch(P=>{l("Error de conexión con el servidor"),v(!1),console.error("Error al cargar órdenes:",P)}),fetch(O+"api_examenes_laboratorio.php",{credentials:"include"}).then(P=>P.json()).then(P=>{L(P.examenes||[])})},[]),N||_.length===0)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"flex items-center gap-3 text-purple-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),e.jsx("span",{children:"Cargando órdenes de laboratorio..."})]})});if(C)return e.jsx("div",{className:"p-4 text-red-600 bg-red-50 rounded-lg border border-red-200",children:C});const h=(P=>P.filter($=>{if((c||n)&&$.fecha){const H=new Date($.fecha),g=c?new Date(c):null,F=n?new Date(n):null;if(g&&H<g||F&&H>new Date(F+"T23:59:59"))return!1}if(m.trim()!==""){const H=m.toLowerCase(),g=($.paciente_nombre+" "+$.paciente_apellido).toLowerCase(),F=($.medico_nombre||"").toLowerCase();if(!g.includes(H)&&!F.includes(H))return!1}return!(E&&$.estado!==E)}))(p),u={total:p.length,pendientes:p.filter(P=>P.estado==="pendiente").length,completadas:p.filter(P=>P.estado==="completado").length,hoy:p.filter(P=>{if(!P.fecha)return!1;const $=new Date(P.fecha).toDateString(),H=new Date().toDateString();return $===H}).length},M=Math.ceil(h.length/d),T=h.slice(w*d,(w+1)*d),A=P=>Array.isArray(P)?P.map($=>{const H=_.find(g=>g.id==$);return H?H.nombre:$}).join(", "):"",z=P=>P?new Date(P).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"N/A";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm",children:"Total Órdenes"}),e.jsx("p",{className:"text-2xl font-bold",children:u.total})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"📋"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-100 text-sm",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold",children:u.pendientes})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"⏳"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-green-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-emerald-100 text-sm",children:"Completadas"}),e.jsx("p",{className:"text-2xl font-bold",children:u.completadas})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"✅"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm",children:"Hoy"}),e.jsx("p",{className:"text-2xl font-bold",children:u.hoy})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-xl",children:"📅"})]})})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Desde"}),e.jsx("input",{type:"date",value:c,onChange:P=>{b(P.target.value),y(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hasta"}),e.jsx("input",{type:"date",value:n,onChange:P=>{o(P.target.value),y(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar"}),e.jsx("input",{type:"text",value:m,onChange:P=>{f(P.target.value),y(0)},placeholder:"Paciente o médico...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsxs("select",{value:E,onChange:P=>{S(P.target.value),y(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"completado",children:"Completado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Por página"}),e.jsxs("select",{value:d,onChange:P=>{x(Number(P.target.value)),y(0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vista:"}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>a("table"),className:`px-3 py-1 rounded-md text-sm transition-colors ${r==="table"?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"📊 Tabla"}),e.jsx("button",{onClick:()=>a("cards"),className:`px-3 py-1 rounded-md text-sm transition-colors ${r==="cards"?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"🗃️ Tarjetas"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",T.length," de ",h.length," órdenes"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{disabled:w===0,onClick:()=>y(P=>Math.max(0,P-1)),className:"px-3 py-1 rounded-lg bg-gray-100 disabled:opacity-50 hover:bg-gray-200 transition-colors",children:"←"}),e.jsxs("span",{className:"px-3 py-1 text-sm",children:[w+1," / ",M||1]}),e.jsx("button",{disabled:w>=M-1,onClick:()=>y(P=>Math.min(M-1,P+1)),className:"px-3 py-1 rounded-lg bg-gray-100 disabled:opacity-50 hover:bg-gray-200 transition-colors",children:"→"})]})]})]}),h.length===0?e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No se encontraron órdenes con los filtros aplicados"})]}):e.jsxs(e.Fragment,{children:[r==="table"&&e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Paciente"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Tipo de Cotización"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden md:table-cell",children:"Médico"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden lg:table-cell",children:"Consulta"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium hidden lg:table-cell",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Acciones"})]})}),e.jsx("tbody",{children:T.map(P=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-purple-50/50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:["#",P.id]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"font-medium",children:[P.paciente_nombre," ",P.paciente_apellido]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:P.consulta_id?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 border border-blue-200",children:"Médico"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-pink-100 text-pink-800 border border-pink-200",children:"Particular"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden md:table-cell",children:P.medico_nombre}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden lg:table-cell",children:P.consulta_id}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 hidden lg:table-cell",children:z(P.fecha)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${P.estado==="completado"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,children:P.estado==="completado"?"✅ Completado":"⏳ Pendiente"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>s(P),className:"inline-flex items-center px-3 py-1.5 bg-gradient-to-r from-purple-500 to-indigo-500 text-white text-xs font-medium rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-all transform hover:scale-105 shadow-md",title:P.estado==="completado"?"Editar resultado":"Llenar resultados",children:P.estado==="completado"?"✏️ Editar":"📝 Procesar"})})})]},P.id))})]})})}),r==="cards"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(P=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6 hover:shadow-xl transition-all transform hover:scale-105",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"🧪"}),e.jsxs("span",{className:"font-bold text-gray-900",children:["#",P.id]})]}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${P.estado==="completado"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,children:P.estado==="completado"?"✅":"⏳"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Paciente"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[P.paciente_nombre," ",P.paciente_apellido]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Médico"}),e.jsx("p",{className:"text-sm text-gray-700",children:P.medico_nombre||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Consulta"}),e.jsx("p",{className:"text-sm text-gray-700",children:P.consulta_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Fecha"}),e.jsx("p",{className:"text-sm text-gray-700",children:z(P.fecha)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Exámenes"}),e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:A(P.examenes)})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>s(P),className:"flex-1 bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-2.5 px-4 rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-all font-medium text-sm shadow-md hover:shadow-lg transform hover:scale-105",children:P.estado==="completado"?"✏️ Editar Resultado":"📝 Procesar Orden"})})})]},P.id))})]})]})}function Xs({orden:s,onVolver:r,onGuardado:a}){const[d,x]=t.useState([]),[w,y]=t.useState({}),[p,j]=t.useState(!1),[N,v]=t.useState(""),[C,l]=t.useState("success");t.useEffect(()=>{fetch(O+"api_examenes_laboratorio.php",{credentials:"include"}).then(n=>n.json()).then(n=>x(n.examenes||[]))},[]),t.useEffect(()=>{if(!(!d||d.length===0))if(s.resultados&&typeof s.resultados=="object")y({...s.resultados});else{const n={};let o=[];if(typeof s.examenes=="string")try{o=JSON.parse(s.examenes)}catch{o=s.examenes.split(",").map(m=>m.trim()).filter(m=>m)}else Array.isArray(s.examenes)?o=s.examenes:s.examenes&&(o=[s.examenes]);o.forEach(m=>{const f=typeof m=="object"?m.id:m,E=d.find(S=>S.id==f);E&&Array.isArray(E.valores_referenciales)&&E.valores_referenciales.length>0?E.valores_referenciales.forEach(S=>{(S.tipo===void 0||S.tipo==="Parámetro")&&S.nombre&&S.nombre.trim()!==""&&(n[`${f}__${S.nombre}`]="")}):n[`${f}`]=""}),y(n)}},[s,d]);function _(n,o){if(!n)return"";let m=n;Object.keys(o).sort((E,S)=>S.length-E.length).forEach(E=>{const S=o[E]||0,i=new RegExp(E.replace(/[.*+?^${}()|[\]\\]/g,"$&"),"g");m=m.replace(i,S===""?0:S)});try{const E=Ae(m);return typeof E=="number"&&!isNaN(E)?E.toFixed(1):E}catch{return""}}const L=n=>{const o={...w,[n.target.name]:n.target.value};y(o)},c=async n=>{n.preventDefault(),j(!0),v("");try{const o={...w};let m=[];if(typeof s.examenes=="string")try{m=JSON.parse(s.examenes)}catch{m=s.examenes.split(",").map(i=>i.trim()).filter(i=>i)}else Array.isArray(s.examenes)?m=s.examenes:s.examenes&&(m=[s.examenes]);m.forEach(i=>{const h=typeof i=="object"?i.id:i,u=d.find(T=>T.id==h);if(!u||!Array.isArray(u.valores_referenciales))return;const M={};u.valores_referenciales.forEach(T=>{(T.tipo===void 0||T.tipo==="Parámetro")&&T.nombre&&T.nombre.trim()!==""&&(M[T.nombre]=o[`${h}__${T.nombre}`]||"")}),u.valores_referenciales.forEach(T=>{if((T.tipo===void 0||T.tipo==="Parámetro")&&T.nombre&&T.nombre.trim()!==""&&T.formula&&T.formula.trim()!==""){const A=_(T.formula,M);M[T.nombre]=A??"",o[`${h}__${T.nombre}`]=A??""}})});const f=s.consulta_id?s.consulta_id:s.id,S=await(await fetch(O+"api_resultados_laboratorio.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consulta_id:f,tipo_examen:"varios",resultados:o})})).json();S.success?(v("✅ Resultados guardados correctamente"),l("success"),setTimeout(()=>{a&&a()},1e3)):(v("❌ "+(S.error||"Error al guardar")),l("error"))}catch{v("❌ Error de conexión"),l("error")}finally{j(!1)}},b=(n,o)=>{let m=!1,f=null,E=null;!isNaN(parseFloat(n.min))&&n.min!==null&&n.min!==""?f=parseFloat(n.min):n.referencias&&n.referencias[0]&&!isNaN(parseFloat(n.referencias[0].valor_min))&&(f=parseFloat(n.referencias[0].valor_min)),!isNaN(parseFloat(n.max))&&n.max!==null&&n.max!==""?E=parseFloat(n.max):n.referencias&&n.referencias[0]&&!isNaN(parseFloat(n.referencias[0].valor_max))&&(E=parseFloat(n.referencias[0].valor_max));let S=parseFloat(o);return isNaN(S)||(f!==null&&S<f&&(m=!0),E!==null&&S>E&&(m=!0)),{fueraDeRango:m,min:f,max:E}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-2xl",children:"📊"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Procesar Resultados de Laboratorio"}),e.jsx("p",{className:"text-purple-100",children:"Complete los valores para cada examen solicitado"})]})]})}),e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-6",children:e.jsx("div",{className:"max-h-[600px] overflow-y-auto space-y-6",children:(()=>{let n=[];if(typeof s.examenes=="string")try{n=JSON.parse(s.examenes)}catch{n=s.examenes.split(",").map(o=>o.trim()).filter(o=>o)}else Array.isArray(s.examenes)?n=s.examenes:s.examenes&&(n=[s.examenes]);return n.map(o=>{const m=typeof o=="object"?o.id:o,f=d.find(E=>E.id==m);if(f&&Array.isArray(f.valores_referenciales)&&f.valores_referenciales.length>0){const E={};return f.valores_referenciales.forEach(S=>{(S.tipo===void 0||S.tipo==="Parámetro")&&S.nombre&&S.nombre.trim()!==""&&(E[S.nombre]=w[`${m}__${S.nombre}`]||"")}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-4 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"🧪"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:f.nombre}),e.jsx("p",{className:"text-sm text-gray-600",children:"Complete todos los parámetros requeridos"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:f.valores_referenciales.map(S=>{if((S.tipo===void 0||S.tipo==="Parámetro")&&S.nombre&&S.nombre.trim()!==""){const i=S.formula&&S.formula.trim()!=="";let h=w[`${m}__${S.nombre}`]||"";i&&(h=_(S.formula,E)),typeof h=="number"&&isNaN(h)&&(h=""),h==null&&(h="");const{fueraDeRango:u,min:M,max:T}=b(S,h);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{children:S.nombre}),i&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"🧮 Calculado"})]}),i&&e.jsxs("span",{className:"text-xs text-blue-600 font-normal",children:["Fórmula: ",S.formula]}),(M!==null||T!==null)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Rango de referencia: ",M!==null?`${M}`:"∞"," - ",T!==null?`${T}`:"∞"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:`${m}__${S.nombre}`,value:h,onChange:i?void 0:L,readOnly:i,required:!0,className:`w-full px-4 py-3 border-2 rounded-lg transition-all duration-200 ${u?"border-red-400 bg-red-50 text-red-700 font-semibold focus:ring-2 focus:ring-red-500":i?"border-blue-200 bg-blue-50 text-blue-800 cursor-not-allowed":"border-gray-300 bg-white hover:border-purple-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:i?"Valor calculado automáticamente":"Ingrese el valor"}),h&&!i&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:u?e.jsx("span",{className:"text-red-500 font-bold",children:"⚠️"}):e.jsx("span",{className:"text-green-500 font-bold",children:"✓"})})]}),u&&(M!==null||T!==null)&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-600 font-medium bg-red-50 px-2 py-1 rounded-md",children:[e.jsx("span",{children:"⚠️"}),e.jsx("span",{children:"Valor fuera del rango de referencia"})]})]},S.nombre)}return null})})]},m)}else if(f)return e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600",children:"🧪"}),e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:f.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Resultado del examen"}),e.jsx("textarea",{name:`${m}`,value:w[`${m}`]||"",onChange:L,rows:4,required:!0,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200",placeholder:"Ingrese el resultado completo del examen..."})]})]},m);return null})})()})}),"        ",e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e.jsx("button",{type:"button",onClick:r,className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium border border-gray-300",children:"← Cancelar"}),e.jsx("button",{type:"submit",disabled:p,className:"px-8 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:p?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Guardando..."]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"💾"}),"Guardar Resultados"]})})]}),N&&e.jsx("div",{className:`p-4 rounded-lg border ${C==="success"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:e.jsx("div",{className:"flex items-center gap-2 font-medium",children:N})})]})]})}function Ks(){const[s,r]=t.useState("ordenes"),[a,d]=t.useState(null),[x,w]=t.useState(0),[y,p]=t.useState([]);t.useEffect(()=>{fetch(O+"api_examenes_laboratorio.php",{credentials:"include"}).then(l=>l.json()).then(l=>p(l.examenes||[]))},[]);const j=async l=>{if(l.estado==="completado"){const _=l.consulta_id?l.consulta_id:l.id,c=await(await fetch(O+`api_get_resultados_laboratorio.php?orden_id=${_}`)).json();if(c.success&&c.resultado){d({...l,resultados:c.resultado.resultados}),r("procesar");return}}d(l),r("procesar")},N=()=>{d(null),w(l=>l+1),r("ordenes")},v=l=>{if(!l)return"";let _;if(typeof l=="string")try{_=JSON.parse(l)}catch{_=l.split(",").map(L=>L.trim()).filter(L=>L)}else if(Array.isArray(l))_=l;else return l.toString();return Array.isArray(_)?_.map(L=>{if(typeof L=="object"&&L.nombre)return L.nombre;const c=y.find(b=>b.id==L);return c?c.nombre:L}).join(", "):""},C=[{id:"ordenes",label:"Órdenes de Laboratorio",icon:"🧪",color:"from-purple-600 to-indigo-600"},{id:"procesar",label:"Procesar Resultados",icon:"📊",color:"from-blue-600 to-cyan-600",disabled:!a}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-indigo-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 text-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-2xl",children:"🔬"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Panel de Laboratorio"}),e.jsx("p",{className:"text-purple-100",children:"Gestión de órdenes y resultados de laboratorio"})]})]}),e.jsx("div",{className:"flex gap-1 bg-white/10 backdrop-blur-sm rounded-lg p-1",children:C.map(l=>e.jsxs("button",{onClick:()=>!l.disabled&&r(l.id),disabled:l.disabled,className:`flex items-center gap-2 px-4 py-2 rounded-md transition-all duration-200 text-sm font-medium ${s===l.id?"bg-white text-purple-600 shadow-lg":l.disabled?"text-purple-200 cursor-not-allowed opacity-50":"text-white hover:bg-white/20"}`,children:[e.jsx("span",{className:"text-lg",children:l.icon}),e.jsx("span",{className:"hidden sm:inline",children:l.label})]},l.id))})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[s==="ordenes"&&e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl shadow-xl border border-white/20",children:e.jsx(Js,{onSeleccionarOrden:j},x)}),s==="procesar"&&a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-sm rounded-lg shadow-md hover:bg-white transition-colors border border-white/20 text-gray-700 hover:text-gray-900",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Volver a órdenes"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Orden"}),e.jsxs("div",{className:"text-xl font-bold",children:["#",a.id]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Paciente"}),e.jsxs("div",{className:"text-xl font-bold",children:[a.paciente_nombre," ",a.paciente_apellido]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Consulta ID"}),e.jsx("div",{className:"text-xl font-bold",children:a.consulta_id})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm",children:"Estado"}),e.jsx("div",{className:`text-xl font-bold ${a.estado==="completado"?"text-green-300":"text-yellow-300"}`,children:a.estado==="completado"?"Completado":"Pendiente"})]})]}),e.jsxs("div",{className:"mt-4 bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("div",{className:"text-purple-200 text-sm mb-2",children:"Exámenes solicitados"}),e.jsx("div",{className:"text-lg",children:v(a.examenes)})]})]}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl shadow-xl border border-white/20 p-6",children:e.jsx(Xs,{orden:a,onVolver:N,onGuardado:N})})]})]})]})}function Ys(){const{consultaId:s}=xe(),[r,a]=t.useState([]),[d,x]=t.useState([]),[w,y]=t.useState(!0),[p,j]=t.useState("");t.useEffect(()=>{y(!0),Promise.all([fetch(`${O}api_resultados_laboratorio.php?consulta_id=${s}`).then(c=>c.json()),fetch(`${O}api_examenes_laboratorio.php`,{credentials:"include"}).then(c=>c.json())]).then(([c,b])=>{c.success?a(c.resultados||[]):j(c.error||"No hay resultados"),x(b.examenes||[]),y(!1)}).catch(()=>{j("Error al cargar resultados"),y(!1)})},[s]);const N={},v={},C={};for(const c of d)N[c.id]=c.nombre,v[c.id]=c.unidad||"",C[c.id]=Array.isArray(c.valores_referenciales)?c.valores_referenciales:[];function l(c,b=null){if(!Array.isArray(c)||c.length===0)return null;if(b){const n=c.find(o=>o.nombre===b);if(n)return n}return c.find(n=>!n.desc||n.desc.toLowerCase()==="general")||c[0]}function _(c){let b=null,n=null;if(!c)return{min:b,max:n};if(Array.isArray(c.referencias)&&c.referencias.length>0){const o=c.referencias[0];isNaN(parseFloat(o.valor_min))||(b=parseFloat(o.valor_min)),isNaN(parseFloat(o.valor_max))||(n=parseFloat(o.valor_max))}return b===null&&!isNaN(parseFloat(c.valor_min))&&c.valor_min!==null&&c.valor_min!==""?b=parseFloat(c.valor_min):b===null&&c.min!==void 0&&!isNaN(parseFloat(c.min))&&(b=parseFloat(c.min)),n===null&&!isNaN(parseFloat(c.valor_max))&&c.valor_max!==null&&c.valor_max!==""?n=parseFloat(c.valor_max):n===null&&c.max!==void 0&&!isNaN(parseFloat(c.max))&&(n=parseFloat(c.max)),{min:b,max:n}}function L(c,b){if(!b||c==null||c==="")return!1;const{min:n,max:o}=_(b),m=parseFloat(c);return isNaN(m)?!1:n!==null&&m<n||o!==null&&m>o}return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-white rounded-xl shadow-xl mt-6",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("h2",{className:"text-3xl font-bold text-green-800",children:"📋 Resultados de Laboratorio"})]}),e.jsx("p",{className:"text-green-600",children:"Reporte completo de los análisis médicos"})]}),e.jsxs(ae,{to:-1,className:"mb-6 inline-flex items-center gap-2 px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg font-medium transition-colors duration-200 hover:scale-105",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"⬅️ Volver"]}),w?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando resultados..."})]}):p?e.jsx("div",{className:"p-6 text-red-600 bg-red-50 border border-red-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),p]})}):r.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("p",{className:"text-gray-500 text-lg",children:"No hay resultados registrados para esta consulta."})]}):e.jsx("div",{className:"space-y-6",children:r.map((c,b)=>e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-green-200",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-4 8v4m-4-4h8m-8-4h8a2 2 0 002-2V7a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})}),e.jsxs("span",{className:"text-sm font-bold text-green-800",children:["📅 Fecha del Análisis: ",new Date(c.fecha).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),c.resultados&&typeof c.resultados=="object"?e.jsx("div",{children:(()=>{const n={};return Object.entries(c.resultados).forEach(([o,m])=>{let f=o,E=null;o.includes("__")&&([f,E]=o.split("__")),n[f]||(n[f]=[]),n[f].push({nombreParam:E,val:m,ex:o})}),Object.entries(n).map(([o,m])=>{const f=N[o]||o;return e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-semibold text-base mb-1",children:f}),e.jsx("ul",{className:"list-disc ml-5",children:m.map(({nombreParam:E,val:S,ex:i})=>{const h=C[o]||[],u=l(h,E),M=v[o]?` ${v[o]}`:"",{min:T,max:A}=_(u),z=u&&L(S,u);return e.jsxs("li",{children:[e.jsxs("b",{children:[E||f,":"]})," ",e.jsxs("span",{className:z?"text-red-600 font-bold":"",children:[S,M]}),(T!==null||A!==null)&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["[",T!==null?`min: ${T}`:"",T!==null&&A!==null?", ":"",A!==null?`max: ${A}`:"","]"]}),z&&(T!==null||A!==null)&&e.jsx("span",{className:"text-xs text-red-600 ml-1 font-semibold",children:"Fuera de rango"})]},i)})})]},o)})})()}):e.jsx("div",{children:JSON.stringify(c.resultados)})]},b))})]})}function Qs(){return e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Reportes"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ae,{to:"/lista-consultas",className:"bg-blue-600 text-white rounded-lg p-6 text-center font-semibold shadow hover:bg-blue-700 transition-all",children:"Lista de Consultas"}),e.jsx(ae,{to:"/reporte-pacientes",className:"bg-green-600 text-white rounded-lg p-6 text-center font-semibold shadow hover:bg-green-700 transition-all",children:"Reporte de Pacientes"}),e.jsx(ae,{to:"/reporte-finanzas",className:"bg-purple-600 text-white rounded-lg p-6 text-center font-semibold shadow hover:bg-purple-700 transition-all",children:"Reporte de Finanzas"})]})]})}function Zs(){const[s,r]=t.useState([]),[a,d]=t.useState(3),[x,w]=t.useState(1),[y,p]=t.useState(!0),[j,N]=t.useState(""),[v,C]=t.useState(""),[l,_]=t.useState(""),[L,c]=t.useState("");t.useEffect(()=>{fetch(O+"api_consultas.php").then(i=>i.json()).then(i=>{i.success?r(i.consultas):N(i.error||"Error al cargar consultas"),p(!1)}).catch(()=>{N("Error de conexión con el servidor"),p(!1)})},[]);const n=(i=>{let h=i;if((v||l)&&(h=h.filter(u=>{if(!u.fecha)return!1;const M=u.fecha.slice(0,10);return!(v&&M<v||l&&M>l)})),L.trim()!==""){const u=L.trim().toLowerCase();h=h.filter(M=>M.paciente_nombre&&M.paciente_nombre.toLowerCase().includes(u)||M.paciente_apellido&&M.paciente_apellido.toLowerCase().includes(u)||M.medico_nombre&&M.medico_nombre.toLowerCase().includes(u)||M.motivo&&M.motivo.toLowerCase().includes(u)||M.estado&&M.estado.toLowerCase().includes(u)||M.id&&M.id.toString().includes(u))}return h})(s),o=n.length,m=Math.max(1,Math.ceil(o/a)),f=n.slice((x-1)*a,x*a),E=()=>{const i=de.json_to_sheet(n.map(z=>({ID:z.id,Fecha:z.fecha?.slice(0,16).replace("T"," "),Paciente:z.paciente_nombre+" "+z.paciente_apellido,Medico:z.medico_nombre,Motivo:z.motivo,Estado:z.estado}))),h=de.book_new();de.book_append_sheet(h,i,"Consultas");const u=Pe(h,{bookType:"xlsx",type:"array"}),M=new Blob([u],{type:"application/octet-stream"}),T=new Date().toISOString().slice(0,10),A=document.createElement("a");A.href=URL.createObjectURL(M),A.download=`consultas_${T}.xlsx`,document.body.appendChild(A),A.click(),document.body.removeChild(A)},S=()=>{const i=new je;i.text("Lista de Consultas",14,10),Ne(i,{head:[["ID","Fecha","Paciente","Médico","Motivo","Estado"]],body:n.map(u=>[u.id,u.fecha?.slice(0,16).replace("T"," "),u.paciente_nombre+" "+u.paciente_apellido,u.medico_nombre,u.motivo,u.estado]),startY:18,styles:{fontSize:9},headStyles:{fillColor:[59,130,246]}});const h=new Date().toISOString().slice(0,10);i.save(`consultas_${h}.pdf`)};return e.jsxs("div",{className:"max-w-5xl mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Lista de Consultas"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[e.jsx("label",{className:"text-sm",children:"Filas por página:"}),e.jsxs("select",{value:a,onChange:i=>{d(Number(i.target.value)),w(1)},className:"border rounded px-2 py-1",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]}),e.jsx("input",{type:"text",value:L,onChange:i=>c(i.target.value),placeholder:"Buscar por paciente, médico, motivo, estado o ID...",className:"border rounded px-2 py-1 min-w-[180px]"}),e.jsx("label",{className:"text-sm",children:"Desde:"}),e.jsx("input",{type:"date",value:v,onChange:i=>C(i.target.value),className:"border rounded px-2 py-1"}),e.jsx("label",{className:"text-sm",children:"Hasta:"}),e.jsx("input",{type:"date",value:l,onChange:i=>_(i.target.value),className:"border rounded px-2 py-1"}),(v||l||L)&&e.jsx("button",{onClick:()=>{C(""),_(""),c("")},className:"text-blue-600 underline ml-2",children:"Limpiar filtro"}),e.jsx("button",{onClick:E,className:"bg-green-600 text-white px-3 py-1 rounded font-semibold text-xs hover:bg-green-700 transition-all",children:"Exportar Excel"}),e.jsx("button",{onClick:S,className:"bg-red-600 text-white px-3 py-1 rounded font-semibold text-xs hover:bg-red-700 transition-all",children:"Exportar PDF"})]}),y?e.jsx("div",{className:"text-center",children:"Cargando..."}):j?e.jsx("div",{className:"text-center text-red-600",children:j}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full text-xs md:text-sm border bg-white rounded shadow",children:[e.jsx("thead",{className:"bg-blue-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 w-12 text-center",children:"ID"}),e.jsx("th",{className:"p-2",children:"Fecha"}),e.jsx("th",{className:"p-2",children:"Paciente"}),e.jsx("th",{className:"p-2",children:"Médico"}),e.jsx("th",{className:"p-2",children:"Motivo"}),e.jsx("th",{className:"p-2",children:"Estado"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-4",children:"No hay consultas registradas"})}):f.map(i=>e.jsxs("tr",{className:"border-b hover:bg-blue-50",children:[e.jsx("td",{className:"p-2 w-12 text-center",children:i.id}),e.jsx("td",{className:"p-2",children:i.fecha?.slice(0,16).replace("T"," ")}),e.jsxs("td",{className:"p-2",children:[i.paciente_nombre," ",i.paciente_apellido]}),e.jsx("td",{className:"p-2",children:i.medico_nombre}),e.jsx("td",{className:"p-2",children:i.motivo}),e.jsx("td",{className:"p-2",children:i.estado})]},i.id))})]}),e.jsxs("div",{className:"flex justify-end items-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>w(i=>Math.max(1,i-1)),disabled:x===1,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{className:"text-sm",children:["Página ",x," de ",m]}),e.jsx("button",{onClick:()=>w(i=>Math.min(m,i+1)),disabled:x===m,className:"px-2 py-1 rounded bg-gray-200 disabled:opacity-50",children:"Siguiente"})]})]})]})}function et(){return e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Reporte de Pacientes"}),e.jsx("div",{className:"text-gray-500 text-center",children:"(Vista en construcción)"})]})}function st(){return e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Reporte de Finanzas"}),e.jsx("div",{className:"text-gray-500 text-center",children:"(Vista en construcción)"})]})}function tt(){const[s,r]=t.useState({nombre_clinica:"",direccion:"",telefono:"",email:"",horario_atencion:"",logo_url:"",website:"",ruc:"",especialidades:"",mision:"",vision:"",valores:"",director_general:"",jefe_enfermeria:"",contacto_emergencias:""}),[a,d]=t.useState(!1),[x,w]=t.useState(!0),[y,p]=t.useState(!1),[j,N]=t.useState("");t.useEffect(()=>{v()},[]);const v=async()=>{try{w(!0);const b=await fetch(O+"api_get_configuracion.php",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(b.ok){const n=await b.json();if(n.success)r(n.data),n.data&&n.data.logo_url&&N(n.data.logo_url);else throw new Error(n.error||"Error al cargar la configuración")}else if(b.status===401){const n=await b.json();throw new Error("🔒 Acceso denegado: "+(n.error||"No está autenticado como administrador"))}else{const n=await b.text();throw console.error("❌ Error del servidor:",n),new Error(`Error del servidor: ${b.status} - ${n}`)}}catch(b){console.error("🚨 Error al cargar configuración:",b),b.message.includes("🔒 Acceso denegado")?W.fire({title:"🔒 Acceso Denegado",text:"Necesita estar autenticado como administrador para ver la configuración.",icon:"warning",confirmButtonText:"Ir a Login",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed&&(window.location.href="/")}):W.fire({title:"Error",text:"No se pudo cargar la configuración: "+b.message,icon:"error",confirmButtonText:"OK"})}finally{w(!1)}},C=(b,n)=>{r(o=>({...o,[b]:n}))},l=async()=>{if(!s.nombre_clinica||!s.direccion||!s.telefono||!s.email){W.fire({title:"Error",text:"Por favor, complete todos los campos obligatorios.",icon:"error",confirmButtonText:"OK"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)){W.fire({title:"Error",text:"Por favor, ingrese un email válido.",icon:"error",confirmButtonText:"OK"});return}d(!0);try{const n=await fetch(O+"api_configuracion.php",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(n.ok){const o=await n.json();if(o.success)W.fire({title:"¡Configuración guardada!",text:o.message||"Los cambios se han aplicado exitosamente.",icon:"success",confirmButtonText:"OK"}),s.logo_url&&N(s.logo_url);else throw new Error(o.error||"Error al guardar la configuración")}else if(n.status===401){await n.json(),W.fire({title:"🔒 Acceso Denegado",text:"Necesita estar autenticado como administrador para modificar la configuración.",icon:"warning",confirmButtonText:"Ir a Login",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&(window.location.href="/")});return}else{const o=await n.text();throw console.error("❌ Error del servidor:",o),new Error(`Error del servidor: ${n.status} - ${o}`)}}catch(n){console.error("🚨 Error al guardar configuración:",n),W.fire({title:"Error",text:"No se pudo guardar la configuración: "+n.message,icon:"error",confirmButtonText:"OK"})}finally{d(!1)}},_=b=>{const n=b.target.files&&b.target.files[0];if(!n)return;const o=URL.createObjectURL(n);N(o),r(m=>({...m,_logo_file:n}))},L=async()=>{const b=s._logo_file;if(!b){W.fire({title:"Info",text:"Seleccione un archivo primero.",icon:"info"});return}p(!0);try{const n=new FormData;n.append("logo",b);const o=await fetch(O+"api_upload_logo.php",{method:"POST",credentials:"include",body:n}),m=await o.json();if(o.ok&&m.success)r(f=>({...f,logo_url:m.path,_logo_file:null})),N(m.path),W.fire({title:"Listo",text:"Logo subido correctamente.",icon:"success"});else throw new Error(m.error||"Error subiendo archivo")}catch(n){console.error("Error upload logo",n),W.fire({title:"Error",text:"No se pudo subir el logo: "+n.message,icon:"error"})}finally{p(!1)}},c=()=>{r(b=>({...b,logo_url:""})),N("")};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-blue-800",children:"⚙️ Configuración del Sistema"}),x?e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando configuración..."})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-800",children:"Información de la Clínica"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la Clínica *"}),e.jsx("input",{type:"text",value:s.nombre_clinica,onChange:b=>C("nombre_clinica",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Teléfono *"}),e.jsx("input",{type:"tel",value:s.telefono,onChange:b=>C("telefono",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",value:s.email,onChange:b=>C("email",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"RUC (opcional)"}),e.jsx("input",{type:"text",value:s.ruc||"",onChange:b=>C("ruc",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dirección *"}),e.jsx("input",{type:"text",value:s.direccion,onChange:b=>C("direccion",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Director General"}),e.jsx("input",{type:"text",value:s.director_general||"",onChange:b=>C("director_general",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Dr. Juan Pérez"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Jefe de Enfermería"}),e.jsx("input",{type:"text",value:s.jefe_enfermeria||"",onChange:b=>C("jefe_enfermeria",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enf. María González"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL del Logo (opcional) / Subir logo"}),e.jsx("input",{type:"url",value:s.logo_url||"",onChange:b=>C("logo_url",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2",placeholder:"https://ejemplo.com/logo.png"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:_,className:"text-sm"}),e.jsx("button",{type:"button",onClick:L,disabled:y,className:"bg-green-600 text-white px-3 py-1 rounded-md hover:bg-green-700 disabled:bg-gray-300 text-sm",children:y?"Subiendo...":"Subir Logo"}),e.jsx("button",{type:"button",onClick:c,className:"bg-red-100 text-red-700 px-3 py-1 rounded-md hover:bg-red-200 text-sm",children:"Eliminar"})]}),j?e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Vista previa:"}),e.jsx("img",{src:j.startsWith("http")?j:"/"+j.replace(/^\/+/,""),alt:"Logo preview",style:{maxHeight:96}})]}):null]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sitio Web (opcional)"}),e.jsx("input",{type:"url",value:s.website||"",onChange:b=>C("website",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://www.ejemplo.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contacto de Emergencias"}),e.jsx("input",{type:"tel",value:s.contacto_emergencias||"",onChange:b=>C("contacto_emergencias",b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Emergencias 24h: +51 987-654-321"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Especialidades"}),e.jsx("textarea",{value:s.especialidades||"",onChange:b=>C("especialidades",b.target.value),rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Medicina General, Pediatría, Ginecología, Traumatología..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Horario de Atención"}),e.jsx("textarea",{value:s.horario_atencion||"",onChange:b=>C("horario_atencion",b.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Lunes a Viernes: 7:00 AM - 8:00 PM..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Misión Institucional"}),e.jsx("textarea",{value:s.mision||"",onChange:b=>C("mision",b.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brindar servicios de salud de calidad..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Visión Institucional"}),e.jsx("textarea",{value:s.vision||"",onChange:b=>C("vision",b.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ser el centro de salud de referencia..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valores Institucionales"}),e.jsx("textarea",{value:s.valores||"",onChange:b=>C("valores",b.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Compromiso, Excelencia, Humanización, Integridad..."})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"* Campos obligatorios"}),e.jsx("button",{onClick:l,disabled:a,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 font-medium transition-colors",children:a?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Guardando..."]}):"💾 Guardar Configuración"})]})})]}),e.jsxs("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"ℹ️ Información del Sistema"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Versión:"})," 1.0.0"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Base de datos:"})," MySQL"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Servidor web:"})," Apache (Laragon)"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Framework:"})," React + Vite"]})]})]})]})}function at(){const[s,r]=t.useState([]),[a,d]=t.useState([]),[x,w]=t.useState(!0),[y,p]=t.useState(!1),[j,N]=t.useState(null),[v,C]=t.useState("todos"),[l,_]=t.useState(1),[L,c]=t.useState(5),b=[{value:"consulta",label:"Consultas Médicas"},{value:"rayosx",label:"Rayos X"},{value:"ecografia",label:"Ecografía"},{value:"ocupacional",label:"Medicina Ocupacional"},{value:"procedimientos",label:"Procedimientos Médicos"},{value:"cirugias",label:"Cirugías Menores"},{value:"tratamientos",label:"Tratamientos Especializados"},{value:"emergencias",label:"Emergencias"}],n=[...b],[o,m]=t.useState({servicio_tipo:"consulta",medico_id:"",descripcion_base:"",descripcion:"",precio_particular:"",precio_seguro:"",precio_convenio:"",activo:1});t.useEffect(()=>{S(),f()},[]);const f=async()=>{try{const q=await(await fetch(`${O}api_medicos.php`)).json();if(q.success){const J=(q.medicos||[]).map(ee=>({...ee,id:parseInt(ee.id)}));d(J)}}catch(k){console.error("Error al cargar médicos:",k)}},E=t.useCallback((k,q)=>{if(!k||k==="general"||k==="")return q||"Consulta General";const J=a.find(ee=>ee.id===parseInt(k));if(J){const ee=J.nombre,B=J.especialidad?` - ${J.especialidad}`:"";return`${ee}${B} - ${q||"Consulta"}`}return q||"Consulta"},[a]),S=async()=>{try{w(!0);const q=await(await fetch(`${O}api_tarifas.php`,{credentials:"include"})).json();q.success?r(q.tarifas||[]):console.error("Error al cargar tarifas:",q.error)}catch(k){console.error("Error:",k),W.fire("Error","Error de conexión al cargar tarifas","error")}finally{w(!1)}},i=(k=null)=>{if(k&&(k.fuente==="medicamentos"||k.fuente==="examenes_laboratorio")){W.fire({title:"No Editable",text:k.fuente==="medicamentos"?"Los precios de medicamentos se gestionan desde el módulo de farmacia.":"Los precios de exámenes se gestionan desde el módulo de laboratorio.",icon:"info",confirmButtonText:"Entendido"});return}if(k){N(k);const q=k.descripcion;let J="general",ee=q;const B=a.find(R=>q.includes(R.nombre));if(B){J=B.id.toString();const R=new RegExp(`^${B.nombre}(\\s*-\\s*${B.especialidad})?\\s*-\\s*`,"i");ee=q.replace(R,"").trim()}m({servicio_tipo:k.servicio_tipo,medico_id:J,descripcion_base:ee,descripcion:q,precio_particular:k.precio_particular,precio_seguro:k.precio_seguro||"",precio_convenio:k.precio_convenio||"",activo:k.activo})}else N(null),m({servicio_tipo:"consulta",medico_id:"general",descripcion_base:"",descripcion:"",precio_particular:"",precio_seguro:"",precio_convenio:"",activo:1});p(!0)},h=()=>{p(!1),N(null),m({servicio_tipo:"consulta",medico_id:"general",descripcion_base:"",descripcion:"",precio_particular:"",precio_seguro:"",precio_convenio:"",activo:1})},u=async()=>{if(!o.descripcion.trim()){W.fire("Error","La descripción es obligatoria","error");return}if(!o.precio_particular||parseFloat(o.precio_particular)<=0){W.fire("Error","El precio particular debe ser mayor a 0","error");return}try{const k=j?`${O}api_tarifas.php`:`${O}api_tarifas.php`,q=j?"PUT":"POST",J=j?{...o,id:j.id}:o,B=await(await fetch(k,{method:q,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(J)})).json();B.success?(W.fire({title:"¡Éxito!",text:j?"Tarifa actualizada correctamente":"Tarifa creada correctamente",icon:"success",confirmButtonText:"OK"}),h(),S()):W.fire("Error",B.error||"Error al guardar la tarifa","error")}catch(k){console.error("Error:",k),W.fire("Error","Error de conexión","error")}},M=async(k,q)=>{if(typeof k=="string"&&(k.startsWith("med_")||k.startsWith("lab_"))){W.fire({title:"No Eliminable",text:k.startsWith("med_")?"Los medicamentos se eliminan desde el módulo de farmacia.":"Los exámenes se eliminan desde el módulo de laboratorio.",icon:"info",confirmButtonText:"Entendido"});return}if((await W.fire({title:"¿Estás seguro?",text:`¿Deseas eliminar la tarifa "${q}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33"})).isConfirmed)try{const B=await(await fetch(`${O}api_tarifas.php`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:k})})).json();B.success?(W.fire("¡Eliminado!","La tarifa ha sido eliminada","success"),S()):W.fire("Error",B.error||"Error al eliminar la tarifa","error")}catch(ee){console.error("Error:",ee),W.fire("Error","Error de conexión","error")}},T=async(k,q)=>{try{const ee=await(await fetch(`${O}api_tarifas.php`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:k,activo:q})})).json();ee.success?S():W.fire("Error",ee.error||"Error al cambiar estado","error")}catch(J){console.error("Error:",J),W.fire("Error","Error de conexión","error")}},A=v==="todos"?s.filter(k=>!["laboratorio","farmacia"].includes(k.servicio_tipo)):s.filter(k=>k.servicio_tipo===v&&!["laboratorio","farmacia"].includes(k.servicio_tipo)),z=A.length,P=Math.ceil(z/L),$=(l-1)*L,H=$+L,g=A.slice($,H),F=k=>{_(k)},U=k=>{c(k),_(1)};t.useEffect(()=>{_(1)},[v]),t.useEffect(()=>{if(a.length>0&&o.medico_id&&o.descripcion_base){const k=E(o.medico_id,o.descripcion_base);m(q=>({...q,descripcion:k}))}},[a,o.medico_id,o.descripcion_base,E]);const Y=k=>{const q=n.find(J=>J.value===k);return q?q.label:k};return x?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"text-xl",children:"Cargando tarifas..."})}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-blue-800",children:"💰 Gestión de Tarifas"}),e.jsx("button",{onClick:()=>i(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-medium",children:"➕ Nueva Tarifa"})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Filtrar por servicio:"}),e.jsxs("select",{value:v,onChange:k=>C(k.target.value),className:"border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"todos",children:"Todos los servicios"}),n.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))]}),e.jsxs("span",{className:"text-gray-600",children:["(",z," tarifa",z!==1?"s":""," - Página ",l," de ",P,")"]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"font-medium text-gray-700 text-sm sm:text-base",children:"Elementos por página:"}),e.jsxs("select",{value:L,onChange:k=>U(parseInt(k.target.value)),className:"border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]}),P>1&&e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>F(1),disabled:l===1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 whitespace-nowrap",children:[e.jsx("span",{className:"hidden sm:inline",children:"Primera"}),e.jsx("span",{className:"sm:hidden",children:"❮❮"})]}),e.jsxs("button",{onClick:()=>F(l-1),disabled:l===1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:[e.jsx("span",{className:"hidden sm:inline",children:"Anterior"}),e.jsx("span",{className:"sm:hidden",children:"❮"})]}),e.jsx("div",{className:"hidden sm:flex items-center gap-2",children:Array.from({length:Math.min(5,P)},(k,q)=>{let J;return P<=5?J=q+1:J=Math.max(1,Math.min(l-2,P-4))+q,e.jsx("button",{onClick:()=>F(J),className:`px-3 py-1 text-sm border rounded ${l===J?"bg-blue-500 text-white":"hover:bg-gray-100"}`,children:J},J)})}),e.jsx("div",{className:"flex sm:hidden items-center gap-1",children:Array.from({length:Math.min(3,P)},(k,q)=>{let J;return P<=3?J=q+1:J=Math.max(1,Math.min(l-1,P-2))+q,e.jsx("button",{onClick:()=>F(J),className:`px-2 py-1 text-xs border rounded ${l===J?"bg-blue-500 text-white":"hover:bg-gray-100"}`,children:J},`mobile-${J}`)})}),e.jsxs("button",{onClick:()=>F(l+1),disabled:l===P,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:[e.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),e.jsx("span",{className:"sm:hidden",children:"❯"})]}),e.jsxs("button",{onClick:()=>F(P),disabled:l===P,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 whitespace-nowrap",children:[e.jsx("span",{className:"hidden sm:inline",children:"Última"}),e.jsx("span",{className:"sm:hidden",children:"❯❯"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Servicio"}),e.jsx("th",{className:"hidden sm:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Particular"}),e.jsx("th",{className:"hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Seguro"}),e.jsx("th",{className:"hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Convenio"}),e.jsx("th",{className:"hidden md:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(k=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex items-center mb-1 sm:mb-0",children:[e.jsx("span",{className:"text-lg mr-2",children:k.fuente==="medicamentos"?"💊":k.fuente==="examenes_laboratorio"?"🔬":"🏥"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:Y(k.servicio_tipo)})]}),k.fuente&&k.fuente!=="tarifas"&&e.jsx("span",{className:"ml-0 sm:ml-2 px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full",children:k.fuente==="medicamentos"?"Desde Farmacia":"Desde Laboratorio"}),e.jsx("div",{className:"sm:hidden mt-2 text-sm font-medium text-gray-900",children:k.descripcion})]})}),e.jsx("td",{className:"hidden sm:table-cell px-6 py-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:k.descripcion})}),e.jsxs("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.jsxs("div",{className:"font-medium",children:["S/ ",parseFloat(k.precio_particular).toFixed(2)]}),e.jsxs("div",{className:"block lg:hidden text-xs text-gray-500 mt-1",children:[k.precio_seguro&&e.jsxs("div",{children:["Seguro: S/ ",parseFloat(k.precio_seguro).toFixed(2)]}),k.precio_convenio&&e.jsxs("div",{children:["Convenio: S/ ",parseFloat(k.precio_convenio).toFixed(2)]})]})]}),e.jsx("td",{className:"hidden lg:table-cell px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:k.precio_seguro?`S/ ${parseFloat(k.precio_seguro).toFixed(2)}`:"-"}),e.jsx("td",{className:"hidden lg:table-cell px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:k.precio_convenio?`S/ ${parseFloat(k.precio_convenio).toFixed(2)}`:"-"}),e.jsx("td",{className:"hidden md:table-cell px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>T(k.id,k.activo===1?0:1),className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${k.activo===1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:k.activo===1?"✓ Activo":"✗ Inactivo"})}),e.jsx("td",{className:"px-3 md:px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-2 space-y-1 sm:space-y-0",children:[e.jsx("div",{className:"block md:hidden mb-2",children:e.jsx("button",{onClick:()=>T(k.id,k.activo===1?0:1),className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${k.activo===1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:k.activo===1?"✓ Activo":"✗ Inactivo"})}),k.fuente==="medicamentos"?e.jsxs("button",{onClick:()=>window.open("/farmacia-medicamentos","_blank"),className:"text-blue-600 hover:text-blue-900 px-2 sm:px-3 py-1 bg-blue-100 rounded text-xs sm:text-sm",children:["🏥 ",e.jsx("span",{className:"hidden sm:inline",children:"Gestionar en"})," Farmacia"]}):k.fuente==="examenes_laboratorio"?e.jsxs("button",{onClick:()=>window.open("/laboratorio-examenes","_blank"),className:"text-green-600 hover:text-green-900 px-2 sm:px-3 py-1 bg-green-100 rounded text-xs sm:text-sm",children:["🧪 ",e.jsx("span",{className:"hidden sm:inline",children:"Gestionar en"})," Lab"]}):e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-1 sm:space-y-0 sm:space-x-2",children:[e.jsx("button",{onClick:()=>i(k),className:"text-blue-600 hover:text-blue-900 px-2 py-1 bg-blue-100 rounded text-xs sm:text-sm",children:"✏️ Editar"}),e.jsx("button",{onClick:()=>M(k.id,k.descripcion),className:"text-red-600 hover:text-red-900 px-2 py-1 bg-red-100 rounded text-xs sm:text-sm",children:"🗑️ Eliminar"})]})]})})]},k.id))})]})}),A.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay tarifas registradas para este filtro"})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:j?"Editar Tarifa":"Nueva Tarifa"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Servicio *"}),e.jsx("select",{value:o.servicio_tipo,onChange:k=>m({...o,servicio_tipo:k.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:b.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Médico * ",a.length===0&&e.jsx("span",{className:"text-gray-400",children:"(Cargando...)"})]}),e.jsxs("select",{value:o.medico_id,onChange:k=>{const q=k.target.value,J=E(q,o.descripcion_base);m({...o,medico_id:q,descripcion:J})},className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:a.length===0,children:[e.jsx("option",{value:"general",children:"Tarifa General (Todos los médicos)"}),a.map(k=>e.jsxs("option",{value:k.id,children:["Dr(a). ",k.nombre," ",k.apellido||""," - ",k.especialidad||"General"]},k.id))]}),a.length===0&&e.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"⚠️ No se pudieron cargar los médicos. Verifique la conexión."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción Base *"}),e.jsx("input",{type:"text",value:o.descripcion_base,onChange:k=>{const q=k.target.value,J=E(o.medico_id,q);m({...o,descripcion_base:q,descripcion:J})},className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ej: Consulta Especializada, Procedimiento, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción Final (Se genera automáticamente)"}),e.jsx("input",{type:"text",value:o.descripcion,readOnly:!0,className:"w-full border rounded px-3 py-2 bg-gray-100 text-gray-600",placeholder:"Se generará automáticamente al seleccionar médico y descripción base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Particular * (S/)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:o.precio_particular,onChange:k=>m({...o,precio_particular:k.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Seguro (S/) - Opcional"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:o.precio_seguro,onChange:k=>m({...o,precio_seguro:k.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Convenio (S/) - Opcional"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:o.precio_convenio,onChange:k=>m({...o,precio_convenio:k.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.activo===1,onChange:k=>m({...o,activo:k.target.checked?1:0}),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Activo"})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-6",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:u,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:j?"Actualizar":"Crear"})]})]})})]})}const rt={administrador:"/usuarios",recepcionista:"/pacientes",enfermero:"/panel-enfermero",medico:"/mis-consultas",laboratorista:"/panel-laboratorio"};function Z({usuario:s,rolesPermitidos:r,children:a}){if(!s)return e.jsx(ue,{to:"/",replace:!0});if(r&&!r.includes(s.rol)){const d=rt[s.rol]||"/";return e.jsx(ue,{to:d,replace:!0})}return a}function nt({medicamento:s,usuario:r,onClose:a}){const[d,x]=t.useState([]),[w,y]=t.useState(!0),[p,j]=t.useState(null),[N,v]=t.useState({tipo:"entrada",cantidad:1,observaciones:"",usuario_id:""}),[C,l]=t.useState(!1),[_,L]=t.useState([]);t.useEffect(()=>{pe.get(O+"api_medicos.php").then(m=>L(m.data.medicos||[])).catch(()=>L([]))},[]);const c=`${O}api_movimientos_medicamento.php`,b=()=>{y(!0),j(null);let m=c+`?medicamento_id=${s.id}`;fetch(m,{credentials:"include"}).then(async f=>{const E=await f.json();if(!f.ok||E.error)throw new Error(E.error||`Error HTTP: ${f.status}`);return E}).then(x).catch(f=>j(f.message)).finally(()=>y(!1))};t.useEffect(()=>{b()},[s.id]);const n=m=>{const{name:f,value:E}=m.target;v(S=>({...S,[f]:f==="cantidad"?Number(E):E}))},o=m=>{m.preventDefault(),l(!0),fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({medicamento_id:s.id,tipo:N.tipo,cantidad:N.cantidad,usuario_id:r?.id?Number(r.id):1,medico_id:N.usuario_id?Number(N.usuario_id):null,observaciones:N.observaciones})}).then(f=>f.json()).then(()=>{v({tipo:"entrada",cantidad:1,observaciones:"",usuario_id:""}),b()}).finally(()=>l(!1))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-2xl w-full p-6 relative",children:[e.jsx("button",{onClick:a,className:"absolute top-2 right-2 text-gray-500 hover:text-black",children:"✕"}),e.jsx("h2",{className:"text-xl font-bold mb-2 text-center",children:"Historial de Movimientos"}),e.jsxs("div",{className:"mb-4 text-center text-lg font-semibold text-purple-700",children:[s.nombre," (",s.codigo,")"]}),e.jsxs("form",{onSubmit:o,className:"flex flex-wrap gap-2 items-end mb-6",children:[e.jsxs("select",{name:"tipo",value:N.tipo,onChange:n,className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"entrada",children:"Entrada"}),e.jsx("option",{value:"salida",children:"Salida"})]}),e.jsx("input",{name:"cantidad",type:"number",min:1,value:N.cantidad,onChange:n,className:"border rounded px-2 py-1 w-24",required:!0}),e.jsxs("select",{name:"usuario_id",value:N.usuario_id,onChange:n,className:"border rounded px-2 py-1 w-56",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona médico responsable"}),_.map(m=>e.jsxs("option",{value:m.id,children:[m.nombre," ",m.apellido," (",m.email,")"]},m.id))]}),e.jsx("input",{name:"observaciones",value:N.observaciones,onChange:n,className:"border rounded px-2 py-1 flex-1",placeholder:"Observaciones"}),e.jsx("button",{type:"submit",disabled:C,className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Registrar"})]}),w?e.jsx("div",{className:"text-center text-gray-500",children:"Cargando movimientos..."}):p?e.jsx("div",{className:"text-center text-red-500",children:p}):e.jsx("div",{className:"overflow-x-auto max-h-72",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200 rounded-lg text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-purple-100",children:[e.jsx("th",{className:"py-1 px-2 border-b",children:"Fecha"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Tipo"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Cantidad"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Usuario"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Médico responsable"}),e.jsx("th",{className:"py-1 px-2 border-b",children:"Observaciones"})]})}),e.jsx("tbody",{children:Array.isArray(d)&&d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-3 text-gray-400",children:"Sin movimientos registrados"})}):Array.isArray(d)?d.map(m=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-1 px-2 border-b",children:new Date(m.fecha_hora).toLocaleString()}),e.jsx("td",{className:"py-1 px-2 border-b",children:m.tipo_movimiento}),e.jsx("td",{className:"py-1 px-2 border-b text-right",children:m.cantidad}),e.jsx("td",{className:"py-1 px-2 border-b",children:m.usuario_nombre||m.usuario_id||"-"}),e.jsx("td",{className:"py-1 px-2 border-b",children:m.medico_nombre||"-"}),e.jsx("td",{className:"py-1 px-2 border-b",children:m.observaciones})]},m.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-3 text-red-500",children:"Error al cargar movimientos o sesión/rol incorrecto"})})})]})})]})})}function it({initialData:s,onSave:r,onCancel:a}){const[d,x]=t.useState({codigo:s?.codigo||"",nombre:s?.nombre||"",presentacion:s?.presentacion||"",concentracion:s?.concentracion||"",laboratorio:s?.laboratorio||"",stock:s?.stock??0,unidades_por_caja:s?.unidades_por_caja??30,fecha_vencimiento:s?.fecha_vencimiento||"",estado:s?.estado||"activo",precio_compra:s?.precio_compra!==void 0&&s?.precio_compra!==null?String(s.precio_compra):"",margen_ganancia:s?.margen_ganancia!==void 0&&s?.margen_ganancia!==null?String(s.margen_ganancia):"30",id:s?.id||void 0}),[w,y]=t.useState(""),p=N=>{const{name:v,value:C}=N.target;x(l=>v==="stock"||v==="unidades_por_caja"?{...l,[v]:Number(C)}:{...l,[v]:C})},j=async N=>{if(N.preventDefault(),!d.codigo.trim()||!d.nombre.trim()){y("El código y el nombre son obligatorios");return}if(!d.fecha_vencimiento){y("La fecha de vencimiento es obligatoria");return}if(!d.unidades_por_caja||d.unidades_por_caja<1){y("Las unidades por caja deben ser mayor a 0");return}y("");const v={...d,precio_compra:parseFloat(d.precio_compra)||0,margen_ganancia:parseFloat(d.margen_ganancia)||0,unidades_por_caja:parseInt(d.unidades_por_caja)||1};if(r){const C=await r(v);C&&C.error&&C.error.toLowerCase().includes("código ya existe")&&W.fire({icon:"error",title:"Código duplicado",text:C.error,confirmButtonColor:"#e53e3e"})}};return e.jsxs("form",{onSubmit:j,className:"bg-white rounded shadow max-w-lg mx-auto flex flex-col max-h-full",children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:[e.jsx("h2",{className:"text-lg font-bold text-center",children:s?"Editar Medicamento":"Nuevo Medicamento"}),w&&e.jsx("div",{className:"text-red-500 text-center mt-2",children:w})]}),e.jsx("div",{className:"p-4 overflow-y-auto flex-1",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Código *"}),e.jsx("input",{name:"codigo",value:d.codigo,onChange:p,className:"w-full border rounded px-2 py-1",maxLength:30,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Nombre *"}),e.jsx("input",{name:"nombre",value:d.nombre,onChange:p,className:"w-full border rounded px-2 py-1",maxLength:100,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Presentación"}),e.jsx("input",{name:"presentacion",value:d.presentacion,onChange:p,className:"w-full border rounded px-2 py-1",maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Concentración"}),e.jsx("input",{name:"concentracion",value:d.concentracion,onChange:p,className:"w-full border rounded px-2 py-1",maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Laboratorio"}),e.jsx("input",{name:"laboratorio",value:d.laboratorio,onChange:p,className:"w-full border rounded px-2 py-1",maxLength:100})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Stock (unidades)"}),e.jsx("input",{name:"stock",type:"number",min:0,value:d.stock,onChange:p,className:"w-full border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Unidades por caja *"}),e.jsx("input",{name:"unidades_por_caja",type:"number",min:1,value:d.unidades_por_caja,onChange:p,className:"w-full border rounded px-2 py-1",required:!0}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ejemplo: 30 pastillas por caja, 100 jeringas por caja"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Fecha de vencimiento *"}),e.jsx("input",{name:"fecha_vencimiento",type:"date",value:d.fecha_vencimiento,onChange:p,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Estado"}),e.jsxs("select",{name:"estado",value:d.estado,onChange:p,className:"w-full border rounded px-2 py-1",children:[e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"inactivo",children:"Inactivo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Precio de compra (S/)"}),e.jsx("input",{name:"precio_compra",type:"number",min:0,step:"0.01",value:d.precio_compra!==void 0&&d.precio_compra!==null?String(d.precio_compra):"",onChange:p,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Margen de ganancia (%)"}),e.jsx("input",{name:"margen_ganancia",type:"number",min:0,max:100,step:"0.1",value:d.margen_ganancia!==void 0&&d.margen_ganancia!==null?String(d.margen_ganancia):"",onChange:p,className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Precio de venta sugerido (S/)"}),e.jsx("input",{value:Number(d.precio_compra)+Number(d.precio_compra)*Number(d.margen_ganancia)/100,readOnly:!0,className:"w-full border rounded px-2 py-1 bg-gray-100 text-gray-700"})]})]})}),e.jsx("div",{className:"p-4 border-t bg-gray-50 rounded-b-lg",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:a,className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors",children:"Guardar"})]})})]})}function Le(){const[s,r]=t.useState(null),[a,d]=t.useState(""),[x,w]=t.useState(""),[y,p]=t.useState(null),[j,N]=t.useState([]),[v,C]=t.useState(!0),[l,_]=t.useState(null),[L,c]=t.useState(!1),[b,n]=t.useState(null),[o,m]=t.useState(""),[f,E]=t.useState(1),[S,i]=t.useState(3),[h,u]=t.useState(!1),[M,T]=t.useState(null),[A,z]=t.useState(""),[P,$]=t.useState(!1),H=()=>{C(!0),_(null);const B=`${O}api_medicamentos.php`;fetch(B,{credentials:"include"}).then(R=>{if(!R.ok)throw new Error("Error al cargar medicamentos");return R.json()}).then(N).catch(_).finally(()=>C(!1))};t.useEffect(()=>{H()},[]);const g=()=>{n(null),c(!0)},F=B=>{n(B),c(!0)},U=B=>{const R=`${O}api_medicamentos.php`;return fetch(R,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)}).then(G=>G.json()).then(G=>G.success?(c(!1),H(),{success:!0}):{error:G.error||"Error al guardar"}).catch(()=>({error:"Error de red o servidor"}))};let Y=j.filter(B=>B.nombre.toLowerCase().includes(o.toLowerCase())||B.codigo.toLowerCase().includes(o.toLowerCase()));Y.sort((B,R)=>B.id&&R.id?R.id-B.id:0),P&&(Y=Y.filter(B=>B.estado==="cuarentena")),a&&(Y=Y.filter(B=>B.fecha_vencimiento&&B.fecha_vencimiento>=a)),x&&(Y=Y.filter(B=>B.fecha_vencimiento&&B.fecha_vencimiento<=x));const k=Math.ceil(Y.length/S),q=Y.slice((f-1)*S,f*S),J=B=>{i(Number(B.target.value)),E(1)},ee=B=>{B>=1&&B<=k&&E(B)};return e.jsxs("div",{className:"max-w-7xl mx-auto p-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-blue-600 mb-2",children:"💊 Gestión de Medicamentos"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Sistema integral de inventario farmacéutico"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-4 gap-2",children:[e.jsx("input",{type:"text",placeholder:"Buscar por código o nombre...",value:o,onChange:B=>m(B.target.value),className:"border rounded px-3 py-2 w-full sm:w-72"}),e.jsxs("select",{value:S,onChange:J,className:"border rounded px-2 py-2 ml-2",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]}),e.jsx("span",{className:"ml-2 text-sm",children:"por página"}),e.jsxs("button",{onClick:g,className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-lg shadow-lg hover:from-purple-700 hover:to-blue-700 transform hover:scale-105 transition-all duration-200 font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"+"}),"Nuevo Medicamento"]})]}),e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-2 sm:p-4 mb-6 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-base font-semibold text-yellow-900 flex-wrap",children:[e.jsx("span",{className:"inline-block text-yellow-600 mr-1",children:"🗓️"}),e.jsx("label",{className:"text-xs sm:text-base",children:"Filtrar por vencimiento:"}),e.jsx("span",{className:"ml-1 text-xs font-normal text-gray-700",children:"Desde"}),e.jsx("input",{type:"date",value:a,onChange:B=>d(B.target.value),className:"border border-yellow-400 rounded px-1 py-1 focus:ring-2 focus:ring-yellow-300 w-16 sm:w-24 md:w-28"}),e.jsx("span",{className:"ml-1 text-xs font-normal text-gray-700",children:"Hasta"}),e.jsx("input",{type:"date",value:x,onChange:B=>w(B.target.value),className:"border border-yellow-400 rounded px-1 py-1 focus:ring-2 focus:ring-yellow-300 w-16 sm:w-24 md:w-28"}),e.jsx("button",{type:"button",onClick:()=>{d(""),w("")},className:"ml-1 px-2 py-1 rounded bg-yellow-300 text-yellow-900 font-semibold border border-yellow-400 hover:bg-yellow-400 transition text-xs sm:text-sm",title:"Limpiar filtros de vencimiento",children:"Limpiar"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 sm:mt-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:B=>$(B.target.checked)}),"Solo cuarentena"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Medicamentos en cuarentena deben ser llevados a puntos de acopio autorizados (DIGEMID)."})]})]}),v&&e.jsx("div",{className:"text-center text-gray-500",children:"Cargando..."}),l&&e.jsx("div",{className:"text-center text-red-500",children:l.message||"Error"}),!v&&!l&&e.jsxs("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 rounded-lg",children:[e.jsxs("table",{className:"w-full bg-white border border-gray-200 rounded-lg text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white",children:[e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider",children:"Código"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider sm:hidden",children:"Acciones"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider hidden md:table-cell",children:"Presentación"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-xs font-semibold uppercase tracking-wider hidden lg:table-cell",children:"Concentración"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden md:table-cell",children:"Stock"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden lg:table-cell",children:"Vencimiento"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden xl:table-cell",children:"Precio Compra"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden xl:table-cell",children:"Margen %"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-right text-xs font-semibold uppercase tracking-wider hidden xl:table-cell",children:"Precio Venta"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden lg:table-cell",children:"Estado"}),e.jsx("th",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-purple-400 text-center text-xs font-semibold uppercase tracking-wider hidden sm:table-cell",children:"Acciones"})]})}),e.jsx("tbody",{children:q.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:12,className:"text-center py-4 text-gray-400",children:"No hay medicamentos registrados"})}):q.map((B,R)=>{let G=R%2===0?"bg-white":"bg-gray-50",D="";if(B.fecha_vencimiento){const I=new Date,te=(new Date(B.fecha_vencimiento)-I)/(1e3*60*60*24);te<0?(D="bg-red-100 border-l-4 border-red-500",G=""):te<90&&(D="bg-orange-100 border-l-4 border-orange-500",G="")}return e.jsxs("tr",{className:`transition-colors duration-200 hover:bg-purple-100 hover:shadow-sm ${G} ${D}`,children:[e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 font-medium text-gray-900",children:B.codigo}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 font-semibold text-gray-800",children:B.nombre}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-center sm:hidden",children:e.jsxs("div",{className:"flex flex-row gap-1 justify-center",children:[e.jsx("button",{onClick:()=>r(B),className:"p-1 text-blue-600 hover:text-white hover:bg-blue-600 rounded-md transition-all duration-200",title:"Ver detalles",children:e.jsx(ze,{size:12})}),e.jsx("button",{onClick:()=>F(B),className:"p-1 text-indigo-600 hover:text-white hover:bg-indigo-600 rounded-md transition-all duration-200",title:"Editar",children:e.jsx(we,{size:12})}),e.jsx("button",{onClick:()=>p(B),className:"p-1 text-purple-600 hover:text-white hover:bg-purple-600 rounded-md transition-all duration-200",title:"Historial",children:e.jsx(Ce,{size:12})}),B.estado!=="cuarentena"&&e.jsx("button",{onClick:()=>{T(B),u(!0),z("")},className:"p-1 text-yellow-600 hover:text-white hover:bg-yellow-600 rounded-md transition-all duration-200",title:"Cuarentena",children:e.jsx(ke,{size:12})})]})}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 hidden md:table-cell",children:B.presentacion}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 hidden lg:table-cell",children:B.concentracion}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-right font-medium text-gray-700 hidden md:table-cell",children:B.stock}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-center hidden lg:table-cell",children:B.fecha_vencimiento?new Date(B.fecha_vencimiento).toLocaleDateString():"-"}),e.jsxs("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-right font-mono text-xs hidden xl:table-cell",children:["S/ ",B.precio_compra!==void 0?Number(B.precio_compra).toFixed(2):"-"]}),e.jsxs("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-right hidden xl:table-cell",children:[B.margen_ganancia!==void 0?Number(B.margen_ganancia).toFixed(1):"-","%"]}),e.jsxs("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-right font-semibold text-green-700 font-mono text-xs hidden xl:table-cell",children:["S/ ",B.precio_compra!==void 0&&B.margen_ganancia!==void 0?(Number(B.precio_compra)+Number(B.precio_compra)*Number(B.margen_ganancia)/100).toFixed(2):"-"]}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 hidden lg:table-cell font-medium text-center text-xs "+(B.estado==="cuarentena"?"bg-yellow-200 text-yellow-900 font-bold":""),children:B.estado==="cuarentena"?"CUARENTENA":B.estado}),e.jsx("td",{className:"py-2 px-2 sm:py-3 sm:px-4 border-b border-gray-200 text-center hidden sm:table-cell",children:e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx("button",{onClick:()=>F(B),className:"p-1 text-indigo-600 hover:text-white hover:bg-indigo-600 rounded-md transition-all duration-200",title:"Editar",children:e.jsx(we,{size:14})}),e.jsx("button",{onClick:()=>p(B),className:"p-1 text-purple-600 hover:text-white hover:bg-purple-600 rounded-md transition-all duration-200",title:"Historial",children:e.jsx(Ce,{size:14})}),B.estado!=="cuarentena"&&e.jsx("button",{onClick:()=>{T(B),u(!0),z("")},className:"p-1 text-yellow-600 hover:text-white hover:bg-yellow-600 rounded-md transition-all duration-200",title:"Cuarentena",children:e.jsx(ke,{size:14})})]})})]},B.id)})})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-xs w-full relative",children:[e.jsx("button",{onClick:()=>r(null),className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-xl",children:"×"}),e.jsx("h2",{className:"text-lg font-bold mb-2 text-blue-800",children:"Detalles del Medicamento"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Código:"})," ",s.codigo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",s.nombre]}),e.jsxs("div",{children:[e.jsx("b",{children:"Presentación:"})," ",s.presentacion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Concentración:"})," ",s.concentracion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Laboratorio:"})," ",s.laboratorio]}),e.jsxs("div",{children:[e.jsx("b",{children:"Stock:"})," ",s.stock]}),e.jsxs("div",{children:[e.jsx("b",{children:"Vencimiento:"})," ",s.fecha_vencimiento?new Date(s.fecha_vencimiento).toLocaleDateString():"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Precio compra:"})," S/"," ",s.precio_compra!==void 0?Number(s.precio_compra).toFixed(2):"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Margen ganancia:"})," ",s.margen_ganancia!==void 0?Number(s.margen_ganancia).toFixed(1):"-","%"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Precio venta:"})," S/"," ",s.precio_compra!==void 0&&s.margen_ganancia!==void 0?(Number(s.precio_compra)+Number(s.precio_compra)*Number(s.margen_ganancia)/100).toFixed(2):"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Estado:"})," ",s.estado]})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full relative",children:[e.jsx("h2",{className:"text-lg font-bold mb-2 text-yellow-800",children:"Enviar a cuarentena"}),e.jsxs("p",{className:"mb-2 text-sm",children:["Medicamento: ",e.jsx("b",{children:M?.nombre})," (",M?.codigo,")"]}),e.jsxs("label",{className:"block mb-2 text-sm",children:["Motivo de cuarentena ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{className:"w-full border rounded px-2 py-1 mb-4",rows:3,value:A,onChange:B=>z(B.target.value),required:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>u(!1),className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Cancelar"}),e.jsx("button",{className:"bg-yellow-600 text-white px-4 py-2 rounded",disabled:!A.trim(),onClick:async()=>{if(!M)return;const B=`${O}api_medicamentos.php`,R=new Date().toISOString().slice(0,10),G={...M,estado:"cuarentena",fecha_cuarentena:R,motivo_cuarentena:A};await fetch(B,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(G)}),u(!1),T(null),z(""),H()},children:"Confirmar"})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Página ",f," de ",k," (",Y.length," ","resultados)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ee(1),disabled:f===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"«"}),e.jsx("button",{onClick:()=>ee(f-1),disabled:f===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"‹"}),e.jsx("span",{className:"px-2 py-1",children:f}),e.jsx("button",{onClick:()=>ee(f+1),disabled:f===k||k===0,className:"px-2 py-1 border rounded disabled:opacity-50",children:"›"}),e.jsx("button",{onClick:()=>ee(k),disabled:f===k||k===0,className:"px-2 py-1 border rounded disabled:opacity-50",children:"»"})]})]})]}),L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-0 max-w-lg w-full relative max-h-[90vh] overflow-y-auto",children:e.jsx(it,{initialData:b,onSave:U,onCancel:()=>c(!1)})})}),y&&e.jsx(nt,{medicamento:y,usuario:null,onClose:()=>{p(null),H()}})]})}function ge(){const s=()=>{if(n.length===0){U("Selecciona al menos un medicamento.");return}const D=n.map(I=>{const X=_.find(re=>re.id===I),te=E[I]||"unidad",ne=m[I]||1,le=i[I]||30,oe=k(X);let me=0,se=X&&X.nombre&&X.nombre!=="0"?X.nombre:"Medicamento sin nombre";return te==="caja"?(me=oe*le*ne,se+=" (Caja)"):(me=oe*ne,se+=" (Unidad)"),{servicio_tipo:"farmacia",servicio_id:I,descripcion:se,cantidad:ne,precio_unitario:oe,subtotal:me}});x(D),y(G()),a(!0)},[r,a]=t.useState(!1),[d,x]=t.useState([]),[w,y]=t.useState(0),p=ie(),j=xe(),[N,v]=t.useState(!1),[C,l]=t.useState(!1),[_,L]=t.useState([]),[c,b]=t.useState(""),[n,o]=t.useState([]),[m,f]=t.useState({}),[E,S]=t.useState({}),[i,h]=t.useState({}),u=j.pacienteId||null,[M,T]=t.useState(null),[A,z]=t.useState(""),[P,$]=t.useState(""),[H,g]=t.useState(""),[F,U]=t.useState(""),Y=()=>{fetch(`${O}api_medicamentos.php`,{credentials:"include"}).then(D=>D.json()).then(D=>{L(D.medicamentos||D||[]);const I={};(D.medicamentos||D||[]).forEach(X=>{I[X.id]=X.unidades_por_caja||1}),h(I)})};t.useEffect(()=>{Y()},[]),t.useEffect(()=>{u&&fetch(`${O}api_pacientes.php?id=${u}`).then(D=>D.json()).then(D=>{D.success&&D.paciente&&T({id:D.paciente.id,dni:D.paciente.dni,nombre:(D.paciente.nombres||D.paciente.nombre||"")+" "+(D.paciente.apellidos||D.paciente.apellido||""),historia_clinica:D.paciente.historia_clinica||""})})},[u]);const k=D=>{if(!D)return 0;const I=Number(D.precio_compra||0),X=Number(D.margen_ganancia||0);return I+I*X/100},q=_.filter(D=>D.nombre.toLowerCase().includes(c.toLowerCase())||D.codigo&&D.codigo.toLowerCase().includes(c.toLowerCase())),J=D=>{o(I=>I.includes(D)?I:[...I,D]),f(I=>({...I,[D]:1})),S(I=>({...I,[D]:"unidad"}))},ee=D=>{o(I=>I.filter(X=>X!==D)),f(I=>{const X={...I};return delete X[D],X}),S(I=>{const X={...I};return delete X[D],X})},B=(D,I)=>{f(X=>({...X,[D]:I}))},R=(D,I)=>{S(X=>({...X,[D]:I})),I==="caja"&&f(X=>({...X,[D]:1}))},G=()=>n.reduce((D,I)=>{const X=_.find(le=>le.id===I),te=m[I]||1,ne=E[I]||"unidad";return X?ne==="caja"?D+k(X)*i[I]*te:D+k(X)*te:D},0);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 bg-white rounded-2xl shadow-2xl mt-8 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-blue-900 flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"medicamentos",children:"💊"}),"Cotizador de Medicamentos"]}),e.jsx("button",{className:"bg-blue-100 text-blue-800 px-4 py-2 rounded font-semibold border border-blue-300 hover:bg-blue-200 transition",onClick:()=>{u?p("/seleccionar-servicio",{state:{pacienteId:u}}):p("/seleccionar-servicio")},children:"← Volver a Servicios"})]}),e.jsxs("div",{className:"mb-4",children:[!j.pacienteId&&e.jsx(Fe,{onPacienteEncontrado:D=>{T({id:D.id,dni:D.dni||"",nombre:((D.nombre||"")+" "+(D.apellido||"")).trim(),historia_clinica:D.historia_clinica||""}),z(""),$(""),g(""),l(!0),U("")},onNoEncontrado:()=>{T(null),v(!0),l(!0),U("Paciente no encontrado. Verifica el DNI, nombre o historia clínica.")},onNuevaBusqueda:()=>{T(null),v(!1),l(!1)}}),!j.pacienteId&&!u&&!A&&!N&&C&&!M&&e.jsx("button",{className:"mt-2 px-3 py-1 bg-yellow-100 text-yellow-800 rounded border border-yellow-300 text-sm",onClick:()=>v(!0),children:"Paciente no encontrado"}),!j.pacienteId&&N&&!u&&e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx("input",{type:"text",value:A,onChange:D=>z(D.target.value),placeholder:"DNI",className:"border px-2 py-1 rounded w-32"}),e.jsx("input",{type:"text",value:P,onChange:D=>$(D.target.value),placeholder:"Nombres",className:"border px-2 py-1 rounded w-40",required:!0}),e.jsx("input",{type:"text",value:H,onChange:D=>g(D.target.value),placeholder:"Apellidos",className:"border px-2 py-1 rounded w-40",required:!0})]}),(u||A)&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded text-blue-800 text-sm",children:[e.jsx("span",{className:"font-bold",children:"Paciente:"})," ",M?`${M.nombre} (DNI: ${M.dni})`:`${P} ${H} (DNI: ${A})`]})]}),e.jsxs("div",{className:"mb-4 flex gap-2 items-center",children:[e.jsx("span",{className:"text-blue-700 text-xl",children:"🔍"}),e.jsx("input",{type:"text",value:c,onChange:D=>b(D.target.value),placeholder:"Buscar medicamento...",className:"border px-3 py-2 rounded-lg w-full max-w-md focus:ring-2 focus:ring-blue-300"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:_.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No hay medicamentos registrados en el sistema."}):q.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-8",children:['Sin coincidencias para "',c,'".']}):e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:q.map(D=>{const I=i[D.id]||30,X=D.stock,te=Math.floor(X/I);return e.jsxs("li",{className:"flex items-center gap-4 py-3 px-2 hover:bg-blue-50 rounded-lg transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"🧪"}),D.nombre]}),e.jsxs("div",{className:"text-xs text-gray-500 flex gap-2 items-center",children:[e.jsxs("span",{children:["📦 ",te," cajas"]}),e.jsxs("span",{children:["💊 ",X," unidades"]}),e.jsxs("span",{children:["💲 S/ ",k(D).toFixed(2)," / unidad"]})]})]}),n.includes(D.id)?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:E[D.id]||"unidad",onChange:ne=>R(D.id,ne.target.value),className:"border rounded-lg px-2 py-1 mr-2 bg-white",children:[e.jsx("option",{value:"unidad",children:"Unidad"}),e.jsx("option",{value:"caja",children:"Caja"})]}),E[D.id]==="caja"?e.jsx("input",{type:"number",min:1,max:te,value:m[D.id]||1,onChange:ne=>B(D.id,Math.max(1,Math.min(te,Number(ne.target.value)))),className:"border rounded-lg px-2 w-16 bg-white"}):e.jsx("input",{type:"number",min:1,max:X,value:m[D.id]||1,onChange:ne=>B(D.id,Math.max(1,Math.min(X,Number(ne.target.value)))),className:"border rounded-lg px-2 w-16 bg-white"}),e.jsx("button",{onClick:()=>ee(D.id),className:"ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-700 text-xl shadow transition","aria-label":"Quitar",children:e.jsx(Be,{})})]}):e.jsx("button",{onClick:()=>J(D.id),className:"w-10 h-10 flex items-center justify-center rounded-full bg-green-100 hover:bg-green-200 text-green-700 text-xl shadow transition","aria-label":"Agregar",children:e.jsx(Oe,{})})]},D.id)})})})}),e.jsxs("div",{className:"col-span-1 md:sticky md:top-24 md:ml-8 w-full md:w-96",children:[n.length>0&&!r&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotización"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:n.map(D=>{const I=_.find(K=>K.id===D),X=E[D]||"unidad",te=m[D]||1,ne=i[D]||30,le=k(I);let oe=0,me=I?.nombre||"";return X==="caja"?(oe=le*ne*te,me+=" (Caja)"):(oe=le*te,me+=" (Unidad)"),e.jsxs("li",{className:"py-2 flex justify-between items-center",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"💊"}),me]}),e.jsxs("span",{children:[te," ",X==="caja"?"caja(s)":"unidad(es)"]}),e.jsxs("span",{className:"font-bold text-green-700",children:["S/ ",oe.toFixed(2)]})]},D)})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",G().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>{o([]),U("")},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:s,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Registrar Venta"})]})]}),r&&(M&&M.nombre&&M.dni||A&&P&&H?e.jsx(he,{paciente:M||{id:null,dni:A,nombre:`${P} ${H}`,historia_clinica:`MANUAL-${A}`},servicio:{key:"farmacia",label:"Farmacia"},detalles:d,total:w,onCobroCompleto:()=>{a(!1),o([]),f({}),S({}),U("Venta procesada correctamente. Stock actualizado."),Y()},onCancelar:()=>a(!1)}):e.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-lg font-semibold text-center",children:"Faltan datos completos del paciente. Por favor, busca un paciente registrado o completa los campos de DNI, nombres y apellidos para continuar con el cobro."}))]})]})}),F&&e.jsx("div",{className:`mt-4 text-center font-semibold ${F.includes("registrada")?"text-green-600":"text-red-600"}`,children:F})]})}function lt(){const{pacienteId:s}=xe(),r=ie(),[a,d]=t.useState([]),[x,w]=t.useState([]),[y,p]=t.useState({}),[j,N]=t.useState(!1),[v,C]=t.useState([]),[l,_]=t.useState(0),[L,c]=t.useState(""),[b,n]=t.useState(null);t.useEffect(()=>{fetch(`${O}api_tarifas.php`,{credentials:"include"}).then(i=>i.json()).then(i=>{const h=(i.tarifas||[]).filter(u=>(u.servicio_tipo==="procedimiento"||u.servicio_tipo==="procedimientos")&&u.activo===1);d(h)}),fetch(`${O}api_pacientes.php?id=${s}`).then(i=>i.json()).then(i=>{i.success&&i.paciente&&n(i.paciente)}),w([]),p({}),N(!1),c("")},[s]);const o=i=>{w(h=>h.includes(i)?h:[...h,i]),p(h=>({...h,[i]:1}))},m=i=>{w(h=>h.filter(u=>u!==i)),p(h=>{const u={...h};return delete u[i],u})},f=(i,h)=>{p(u=>({...u,[i]:h}))},E=()=>x.reduce((i,h)=>{const u=a.find(T=>T.id===h),M=y[h]||1;return u?i+u.precio_particular*M:i},0),S=()=>{if(x.length===0){c("Selecciona al menos un procedimiento.");return}const i=x.map(h=>{const u=a.find(A=>A.id===h),M=y[h]||1;let T=u&&u.descripcion?u.descripcion:u&&u.nombre?u.nombre:"";return(T===0||T==="0"||T===null||T===void 0)&&(T=u&&u.nombre?u.nombre:""),u?{servicio_tipo:"procedimiento",servicio_id:h,descripcion:T,cantidad:M,precio_unitario:u.precio_particular,subtotal:u.precio_particular*M}:null}).filter(Boolean);C(i),_(E()),N(!0)};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 md:p-8 bg-white rounded-xl shadow-lg mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"🛠️"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Cotización de Procedimientos"})]}),e.jsx("button",{onClick:()=>r("/seleccionar-servicio",{state:{pacienteId:s}}),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",children:"Volver"})]}),e.jsx("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:e.jsxs("div",{className:"text-gray-600",children:[e.jsx("b",{children:"ID Paciente:"})," ",s]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Selecciona los procedimientos:"}),a.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No hay procedimientos para mostrar."}):e.jsx("div",{className:"bg-white rounded-lg shadow border border-gray-200",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:a.map(i=>e.jsxs("li",{className:"flex items-center px-4 py-3 hover:bg-blue-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:x.includes(i.id),onChange:()=>x.includes(i.id)?m(i.id):o(i.id),className:"mr-3 accent-orange-600 w-5 h-5"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"font-semibold text-gray-800",children:i.descripcion||i.nombre})}),e.jsxs("div",{className:"font-bold text-green-700 text-lg",children:["S/ ",i.precio_particular]}),x.includes(i.id)&&e.jsx("input",{type:"number",min:1,value:y[i.id]||1,onChange:h=>f(i.id,Math.max(1,Number(h.target.value))),className:"border rounded-lg px-2 w-16 bg-white ml-2"})]},i.id))})})]})}),e.jsxs("div",{className:"w-full md:w-96 md:sticky md:top-8 h-fit",children:[x.length>0&&!j&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Lista de Cotización"}),e.jsx("ul",{className:"divide-y divide-gray-200 bg-gray-50 rounded-lg shadow p-4 max-h-80 overflow-y-auto",children:x.map(i=>{const h=a.find(M=>M.id===i),u=y[i]||1;return h?e.jsxs("li",{className:"py-2 flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx("div",{children:e.jsx("span",{className:"font-medium text-gray-900",children:h.descripcion||h.nombre})}),e.jsxs("div",{className:"font-bold text-green-700 text-right",children:["S/ ",(h.precio_particular*u).toFixed(2)]})]},i):null})}),e.jsxs("div",{className:"mt-4 text-lg font-bold text-right",children:["Total: ",e.jsxs("span",{className:"text-green-600",children:["S/ ",E().toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 justify-end",children:[e.jsx("button",{onClick:()=>{w([]),c("")},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Limpiar selección"}),e.jsx("button",{onClick:S,className:"bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-700",children:"Cotizar"})]})]}),j&&e.jsx(he,{paciente:b,servicio:{key:"procedimiento",label:"Procedimiento"},detalles:v,total:l,onCobroCompleto:()=>{N(!1),w([]),p({}),c("Cotización procesada correctamente.")},onCancelar:()=>N(!1)})]})]}),L&&e.jsx("div",{className:`mt-6 text-center font-semibold ${L.includes("correctamente")?"text-green-600":"text-red-600"}`,children:L})]})}function ot(){const[s,r]=t.useState(!1),[a,d]=t.useState(null),[x,w]=t.useState([]),[y,p]=t.useState(""),[j,N]=t.useState(""),{pacienteId:v}=xe(),C=ie(),[l,_]=t.useState(null),[L,c]=t.useState(!0),[b,n]=t.useState(""),[o,m]=t.useState(1),[f,E]=t.useState(3);if(t.useEffect(()=>{m(1)},[f,y,j]),t.useEffect(()=>{fetch(`${O}api_consumos_paciente.php?paciente_id=${v}`,{credentials:"include"}).then($=>$.json()).then($=>{$.success?_($):n($.error||"Error al cargar consumo"),c(!1)}).catch(()=>{n("Error de conexión con el servidor"),c(!1)})},[v]),L)return e.jsx(ye,{});if(b)return e.jsx("div",{className:"text-red-600 font-bold p-6",children:b});let S=l.historial;function i($){return $.split(" ")[0]}y&&(S=S.filter($=>i($.fecha)>=y)),j&&(S=S.filter($=>i($.fecha)<=j));const h=S.length,u=Math.max(1,Math.ceil(h/f)),M=(o-1)*f,T=M+f,A=S.slice(M,T),z=()=>{const H=[],g=[];for(let F=Math.max(2,o-2);F<=Math.min(u-1,o+2);F++)H.push(F);return o-2>2?g.push(1,"..."):g.push(1),g.push(...H),o+2<u-1?g.push("...",u):u>1&&g.push(u),g.filter((F,U,Y)=>Y.indexOf(F)===U)};function P(){if(!a||!x)return;const $=new Date(a.fecha).toLocaleString("es-PE"),H=l.apellido?`${l.nombre} ${l.apellido}`:l.nombre,g=a.tipo_pago?a.tipo_pago.toUpperCase():a.detalles&&a.detalles[0]?.tipo_pago?a.detalles[0].tipo_pago.toUpperCase():"EFECTIVO",F=a.cobertura?a.cobertura.toUpperCase():a.detalles&&a.detalles[0]?.cobertura?a.detalles[0].cobertura.toUpperCase():"PARTICULAR",U=`
      <div style="font-family: monospace; width: 320px; margin: 0 auto;">
        <h3 style="text-align: center; margin-bottom: 10px;">🏥 CLÍNICA 2 DE MAYO</h3>
        <hr>
        <p><strong>COMPROBANTE DE PAGO #${a.cobro_id||""}</strong></p>
        <p>Fecha: ${$}</p>
        <p>Paciente: ${H}</p>
        <p>DNI: ${l.dni}</p>
        <p>H.C.: ${l.historia_clinica}</p>
        <hr>
        <p><strong>DETALLE:</strong></p>
        ${x.map(Y=>`<p>${Y.descripcion} x${Y.cantidad||1} .... S/ ${(Y.subtotal||Y.monto).toFixed(2)}</p>`).join("")}
        <hr>
        <p style="font-weight:bold; font-size:17px; color:#008000;">TOTAL: S/ ${x.reduce((Y,k)=>Y+Number(k.subtotal||k.monto),0).toFixed(2)}</p>
        <p>Tipo de pago: ${g}</p>
        <p>Cobertura: ${F}</p>
        <hr>
        <div style="text-align: center; font-size: 12px;">Gracias por su preferencia<br>Conserve este comprobante</div>
      </div>
    `;W.fire({title:"Ticket de Cobro",html:U,icon:"info",confirmButtonText:"Imprimir",showCancelButton:!0,cancelButtonText:"Cerrar"}).then(Y=>{if(Y.isConfirmed){const k=window.open("","_blank","width=400,height=600");k.document.write(`<html><head><title>Ticket</title></head><body>${U}</body></html>`),k.document.close(),k.print()}})}return e.jsxs("div",{className:"max-w-3xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8 font-sans",children:[s&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-lg w-full relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-red-600 text-xl font-bold",onClick:()=>r(!1),children:"×"}),e.jsx("h3",{className:"text-lg font-bold mb-2 text-blue-800",children:"Detalle del Cobro"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Fecha:"})," ",a.fecha,e.jsx("br",{})]}),e.jsxs("table",{className:"min-w-full border rounded mb-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"px-2 py-1 border text-left",children:"Servicio"}),e.jsx("th",{className:"px-2 py-1 border text-left",children:"Descripción"}),e.jsx("th",{className:"px-2 py-1 border text-right",children:"Monto (S/)"})]})}),e.jsx("tbody",{children:x.map(($,H)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:$.servicio_tipo||a.servicio}),e.jsx("td",{className:"border px-2 py-1",children:$.descripcion&&$.descripcion!=="0"?$.descripcion:e.jsx("span",{className:"italic text-gray-500",children:"Sin detalle"})}),e.jsx("td",{className:"border px-2 py-1 text-right",children:Number($.subtotal||$.monto).toFixed(2)})]},H))})]}),e.jsxs("div",{className:"font-bold text-right text-green-700 text-lg mb-4",children:["Total: S/ ",x.reduce(($,H)=>$+Number(H.subtotal||H.monto),0).toFixed(2)]}),e.jsx("button",{className:"w-full py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded shadow",onClick:P,children:"Imprimir ticket"})]})}),e.jsx("button",{onClick:()=>C(-1),className:"mb-4 bg-gradient-to-r from-blue-200 to-purple-200 px-4 py-2 rounded hover:bg-blue-300 flex items-center gap-2 text-blue-900 font-semibold",children:"← Volver"}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Re,{className:"text-3xl text-blue-700"}),e.jsx("h2",{className:"text-2xl font-bold text-blue-800",children:"Consumo del Paciente"})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-2 gap-4 bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"ID:"})," ",l.paciente_id," ",e.jsx("br",{}),e.jsx("span",{className:"font-semibold text-gray-700",children:"Nombre:"})," ",l.nombre," ",l.apellido," ",e.jsx("br",{}),e.jsx("span",{className:"font-semibold text-gray-700",children:"DNI:"})," ",l.dni]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Historia Clínica:"})," ",l.historia_clinica," ",e.jsx("br",{}),e.jsxs("span",{className:"inline-flex items-center gap-2 font-bold text-green-700 text-lg mt-2",children:[e.jsx(_e,{className:"text-2xl"}),"Consumo Total: S/ ",l.consumo_total.toFixed(2)]}),l.deuda_total>0&&e.jsxs("span",{className:"inline-flex items-center gap-2 font-bold text-red-600 text-lg mt-2 ml-4",children:[e.jsx(_e,{className:"text-2xl"}),"Deuda: S/ ",l.deuda_total.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-8 mb-2",children:[e.jsx(He,{className:"text-xl text-purple-700"}),e.jsx("h4",{className:"font-semibold text-lg text-purple-800",children:"Historial de Servicios"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"fechaInicio",className:"font-semibold text-gray-700",children:"Desde:"}),e.jsx("input",{type:"date",id:"fechaInicio",value:y,onChange:$=>p($.target.value),className:"border rounded px-2 py-1 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"fechaFin",className:"font-semibold text-gray-700",children:"Hasta:"}),e.jsx("input",{type:"date",id:"fechaFin",value:j,onChange:$=>N($.target.value),className:"border rounded px-2 py-1 text-sm"})]}),e.jsx("button",{onClick:()=>{p(""),N("")},className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 font-semibold",children:"Limpiar Filtros"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border rounded-lg shadow-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-purple-100",children:[e.jsx("th",{className:"px-3 py-2 border text-left",children:"Fecha"}),e.jsx("th",{className:"px-3 py-2 border text-left",children:"Servicio"}),e.jsx("th",{className:"px-3 py-2 border text-left",children:"Descripción"}),e.jsx("th",{className:"px-3 py-2 border text-right",children:"Monto (S/)"})]})}),e.jsx("tbody",{children:S.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-6 text-gray-500",children:l.historial.length===0?"No hay servicios registrados.":"No se encontraron servicios en el rango de fechas seleccionado."})}):A.map(($,H)=>e.jsxs("tr",{className:H%2===0?"bg-white":"bg-blue-50",children:[e.jsx("td",{className:"border px-3 py-2",children:$.fecha}),e.jsx("td",{className:"border px-3 py-2",children:e.jsxs("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold ${$.servicio==="consulta"?"bg-green-100 text-green-700":$.servicio==="laboratorio"?"bg-yellow-100 text-yellow-700":$.servicio==="farmacia"?"bg-purple-100 text-purple-700":$.servicio==="procedimiento"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:[$.servicio,$.servicio==="laboratorio"&&$.resultados_laboratorio&&e.jsx("button",{className:"ml-2 text-purple-700 hover:text-purple-900",title:"Descargar resultados",onClick:()=>window.open($.resultados_laboratorio,"_blank"),children:e.jsx("span",{role:"img","aria-label":"descargar",children:"📥"})})]})}),e.jsx("td",{className:"border px-3 py-2",children:e.jsx("button",{className:"px-3 py-1 bg-blue-100 hover:bg-blue-200 rounded text-blue-900 font-semibold text-xs shadow",onClick:()=>{d($),w($.detalles),r(!0)},children:"Ver detalle"})}),e.jsx("td",{className:"border px-3 py-2 text-right font-semibold text-green-700",children:Number($.monto).toFixed(2)})]},H))})]})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:["Mostrando ",h===0?0:M+1," - ",Math.min(T,h)," de ",h," servicios"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"font-semibold",children:"Filas:"}),e.jsxs("select",{id:"itemsPerPage",value:f,onChange:$=>E(Number($.target.value)),className:"border rounded px-2 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]})]}),h>0&&e.jsxs("span",{className:"text-blue-600 font-medium",children:["Total de servicios: S/ ",S.reduce(($,H)=>$+Number(H.monto),0).toFixed(2)]})]}),u>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${o===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>m(1),disabled:o===1,title:"Primera página",children:"«"}),e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${o===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>m(o-1),disabled:o===1,children:"‹ Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:z().map(($,H)=>e.jsx(be.Fragment,{children:$==="..."?e.jsx("span",{className:"px-3 py-2 text-gray-500",children:"..."}):e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${o===$?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>m($),children:$})},H))}),e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${o===u?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>m(o+1),disabled:o===u,children:"Siguiente ›"}),e.jsx("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${o===u?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,onClick:()=>m(u),disabled:o===u,title:"Última página",children:"»"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Ir a página:"}),e.jsx("input",{type:"number",min:"1",max:u,value:o,onChange:$=>{const H=parseInt($.target.value);H>=1&&H<=u&&m(H)},className:"w-16 px-2 py-1 border rounded text-center focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsxs("span",{className:"text-gray-600",children:["de ",u]})]})]})]})]})}function ct(){const[s,r]=t.useState([]),[a,d]=t.useState(!0),[x,w]=t.useState(null),[y,p]=t.useState([]),[j,N]=t.useState(!1),[v,C]=t.useState(""),[l,_]=t.useState(""),[L,c]=t.useState(1),[b,n]=t.useState(3),[o,m]=t.useState(0),f=()=>{d(!0);let h=`${O}api_cobros.php`;const u=[`page=${L}`,`limit=${b}`,"servicio=farmacia"];let M=v,T=l;(M&&!T||!M&&T)&&(M=M||T,T=T||M),M&&T&&(u.push(`fecha_inicio=${M}`),u.push(`fecha_fin=${T}`)),h+="?"+u.join("&"),fetch(h,{credentials:"include"}).then(A=>{if(!A.ok)throw new Error(`Error HTTP: ${A.status}`);return A.json()}).then(A=>{r(A.cobros||[]),m(A.total||0),d(!1)}).catch(A=>{d(!1),console.error("Error al cargar ventas:",A),alert("Error al cargar ventas: "+A.message)})};t.useEffect(()=>{f()},[v,l,L,b]);const E=h=>{w(h),N(!0),fetch(`${O}api_cobros.php?cobro_id=${h.id}`,{credentials:"include"}).then(u=>u.json()).then(u=>{if(u.success&&u.cobro){const M=u.cobro.detalles||[];let T=[];M.forEach(A=>{if(A.servicio_tipo==="farmacia")try{T=JSON.parse(A.descripcion)}catch{T.push({descripcion:A.descripcion,cantidad:A.cantidad,precio_unitario:A.precio_unitario,subtotal:A.subtotal})}}),p(T)}})},S=()=>{const h=new je;h.text("Ventas de Farmacia",14,14),Ne(h,{head:[["Fecha","Paciente","DNI","Usuario","Total","Estado"]],body:s.map(u=>[new Date(u.fecha_cobro).toLocaleDateString(),u.nombre?`${u.nombre} ${u.apellido||""}`.trim():"-",u.dni||"-",u.usuario_nombre||u.usuario_id,`S/ ${parseFloat(u.total).toFixed(2)}`,u.estado])}),h.save("ventas_farmacia.pdf")},i=()=>{const h=de.json_to_sheet(s.map(M=>({Fecha:new Date(M.fecha_cobro).toLocaleDateString(),Paciente:M.nombre?`${M.nombre} ${M.apellido||""}`.trim():"-",DNI:M.dni||"-",Usuario:M.usuario_nombre||M.usuario_id,Total:parseFloat(M.total).toFixed(2),Estado:M.estado}))),u=de.book_new();de.book_append_sheet(u,h,"Ventas"),Ie(u,"ventas_farmacia.xlsx")};return e.jsxs("div",{className:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-800 mb-4",children:"Ventas de Farmacia"}),e.jsxs("div",{className:"flex gap-4 mb-4 items-center",children:[e.jsxs("label",{className:"text-sm",children:["Mostrar:",e.jsxs("select",{value:b,onChange:h=>{n(Number(h.target.value)),c(1)},className:"ml-2 border rounded px-2 py-1",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]}),e.jsx("button",{className:"px-3 py-1 bg-green-600 text-white rounded",onClick:S,children:"Exportar PDF"}),e.jsx("button",{className:"px-3 py-1 bg-amber-500 text-white rounded",onClick:i,children:"Exportar Excel"}),e.jsxs("label",{className:"text-sm",children:["Desde:",e.jsx("input",{type:"date",value:v,onChange:h=>C(h.target.value),className:"ml-2 border rounded px-2 py-1"})]}),e.jsxs("label",{className:"text-sm",children:["Hasta:",e.jsx("input",{type:"date",value:l,onChange:h=>_(h.target.value),className:"ml-2 border rounded px-2 py-1"})]}),e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded",onClick:f,children:"Filtrar"}),(v||l)&&e.jsx("button",{className:"px-2 py-1 bg-gray-200 text-gray-700 rounded",onClick:()=>{C(""),_("")},children:"Limpiar"})]}),a?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Cargando ventas..."}):s.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No hay ventas registradas."}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full text-sm border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-50",children:[e.jsx("th",{className:"p-2",children:"Fecha"}),e.jsx("th",{className:"p-2",children:"Paciente"}),e.jsx("th",{className:"p-2",children:"DNI"}),e.jsx("th",{className:"p-2",children:"Usuario"}),e.jsx("th",{className:"p-2",children:"Total"}),e.jsx("th",{className:"p-2",children:"Estado"}),e.jsx("th",{className:"p-2",children:"Detalle"})]})}),e.jsx("tbody",{children:s.map(h=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:new Date(h.fecha_cobro).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:h.nombre?`${h.nombre} ${h.apellido||""}`.trim():"-"}),e.jsx("td",{className:"p-2",children:h.dni||"-"}),e.jsx("td",{className:"p-2",children:h.usuario_nombre||h.usuario_id}),e.jsxs("td",{className:"p-2 font-bold text-blue-700",children:["S/ ",parseFloat(h.total).toFixed(2)]}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${h.estado==="pagado"?"bg-green-100 text-green-800":h.estado==="anulado"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:h.estado})}),e.jsx("td",{className:"p-2",children:e.jsx("button",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200",onClick:()=>E(h),children:"Ver"})})]},h.id))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("span",{className:"text-sm",children:["Página ",L," de ",Math.max(1,Math.ceil(o/b))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded",disabled:L===1,onClick:()=>c(L-1),children:"Anterior"}),e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded",disabled:L>=Math.ceil(o/b),onClick:()=>c(L+1),children:"Siguiente"})]})]})]}),j&&x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 text-xl",onClick:()=>N(!1),children:"✕"}),e.jsx("h3",{className:"text-xl font-bold mb-2 text-blue-700",children:"Detalle de Venta"}),e.jsxs("div",{className:"mb-2 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Paciente:"})," ",x.nombre?`${x.nombre} ${x.apellido||""}`.trim():"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",x.dni||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Usuario:"})," ",x.usuario_nombre||x.usuario_id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Fecha:"})," ",new Date(x.fecha_cobro).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("b",{children:"Total:"})," S/ ",parseFloat(x.total).toFixed(2)]}),e.jsxs("div",{children:[e.jsx("b",{children:"Tipo de Pago:"})," ",x.tipo_pago]})]}),e.jsxs("table",{className:"w-full text-sm border mb-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-50",children:[e.jsx("th",{className:"p-2",children:"Medicamento"}),e.jsx("th",{className:"p-2",children:"Cantidad"}),e.jsx("th",{className:"p-2",children:"Precio Unitario"}),e.jsx("th",{className:"p-2",children:"Subtotal"})]})}),e.jsx("tbody",{children:y.map(h=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:h.descripcion}),e.jsx("td",{className:"p-2",children:h.cantidad}),e.jsxs("td",{className:"p-2",children:["S/ ",h.precio_unitario]}),e.jsxs("td",{className:"p-2",children:["S/ ",h.subtotal]})]},h.id))})]})]})})]})}function dt(){const s=fe(),r=ie(),[a,d]=t.useState(null),x=s.state?.pacienteId,[w,y]=t.useState([]);return t.useEffect(()=>{fetch(O+"api_tarifas.php",{credentials:"include"}).then(p=>p.json()).then(p=>{if(p.success&&Array.isArray(p.tarifas)){const j=["consulta","laboratorio","farmacia","ecografia","rayosx","ocupacional"],N=p.tarifas.filter(v=>v.activo===1&&!j.includes(v.servicio_tipo)).map(v=>({key:v.servicio_tipo+"_"+v.id,label:v.descripcion,tarifaId:v.id}));y(N)}})},[]),t.useEffect(()=>{x&&fetch(`${O}api_pacientes.php?id=${x}`).then(p=>p.json()).then(p=>{p.success&&p.paciente?d(p.paciente):d(null)})},[x]),e.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-blue-400 rounded-t-xl p-4 mb-0",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"🗂️"})," Atención en Recepción"]}),e.jsx("p",{className:"text-white text-sm",children:"Gestión de pacientes y servicios"})]}),e.jsxs("div",{className:"bg-white rounded-b-xl shadow p-4",children:[e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded font-bold hover:bg-blue-600 mb-4",onClick:()=>r("/"),children:"Volver al Dashboard"}),a?e.jsxs("div",{className:"bg-blue-50 rounded p-4 mb-4",children:[e.jsx("div",{className:"font-bold text-blue-800 mb-2",children:"Paciente encontrado:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Nombre:"})," ",a.nombre]}),e.jsxs("div",{children:[e.jsx("b",{children:"Apellido:"})," ",a.apellido]}),e.jsxs("div",{children:[e.jsx("b",{children:"DNI:"})," ",a.dni]}),e.jsxs("div",{children:[e.jsx("b",{children:"Fecha de nacimiento:"})," ",a.fecha_nacimiento]}),e.jsxs("div",{children:[e.jsx("b",{children:"Sexo:"})," ",a.sexo]}),e.jsxs("div",{children:[e.jsx("b",{children:"Dirección:"})," ",a.direccion]}),e.jsxs("div",{children:[e.jsx("b",{children:"Teléfono:"})," ",a.telefono]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",a.email]}),e.jsxs("div",{children:[e.jsx("b",{children:"Tipo de seguro:"})," ",a.tipo_seguro]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Historia Clínica:"})," ",a.historia_clinica]}),e.jsxs("div",{children:[e.jsx("b",{children:"Edad:"})," ",a.edad?a.edad+" años":a.fecha_nacimiento?(()=>{const p=new Date(a.fecha_nacimiento);return isNaN(p)?"Edad no disponible":Math.floor((new Date-p)/(365.25*24*60*60*1e3))+" años"})():"Edad no disponible"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Procedencia:"})," ",a.procedencia]})]})]})]}):e.jsx("div",{className:"text-center text-gray-500 mb-4",children:"Busca un paciente por DNI para mostrar los servicios."}),a&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-2",children:[e.jsxs("div",{className:"font-semibold text-blue-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"🔽"})," Seleccionar Servicio para: ",e.jsxs("span",{className:"text-black",children:[a.nombre," ",a.apellido]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-100 font-bold",onClick:()=>r("/agendar-consulta",{state:{pacienteId:a.id}}),children:"👨‍⚕️ Consulta Médica"}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-green-100 font-bold",onClick:()=>r(`/cotizar-laboratorio/${a.id}`),children:["🧪 Laboratorio ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-purple-100 font-bold",onClick:()=>r(`/cotizar-farmacia/${a.id}`),children:["💊 Farmacia ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-50 font-bold",onClick:()=>r(`/cotizar-rayosx/${a.id}`),children:["🩻 Rayos X ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-50 font-bold",onClick:()=>r(`/cotizar-ecografia/${a.id}`),children:["🩺 Ecografías ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-orange-100 font-bold",onClick:()=>r(`/cotizar-procedimientos/${a.id}`),children:["🛠️ Procedimientos ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]}),e.jsxs("button",{className:"flex items-center gap-2 justify-center border rounded-lg py-3 px-2 bg-white hover:bg-blue-50 font-bold",onClick:()=>{W.fire({title:"Página en construcción",text:"La funcionalidad de Medicina Ocupacional estará disponible próximamente.",icon:"info",confirmButtonText:"OK"})},children:["👨‍⚕️ Medicina Ocupacional ",e.jsx("span",{className:"text-yellow-500",children:"💰"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 flex gap-4 items-center",children:[e.jsx("span",{children:"💰 = Requiere pago previo"}),e.jsx("span",{children:"📅 = Agendar primero, cobrar después"})]})]})]})]})})}function xt(){const[s,r]=t.useState(()=>{const d=sessionStorage.getItem("usuario"),x=sessionStorage.getItem("medico");return d?JSON.parse(d):x?JSON.parse(x):null}),a=async()=>{try{await fetch("/policlinico-2demayo/api_logout.php",{method:"POST",credentials:"include"})}catch(d){console.error("Error al cerrar sesión en el backend:",d)}r(null),sessionStorage.removeItem("usuario"),sessionStorage.removeItem("medico"),window.location.href="/"};return t.useEffect(()=>{s&&(s.rol==="medico"?(sessionStorage.setItem("medico",JSON.stringify(s)),sessionStorage.removeItem("usuario")):(sessionStorage.setItem("usuario",JSON.stringify(s)),sessionStorage.removeItem("medico")))},[s]),e.jsx(Ve,{children:s?e.jsx(es,{usuario:s,onLogout:a,children:e.jsxs(We,{children:[e.jsx(Q,{path:"/",element:s?.rol==="medico"?e.jsx(ue,{to:"/mis-consultas",replace:!0}):s?.rol==="laboratorista"?e.jsx(ue,{to:"/panel-laboratorio",replace:!0}):s?.rol==="enfermero"?e.jsx(ue,{to:"/panel-enfermero",replace:!0}):s?.rol==="químico"||s?.rol==="quimico"?e.jsx(ue,{to:"/medicamentos",replace:!0}):e.jsx(is,{usuario:s})}),e.jsx(Q,{path:"/pacientes",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(ls,{})})}),e.jsx(Q,{path:"/usuarios",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(os,{})})}),e.jsx(Q,{path:"/agendar-consulta",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(xs,{})})}),s?.rol==="medico"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{path:"/mis-consultas",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(hs,{usuario:s})})}),e.jsx(Q,{path:"/panel-medico",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(ws,{})})}),e.jsx(Q,{path:"/historia-clinica/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Ee,{})})}),e.jsx(Q,{path:"/historia-clinica/:pacienteId/:consultaId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Ee,{})})}),e.jsx(Q,{path:"/historial-consultas",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(zs,{medicoId:s.id})})}),e.jsx(Q,{path:"/solicitud-laboratorio/:consultaId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Ws,{})})}),e.jsx(Q,{path:"/resultados-laboratorio/:consultaId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["medico"],children:e.jsx(Ys,{})})})]}),(s?.rol==="químico"||s?.rol==="quimico")&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{path:"/medicamentos",element:e.jsx(Z,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(Le,{})})}),e.jsx(Q,{path:"/farmacia/cotizador",element:e.jsx(Z,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(ge,{})})}),e.jsx(Q,{path:"/farmacia/ventas",element:e.jsx(Z,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(ct,{})})})]}),s?.rol==="enfermero"&&e.jsx(Q,{path:"/panel-enfermero",element:e.jsx(Z,{usuario:s,rolesPermitidos:["enfermero"],children:e.jsx(Hs,{})})}),(s?.rol==="administrador"||s?.rol==="recepcionista")&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{path:"/medicos",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(Ns,{})})}),e.jsx(Q,{path:"/reportes",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Qs,{})})}),e.jsx(Q,{path:"/lista-consultas",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Zs,{})})}),e.jsx(Q,{path:"/reporte-pacientes",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(et,{})})}),e.jsx(Q,{path:"/reporte-finanzas",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(st,{})})}),e.jsx(Q,{path:"/configuracion",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(tt,{})})}),e.jsx(Q,{path:"/gestion-tarifas",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador"],children:e.jsx(at,{})})}),e.jsx(Q,{path:"/cotizar-laboratorio/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(qs,{})})}),e.jsx(Q,{path:"/cotizar-rayosx/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Us,{})})}),e.jsx(Q,{path:"/cotizar-ecografia/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(Gs,{})})}),e.jsx(Q,{path:"/cotizar-farmacia/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(ge,{})})}),e.jsx(Q,{path:"/cotizar-procedimientos/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(lt,{})})}),e.jsx(Q,{path:"/seleccionar-servicio",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(dt,{})})}),e.jsx(Q,{path:"/consumo-paciente/:pacienteId",element:e.jsx(Z,{usuario:s,rolesPermitidos:["administrador","recepcionista"],children:e.jsx(ot,{})})})]}),s?.rol==="laboratorista"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{path:"/panel-laboratorio",element:e.jsx(Z,{usuario:s,rolesPermitidos:["laboratorista"],children:e.jsx(Ks,{})})}),e.jsx(Q,{path:"/examenes-laboratorio",element:e.jsx(Z,{usuario:s,rolesPermitidos:["laboratorista"],children:e.jsx(Ue,{})})})]}),(s?.rol==="químico"||s?.rol==="quimico")&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{path:"/medicamentos",element:e.jsx(Z,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(Le,{})})}),e.jsx(Q,{path:"/farmacia/cotizador",element:e.jsx(Z,{usuario:s,rolesPermitidos:["químico","quimico"],children:e.jsx(ge,{})})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-800 via-blue-500 to-green-400",children:e.jsx(Ke,{onLogin:r})})})}class mt extends be.Component{constructor(r){super(r),this.state={hasError:!1}}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,a){console.error("Error capturado por ErrorBoundary:",r,a)}render(){return this.state.hasError?e.jsxs("div",{className:"max-w-md mx-auto mt-6 p-4 bg-red-100 text-red-700 rounded shadow text-center",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"¡Ups! Algo salió mal."}),e.jsx("p",{children:"Por favor, recarga la página o intenta más tarde."})]}):this.props.children}}qe.createRoot(document.getElementById("root")).render(e.jsx(be.StrictMode,{children:e.jsx(mt,{children:e.jsx(xt,{})})}));
